<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OUTIL DE CALCUL SPHERE FICTIVE </title>

    <style>

       body {
            
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #cec9c9; /* Set background color to light gray */
            overflow: hidden; /* Prevent scrolling */
        } 
 
        .container {
 

            border: 0px solid #f1eded;
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden; /* Prevent scrolling */
            
        }

        #sceneContainer {
            flex: 1; /* Take the remaining space */
            width: 83vw;
            height: 91.5vh;
            background-color: #ffffff; /* Set background color to light gray */
            overflow: hidden; /* Ensure no overflow */
            float: right;
            display: flex; /* Flexbox to center content */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            border: 1px solid #ffffff;
            border-radius:10px;
        }

        #item-list {
            list-style-type: none;
            padding: 10px;
            margin: 5px;
            margin-left: 10px; /* Ajouter une marge à gauche */
            width: 16%;
            margin-top: 5px; /* Add some margin at the top for spacing */
            max-height: 150px; /* Maximum height of the container */
            overflow: auto; /* Enable vertical scroll if content overflows */
            background-color: #dddddd; /* Set background color to light gray */
            border: 1px solid #ffffff;
            border-radius:10px;
            
        }

        #label-list {
        margin-top: 10px; /* Espace entre item-list et label-list */
        bottom: 0;
        left: 5px;
        margin-top: 5px; /* Add some margin at the top for spacing */
        margin-left: 10px; /* Ajouter une marge à gauche */

        width: 16%;
        padding: 10px;   
        max-height: auto; /* Maximum height of the container */
        overflow: auto; /* Enable vertical scroll if content overflows */
        background-color: #dddddd; /* Set background color to light gray */
        border: 1px solid #ffffff;
        border-radius:10px;
        }



.label-list label {
    width: 500px; /* Set a fixed width for labels */
    margin-right: 10px; /* Add margin between label and input */
}

.label-list input[type="number"] {
    width: 100%; /* Set the width to 100% to fill the container */
    box-sizing: border-box; /* Include padding and border in the width */
    margin-top: 5px; /* Add some margin at the top for spacing */

    /*flex: 1; /* Fill remaining space in the container */
}


        


#label-input-container {
    max-width: 28%; /* Adjust the maximum width as needed */
    margin-left: 10px; /* Add 20px margin from the left */
    
}


        #buttons {
            margin: 0px;
            position:relative
           
        }


        button:hover {
            opacity: 0.5; /* Réduit l'opacité lors du survol */
            

        }

        .highlighted-overlay {
    position: absolute; /* Position the overlay relative to the button */
    top: 0;
    left: 0;
    width: 40px; /* Adjust the width and height to match the button */
    height: 40px;
    background-color: rgba(213, 216, 47,0.3); /* Semi-transparent yellow overlay */
    pointer-events: none; /* Allow clicks to pass through the overlay to the button */
    border-radius: inherit; /* Match button border-radius */
    display: none; /* Initially hidden */
}


    .item {
        background-color: #9797978e;
        padding: 5px;
        margin-bottom: 5px;
        border-radius: 15px;
        cursor: pointer;
        text-align: center;
    }

    .item:hover {
    background-color: #8c8d8c;
    }


    /* Style the labels */
    .label-list {
    list-style-type: none;
    padding: 0;
    margin: 20px;
    color: white
    }

    
    .label {

        color:white
    }

    

    .label-list select {
    list-style-type: none;
    padding: 0;
    margin: 20px;
    color: white
    }


    .selected {

        background-color: #d5d82f;
    }


    .custom-button {
            background-size: cover;
            background-position: center;
            width: 34px;
            height: 34px;
            border: 1x solid #000;
            cursor: pointer;
    }


    .custom-button-1 {
            background-image: url("photos/nouveau_fichier.jpg");

        }

        .custom-button-37 {
            background-image: url("photos/open_file_arf.jpg");

        }

    .custom-button-38 {
            background-image: url("photos/save_as.jpg");

        }

        .custom-button-39 {
            background-image: url("photos/import_file.jpg");

        }

        .custom-button-2 {
            background-image: url("photos/save.jpg");

        }

        .custom-button-41 {
            background-image: url("photos/print_definitions.jpg");

        }

        .custom-button-3 {
            background-image: url("photos/previous.jpg");

        }

        .custom-button-3.disabled {
            background-image: url("photos/previous_disabled.jpg");
  
        }

        .custom-button-3.enabled {
            background-image: url("photos/previous.jpg");
  
        }

        .custom-button-4 {
            background-image: url("photos/next.jpg");

        }

        .custom-button-4.disabled {
            background-image: url("photos/next_disabled.jpg");

        }

        .custom-button-4.enabled {
            background-image: url("photos/next.jpg");

        }
        .custom-button-5 {
            background-image: url("photos/cube.jpg");

        }

        /* Style for highlighted button */
        .custom-button.highlighted + .highlighted-overlay {
          display: block; /* Show the overlay when button has 'highlighted' class */
        }

 
        .custom-button-6 {
            background-image: url("photos/cube_faitage.jpg");

        }


        .custom-button-7 {
            background-image: url("photos/cylindre.jpg");

        }
 
        .custom-button-40 {
            background-image: url("photos/cylindreh.jpg");
  
        }
 
        .custom-button-8 {
            background-image: url("photos/toit_cylindrique.jpg");

        }
 

        .custom-button-9 {
            background-image: url("photos/cone.jpg");
 
        }
  
        .custom-button-10 {
            background-image: url("photos/sphere.jpg");
 
        }
  

        .custom-button-11 {
            background-image: url("photos/toit_spherique.jpg");

        }
  
        .custom-button-12 {
            background-image: url("photos/cable_aerien.jpg");

        }
 

        .custom-button-13 {
            background-image: url("photos/pda.jpg");

        }
  

        .custom-button-14 {
            background-image: url("photos/pts.jpg");

        }
 

        .custom-button-15 {
            background-image: url("photos/delete.jpg");
  
        }

        .custom-button-16 {
            background-image: url("photos/run_t.jpg");

        }
        

        .custom-button-16.enabled {
            background-image: url("photos/run_t.jpg");

        }

        .custom-button-16.disabled {
            background-image: url("photos/run_ttt.jpg"); /* Set the background image for disabled button */
            cursor: pointer; /* Change cursor to not-allowed when button is disabled */
        }


        .custom-button-17 {
            background-image: url("photos/results.jpg");

            
        }
        

        .custom-button-17.enabled {
            background-image: url("photos/results_p.jpg");

            
        }

        .custom-button-17.disabled {
            background-image: url("photos/results_n.jpg");

            
        }
 
        .custom-button-18 {
            background-image: url("photos/ruler_2.jpg");

        }

        .custom-button-18.enabled {
            background-image: url("photos/ruler_2.jpg");

        }

        .custom-button-18.disabled {
            background-image: url("photos/ruler_2.jpg");
  
        }

        .custom-button-19 {
            background-image: url("photos/drag_xy.jpg");

        }

        .custom-button-19.enabled {
            background-image: url("photos/drag_xy.jpg");


        } 

        .custom-button-19.disabled {
            background-image: url("photos/drag_xy.jpg");

        }


        .custom-button-20 {
            background-image: url("photos/drag_z.jpg");

        }

        .custom-button-20.enabled {
            background-image: url("photos/drag_z.jpg");


        } 

        .custom-button-20.disabled {
            background-image: url("photos/drag_z.jpg");

        }

        .custom-button-21 {
            background-image: url("photos/duplicate.jpg");

        }

        .custom-button-36 {
            background-image: url("photos/cut.jpg");

        }

        .custom-button-22 {
            background-image: url("photos/isometric_view_2.jpg");
  
        }


        .custom-button-23 {
            background-image: url("photos/top_2.jpg");

        }

        .custom-button-24 {
            background-image: url("photos/front_2.jpg");
 
        }

        .custom-button-25 {
            background-image: url("photos/back_2.jpg");

        }

        .custom-button-26 {
            background-image: url("photos/left_2.jpg");
  
        }

        .custom-button-27 {
            background-image: url("photos/right_2.jpg");

        }

        .custom-button-28 {
            background-image: url("photos/orthogonal.jpg");

        }


        .custom-button-29 {
            background-image: url("photos/selection.jpg");

        }

        .custom-button-29.enabled {
            background-image: url("photos/selection.jpg");

        }

        .custom-button-29.disabled {
            background-image: url("photos/selection.jpg");

        }


        .custom-button-30 {
            background-image: url("photos/zoom_in.jpg");

        }

        .custom-button-31 {
            background-image: url("photos/zoom_out.jpg");

        }

        .custom-button-32 {
            background-image: url("photos/translation.jpg");

        }

        .custom-button-33 {
            background-image: url("photos/reset.jpg");

        }

        .custom-button-34 {
            background-image: url("photos/run-2.jpg");

        }    

        .custom-button-34.enabled {
            background-image: url("photos/run-2.jpg");

        }   

        .custom-button-34.disabled {
            background-image: url("photos/run_disable.jpg");

        }   

        .custom-button-35 {
            background-image: url("photos/animation.jpg");

        }

        .custom-button-42 {
            background-image: url("photos/settings.jpg");

        }

        .custom-button-43 {
            background-image: url("photos/form.jpg");

        }



        .error-message {
            color: red;
            display: inline; /* Display inline to be next to input */
            margin-left: 10px; /* Adjust spacing as needed */
            font-size: 0.8em; /* Specify size of error message text */
        }

        .exclamation {
            position: relative;
            right: 0px;
            top: 50%;

            color: red; /* Color of the exclamation icon */
        }

        .tooltip {
            position: absolute;
            background-color: #ffffff;
            color: rgb(255, 0, 0);
            padding: 5px;
            border-radius: 5px;
            display: none; /* Initially hidden */
            font-size: 14px; /* Set the size of the tooltip text */
        }

        #button-container {
                    list-style-type: none;
                    padding: 10px;
                    margin: 5px;
                    margin-left: 10px; /* Ajouter une marge à gauche */
                    width: auto;
                    margin-top: 5px; /* Add some margin at the top for spacing */
                    max-height: 50px; /* Maximum height of the container */
                    overflow: auto; /* Enable vertical scroll if content overflows */
                    background-color: #dddddd; /* Set background color to light gray */
                    border: 1px solid #ffffff;
                    border-radius:10px;
                    
        }

        
        #data-container {

            padding: 10px;
            margin: 5px;
            margin-left: 10px; /* Ajouter une marge à gauche */
            width: 16%;
            margin-top: 5px; /* Add some margin at the top for spacing */
            max-height: 100px; /* Maximum height of the container */
            overflow: auto; /* Enable vertical scroll if content overflows */
            background-color: #dddddd; /* Set background color to light gray */
            border: 1px solid #ffffff;
            border-radius:10px;

            
        }

            #data-container-settings {

            padding: 10px;

            width: 100%;
            margin-top: 5px; /* Add some margin at the top for spacing */
            max-height: 200px; /* Maximum height of the container */
            overflow: none; /* Enable vertical scroll if content overflows */
            background-color: #dddddd; /* Set background color to light gray */
            border: 1px solid #ffffff;
            border-radius:10px;
            display: flex;
            justify-content: space-between; /* Aligns label to the left and input to the right */
            align-items: center; /* Vertically centers both label and input */
               
            
        }

        #data-container-settings-button {

            padding: 10px;

            width: 100%;
            margin-top: 5px; /* Add some margin at the top for spacing */
            max-height: 200px; /* Maximum height of the container */
            overflow: none; /* Enable vertical scroll if content overflows */
            background-color: #dddddd; /* Set background color to light gray */
            border: 1px solid #ffffff;
            border-radius:10px;
            display: flex;
            justify-content: center; /* Aligns label to the left and input to the right */
            align-items: center; /* Vertically centers both label and input */
        

        }

        .general-data-input {

            width:250px;
            height:20px;
            padding:0px;
            font-Size: 14px;
            color:blue;
            border:1px solid #dddddd;
            background-Color:cornsilk;

        }

        .general-data-input-settings {

            width:300px;
            height:20px;
            padding:0px;
            font-Size: 14px;
            color:blue;
            border:1px solid #dddddd;
            background-Color:cornsilk;

        }

        .label_input_field {
            font-size:16px;
            overflow: hidden;

        }

        .select_field {

            background-color: cornsilk;
            color:blue;
            width:245px;
            font-size:14px;
            border: 1px solid #ccc; /* Thin border */

        }

        .select_field_o {

            background-color: rgba(221, 247, 225, 0.774);
            color:blue;
            width:245px;
            border: 1px solid #ccc; /* Thin border */

        }

        .popup_settings {
            position: fixed;
            top: 60px;
            right: 0;

            background-color: rgb(201, 201, 201);
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            width: 400px; /* Set the width of the popup */
            height: auto; /* Set the height of the popup */
            display: none;
            box-sizing: border-box; /* Include padding in width and height */
            overflow: none; /* Add scroll if content overflows */

            align-items: center;

            
        }

        .popup_form {
            position: fixed;
            top: 60px;
            left: 0;

            background-color: rgb(201, 201, 201);
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            width: 500px; /* Set the width of the popup */
            height: auto; /* Set the height of the popup */
            display: none;
            box-sizing: border-box; /* Include padding in width and height */
            overflow: none; /* Add scroll if content overflows */

            align-items: center;

            
        }

        /* Styles for the title */
        .popup-title {
            margin: -20px -20px 20px;
            padding: 10px 20px;
            background-color:#000000;
            color: white;
            font-size: 15px;
            text-align: left;

        }

    .overlay {
            position: fixed;
            top: 5%;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255,0); /* Fully transparent */
            display: none;
            z-index: 999;
    }

    .button_exposition {

            padding: 10px 20px;
            background-color: #000000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;


        }

    .button_exposition:hover {
            background-color: #7f7f7f;
    }

    .color-picker-container {
    display: flex;
    justify-content: space-between; /* Pushes the label to the left and the input to the right */
    align-items: center; /* Vertically aligns both the label and the input */
    width: 100%; /* Ensure the container takes the full width of its parent */
}

.color-picker-container label {
    margin-right: 10px; /* Optional: Add some space between the label and input */
}

.custom-icon {
    font-size: 10px; /* Taille réduite de l'icône */
}
 


    </style>

</head>
<body>
   

    <div id="button-container">
        
            <!-- Buttons will be added here -->
            <button class="custom-button custom-button-43"  title="Données générales" id="form"> </button> 
            <button class="custom-button custom-button-1" title="Nouveau fichier" onclick="new_file()"> </button>
            <button class="custom-button custom-button-37" title="Ouvrir un fichier" id="openShapesButton"> </button>
            <button class="custom-button custom-button-39" title="Importer un fichier" id="ImportShapesButton"> </button>
            <input type="file" id="openShapes" style="display: none;">
            <input type="file" id="ImportShapes" style="display: none;">
            <button class="custom-button custom-button-2" title="Enregistrer" id="save" onclick="save()"> </button>
            <button class="custom-button custom-button-38" title="Enregistrer sous" id="save_as" onclick="save_as()"> </button>
            <button class="custom-button custom-button-41" title="Afficher les résultats" onclick="print_results()"> </button>
            <button class="custom-button custom-button-3" title="précédent" id="previous" onclick="previous()"> </button>
            <button class="custom-button custom-button-4" title="suivant" id="next" onclick="next()"> </button>
            <button class="custom-button custom-button-5" title="cube" id="cube" onclick="structure_cubique()"></button> 
            <button class="custom-button custom-button-6" title="cube avec faîtage" id="cube_f"  onclick="Structure_faitage()"> </button>
            <button class="custom-button custom-button-7" title="cylindre vertical" id="cylinder" onclick="structure_cylindrique()"> </button>
            <button class="custom-button custom-button-40" title="cylindre horizontal" id="cylinderh" onclick="structure_cylindrique_h()"> </button>
            <button class="custom-button custom-button-8" title="cube à sommet cylindrique" id="cube_cy" onclick="structure_cubique_cy()"> </button>
            <button class="custom-button custom-button-9" title="cône" id="cone" onclick="structure_conique()"> </button>    
            <button class="custom-button custom-button-10" title="sphère" id="sphere" onclick="structure_spherique()"> </button>
            <button class="custom-button custom-button-11" title="cylindre à sommet sphérique" id="cylinder_sp" onclick="structure_cylindrique_sp()"> </button> 
            <button class="custom-button custom-button-12" title="câble aérien" id="ca" onclick="cable_aerien()"> </button>
            <button class="custom-button custom-button-13" title="PDA" id="pda" onclick="PDA()"></button>
            <button class="custom-button custom-button-14" title="PTS" id="pts" onclick="PTS()"></button>
            <div class="highlighted-overlay" id="highlightOverlay"></div>
            <button class="custom-button custom-button-15" title="retirer les résultats" id="delete" onclick="delete_points()"> </button>
            <button class="custom-button custom-button-16"  title="Lancer le calcul" id="run" onclick="programme_principal()"> </button>
            <button class="custom-button custom-button-17"  title="Etat de la protection - Rouge: site non protégé - Vert: Site protégé" id="results" onclick=""> </button>
            <button class="custom-button custom-button-18"  title="mesurer une distance" id="rulerButton" onclick=""> </button>
            <button class="custom-button custom-button-19"  title="déplacer un object dans le sens horizontal" id="dragObjectButton" onclick="drag(inputdata=1)"> </button>
            <button class="custom-button custom-button-20"  title="déplacer un object dans le sens vertical" id="dragObjectButton_z" onclick="drag(inputdata=2)"> </button>
            <button class="custom-button custom-button-36"   title="supprimer un object" onclick="delete_object()"> </button>
            <button class="custom-button custom-button-21"   title="dupliquer un object" onclick="duplicate()"> </button>
            <button class="custom-button custom-button-22"  title="vue isommétrique" onclick="isometric_view ()"> </button>
            <button class="custom-button custom-button-23"  title="vue de dessus" onclick="top_view ()"> </button>
            <button class="custom-button custom-button-24"  title="vue de face" onclick="front_view ()"> </button>
            <button class="custom-button custom-button-25"  title="vue arrière" onclick="back_view ()"> </button>
            <button class="custom-button custom-button-26"  title="vue de gauche" onclick="left_view ()"> </button>
            <button class="custom-button custom-button-27"  title="vue de droite" onclick="right_view ()"> </button>
            <button class="custom-button custom-button-28"  title="Vue orthogonale" onclick="orthogonal_view ()"> </button>
            <button class="custom-button custom-button-29"   title="selectionner l'object" id="SelectObjectButton" onclick="selection ()"> </button>
            <button class="custom-button custom-button-30"  title="zoom avant" onclick="zoom_in ()"> </button>
            <button class="custom-button custom-button-31"  title="zoom arrière" onclick="zoom_out ()"> </button>
            <button class="custom-button custom-button-32"  title="déplacer la scène" id="panButton"> </button>
            <button class="custom-button custom-button-33"  title="restaurer la scène" onclick="reset ()"> </button>
            <button class="custom-button custom-button-34"  title="Lancer le calcul dynamique" id="updateresults"> </button> 
            <button class="custom-button custom-button-35"  title="animer la scène" id="animationButton"> </button> 
            <button class="custom-button custom-button-42"  title="Paramètres" id="settings"> </button> 
            


    </div>

    <div class="container" id="sceneContainer">

        <div class="overlay" id="overlay-settings"></div>
    
        <div class="popup_settings" id="popup-settings">

            <div class="popup-title">Paramètres</div>
           
            <div class="container" id="data-container-settings"> 

                <label for="taille_mailles" class="label_input_field">Taille des mailles (m)</label>
                <input type="range" style="width: 150px; height: 20px; background-color:cornsilk;color: blue; border: 1px solid #ccc" id="taille_mailles" min="1" max="50" value="10">
                <span id="taille_mailles-value">10</span>
        
            </div>
        
            <div class="container" id="data-container-settings">
        
                <label for="resolution" class="label_input_field">Résolution du calcul :</label>
                <input type="range" style="width: 150px; height: 20px; background-color:cornsilk;color: blue; border: 1px solid #ccc" id="resolution" min="50" max="999" value="100">
                <span id="resolution-value">100</span>
            </div>

            <div class="container" id="data-container-settings">
        
                <label for="camera-position" class="label_input_field">Position de la caméra (m) :</label>
               <input type="range" style="width: 100px; height: 20px; background-color:cornsilk;color: blue; border: 1px solid #ccc" id="camera-position" min="50" max="300" value="100">
                <span id="camera-position-value">100</span>
        
            </div>

            <div class="container" id="data-container-settings">

                <div class="color-picker-container">
                    <label for="Couleur_scene" class="label_input_field">Couleur de la scene :</label>
                    <input type="color" id="Couleur_scene" style="width: 50px; height: 20px;" value="#000000">
                </div>
        
            </div>

            <div class="container" id="data-container-settings">

                <div class="color-picker-container">
                    <label for="Couleur_grille" class="label_input_field">Couleur de la grille :</label>
                    <input type="color" id="Couleur_grille" style="width: 50px; height: 20px;" value="#444444">
                </div>
        
            </div>

            <div class="container" id="data-container-settings">

                <div class="color-picker-container">
                    <label for="Couleur_object" class="label_input_field">Couleur de la selection :</label>
                    <input type="color" id="Couleur_object" style="width: 50px; height: 20px;" value="#00ff00">
                </div>
        
            </div>

            <div class="container" id="data-container-settings">
        
                
                <div class="color-picker-container">
                    <label for="Couleur_resultats" class="label_input_field">Couleur des résultats :</label>
                    <input type="color" id="Couleur_resultats" style="width: 50px; height: 20px;" value="#ff0000">
                </div>

        
            </div>


        </div>


        <div class="overlay" id="overlay-form"></div>
    
        <div class="popup_form" id="popup-form">

            <div class="popup-title">Données générales</div>
           
            <div class="container" id="data-container-settings"> 
                <label for="nom_projet" class="label_input_field">Nom du projet:</label>
                <input type="text" style="width: 250px; height: 20px; background-color:cornsilk;color: blue; border: 1px solid #ccc" id="nom_projet" style="color: blue;" value="Nom du projet">
            </div>

            <div class="container" id="data-container-settings"> 
                <label for="nom_redacteur" class="label_input_field">Nom du rédacteur:</label>
                <input type="text" style="width: 250px; height: 20px; background-color:cornsilk;color: blue; border: 1px solid #ccc" id="nom_redacteur" style="color: blue;" value="Nom et prénom">
            </div>

            <div class="container" id="data-container-settings"> 
                <label for="nom_societe" class="label_input_field">Nom de la société:</label>
                <input type="text" style="width: 250px; height: 20px; background-color:cornsilk;color: blue; border: 1px solid #ccc" id="nom_societe" style="color: blue;" value="Nom de la société">
            </div>
 

        </div>

      
    </div>

    
    <div class="container" id="data-container">

        <label for="niveau-protection" class="label_input_field">Niveau de protection foudre</label>

        <select class="select_field" id="niveau-protection">
            <option value="1">I</option>
            <option value="2">II</option>
            <option value="3">III</option>
            <option value="4">IV</option>
            <option value="AUTRE">AUTRE</option>

        </select>


    </div>

    <div class="container" id="data-container">

        <label for="courant-impulsionnel" class="label_input_field">Courant de foudre (kA)</label>

        <input type="text"readOnly class="select_field_o" id="courant-impulsionnel" value = "3">

    </div>

    <div class="container" id="data-container">

        <label for="rayon-sphere-fictive" class="label_input_field">Rayon de la sphère fictive</label>

        <input type="text"readOnly class="select_field_o" id="rayon-sphere-fictive" value = "20">

    </div>



 
    <div class="container" id="item-list">

    
    
    </div>


     <div class="container" id="label-list">
        
               
    </div>

    <div id="messageBox" style="display: none; position: fixed; top: 20%; left: 50%; transform: translate(-50%, -50%); padding: 20px; background: white; border: 1px solid black; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); z-index: 1000;">
        <p id="messageContent"></p>
        <button onclick="document.getElementById('messageBox').style.display = 'none';">OK</button>
    </div>



<!-- Include the latest version of Three.js -->
<script src="https://cdn.jsdelivr.net/npm/three@0.130.1/build/three.min.js"></script>

<!-- Include the necessary dependencies -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/exporters/GLTFExporter.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r136/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/delaunator@5.0.0/delaunator.min.js"></script>

<!-- Include OrbitControls after Three.js -->
<script src="/OrbitControls.js"></script>

<!-- Include your custom script -->

    <script>

///////////////////////POPUP SETTINGS /////////////////////////////////////////
const popup_settings = document.getElementById('popup-settings');
const overlay_settings = document.getElementById('overlay-settings');
let setting_apparition = false;

// Fonction pour afficher la popup
function showPopup_settings() {
    popup_settings.style.display = "block";
    overlay_settings.style.display = "block";
    setting_apparition = true;
}

// Fonction pour masquer la popup
function hidePopup_settings() {
    popup_settings.style.display = "none";
    overlay_settings.style.display = "none";
    setting_apparition = false;
}

// Gestionnaire pour ouvrir la popup
document.getElementById('settings').addEventListener('click', showPopup_settings);

// Gestionnaire global pour détecter les clics hors de la popup
document.addEventListener('click', function(event) {
    if (setting_apparition && !popup_settings.contains(event.target) && event.target.id !== 'settings') {
        hidePopup_settings();
    }
});

// Gestionnaire pour fermer avec la touche Escape
document.addEventListener('keydown', function(event) {
    if (event.key === "Escape" && setting_apparition) {
        hidePopup_settings();
    }
});

//////////////////////////////////////////////////////////

///////////////////////POPUP FORM /////////////////////////////////////////
const popup_form = document.getElementById('popup-form');
const overlay_form = document.getElementById('overlay-form');
let form_apparition = false;

// Fonction pour afficher la popup
function showPopup_form() {
    popup_form.style.display = "block";
    overlay_form.style.display = "block";
    form_apparition = true;
}

// Fonction pour masquer la popup
function hidePopup_form() {
    popup_form.style.display = "none";
    overlay_form.style.display = "none";
    form_apparition = false;
}

// Gestionnaire pour ouvrir la popup
document.getElementById('form').addEventListener('click', showPopup_form);

// Gestionnaire global pour détecter les clics hors de la popup
document.addEventListener('click', function(event) {
    if (form_apparition && !popup_form.contains(event.target) && event.target.id !== 'form') {
        hidePopup_form();
    }
});

// Gestionnaire pour fermer avec la touche Escape
document.addEventListener('keydown', function(event) {
    if (event.key === "Escape" && form_apparition) {
        hidePopup_form();
    }
});

//////////////////////////////////////////////////////////


var Couleur_scene='#000000';

document.getElementById('Couleur_scene').addEventListener('change', function() {
    Couleur_scene = document.getElementById('Couleur_scene').value;
    renderer.setClearColor(Couleur_scene, 1); // Updates the background color of the scene
    saveState();
});


var couleur_grille='#616161';

document.getElementById('Couleur_grille').addEventListener('change', function() {
    couleur_grille = document.getElementById('Couleur_grille').value;
    var taille_mailles = parseFloat(document.getElementById('taille_mailles').value);
    meshgrid(taille_mailles);
    saveState();
});

var couleur_object='#00ff00';

document.getElementById('Couleur_object').addEventListener('change', function() {
    couleur_object = document.getElementById('Couleur_object').value;
    saveState();
});

var couleur_resultats='#ff0000';

document.getElementById('Couleur_resultats').addEventListener('change', function() {
    couleur_resultats = document.getElementById('Couleur_resultats').value;
    saveState();
});

var camera_position=100;

document.getElementById('camera-position').addEventListener("input", function() {
    document.getElementById('camera-position-value').textContent = this.value;
    camera_position = parseFloat(this.value);
    camera.position.set(camera_position, camera_position, camera_position);
    camera.lookAt(0, 0, 0);
    controls.update();
});


document.getElementById("taille_mailles").addEventListener("input", function() {
    document.getElementById("taille_mailles-value").textContent = this.value;
    taille_mailles=parseFloat(this.value);
    meshgrid(taille_mailles);

});

document.getElementById("resolution").addEventListener("input", function() {
    document.getElementById("resolution-value").textContent = this.value;
    Nombre_points=parseFloat(this.value);
    saveState();

});

nomprojet='Projet N°';

document.getElementById('nom_projet').addEventListener('change',function() {

nomprojet = document.getElementById('nom_projet').value;

saveState();

});

nomredacteur='Nom Prénom';

document.getElementById('nom_redacteur').addEventListener('change',function() {

nomredacteur = document.getElementById('nom_redacteur').value;

saveState();

});


nomsociete='Nom de la société';
document.getElementById('nom_societe').addEventListener('change',function() {

nomsociete = document.getElementById('nom_societe').value;

saveState();

});


var niveauprotection = document.getElementById('niveau-protection').value;
var classnamecourant = document.getElementById('courant-impulsionnel').className;
var courantimpulsionnel = document.getElementById('courant-impulsionnel').value;
var rayonspherefictive=document.getElementById('rayon-sphere-fictive').value;

document.getElementById('niveau-protection').addEventListener('change', function() {

niveauprotection = document.getElementById('niveau-protection').value;

if (niveauprotection =='1') {

    Rayon_p = 20.;
    document.getElementById('courant-impulsionnel').value = '3';
    document.getElementById('rayon-sphere-fictive').value = '20';
    document.getElementById('courant-impulsionnel').readOnly = true;
    document.getElementById('rayon-sphere-fictive').readOnly = true;
    document.getElementById('courant-impulsionnel').className = 'select_field_o';
    document.getElementById('rayon-sphere-fictive').className = 'select_field_o';
    

} else if (niveauprotection =='2') {

    Rayon_p = 30.;
    document.getElementById('courant-impulsionnel').value = '5';
    document.getElementById('rayon-sphere-fictive').value = '30';
    document.getElementById('courant-impulsionnel').readOnly = true;
    document.getElementById('rayon-sphere-fictive').readOnly = true;
    document.getElementById('courant-impulsionnel').className = 'select_field_o';
    document.getElementById('rayon-sphere-fictive').className = 'select_field_o';


} else if (niveauprotection =='3') {

    document.getElementById('courant-impulsionnel').value = '10';
    document.getElementById('rayon-sphere-fictive').value = '45';
    document.getElementById('courant-impulsionnel').readOnly = true;
    document.getElementById('rayon-sphere-fictive').readOnly = true;
    document.getElementById('courant-impulsionnel').className = 'select_field_o';
    document.getElementById('rayon-sphere-fictive').className = 'select_field_o';


} else if (niveauprotection =='4') {

    document.getElementById('courant-impulsionnel').value = '15';
    document.getElementById('rayon-sphere-fictive').value = '60';
    document.getElementById('courant-impulsionnel').readOnly = true;
    document.getElementById('rayon-sphere-fictive').readOnly = true;
    document.getElementById('courant-impulsionnel').className = 'select_field_o';
    document.getElementById('rayon-sphere-fictive').className = 'select_field_o';


} else {

    document.getElementById('courant-impulsionnel').value = '3';
    document.getElementById('rayon-sphere-fictive').value = '20';
    document.getElementById('courant-impulsionnel').readOnly = false;
    document.getElementById('rayon-sphere-fictive').readOnly = false;
    document.getElementById('courant-impulsionnel').className = 'select_field';
    document.getElementById('rayon-sphere-fictive').className = 'select_field';
    
}

classnamecourant = document.getElementById('courant-impulsionnel').className;
courantimpulsionnel = document.getElementById('courant-impulsionnel').value;
rayonspherefictive=document.getElementById('rayon-sphere-fictive').value;


saveState();

    if (let_dynamic_results==true) {

        programme_principal ();

    }



});



document.getElementById('courant-impulsionnel').addEventListener('change', function() {


    var courantimpulsionnell = parseFloat(document.getElementById('courant-impulsionnel').value);

    if (courantimpulsionnell <=0) {

        courantimpulsionnell = 3.0;
        document.getElementById('courant-impulsionnel').value = '2';

    } else if (courantimpulsionnell >600) {

        courantimpulsionnell = 600.0;
        document.getElementById('courant-impulsionnel').value = '600';

    }

    Rayon_p = 10*Math.pow(courantimpulsionnell,0.65);
    document.getElementById('rayon-sphere-fictive').value = Rayon_p.toFixed(0);

    
    if (let_dynamic_results==true) {

        programme_principal ();

    }

    courantimpulsionnel = document.getElementById('courant-impulsionnel').value;


    saveState();

});



document.getElementById('rayon-sphere-fictive').addEventListener('change', function() {

const Rayon_pp = parseFloat(document.getElementById('rayon-sphere-fictive').value);

if (isNaN(Rayon_pp)||Rayon_pp<=0 || Rayon_pp =='' || Rayon_pp > 639) {

    return

}

Rayon_p = parseFloat(document.getElementById('rayon-sphere-fictive').value);

document.getElementById('rayon-sphere-fictive').value = this.value;

var courantimpulsionnelll = Math.pow(Rayon_p/10,1/0.65);

document.getElementById('courant-impulsionnel').value = courantimpulsionnelll.toFixed(2);

courantimpulsionnel = document.getElementById('courant-impulsionnel').value;

courantimpulsionnel = document.getElementById('courant-impulsionnel').value;
rayonspherefictive=document.getElementById('rayon-sphere-fictive').value;

saveState();

if (let_dynamic_results==true) {

    programme_principal ();

}

});



function print_results() {

    const newWindow = window.open('aaaaa', '_blank');

    const newDoc = newWindow.document;

    // Obtenir la date actuelle
    const currentDate = new Date();
    const formattedDate = currentDate.toLocaleDateString('fr-FR', {
        Année: 'numeric',
        Mois: 'long',
        Jour: 'numeric'
    });


    versionlogicielle='ELP-SF-02-08-01A';
    normeReference='NF EN 62305-3/NF C 17-102';

    const niveauprotection=document.getElementById('niveau-protection').value;
    const courantimpulsionnel=document.getElementById('courant-impulsionnel').value;
    const Rayon_sphere_fictive=document.getElementById('rayon-sphere-fictive').value;

    const html = `
    <html>
    <head>
        <title>Méthode de la sphère fictive ${''} </title>
            <style>
            @media print {
                    @page {
                        margin-left: 1cm;
                        margin-right: 1cm;
                        margin-top: 2cm;
                        margin-bottom: 1cm;
                    }
                    body {
                        margin: 0;
                    }
                    .page-number:after {
                        content: counter(page);
                    }
                    .page-number {
                        position: fixed;
                        bottom: 0;
                        width: 100%;
                        text-align: center;
                    }
                }

                
                /* Optional: Additional CSS styles for the output window */
            </style>
    </head>
    <body>

            <h3 style="text-decoration: underline;text-align: center;">DONNEES DE SORTIE LOGICIELLE</h3>
            <p style="text-align: center">Version logicielle: <span style="color: blue;">${versionlogicielle}</p>
            <p style="text-align: center">Nom du projet: <span style="color: blue;">${nomprojet}</p>

            <p style="margin: 0;">--------------------------------------------------------------------------------------------------------------</p>
            <h4 style="margin: 0px 0;">DONNEES GENERALES</h4>  
            <p style="margin: 0;">--------------------------------------------------------------------------------------------------------------</p>

            <p>Date: <span style="color: blue;">${formattedDate}</span></p>
            <p>Norme de référence: <span style="color: blue;">${normeReference}</span></p>
            <p>Nom et prénom du rédacteur: <span style="color: blue;">${nomredacteur}</span></p>
            <p>Nom de la société: <span style="color: blue;">${nomsociete}</span></p>
            <p>Niveau de protection requis: <span style="color: blue;">${niveauprotection}</span></p>
            <p>Courant impulsionnel de foudre: <span style="color: blue;">${courantimpulsionnel} kA</span></p>
            <p>Rayon de la sphère fictive: <span style="color: blue;">${Rayon_sphere_fictive} m</span></p>

            <p style="margin: 0;">--------------------------------------------------------------------------------------------------------------</p>
            <h4 style="margin: 0px 0;">RESULTATS DE CALCUL</h4>  
            <p style="margin: 0;">--------------------------------------------------------------------------------------------------------------</p>
            <div id="enteredstructures-data-container"></div>

           <p style="margin: 0;">--------------------------------------------------------------------------------------------------------------</p>
            <h4 style="margin: 0px 0;">ETAT DE LA PROTECTION - STRUCTURES NON PROTEGEES</h4>  
            <p style="margin: 0;">--------------------------------------------------------------------------------------------------------------</p>
            <div id="unprotectedstructures-data-container"></div>    
  
    
    </body>
    </html>
    `;




    newDoc.open();

    newDoc.write(html);
    newDoc.close();

    newWindow.onload = function () {

    const enteredstructuresdatacontainer = newDoc.getElementById('enteredstructures-data-container');
    const unprotectedstructuresdatacontainer = newDoc.getElementById('unprotectedstructures-data-container');

    for (let i = 0; i < group_data_cube_float.length; i++) {

        if (group_data_cube_float[i].group_name=='group_cube') {

            alpha=group_data_cube[i].prevRotZ;

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Structure cubique)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Protégée/Ceinturée/Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>


            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Longueur (L): <span style="color: blue;">${group_data_cube_float[i].Longueur_bat_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Largeur (W): <span style="color: blue;">${group_data_cube_float[i].Largeur_bat_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur (H): <span style="color: blue;">${group_data_cube_float[i].Hauteur_bat_1} m</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0): <span style="color: blue;">${group_data_cube_float[i].x0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0): <span style="color: blue;">${group_data_cube_float[i].y0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].z0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Angle de rotation/Z: <span style="color: blue;">${alpha} °</span></p>
            </div>


        `;


        } else if (group_data_cube_float[i].group_name=='group_cube_f') {

            alpha=group_data_cube[i].prevRotZ;
            

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Structure cubique avec faîtage)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Protégée/Ceinturée/Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>


            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Longueur (L): <span style="color: blue;">${group_data_cube_float[i].Longueur_bat_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Largeur (W): <span style="color: blue;">${group_data_cube_float[i].Largeur_bat_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur (H): <span style="color: blue;">${group_data_cube_float[i].Hauteur_bat_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur maximale (Hmax): <span style="color: blue;">${group_data_cube_float[i].HauteurMax_bat_1} m</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0): <span style="color: blue;">${group_data_cube_float[i].x0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0): <span style="color: blue;">${group_data_cube_float[i].y0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].z0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Angle de rotation/Z: <span style="color: blue;">${alpha} °</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Décalage du faîtage/Centre: <span style="color: blue;">${group_data_cube_float[i].yf_1} m</span></p>

            </div>

        `;

        } else if (group_data_cube_float[i].group_name=='group_cylinder') {

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Structure cylindrique verticale)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Protégée/Ceinturée/Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>


            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Rayon du sommet (Rsup): <span style="color: blue;">${group_data_cube_float[i].Rayon_sup} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Rayon de la base (Rinf): <span style="color: blue;">${group_data_cube_float[i].Rayon_inf} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur (H): <span style="color: blue;">${group_data_cube_float[i].Hauteur_bat_1} m</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0): <span style="color: blue;">${group_data_cube_float[i].x0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0): <span style="color: blue;">${group_data_cube_float[i].y0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].z0_1} m</span></p>
            </div>

            `;



        }  else if (group_data_cube_float[i].group_name=='group_cylinderh') {

            alpha=group_data_cube[i].prevRotZ;

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Structure cylindrique horizontale)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Protégée/Ceinturée/Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>


            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Rayon (R): <span style="color: blue;">${group_data_cube_float[i].Rayon} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Longueur (L): <span style="color: blue;">${group_data_cube_float[i].Longueur_bat_1} m</span></p>

            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0): <span style="color: blue;">${group_data_cube_float[i].x0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0): <span style="color: blue;">${group_data_cube_float[i].y0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].z0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Angle de rotation/Z: <span style="color: blue;">${alpha} °</span></p>
            
            </div>

            `;



        } else if (group_data_cube_float[i].group_name=='group_pda') {

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Paratonnerre à Dispositif d'Amorçage)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur (H): <span style="color: blue;">${group_data_cube_float[i].Hauteur_bat_1} m</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0): <span style="color: blue;">${group_data_cube_float[i].x0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0): <span style="color: blue;">${group_data_cube_float[i].y0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].z0_1} m</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Temps d'avance à l'amorçage: <span style="color: blue;">${group_data_cube_float[i].DeltaT} &micros</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Installation (ICPE/Autre): <span style="color: blue;">${group_data_cube_float[i].prevICPE}</span></p>
            </div>



            `;



        } else if (group_data_cube_float[i].group_name=='group_pts') {

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Paratonnerre à Tige Simple)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Protégée/Ceinturée/Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>


            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur (H): <span style="color: blue;">${group_data_cube_float[i].Hauteur_bat_1} m</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0): <span style="color: blue;">${group_data_cube_float[i].x0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0): <span style="color: blue;">${group_data_cube_float[i].y0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].z0_1} m</span></p>
            </div>

            `;



        } else if (group_data_cube_float[i].group_name=='group_cube_cy') {

            alpha=group_data_cube[i].prevRotZ;

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Structure cubique à toit cylindrique)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Protégée/Ceinturée/Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Longueur du cube (L): <span style="color: blue;">${group_data_cube_float[i].Longueur_bat_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Largeur du cube (W): <span style="color: blue;">${group_data_cube_float[i].Largeur_bat_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur du cube (H): <span style="color: blue;">${group_data_cube_float[i].Hauteur_bat_1} m</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0): <span style="color: blue;">${group_data_cube_float[i].x0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0): <span style="color: blue;">${group_data_cube_float[i].y0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].z0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Angle de rotation/Z: <span style="color: blue;">${alpha} °</span></p>
            </div>


        `;


        } else if (group_data_cube_float[i].group_name=='group_cone') {

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Structure conique)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Protégée/Ceinturée/Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>


            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Rayon de la base (R): <span style="color: blue;">${group_data_cube_float[i].Rayon} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur (H): <span style="color: blue;">${group_data_cube_float[i].Hauteur_bat_1} m</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0): <span style="color: blue;">${group_data_cube_float[i].x0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0): <span style="color: blue;">${group_data_cube_float[i].y0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].z0_1} m</span></p>

            </div>


        `;


        } else if (group_data_cube_float[i].group_name=='group_sphere') {

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Structure sphérique)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Protégée/Ceinturée/Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>


            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Rayon (R): <span style="color: blue;">${group_data_cube_float[i].Rayon} m</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0): <span style="color: blue;">${group_data_cube_float[i].x0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0): <span style="color: blue;">${group_data_cube_float[i].y0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].z0_1} m</span></p>

            </div>


        `;


        } else if (group_data_cube_float[i].group_name=='group_cylinder_sp') {

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Structure cylindrique à toit sphérique)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Protégée/Ceinturée/Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Rayon du cylindre (R): <span style="color: blue;">${group_data_cube_float[i].Rayon} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur du cylindre (R): <span style="color: blue;">${group_data_cube_float[i].Hauteur_bat_1} m</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0): <span style="color: blue;">${group_data_cube_float[i].x0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0): <span style="color: blue;">${group_data_cube_float[i].y0_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].z0_1} m</span></p>

            </div>


        `;


        } else if (group_data_cube_float[i].group_name=='group_ca') {

            alpha=group_data_cube[i].prevRotZ;
            fleche=group_data_cube[i].prevSag;

            enteredstructuresdatacontainer.innerHTML += `
            <h4 style="text-decoration: underline;">${group_data_cube[i].text_new_item} (Câble aérien)</h4>
            <p style="margin: 0 10px 0 0; padding: 0;">Spécificité de la structure (Protégée/Ceinturée/Ignorée/Autre): <span style="color: blue;">${group_data_cube_float[i].prevSpec}</span></p>


            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Longueur du câble (L): <span style="color: blue;">${group_data_cube_float[i].Longueur_C} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Flêche du câble (F): <span style="color: blue;">${fleche} %</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur du point de départ (Hp1): <span style="color: blue;">${group_data_cube_float[i].Hauteur_C_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Hauteur du point d'arrivée (Hp2): <span style="color: blue;">${group_data_cube_float[i].Hauteur_C_1} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Angle d'inclinaison du câble: <span style="color: blue;">${alpha} °</span></p>
            </div>

            <div style="display: flex; flex-wrap: wrap;">
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (X0 Point Départ): <span style="color: blue;">${group_data_cube_float[i].X0_C} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Y0 Point Départ): <span style="color: blue;">${group_data_cube_float[i].Y0_C} m</span></p>
            <p style="margin: 0 10px 0 0; padding: 0;">Centre (Z0): <span style="color: blue;">${group_data_cube_float[i].Z0_C} m</span></p>

            </div>


        `;


        }


      

    }

    
    if (snp.length>0) {



        if (test_snp===0) {


            unprotectedstructuresdatacontainer.innerHTML += `

            <p style="display: inline-block; margin-right: 12px;"><span style="color: gray;font-weight: bold">CALCUL NON LANCE</span></p>


        `;


        } else {


            for (let i = 0; i < snp.length; i++) {


            

                unprotectedstructuresdatacontainer.innerHTML += `

                <p style="margin-right: 12px;font-weight: bold"><span style="color: red;">${i+1}- ${snp[i]}</span></p>



                `;

            }

        }





  

        


    } else {

        if (test_snp===1) {


            unprotectedstructuresdatacontainer.innerHTML += `

            <p style="margin-right: 12px"><span style="color: green;font-weight: bold">TOUTES LES STRUCTURES SONT PROTEGEES</span></p>


        `;


        } else {


        unprotectedstructuresdatacontainer.innerHTML += `

        <p style="display: inline-block; margin-right: 12px;"><span style="color: gray;font-weight: bold">CALCUL NON LANCE</span></p>


        `;

    }

        


    }


    newWindow.print();

    const tempWindow = window.open('', '_blank', 'width=1,height=1');
    tempWindow.blur(); // Perdre le focus de la fenêtre temporaire
    window.focus(); // Revenir à la fenêtre principale
    setTimeout(() => tempWindow.close(), 100); // Fermer la fenêtre temporaire




}

}






updatebutton=document.getElementById('updateresults');

let let_dynamic_results=false;

updatebutton.addEventListener('click', function() {

    let_dynamic_results=!let_dynamic_results;

    //console.log(let_dynamic_results);

    if (let_dynamic_results!==false) {

    var button = document.getElementById('updateresults');
            //button.classList.remove('disabled'); // Remove the 'disabled' class
            button.style.backgroundImage = "url('photos/run-3.jpg')"; // Reset background image
            button.title="Arrêter le calcul dynamique"

    } else {

        var button = document.getElementById('updateresults');
            //button.classList.remove('disabled'); // Remove the 'disabled' class
            button.style.backgroundImage = "url('photos/run-2.jpg')"; // Reset background image
            button.title="Lancer le calcul dynamique";

    }

 

});





        var group_scene = new THREE.Group();
        groups_data=[];
        const originalColorsByGroup = new Map();
        inputdata=null;
        output=[];
        group_data_cube=[];
        group_data_cube_float=[];
        group_color_data_cube=[];
        index=null;
        var points=null;
        var gridHelper;
        let itemCounter_cube = 0;
        let itemCounter_f = 0;
        let itemCounter_cy = 0;
        let itemCounter_cyh = 0;
        let itemCounter_tsp = 0;
        let itemCounter_tcy = 0;
        let itemCounter_co = 0;
        let itemCounter_sp = 0;
        let itemCounter_pda = 0;
        let itemCounter_pts = 0;
        let itemCounter_ca = 0;
        var currentView = null;//'perspective';
        var currentView_1 =null; //'perspective';
        var windowHalfX = window.innerWidth / 2;
        var windowHalfY = window.innerHeight / 2;
        //var rayon_p;
        var Nombre_points=100;
        let initialFov
        let initialCameraPosition 
        let initialCameraRotation
        var snp=[];
        var test_snp=0;


        
        
        //////////////////////////////INTITIALISE THE SCENE//////////////////////////////////////////////////////

        init();
        

        //var camera_position=50;
        //var scene, camera, renderer, controls;
        //var camera_position = 100;
        //var camera_position_z = 50;

        function init() {
       
            scene = new THREE.Scene();
            //camera_position=100.;
            camera_position_z=50.;
            currentView='perspective'
            camera = new THREE.PerspectiveCamera(75, window.innerWidth /window.innerHeight, 0.1, 100000);
            renderer = new THREE.WebGLRenderer();
            

            renderer.setClearColor(Couleur_scene, 1);
            camera.position.set(camera_position, camera_position, camera_position); // Default top view
            camera.lookAt(0, 0, 0);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('sceneContainer').appendChild(renderer.domElement);

            initialFov = camera.fov;
            initialCameraPosition = camera.position.clone();
            initialCameraRotation=camera.rotation.clone();

            var size = 20;
            var near = -100;
            var far = 100;
            var aspect = window.innerWidth / window.innerHeight;

            cameraZ = new THREE.OrthographicCamera(-size * aspect, size * aspect, size, -size, near, far);
            cameraZ.position.set(0, camera_position_z, 0);
            cameraZ.lookAt(0, 0, 0);    

            cameraY = new THREE.OrthographicCamera(-size * aspect, size * aspect, size, -size, near, far);
            cameraY.position.set(0, 0, camera_position_z);
            cameraY.lookAt(0, 0, 0);

            cameraYM = new THREE.OrthographicCamera(-size * aspect, size * aspect, size, -size, near, far);
            cameraYM.position.set(0, 0, -camera_position_z);
            cameraYM.lookAt(0, 0, 0);    

            cameraX = new THREE.OrthographicCamera(-size * aspect, size * aspect, size, -size, near, far);
            cameraX.position.set(camera_position_z, 0, 0);
            cameraX.lookAt(0, 0, 0);

            cameraXM = new THREE.OrthographicCamera(-size * aspect, size * aspect, size, -size, near, far);
            cameraXM.position.set(-camera_position_z, 0, 0);
            cameraXM.lookAt(0, 0, 0);
        
            controls = new THREE.OrbitControls(camera, renderer.domElement);

            controls.enableDamping = true;
            controls.dampingFactor = 0.25;
            controls.enableZoom = true;

            controls.reset();
  

    }

    
    ///////////////////////////////ADDED FOR VIEWS//////////////////////////////////////////////////////////


    function onWindowResize() {

            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);
    }


        //////////////////////////////////////////RENDER FUNCTION////////////////////////////////////////////

        //function render () {

        //requestAnimationFrame(render);
        //renderer.render(scene,camera);
        //controls.update();
        //}
        //////////////////////////////////////////////////////////////////////////////////////////////////////////

        meshgrid (taille_mailles=10);
        axes_creation ();
        light_interraction ();
        

        


        ///////////////////////////////////MESHGRID///////////////////////////////////////////////////////////////
        
        
        function meshgrid (taille_mailles) {

        if (gridHelper !== undefined) {
            scene.remove(gridHelper);
        }

        //Construct meshgrid
        var size = 1000;

        var divisions = size/taille_mailles;
        divisions=2*divisions.toFixed(0);
        
        size=divisions*taille_mailles;

        gridHelper = new THREE.GridHelper(size, divisions, couleur_grille, couleur_grille); // Both grid lines are colored

        group_scene.add(gridHelper);
        scene.add(gridHelper);
        
        gridHelper.name='gridHelper';

        }
        //////////////////////////////////////////////////////////////////////////////////////////////////////////

        ////////////////////////////////////////AXES CREATION/////////////////////////////////////////////////////

        function axes_creation () {
 
        // Create arrow for X-axis
        var xAxis = new THREE.ArrowHelper(new THREE.Vector3(100, 0, 0), new THREE.Vector3(0, 0, 0), 10, 0xff0000);
        group_scene.add(xAxis);
        scene.add(xAxis);
        xAxis.name='xAxis';

        // Create arrow for Y-axis
        var yAxis = new THREE.ArrowHelper(new THREE.Vector3(0, 0, 100), new THREE.Vector3(0, 0, 0), 10, 0x006400);
        group_scene.add(yAxis);
        scene.add(yAxis);
        yAxis.name='yAxis';
      

        // Create arrow for Z-axis
        var zAxis = new THREE.ArrowHelper(new THREE.Vector3(0, 100, 0), new THREE.Vector3(0, 0, 0), 10, 0x0000ff);
        group_scene.add(zAxis);
        scene.add(zAxis);
        zAxis.name='zAxis';


        }
    
        //////////////////////////////////////////////////////////////////////////////////////////////////////////


       function light_interraction() {
            // Supprimer toutes les lumières existantes pour éviter les doublons
            while (scene.children.find(obj => obj.type.includes('Light'))) {
                const light = scene.children.find(obj => obj.type.includes('Light'));
                scene.remove(light);
            }

            // Lumière ambiante (éclairage doux général)
            const ambientLight = new THREE.AmbientLight(0x404040, 0.8); // Couleur douce et intensité ajustée
            scene.add(ambientLight);

            // Lumière directionnelle (pour les ombres et les effets directionnels)
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1); // Intensité augmentée
            directionalLight.position.set(5, 10, 7).normalize(); // Position dynamique
            directionalLight.castShadow = true; // Activer les ombres
            directionalLight.shadow.mapSize.width = 1024; // Résolution des ombres
            directionalLight.shadow.mapSize.height = 1024;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            scene.add(directionalLight);

            // Lumière ponctuelle (effet de projecteur focalisé)
            const pointLight = new THREE.PointLight(0xffaa00, 1, 100); // Couleur chaude
            pointLight.position.set(10, 15, 5);
            scene.add(pointLight);

            // Lumière hémisphérique (simule le ciel et le sol)
            const hemisphereLight = new THREE.HemisphereLight(0x87ceeb, 0x444444, 0.6); // Ciel bleu et sol gris
            hemisphereLight.position.set(0, 50, 0);
            scene.add(hemisphereLight);

            // Ajout de helpers pour visualiser les lumières (optionnel, pour debug)
            //const directionalLightHelper = new THREE.DirectionalLightHelper(directionalLight, 5);
            //const pointLightHelper = new THREE.PointLightHelper(pointLight, 1);
            //const hemisphereLightHelper = new THREE.HemisphereLightHelper(hemisphereLight, 5);

            //scene.add(directionalLightHelper);
            //scene.add(pointLightHelper);
            //scene.add(hemisphereLightHelper);
        }





    ///////////////////////////////////////////////ANIMATE FUNCTION//////////////////////////////////////////
        function animate() {

            //view = 'isommetrique'

            

            if (isAnimating) {
            requestAnimationFrame(animate);
        
        // Add animation here (for example, rotating the entire scene)
            scene.rotation.y += 0.005;
        
        // Update controls and render scene
            controls.update();
            renderer.render(scene, camera);
         } else {
 
            requestAnimationFrame(animate);
               
            if (currentView === 'front') {
                renderer.render(scene, cameraY);
            } else if (currentView === 'back') {
                renderer.render(scene, cameraYM);
            } else if (currentView === 'left') {
                renderer.render(scene, cameraXM);
            } else if (currentView === 'right') {
                renderer.render(scene, cameraX);
            } else if (currentView === 'top') {
                renderer.render(scene, cameraZ);

            } else {

                renderer.render(scene, camera);

            }

            
            controls.update(); // Update controls continuously

            controls.enabled=true;

            
                        

        
      }
            


}


        function top_view() {

            
            //controls.reset();

            currentView = 'perspective'

            //cameraZ = new THREE.OrthographicCamera(-size * aspect, size * aspect, size, -size, near, far);
            camera.position.set(0, camera_position, 0);
            camera.lookAt(0, 0, 0);
            scene.rotation.set(0, 0, 0); // Reset scene rotation
            renderer.render(scene, camera);
            currentView_1 = 'top'


        }

        // Function to switch to front view
        function front_view() {

            currentView = 'perspective'
            controls.reset();
          
            camera.position.set(0, 0, camera_position);
            camera.lookAt(0, 0, 0);
            scene.rotation.set(0, 0, 0); // Reset scene rotation
            renderer.render(scene, camera);
            currentView_1 = 'front'
  
        }


        function back_view() {

            currentView = 'perspective'
            controls.reset();
            
            camera.position.set(0, 0, -camera_position);
            camera.lookAt(0, 0, 0);
            scene.rotation.set(0, 0, 0); // Reset scene rotation
            renderer.render(scene, camera);
            currentView_1 = 'back'

        }


        function left_view() {

            currentView = 'perspective'
            controls.reset();
            
            camera.position.set(-camera_position, 0, 0);
            camera.lookAt(0, 0, 0);
            scene.rotation.set(0, 0, 0); // Reset scene rotation
            renderer.render(scene, camera);
            currentView_1 = 'left'

        }


        function right_view() {

            currentView = 'perspective'
           
            controls.reset();
            camera.position.set(camera_position, 0, 0);
            camera.lookAt(0, 0, 0);
            scene.rotation.set(0, 0, 0); // Reset scene rotation
            renderer.render(scene, camera);
            currentView_1 = 'right'

        }

        function isometric_view() {
            controls.reset();
            currentView = 'perspective'
            camera.position.set(camera_position, camera_position, camera_position);
            camera.lookAt(0, 0, 0);
            scene.rotation.set(0, 0, 0); // Reset scene rotation
            renderer.render(scene, camera);
        }

        
        function orthogonal_view() {
                       
            controls.reset();

            if (currentView_1 === 'front') {
                currentView = 'front';
            } else if (currentView_1 === 'back') {
                currentView = 'back';
            } else if (currentView_1 === 'left') {
                currentView = 'left'
            } else if (currentView_1 === 'right') {
                currentView = 'right'
            } else if (currentView_1 === 'top') {
                currentView = 'top'

            } else {

                currentView = 'perspective'

            }
            //camera.position.set(camera_position, 0, 0);
            //camera.lookAt(0, 0, 0);
            scene.rotation.set(0, 0, 0); // Reset scene rotation
            //renderer.render(scene, camera);
            //currentView = 'right'

            
        }


        function zoom_in() {

            
            if (currentView==='perspective') {

  
            camera.fov -= 5; // Decrease the field of view to zoom in
            camera.updateProjectionMatrix(); // Update the camera's projection matrix

            } else {

                
            var aspect = window.innerWidth / window.innerHeight;
            var size = 5;
            var near = -10;
            var far = 10;
            var zoomFactor = +5;

            cameraX.left += zoomFactor * aspect;
            cameraX.right -= zoomFactor * aspect;
            cameraX.top -= zoomFactor;
            cameraX.bottom += zoomFactor;
            cameraX.updateProjectionMatrix();

            cameraXM.left += zoomFactor * aspect;
            cameraXM.right -= zoomFactor * aspect;
            cameraXM.top -= zoomFactor;
            cameraXM.bottom += zoomFactor;
            cameraXM.updateProjectionMatrix();

            cameraY.left += zoomFactor * aspect;
            cameraY.right -= zoomFactor * aspect;
            cameraY.top -= zoomFactor;
            cameraY.bottom += zoomFactor;
            cameraY.updateProjectionMatrix();

            cameraYM.left += zoomFactor * aspect;
            cameraYM.right -= zoomFactor * aspect;
            cameraYM.top -= zoomFactor;
            cameraYM.bottom += zoomFactor;
            cameraYM.updateProjectionMatrix();

            cameraZ.left += zoomFactor * aspect;
            cameraZ.right -= zoomFactor * aspect;
            cameraZ.top -= zoomFactor;
            cameraZ.bottom += zoomFactor;
            cameraZ.updateProjectionMatrix();

                // Similar adjustments for cameraY and cameraZ if need

                }



            }
        
        
        function zoom_out() {
            
            
            if (currentView==='perspective') {
  
            camera.fov += 5; // Decrease the field of view to zoom in
            camera.updateProjectionMatrix(); // Update the camera's projection matrix

            } else {
        
            var aspect = window.innerWidth / window.innerHeight;
            var size = 5;
            var near = -10;
            var far = 10;
            var zoomFactor = +5;

            cameraX.left -= zoomFactor * aspect;
            cameraX.right += zoomFactor * aspect;
            cameraX.top += zoomFactor;
            cameraX.bottom -= zoomFactor;
            cameraX.updateProjectionMatrix();

            cameraXM.left -= zoomFactor * aspect;
            cameraXM.right += zoomFactor * aspect;
            cameraXM.top += zoomFactor;
            cameraXM.bottom -= zoomFactor;
            cameraXM.updateProjectionMatrix();

            cameraY.left -= zoomFactor * aspect;
            cameraY.right += zoomFactor * aspect;
            cameraY.top += zoomFactor;
            cameraY.bottom -= zoomFactor;
            cameraY.updateProjectionMatrix();

            cameraYM.left -= zoomFactor * aspect;
            cameraYM.right += zoomFactor * aspect;
            cameraYM.top += zoomFactor;
            cameraYM.bottom -= zoomFactor;
            cameraYM.updateProjectionMatrix();

            cameraZ.left -= zoomFactor * aspect;
            cameraZ.right += zoomFactor * aspect;
            cameraZ.top += zoomFactor;
            cameraZ.bottom -= zoomFactor;
            cameraZ.updateProjectionMatrix();

        // Similar adjustments for cameraY and cameraZ if need

        }


        }

 
 

        sol()
       
   
        function sol() {
            
            var length_s=1000.0;
            var width_s=1000.0;
            var height_s=0.1;
            var x_s=0.0;
            var y_s=0.0;
            var z_s=-0.05;
            //var rotationAngle=0; //degré
            //var rotationAngle=rotationAngle*Math.PI/180;
            var cubeGeometry_s = new THREE.BoxGeometry(length_s,height_s,width_s);
            var cubeMaterial_s = new THREE.MeshPhongMaterial({ transparent: true, opacity: 0 });
            var floor = new THREE.Mesh(cubeGeometry_s, cubeMaterial_s);
            floor.position.set(x_s, z_s, y_s);
            floor.userData.id='floor'
            //floor.rotation.z=rotationAngle;

            group_scene.add(floor);
            
            scene.add(floor);

            renderer.render(scene, camera);

            //document.addEventListener('click', onClick, false);

            floor.name='floor';


        }


        function hideInputFields() {

            
        var labelsInputContainer = document.getElementById('label-list');

        if (labelsInputContainer) {
        labelsInputContainer.innerHTML = ''; // Clear the container

        }


        }



        function show_input_fields (newItem,group,index){
           
        hideInputFields()
     
        var color_cube=group_color_data_cube[index];




        if (group.name=='group_cube') {

        var labelsInputContainer = document.getElementById('label-list');
        var select = document.createElement("select");
        var select_2 = document.createElement("select");

        // Create and append label and input fields for cube dimensions
        var RenameLabelDiv = document.createElement('div');
        var RenameLabel = document.createElement('label');
        RenameLabel.textContent = 'Renommer:';
        RenameLabel.style.display = 'block'; // Ensure label is on its own line
        RenameLabelDiv.appendChild(RenameLabel);
        var RenameInput = document.createElement('input');
        RenameInput.type = 'text';
        //widthInput.style.marginLeft = '150px';
        RenameInput.placeholder = 'Nom de la structure';
        RenameInput.style.color = 'blue'; // Set text color to blue
        RenameInput.style.display = 'block'; // Ensure label is on its own line
        RenameInput.style.width = '250px'; // Set width
        RenameInput.style.height = '20px'; // Set width
        RenameInput.style.padding = '5px'; // Adjust padding to match select
        RenameInput.style.border = '1px solid #ccc'; // Match border style
        RenameInput.style.fontSize = '14px'; // Match font size
        RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        RenameInput.style.backgroundColor='cornsilk';
        RenameInput.value = group_data_cube[index].text_new_item;
        //widthInput.style.marginLeft = '50px';
        RenameInput.addEventListener('input', updateCubeDimensions);
        RenameInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        RenameLabelDiv.appendChild(RenameInput);
        labelsInputContainer.appendChild(RenameLabelDiv);

        // Create and append label and input fields for cube dimensions
        var widthLabelDiv = document.createElement('div');
        var widthLabel = document.createElement('label');
        widthLabel.textContent = 'Longueur (m):';
        widthLabelDiv.appendChild(widthLabel);
        var widthInput = document.createElement('input');
        widthInput.type = 'number';
        //widthInput.style.marginLeft = '150px';
        widthInput.placeholder = 'Entrer la valeur';
        widthInput.style.color = 'blue'; // Set text color to blue
        widthInput.style.width = '250px'; // Set width
        widthInput.style.height = '20px'; // Set width
        widthInput.style.padding = '5px'; // Adjust padding to match select
        widthInput.style.border = '1px solid #ccc'; // Match border style
        widthInput.style.fontSize = '14px'; // Match font size
        widthInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        widthInput.style.backgroundColor='cornsilk';
        widthInput.value = group_data_cube[index].prevWidth;
        //widthInput.style.marginLeft = '50px';
        widthInput.addEventListener('input', updateCubeDimensions);
        widthInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        widthLabelDiv.appendChild(widthInput);
        labelsInputContainer.appendChild(widthLabelDiv);

        var depthLabelDiv = document.createElement('div');
        var depthLabel = document.createElement('label');
        depthLabel.textContent = 'Largeur (m):';
        depthLabel.style.display = 'block'; // Ensure label is on its own line
        depthLabelDiv.appendChild(depthLabel);
        var depthInput = document.createElement('input');
        depthInput.type = 'number';
        depthInput.placeholder = 'Entrer la valeur';
        depthInput.style.color = 'blue'; // Set text color to blue
        depthInput.style.display = 'block'; // Ensure input is on its own line
        depthInput.style.width = '250px'; // Set width
        depthInput.style.height = '20px'; // Set width
        depthInput.style.padding = '5px'; // Adjust padding to match select
        depthInput.style.border = '1px solid #ccc'; // Match border style
        depthInput.style.fontSize = '14px'; // Match font size
        depthInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        depthInput.style.backgroundColor='cornsilk';
        depthInput.value = group_data_cube[index].prevDepth;
        depthInput.addEventListener('input', updateCubeDimensions);
        depthInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        //depthInput.style.marginLeft = '50px';
        depthLabelDiv.appendChild(depthInput);
        labelsInputContainer.appendChild(depthLabelDiv);

        var heightLabelDiv = document.createElement('div');
        var heightLabel = document.createElement('label');
        heightLabel.textContent = 'Hauteur (m):';
        heightLabel.style.display = 'block'; // Ensure label is on its own line
        heightLabelDiv.appendChild(heightLabel);
        var heightInput = document.createElement('input');
        heightInput.type = 'number';
        heightInput.placeholder = 'Entrer la valeur';
        heightInput.style.color = 'blue'; // Set text color to blue
        heightInput.style.display = 'block'; // Ensure label is on its own line
        heightInput.style.width = '250px'; // Set width
        heightInput.style.height = '20px'; // Set width
        heightInput.style.padding = '5px'; // Adjust padding to match select
        heightInput.style.border = '1px solid #ccc'; // Match border style
        heightInput.style.fontSize = '14px'; // Match font size
        heightInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        heightInput.style.backgroundColor='cornsilk';

        heightInput.value = group_data_cube[index].prevHeight;
        heightInput.addEventListener('input', updateCubeDimensions);
        heightInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        //heightInput.style.marginLeft = '50px';
        heightLabelDiv.appendChild(heightInput);
        labelsInputContainer.appendChild(heightLabelDiv);

        // Create and append label and input fields for cube position
        var xLabelDiv = document.createElement('div');
        var xLabel = document.createElement('label');
        xLabel.textContent = 'Origine X0 (m):';
        xLabel.style.display = 'block'; // Ensure label is on its own line
        xLabelDiv.appendChild(xLabel);
        var xInput = document.createElement('input');
        xInput.type = 'number';
        xInput.placeholder = 'Entrer la valeur';
        xInput.style.color = 'blue'; // Set text color to blue
        xInput.style.display = 'block'; // Ensure label is on its own line
        xInput.style.width = '250px'; // Set width
        xInput.style.height = '20px'; // Set width
        xInput.style.padding = '5px'; // Adjust padding to match select
        xInput.style.border = '1px solid #ccc'; // Match border style
        xInput.style.fontSize = '14px'; // Match font size
        xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        xInput.style.backgroundColor='cornsilk';
        xInput.value = group_data_cube[index].prev
        xInput.value =group_data_cube[index].prevPosX ;
        xInput.addEventListener('input', updateCubeDimensions);

        xInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        
        //xInput.style.marginLeft = '50px';
        xLabelDiv.appendChild(xInput);
        labelsInputContainer.appendChild(xLabelDiv);

        var yLabelDiv = document.createElement('div');
        var yLabel = document.createElement('label');
        yLabel.textContent = 'Origine Y0 (m):';
        yLabel.style.display = 'block'; // Ensure label is on its own line
        yLabelDiv.appendChild(yLabel);
        var yInput = document.createElement('input');
        yInput.type = 'number';
        yInput.placeholder = 'Entrer la valeur';
        yInput.style.color = 'blue'; // Set text color to blue
        yInput.style.display = 'block'; // Ensure label is on its own line
        yInput.style.width = '250px'; // Set width
        yInput.style.height = '20px'; // Set width
        yInput.style.padding = '5px'; // Adjust padding to match select
        yInput.style.border = '1px solid #ccc'; // Match border style
        yInput.style.fontSize = '14px'; // Match font size
        yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        yInput.style.backgroundColor='cornsilk';
        yInput.value = group_data_cube[index].prevPosY;
        yInput.addEventListener('input', updateCubeDimensions);
        yInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        //yInput.style.marginLeft = '50px';
        yLabelDiv.appendChild(yInput);
        labelsInputContainer.appendChild(yLabelDiv);

        var zLabelDiv = document.createElement('div');
        var zLabel = document.createElement('label');
        zLabel.textContent = 'Origine Z0 (m):';
        zLabel.style.display = 'block'; // Ensure label is on its own line
        zLabelDiv.appendChild(zLabel);
        var zInput = document.createElement('input');
        zInput.type = 'number';
        zInput.placeholder = 'Entrer la valeur';
        zInput.style.color = 'blue'; // Set text color to blue
        zInput.style.display = 'block'; // Ensure label is on its own line
        zInput.style.width = '250px'; // Set width
        zInput.style.height = '20px'; // Set width
        zInput.style.padding = '5px'; // Adjust padding to match select
        zInput.style.border = '1px solid #ccc'; // Match border style
        zInput.style.fontSize = '14px'; // Match font size
        zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        zInput.style.backgroundColor='cornsilk';
        zInput.value = group_data_cube[index].prevPosZ;
        zInput.addEventListener('input', updateCubeDimensions);
        zInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        //zInput.style.marginLeft = '50px';
        zLabelDiv.appendChild(zInput);
        labelsInputContainer.appendChild(zLabelDiv);

        var rotationAngleLabelDiv = document.createElement('div');
        var rotationAngleLabel = document.createElement('label');
        rotationAngleLabel.textContent = 'Angle autour de z (°):';
        rotationAngleLabel.style.display = 'block'; // Ensure label is on its own line
        rotationAngleLabelDiv.appendChild(rotationAngleLabel);
        var rotationAngle = document.createElement('input');
        rotationAngle.type = 'number';
        rotationAngle.placeholder = 'Entrer la valeur';
        rotationAngle.style.color = 'blue'; // Set text color to blue
        rotationAngle.style.display = 'block'; // Ensure label is on its own line
        rotationAngle.style.width = '250px'; // Set width
        rotationAngle.style.height = '20px'; // Increase height for better visibility
        rotationAngle.style.padding = '5px'; // Add padding for better readability
        rotationAngle.style.border = '1px solid #ccc'; // Match border style
        rotationAngle.style.fontSize = '14px'; // Increase font size for better readability
        rotationAngle.style.boxSizing = 'border-box'; // Include padding and border in the width
        rotationAngle.style.backgroundColor = 'cornsilk'; // Light background color for visibility

        rotationAngle.value = group_data_cube[index].prevRotZ;
        rotationAngle.addEventListener('input', updateCubeDimensions);
        rotationAngle.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        //rotationAngle.style.marginLeft = '50px';
        rotationAngleLabelDiv.appendChild(rotationAngle);
        labelsInputContainer.appendChild(rotationAngleLabelDiv);

        var visibleLabelDiv = document.createElement('div');
        var visibleLabel = document.createElement('label');
        visibleLabel.textContent = 'Structure visible:';
        visibleLabelDiv.appendChild(visibleLabel);
        var option1 = document.createElement('option');
        option1.value='Oui';
        option1.textContent='Oui';
        select.appendChild(option1);
        select.style.color = 'blue'; // Set text color to blue
        var option2 = document.createElement('option');
        option2.value='Non';
        option2.textContent='Non';
        select.appendChild(option2);
        select.style.color = 'blue'; // Set text color to blue
        select.style.width = '250px'; // Set width
        select.style.height = '20px'; // Set width
        select.style.padding = '0px'; // Adjust padding to match select
        select.style.border = '1px solid #ccc'; // Match border style
        select.style.fontSize = '14px'; // Match font size
        select.style.boxSizing = 'border-box'; // Include padding and border in the width
        select.style.backgroundColor='cornsilk';


        if (group_data_cube[index].prevVisible==='Oui') {
            option1.selected=true;
            
        } else {
            option2.selected=true; 
        }

        select.addEventListener('change', updateCubeDimensions);
        select.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        

        visibleLabelDiv.appendChild(select);
        labelsInputContainer.appendChild(visibleLabelDiv);

        var specLabelDiv = document.createElement('div');
        var specLabel = document.createElement('label');
        specLabel.textContent = 'Structure:';
        specLabelDiv.appendChild(specLabel);
        var option_1 = document.createElement('option');
        option_1.value='Ceinturée';
        option_1.textContent='Ceinturée';
        select_2.appendChild(option_1);
        select_2.style.color = 'blue'; // Set text color to blue
        var option_2 = document.createElement('option');
        option_2.value='Protégée';
        option_2.textContent='Protégée';
        select_2.appendChild(option_2);
        select_2.style.color = 'blue'; // Set text color to blue

        var option_3 = document.createElement('option');
        option_3.value='Ignorée';
        option_3.textContent='Ignorée';
        select_2.appendChild(option_3);
        select_2.style.color = 'blue'; // Set text color to blue

        var option_4 = document.createElement('option');
        option_4.value='Autre';
        option_4.textContent='Autre';
        select_2.appendChild(option_4);
        select_2.style.color = 'blue'; // Set text color to blue
        select_2.style.width = '250px'; // Set width
        select_2.style.height = '20px'; // Set width
        select_2.style.padding = '0px'; // Adjust padding to match select
        select_2.style.border = '1px solid #ccc'; // Match border style
        select_2.style.fontSize = '14px'; // Match font size
        select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
        select_2.style.backgroundColor='cornsilk';

        if (group_data_cube[index].prevSpec==='Ceinturée') {
            option_1.selected=true;
            
        } else if (group_data_cube[index].prevSpec==='Protégée') {

            option_2.selected=true;
            
        } else if (group_data_cube[index].prevSpec==='Ignorée') {

            option_3.selected=true;

        } else {
            
            option_4.selected=true;

        }

        select_2.addEventListener('change', updateCubeDimensions);
        select_2.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        
        

        specLabelDiv.appendChild(select_2);
        labelsInputContainer.appendChild(specLabelDiv);


        // Create and append label and input fields for cube color
        var colorInputDiv = document.createElement('div');
        //colorInputDiv.style.display = 'flex';
        //colorInputDiv.style.alignItems = 'center';
        var colorLabel = document.createElement('label');
        colorLabel.textContent = 'Couleur: ';
        colorInputDiv.appendChild(colorLabel);
        var colorInput = document.createElement('input');
        colorInput.type = 'color';
        //colorInput.style.marginLeft = '10px';
        colorInput.value = color_cube;
        colorInput.addEventListener('input', updateCubeColor);
        colorInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        
        //colorInput.style.marginLeft = '50px';
        colorInputDiv.appendChild(colorInput);
        labelsInputContainer.appendChild(colorInputDiv);
        colorInput.style.width = '250px'; // Set width
        colorInput.style.padding = '5px'; // Adjust padding to match select
        colorInput.style.border = '1px solid #ccc'; // Match border style
        colorInput.style.fontSize = '16px'; // Match font size
        colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width

        } else if (group.name=='group_cube_f') {

        var labelsInputContainer = document.getElementById('label-list');
        var select = document.createElement("select");
        var select_2 = document.createElement("select");

        // Create and append label and input fields for cube dimensions
        var RenameLabelDiv = document.createElement('div');
        var RenameLabel = document.createElement('label');
        RenameLabel.textContent = 'Renommer:';
        RenameLabel.style.display = 'block'; // Ensure label is on its own line
        RenameLabelDiv.appendChild(RenameLabel);
        var RenameInput = document.createElement('input');
        RenameInput.type = 'text';
        //widthInput.style.marginLeft = '150px';
        RenameInput.placeholder = 'Nom de la structure';
        RenameInput.value = group_data_cube[index].text_new_item;
        //widthInput.style.marginLeft = '50px';
        RenameInput.style.color = 'blue'; // Set text color to blue
        RenameInput.style.display = 'block'; // Ensure label is on its own line
        RenameInput.style.width = '250px'; // Set width
        RenameInput.style.height = '20px'; // Set width
        RenameInput.style.padding = '5px'; // Adjust padding to match select
        RenameInput.style.border = '1px solid #ccc'; // Match border style
        RenameInput.style.fontSize = '14px'; // Match font size
        RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        RenameInput.style.backgroundColor='cornsilk';
        RenameInput.addEventListener('input', updateCubeDimensions);
        RenameInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        RenameLabelDiv.appendChild(RenameInput);
        labelsInputContainer.appendChild(RenameLabelDiv);

        // Create and append label and input fields for cube dimensions
        var widthLabelDiv = document.createElement('div');
        var widthLabel = document.createElement('label');
        widthLabel.textContent = 'Longueur (m):';
        widthLabel.style.display = 'block'; // Ensure label is on its own line
        widthLabelDiv.appendChild(widthLabel);
        var widthInput = document.createElement('input');
        widthInput.type = 'number';
        //widthInput.style.marginLeft = '150px';
        widthInput.placeholder = 'Entrer la valeur';
        widthInput.value = group_data_cube[index].prevWidth;
        //widthInput.style.marginLeft = '50px';
        widthInput.style.color = 'blue'; // Set text color to blue
        widthInput.style.display = 'block'; // Ensure label is on its own line
        widthInput.style.width = '250px'; // Set width
        widthInput.style.height = '20px'; // Set width
        widthInput.style.padding = '5px'; // Adjust padding to match select
        widthInput.style.border = '1px solid #ccc'; // Match border style
        widthInput.style.fontSize = '14px'; // Match font size
        widthInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        widthInput.style.backgroundColor='cornsilk';
        widthInput.addEventListener('input', updateCubeDimensions);
        widthInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });
        widthLabelDiv.appendChild(widthInput);
        labelsInputContainer.appendChild(widthLabelDiv);

        var depthLabelDiv = document.createElement('div');
        var depthLabel = document.createElement('label');
        depthLabel.textContent = 'Largeur (m):';
        depthLabel.style.display = 'block'; // Ensure label is on its own line
        depthLabelDiv.appendChild(depthLabel);
        var depthInput = document.createElement('input');
        depthInput.type = 'number';
        depthInput.placeholder = 'Entrer la valeur';
        depthInput.value = group_data_cube[index].prevDepth;
        depthInput.style.color = 'blue'; // Set text color to blue
        depthInput.style.display = 'block'; // Ensure label is on its own line
        depthInput.style.width = '250px'; // Set width
        depthInput.style.height = '20px'; // Set width
        depthInput.style.padding = '5px'; // Adjust padding to match select
        depthInput.style.border = '1px solid #ccc'; // Match border style
        depthInput.style.fontSize = '14px'; // Match font size
        depthInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        depthInput.style.backgroundColor='cornsilk';
        depthInput.addEventListener('input', updateCubeDimensions);

        depthInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //depthInput.style.marginLeft = '50px';
        depthLabelDiv.appendChild(depthInput);
        labelsInputContainer.appendChild(depthLabelDiv);

        var heightLabelDiv = document.createElement('div');
        var heightLabel = document.createElement('label');
        heightLabel.textContent = 'Hauteur (m):';
        heightLabel.style.display = 'block'; // Ensure label is on its own line
        heightLabelDiv.appendChild(heightLabel);
        var heightInput = document.createElement('input');
        heightInput.type = 'number';
        heightInput.placeholder = 'Entrer la valeur';
        heightInput.value = group_data_cube[index].prevHeight;
        heightInput.style.color = 'blue'; // Set text color to blue
        heightInput.style.display = 'block'; // Ensure label is on its own line
        heightInput.style.width = '250px'; // Set width
        heightInput.style.height = '20px'; // Set width
        heightInput.style.padding = '5px'; // Adjust padding to match select
        heightInput.style.border = '1px solid #ccc'; // Match border style
        heightInput.style.fontSize = '14px'; // Match font size
        heightInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        heightInput.style.backgroundColor='cornsilk';
        heightInput.addEventListener('input', updateCubeDimensions);

        heightInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //heightInput.style.marginLeft = '50px';
        heightLabelDiv.appendChild(heightInput);
        labelsInputContainer.appendChild(heightLabelDiv);

        var heightmaxLabelDiv = document.createElement('div');
        var heightmaxLabel = document.createElement('label');
        heightmaxLabel.textContent = 'Hauteur maximale (m):';
        heightmaxLabel.style.display = 'block'; // Ensure label is on its own line
        heightmaxLabelDiv.appendChild(heightmaxLabel);
        var heightmaxInput = document.createElement('input');
        heightmaxInput.type = 'number';
        heightmaxInput.placeholder = 'Entrer la valeur';
        heightmaxInput.value = group_data_cube[index].prevHeightMax;
        heightmaxInput.style.color = 'blue'; // Set text color to blue
        heightmaxInput.style.display = 'block'; // Ensure label is on its own line
        heightmaxInput.style.width = '250px'; // Set width
        heightmaxInput.style.height = '20px'; // Set width
        heightmaxInput.style.padding = '5px'; // Adjust padding to match select
        heightmaxInput.style.border = '1px solid #ccc'; // Match border style
        heightmaxInput.style.fontSize = '14px'; // Match font size
        heightmaxInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        heightmaxInput.style.backgroundColor='cornsilk';
        heightmaxInput.addEventListener('input', updateCubeDimensions);

        heightmaxInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //heightInput.style.marginLeft = '50px';
        heightmaxLabelDiv.appendChild(heightmaxInput);
        labelsInputContainer.appendChild(heightmaxLabelDiv);        

        // Create and append label and input fields for cube position
        var xLabelDiv = document.createElement('div');
        var xLabel = document.createElement('label');
        xLabel.textContent = 'Origine X0 (m):';
        xLabel.style.display = 'block'; // Ensure label is on its own line
        xLabelDiv.appendChild(xLabel);
        var xInput = document.createElement('input');
        xInput.type = 'number';
        xInput.placeholder = 'Entrer la valeur';
        xInput.value =group_data_cube[index].prevPosX ;
        xInput.style.color = 'blue'; // Set text color to blue
        xInput.style.display = 'block'; // Ensure label is on its own line
        xInput.style.width = '250px'; // Set width
        xInput.style.height = '20px'; // Set width
        xInput.style.padding = '5px'; // Adjust padding to match select
        xInput.style.border = '1px solid #ccc'; // Match border style
        xInput.style.fontSize = '14px'; // Match font size
        xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        xInput.style.backgroundColor='cornsilk';
        xInput.addEventListener('input', updateCubeDimensions);

        xInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //xInput.style.marginLeft = '50px';
        xLabelDiv.appendChild(xInput);
        labelsInputContainer.appendChild(xLabelDiv);

        var yLabelDiv = document.createElement('div');
        var yLabel = document.createElement('label');
        yLabel.textContent = 'Origine Y0 (m):';
        yLabel.style.display = 'block'; // Ensure label is on its own line
        yLabelDiv.appendChild(yLabel);
        var yInput = document.createElement('input');
        yInput.type = 'number';
        yInput.placeholder = 'Entrer la valeur';
        yInput.value = group_data_cube[index].prevPosY;
        yInput.style.color = 'blue'; // Set text color to blue
        yInput.style.display = 'block'; // Ensure label is on its own line
        yInput.style.width = '250px'; // Set width
        yInput.style.height = '20px'; // Set width
        yInput.style.padding = '5px'; // Adjust padding to match select
        yInput.style.border = '1px solid #ccc'; // Match border style
        yInput.style.fontSize = '14px'; // Match font size
        yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        yInput.style.backgroundColor='cornsilk';
        yInput.addEventListener('input', updateCubeDimensions);

        yInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //yInput.style.marginLeft = '50px';
        yLabelDiv.appendChild(yInput);
        labelsInputContainer.appendChild(yLabelDiv);

        var yfLabelDiv = document.createElement('div');
        var yfLabel = document.createElement('label');
        yfLabel.textContent = 'Position relative faîtage Y0 (m):';
        yfLabel.style.display = 'block'; // Ensure label is on its own line
        yfLabelDiv.appendChild(yfLabel);
        var yfInput = document.createElement('input');
        yfInput.type = 'number';
        yfInput.placeholder = 'Entrer la valeur';
        yfInput.value = group_data_cube[index].prevPosYf;
        yfInput.style.color = 'blue'; // Set text color to blue
        yfInput.style.display = 'block'; // Ensure label is on its own line
        yfInput.style.width = '250px'; // Set width
        yfInput.style.height = '20px'; // Set width
        yfInput.style.padding = '5px'; // Adjust padding to match select
        yfInput.style.border = '1px solid #ccc'; // Match border style
        yfInput.style.fontSize = '14px'; // Match font size
        yfInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        yfInput.style.backgroundColor='cornsilk';
        yfInput.addEventListener('input', updateCubeDimensions);

        yfInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //yInput.style.marginLeft = '50px';
        yfLabelDiv.appendChild(yfInput);
        labelsInputContainer.appendChild(yfLabelDiv);

        var zLabelDiv = document.createElement('div');
        var zLabel = document.createElement('label');
        zLabel.textContent = 'Origine Z0 (m):';
        zLabel.style.display = 'block'; // Ensure label is on its own line
        zLabelDiv.appendChild(zLabel);
        var zInput = document.createElement('input');
        zInput.type = 'number';
        zInput.placeholder = 'Entrer la valeur';
        zInput.value = group_data_cube[index].prevPosZ;
        zInput.style.color = 'blue'; // Set text color to blue
        zInput.style.display = 'block'; // Ensure label is on its own line
        zInput.style.width = '250px'; // Set width
        zInput.style.height = '20px'; // Set width
        zInput.style.padding = '5px'; // Adjust padding to match select
        zInput.style.border = '1px solid #ccc'; // Match border style
        zInput.style.fontSize = '14px'; // Match font size
        zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        zInput.style.backgroundColor='cornsilk';
        zInput.addEventListener('input', updateCubeDimensions);

        zInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //zInput.style.marginLeft = '50px';
        zLabelDiv.appendChild(zInput);
        labelsInputContainer.appendChild(zLabelDiv);

        var rotationAngleLabelDiv = document.createElement('div');
        var rotationAngleLabel = document.createElement('label');
        rotationAngleLabel.textContent = 'Angle autour de z (°):';
        rotationAngleLabel.style.display = 'block'; // Ensure label is on its own line
        rotationAngleLabelDiv.appendChild(rotationAngleLabel);
        var rotationAngle = document.createElement('input');
        rotationAngle.type = 'number';
        rotationAngle.placeholder = 'Entrer la valeur';
        rotationAngle.value = group_data_cube[index].prevRotZ;
        rotationAngle.style.color = 'blue'; // Set text color to blue
        rotationAngle.style.display = 'block'; // Ensure label is on its own line
        rotationAngle.style.width = '250px'; // Set width
        rotationAngle.style.height = '20px'; // Increase height for better visibility
        rotationAngle.style.padding = '5px'; // Add padding for better readability
        rotationAngle.style.border = '1px solid #ccc'; // Match border style
        rotationAngle.style.fontSize = '14px'; // Increase font size for better readability
        rotationAngle.style.boxSizing = 'border-box'; // Include padding and border in the width
        rotationAngle.style.backgroundColor = 'cornsilk'; // Light background color for visibility
        rotationAngle.addEventListener('input', updateCubeDimensions);

        rotationAngle.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //rotationAngle.style.marginLeft = '50px';
        rotationAngleLabelDiv.appendChild(rotationAngle);
        labelsInputContainer.appendChild(rotationAngleLabelDiv);

        var visibleLabelDiv = document.createElement('div');
        var visibleLabel = document.createElement('label');
        visibleLabel.textContent = 'Structure visible:';
        visibleLabelDiv.appendChild(visibleLabel);
        var option1 = document.createElement('option');
        option1.value='Oui';
        option1.textContent='Oui';
        select.appendChild(option1);
        select.style.color = 'blue'; // Set text color to blue
        select.style.width = '250px'; // Set width
        select.style.height = '20px'; // Set width
        select.style.padding = '0px'; // Adjust padding to match select
        select.style.border = '1px solid #ccc'; // Match border style
        select.style.fontSize = '14px'; // Match font size
        select.style.boxSizing = 'border-box'; // Include padding and border in the width
        select.style.backgroundColor='cornsilk';

        var option2 = document.createElement('option');
        option2.value='Non';
        option2.textContent='Non';
        select.appendChild(option2);
        select.style.color = 'blue'; // Set text color to blue
        if (group_data_cube[index].prevVisible==='Oui') {
            option1.selected=true;
            
        } else {

            option2.selected=true;
            
        }

        select.addEventListener('change', updateCubeDimensions);

        select.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        visibleLabelDiv.appendChild(select);
        labelsInputContainer.appendChild(visibleLabelDiv);

        var specLabelDiv = document.createElement('div');
        var specLabel = document.createElement('label');
        specLabel.textContent = 'Structure:';
        specLabelDiv.appendChild(specLabel);
        var option_1 = document.createElement('option');
        option_1.value='Ceinturée';
        option_1.textContent='Ceinturée';
        select_2.appendChild(option_1);
        select_2.style.color = 'blue'; // Set text color to blue
        select_2.style.width = '250px'; // Set width
        select_2.style.height = '20px'; // Set width
        select_2.style.padding = '0px'; // Adjust padding to match select
        select_2.style.border = '1px solid #ccc'; // Match border style
        select_2.style.fontSize = '14px'; // Match font size
        select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
        select_2.style.backgroundColor='cornsilk';

        var option_2 = document.createElement('option');
        option_2.value='Protégée';
        option_2.textContent='Protégée';
        select_2.appendChild(option_2);
        select_2.style.color = 'blue'; // Set text color to blue

        var option_3 = document.createElement('option');
        option_3.value='Ignorée';
        option_3.textContent='Ignorée';
        select_2.appendChild(option_3);
        select_2.style.color = 'blue'; // Set text color to blue

        var option_4 = document.createElement('option');
        option_4.value='Autre';
        option_4.textContent='Autre';
        select_2.appendChild(option_4);
        select_2.style.color = 'blue'; // Set text color to blue

        if (group_data_cube[index].prevSpec==='Ceinturée') {
            option_1.selected=true;
            
        } else if (group_data_cube[index].prevSpec==='Protégée') {

            option_2.selected=true;
            
        } else if (group_data_cube[index].prevSpec==='Ignorée') {

            option_3.selected=true;

        } else {
            
            option_4.selected=true;

        }

        select_2.addEventListener('change', updateCubeDimensions);

        select_2.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        specLabelDiv.appendChild(select_2);
        labelsInputContainer.appendChild(specLabelDiv);


        // Create and append label and input fields for cube color
        var colorInputDiv = document.createElement('div');
        //colorInputDiv.style.display = 'flex';
        //colorInputDiv.style.alignItems = 'center';
        var colorLabel = document.createElement('label');
        colorLabel.textContent = 'Couleur: ';
        colorInputDiv.appendChild(colorLabel);
        var colorInput = document.createElement('input');
        colorInput.type = 'color';
        //colorInput.style.marginLeft = '10px';
        colorInput.value = color_cube;
        colorInput.style.width = '250px'; // Set width
        colorInput.style.padding = '5px'; // Adjust padding to match select
        colorInput.style.border = '1px solid #ccc'; // Match border style
        colorInput.style.fontSize = '16px'; // Match font size
        colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        colorInput.addEventListener('input', updateCubeColor);

        colorInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //colorInput.style.marginLeft = '50px';
        colorInputDiv.appendChild(colorInput);
        labelsInputContainer.appendChild(colorInputDiv);


    }   else if (group.name=='group_cylinder') {


        var labelsInputContainer = document.getElementById('label-list');
        var select = document.createElement("select");
        var select_2 = document.createElement("select");

        // Create and append label and input fields for cube dimensions
        var RenameLabelDiv = document.createElement('div');
        var RenameLabel = document.createElement('label');
        RenameLabel.textContent = 'Renommer:';
        RenameLabel.style.display = 'block'; // Ensure label is on its own line
        RenameLabelDiv.appendChild(RenameLabel);
        var RenameInput = document.createElement('input');
        RenameInput.type = 'text';
        //widthInput.style.marginLeft = '150px';
        RenameInput.placeholder = 'Nom de la structure';
        RenameInput.value = group_data_cube[index].text_new_item;
        //widthInput.style.marginLeft = '50px';
        RenameInput.style.color = 'blue'; // Set text color to blue
        RenameInput.style.display = 'block'; // Ensure label is on its own line
        RenameInput.style.width = '250px'; // Set width
        RenameInput.style.height = '20px'; // Set width
        RenameInput.style.padding = '5px'; // Adjust padding to match select
        RenameInput.style.border = '1px solid #ccc'; // Match border style
        RenameInput.style.fontSize = '14px'; // Match font size
        RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        RenameInput.style.backgroundColor='cornsilk';
        RenameInput.addEventListener('input', updateCubeDimensions);

        RenameInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        RenameLabelDiv.appendChild(RenameInput);
        labelsInputContainer.appendChild(RenameLabelDiv);

        var RadiusTopLabelDiv = document.createElement('div');
        var RadiusTopLabel = document.createElement('label');
        RadiusTopLabel.textContent = 'Rayon supérieur (m):';
        RadiusTopLabel.style.display = 'block'; // Ensure label is on its own line
        RadiusTopLabelDiv.appendChild(RadiusTopLabel);
        var RadiusTopInput = document.createElement('input');
        RadiusTopInput.type = 'number';
        //widthInput.style.marginLeft = '150px';
        RadiusTopInput.placeholder = 'Enter value';
        RadiusTopInput.value = group_data_cube[index].prevRadiusTop; 
        //widthInput.style.marginLeft = '50px';
        RadiusTopInput.style.color = 'blue'; // Set text color to blue
        RadiusTopInput.style.display = 'block'; // Ensure label is on its own line
        RadiusTopInput.style.width = '250px'; // Set width
        RadiusTopInput.style.height = '20px'; // Set width
        RadiusTopInput.style.padding = '5px'; // Adjust padding to match select
        RadiusTopInput.style.border = '1px solid #ccc'; // Match border style
        RadiusTopInput.style.fontSize = '14px'; // Match font size
        RadiusTopInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        RadiusTopInput.style.backgroundColor='cornsilk';
        RadiusTopInput.addEventListener('input', updateCubeDimensions);

        RadiusTopInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        RadiusTopLabelDiv.appendChild(RadiusTopInput);
        labelsInputContainer.appendChild(RadiusTopLabelDiv);

        var RadiusBottomLabelDiv = document.createElement('div');
        var RadiusBottomLabel = document.createElement('label');
        RadiusBottomLabel.textContent = 'Rayon inférieur (m):';
        RadiusBottomLabel.style.display = 'block'; // Ensure label is on its own line
        RadiusBottomLabelDiv.appendChild(RadiusBottomLabel);
        var RadiusBottomInput = document.createElement('input');
        RadiusBottomInput.type = 'number';
        //widthInput.style.marginLeft = '150px';
        RadiusBottomInput.placeholder = 'Enter value';
        RadiusBottomInput.value = group_data_cube[index].prevRadiusBottom;
        //widthInput.style.marginLeft = '50px';
        RadiusBottomInput.style.color = 'blue'; // Set text color to blue
        RadiusBottomInput.style.display = 'block'; // Ensure label is on its own line
        RadiusBottomInput.style.width = '250px'; // Set width
        RadiusBottomInput.style.height = '20px'; // Set width
        RadiusBottomInput.style.padding = '5px'; // Adjust padding to match select
        RadiusBottomInput.style.border = '1px solid #ccc'; // Match border style
        RadiusBottomInput.style.fontSize = '14px'; // Match font size
        RadiusBottomInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        RadiusBottomInput.style.backgroundColor='cornsilk';
        RadiusBottomInput.addEventListener('input', updateCubeDimensions);

        RadiusBottomInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        RadiusBottomLabelDiv.appendChild(RadiusBottomInput);
        labelsInputContainer.appendChild(RadiusBottomLabelDiv);

        var heightLabelDiv = document.createElement('div');
        var heightLabel = document.createElement('label');
        heightLabel.textContent = 'Hauteur (m):';
        heightLabel.style.display = 'block'; // Ensure label is on its own line
        heightLabelDiv.appendChild(heightLabel);
        var heightInput = document.createElement('input');
        heightInput.type = 'number';
        heightInput.placeholder = 'Entrer la valeur';
        heightInput.value = group_data_cube[index].prevHeight;
        heightInput.style.color = 'blue'; // Set text color to blue
        heightInput.style.display = 'block'; // Ensure label is on its own line
        heightInput.style.width = '250px'; // Set width
        heightInput.style.height = '20px'; // Set width
        heightInput.style.padding = '5px'; // Adjust padding to match select
        heightInput.style.border = '1px solid #ccc'; // Match border style
        heightInput.style.fontSize = '14px'; // Match font size
        heightInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        heightInput.style.backgroundColor='cornsilk';
        heightInput.addEventListener('input', updateCubeDimensions);

        heightInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //heightInput.style.marginLeft = '50px';
        heightLabelDiv.appendChild(heightInput);
        labelsInputContainer.appendChild(heightLabelDiv);

        // Create and append label and input fields for cube position
        var xLabelDiv = document.createElement('div');
        var xLabel = document.createElement('label');
        xLabel.textContent = 'Origine X0 (m):';
        xLabel.style.display = 'block'; // Ensure label is on its own line
        xLabelDiv.appendChild(xLabel);
        var xInput = document.createElement('input');
        xInput.type = 'number';
        xInput.placeholder = 'Entrer la valeur';
        xInput.value =group_data_cube[index].prevPosX ;
        xInput.style.color = 'blue'; // Set text color to blue
        xInput.style.display = 'block'; // Ensure label is on its own line
        xInput.style.width = '250px'; // Set width
        xInput.style.height = '20px'; // Set width
        xInput.style.padding = '5px'; // Adjust padding to match select
        xInput.style.border = '1px solid #ccc'; // Match border style
        xInput.style.fontSize = '14px'; // Match font size
        xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        xInput.style.backgroundColor='cornsilk';
        xInput.addEventListener('input', updateCubeDimensions);

        xInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //xInput.style.marginLeft = '50px';
        xLabelDiv.appendChild(xInput);
        labelsInputContainer.appendChild(xLabelDiv);

        var yLabelDiv = document.createElement('div');
        var yLabel = document.createElement('label');
        yLabel.textContent = 'Origine Y0 (m):';
        yLabel.style.display = 'block'; // Ensure label is on its own line
        yLabelDiv.appendChild(yLabel);
        var yInput = document.createElement('input');
        yInput.type = 'number';
        yInput.placeholder = 'Entrer la valeur';
        yInput.value = group_data_cube[index].prevPosY;
        yInput.style.color = 'blue'; // Set text color to blue
        yInput.style.display = 'block'; // Ensure label is on its own line
        yInput.style.width = '250px'; // Set width
        yInput.style.height = '20px'; // Set width
        yInput.style.padding = '5px'; // Adjust padding to match select
        yInput.style.border = '1px solid #ccc'; // Match border style
        yInput.style.fontSize = '14px'; // Match font size
        yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        yInput.style.backgroundColor='cornsilk';
        yInput.addEventListener('input', updateCubeDimensions);

        yInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //yInput.style.marginLeft = '50px';
        yLabelDiv.appendChild(yInput);
        labelsInputContainer.appendChild(yLabelDiv);

        var zLabelDiv = document.createElement('div');
        var zLabel = document.createElement('label');
        zLabel.textContent = 'Origine Z0 (m):';
        zLabel.style.display = 'block'; // Ensure label is on its own line
        zLabelDiv.appendChild(zLabel);
        var zInput = document.createElement('input');
        zInput.type = 'number';
        zInput.placeholder = 'Entrer la valeur';
        zInput.value = group_data_cube[index].prevPosZ;
        zInput.style.color = 'blue'; // Set text color to blue
        zInput.style.display = 'block'; // Ensure label is on its own line
        zInput.style.width = '250px'; // Set width
        zInput.style.height = '20px'; // Set width
        zInput.style.padding = '5px'; // Adjust padding to match select
        zInput.style.border = '1px solid #ccc'; // Match border style
        zInput.style.fontSize = '14px'; // Match font size
        zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        zInput.style.backgroundColor='cornsilk';
        zInput.addEventListener('input', updateCubeDimensions);

        zInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //zInput.style.marginLeft = '50px';
        zLabelDiv.appendChild(zInput);
        labelsInputContainer.appendChild(zLabelDiv);

        var visibleLabelDiv = document.createElement('div');
        var visibleLabel = document.createElement('label');
        visibleLabel.textContent = 'Structure visible:';
        visibleLabelDiv.appendChild(visibleLabel);
        var option1 = document.createElement('option');
        option1.value='Oui';
        option1.textContent='Oui';
        select.appendChild(option1);
        select.style.color = 'blue'; // Set text color to blue
        var option2 = document.createElement('option');
        option2.value='Non';
        option2.textContent='Non';
        select.appendChild(option2);
        select.style.color = 'blue'; // Set text color to blue
        select.style.width = '250px'; // Set width
        select.style.height = '20px'; // Set width
        select.style.padding = '0px'; // Adjust padding to match select
        select.style.border = '1px solid #ccc'; // Match border style
        select.style.fontSize = '14px'; // Match font size
        select.style.boxSizing = 'border-box'; // Include padding and border in the width
        select.style.backgroundColor='cornsilk';

        if (group_data_cube[index].prevVisible==='Oui') {
            option1.selected=true;
            
        } else {

            option2.selected=true;
            
        }

        select.addEventListener('change', updateCubeDimensions);

        select.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        visibleLabelDiv.appendChild(select);
        labelsInputContainer.appendChild(visibleLabelDiv);

        var specLabelDiv = document.createElement('div');
        var specLabel = document.createElement('label');
        specLabel.textContent = 'Structure:';
        specLabelDiv.appendChild(specLabel);
        var option_1 = document.createElement('option');
        option_1.value='Ceinturée';
        option_1.textContent='Ceinturée';
        select_2.appendChild(option_1);
        select_2.style.color = 'blue'; // Set text color to blue
        select_2.style.width = '250px'; // Set width
        select_2.style.height = '20px'; // Set width
        select_2.style.padding = '0px'; // Adjust padding to match select
        select_2.style.border = '1px solid #ccc'; // Match border style
        select_2.style.fontSize = '14px'; // Match font size
        select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
        select_2.style.backgroundColor='cornsilk';
        var option_2 = document.createElement('option');
        option_2.value='Protégée';
        option_2.textContent='Protégée';
        select_2.appendChild(option_2);
        select_2.style.color = 'blue'; // Set text color to blue

        var option_3 = document.createElement('option');
        option_3.value='Ignorée';
        option_3.textContent='Ignorée';
        select_2.appendChild(option_3);
        select_2.style.color = 'blue'; // Set text color to blue

        var option_4 = document.createElement('option');
        option_4.value='Autre';
        option_4.textContent='Autre';
        select_2.appendChild(option_4);
        select_2.style.color = 'blue'; // Set text color to blue

        if (group_data_cube[index].prevSpec==='Ceinturée') {
            option_1.selected=true;
            
        } else if (group_data_cube[index].prevSpec==='Protégée') {

            option_2.selected=true;
            
        } else if (group_data_cube[index].prevSpec==='Ignorée') {

            option_3.selected=true;

        } else {
            
            option_4.selected=true;

        }

        select_2.addEventListener('change', updateCubeDimensions);

        select_2.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        specLabelDiv.appendChild(select_2);
        labelsInputContainer.appendChild(specLabelDiv);

        // Create and append label and input fields for cube color
        var colorInputDiv = document.createElement('div');
        //colorInputDiv.style.display = 'flex';
        //colorInputDiv.style.alignItems = 'center';
        var colorLabel = document.createElement('label');
        colorLabel.textContent = 'Couleur: ';
        colorInputDiv.appendChild(colorLabel);
        var colorInput = document.createElement('input');
        colorInput.type = 'color';
        //colorInput.style.marginLeft = '10px';
        colorInput.value = color_cube;
        colorInput.style.width = '250px'; // Set width
        colorInput.style.padding = '5px'; // Adjust padding to match select
        colorInput.style.border = '1px solid #ccc'; // Match border style
        colorInput.style.fontSize = '16px'; // Match font size
        colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        colorInput.addEventListener('input', updateCubeColor);

        colorInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //colorInput.style.marginLeft = '50px';
        colorInputDiv.appendChild(colorInput);
        labelsInputContainer.appendChild(colorInputDiv);


    } else if (group.name=='group_cylinderh') {

    var labelsInputContainer = document.getElementById('label-list');
    var select = document.createElement("select");
    var select_2 = document.createElement("select");

    // Create and append label and input fields for cube dimensions
    var RenameLabelDiv = document.createElement('div');
    var RenameLabel = document.createElement('label');
    RenameLabel.textContent = 'Renommer:';
    RenameLabel.style.display = 'block'; // Ensure label is on its own line
    RenameLabelDiv.appendChild(RenameLabel);
    var RenameInput = document.createElement('input');
    RenameInput.type = 'text';
    //widthInput.style.marginLeft = '150px';
    RenameInput.placeholder = 'Nom de la structure';
    RenameInput.value = group_data_cube[index].text_new_item;
    //widthInput.style.marginLeft = '50px';
    RenameInput.style.color = 'blue'; // Set text color to blue
    RenameInput.style.display = 'block'; // Ensure label is on its own line
    RenameInput.style.width = '250px'; // Set width
    RenameInput.style.height = '20px'; // Set width
    RenameInput.style.padding = '5px'; // Adjust padding to match select
    RenameInput.style.border = '1px solid #ccc'; // Match border style
    RenameInput.style.fontSize = '14px'; // Match font size
    RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
    RenameInput.style.backgroundColor='cornsilk';
    RenameInput.addEventListener('input', updateCubeDimensions);

    RenameInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
    });

    RenameLabelDiv.appendChild(RenameInput);
    labelsInputContainer.appendChild(RenameLabelDiv);

    var RadiusLabelDiv = document.createElement('div');
    var RadiusLabel = document.createElement('label');
    RadiusLabel.textContent = 'Rayon (m):';
    RadiusLabel.style.display = 'block'; // Ensure label is on its own line
    RadiusLabelDiv.appendChild(RadiusLabel);
    var RadiusInput = document.createElement('input');
    RadiusInput.type = 'number';
    //widthInput.style.marginLeft = '150px';
    RadiusInput.placeholder = 'Enter value';
    RadiusInput.value = group_data_cube[index].prevRadius; 
    //widthInput.style.marginLeft = '50px';
    RadiusInput.style.color = 'blue'; // Set text color to blue
    RadiusInput.style.width = '250px'; // Set width
    RadiusInput.style.height = '20px'; // Set width
    RadiusInput.style.padding = '5px'; // Adjust padding to match select
    RadiusInput.style.border = '1px solid #ccc'; // Match border style
    RadiusInput.style.fontSize = '14px'; // Match font size
    RadiusInput.style.boxSizing = 'border-box'; // Include padding and border in the width
    RadiusInput.style.backgroundColor='cornsilk';
    RadiusInput.style.display = 'block'; // Ensure label is on its own line
    RadiusInput.addEventListener('input', updateCubeDimensions);

    RadiusInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
    });

    RadiusLabelDiv.appendChild(RadiusInput);
    labelsInputContainer.appendChild(RadiusLabelDiv);

    var LengthLabelDiv = document.createElement('div');
    var LengthLabel = document.createElement('label');
    LengthLabel.textContent = 'Longueur (m):';
    LengthLabel.style.display = 'block'; // Ensure label is on its own line
    LengthLabelDiv.appendChild(LengthLabel);
    var LengthInput = document.createElement('input');
    LengthInput.type = 'number';
    LengthInput.placeholder = 'Entrer la valeur';
    LengthInput.value = group_data_cube[index].prevLength;
    LengthInput.style.color = 'blue'; // Set text color to blue
    LengthInput.style.display = 'block'; // Ensure label is on its own line
    LengthInput.style.width = '250px'; // Set width
    LengthInput.style.height = '20px'; // Set width
    LengthInput.style.padding = '5px'; // Adjust padding to match select
    LengthInput.style.border = '1px solid #ccc'; // Match border style
    LengthInput.style.fontSize = '14px'; // Match font size
    LengthInput.style.boxSizing = 'border-box'; // Include padding and border in the width
    LengthInput.style.backgroundColor='cornsilk';
    LengthInput.addEventListener('input', updateCubeDimensions);

    LengthInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
    });

    //heightInput.style.marginLeft = '50px';
    LengthLabelDiv.appendChild(LengthInput);
    labelsInputContainer.appendChild(LengthLabelDiv);

    // Create and append label and input fields for cube position
    var xLabelDiv = document.createElement('div');
    var xLabel = document.createElement('label');
    xLabel.textContent = 'Origine X0 (m):';
    xLabel.style.display = 'block'; // Ensure label is on its own line
    xLabelDiv.appendChild(xLabel);
    var xInput = document.createElement('input');
    xInput.type = 'number';
    xInput.placeholder = 'Entrer la valeur';
    xInput.value =group_data_cube[index].prevPosX ;
    xInput.style.color = 'blue'; // Set text color to blue
    xInput.style.display = 'block'; // Ensure label is on its own line
    xInput.style.width = '250px'; // Set width
    xInput.style.height = '20px'; // Set width
    xInput.style.padding = '5px'; // Adjust padding to match select
    xInput.style.border = '1px solid #ccc'; // Match border style
    xInput.style.fontSize = '14px'; // Match font size
    xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
    xInput.style.backgroundColor='cornsilk';
    xInput.addEventListener('input', updateCubeDimensions);

    xInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
    });

    //xInput.style.marginLeft = '50px';
    xLabelDiv.appendChild(xInput);
    labelsInputContainer.appendChild(xLabelDiv);

    var yLabelDiv = document.createElement('div');
    var yLabel = document.createElement('label');
    yLabel.textContent = 'Origine Y0 (m):';
    yLabel.style.display = 'block'; // Ensure label is on its own line
    yLabelDiv.appendChild(yLabel);
    var yInput = document.createElement('input');
    yInput.type = 'number';
    yInput.placeholder = 'Entrer la valeur';
    yInput.value = group_data_cube[index].prevPosY;
    yInput.style.color = 'blue'; // Set text color to blue
    yInput.style.display = 'block'; // Ensure label is on its own line
    yInput.style.width = '250px'; // Set width
    yInput.style.height = '20px'; // Set width
    yInput.style.padding = '5px'; // Adjust padding to match select
    yInput.style.border = '1px solid #ccc'; // Match border style
    yInput.style.fontSize = '14px'; // Match font size
    yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
    yInput.style.backgroundColor='cornsilk';
    yInput.addEventListener('input', updateCubeDimensions);

    yInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
    });

    //yInput.style.marginLeft = '50px';
    yLabelDiv.appendChild(yInput);
    labelsInputContainer.appendChild(yLabelDiv);

    var zLabelDiv = document.createElement('div');
    var zLabel = document.createElement('label');
    zLabel.textContent = 'Origine Z0 (m):';
    zLabel.style.display = 'block'; // Ensure label is on its own line
    zLabelDiv.appendChild(zLabel);
    var zInput = document.createElement('input');
    zInput.type = 'number';
    zInput.placeholder = 'Entrer la valeur';
    zInput.value = group_data_cube[index].prevPosZ;
    zInput.style.color = 'blue'; // Set text color to blue
    zInput.style.display = 'block'; // Ensure label is on its own line
    zInput.style.width = '250px'; // Set width
    zInput.style.height = '20px'; // Set width
    zInput.style.padding = '5px'; // Adjust padding to match select
    zInput.style.border = '1px solid #ccc'; // Match border style
    zInput.style.fontSize = '14px'; // Match font size
    zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
    zInput.style.backgroundColor='cornsilk';
    zInput.addEventListener('input', updateCubeDimensions);

    zInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
    });

    //zInput.style.marginLeft = '50px';
    zLabelDiv.appendChild(zInput);
    labelsInputContainer.appendChild(zLabelDiv);

    var rotationAngleLabelDiv = document.createElement('div');
    var rotationAngleLabel = document.createElement('label');
    rotationAngleLabel.textContent = 'Angle autour de z (°):';
    rotationAngleLabel.style.display = 'block'; // Ensure label is on its own line
    rotationAngleLabelDiv.appendChild(rotationAngleLabel);
    var rotationAngle = document.createElement('input');
    rotationAngle.type = 'number';
    rotationAngle.placeholder = 'Entrer la valeur';
    rotationAngle.value = group_data_cube[index].prevRotZ;
    rotationAngle.style.color = 'blue'; // Set text color to blue
    rotationAngle.style.display = 'block'; // Ensure label is on its own line
    rotationAngle.style.width = '250px'; // Set width
    rotationAngle.style.height = '20px'; // Increase height for better visibility
    rotationAngle.style.padding = '5px'; // Add padding for better readability
    rotationAngle.style.border = '1px solid #ccc'; // Match border style
    rotationAngle.style.fontSize = '14px'; // Increase font size for better readability
    rotationAngle.style.boxSizing = 'border-box'; // Include padding and border in the width
    rotationAngle.style.backgroundColor = 'cornsilk'; // Light background color for visibility
    rotationAngle.addEventListener('input', updateCubeDimensions);

    rotationAngle.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
    });

    //rotationAngle.style.marginLeft = '50px';
    rotationAngleLabelDiv.appendChild(rotationAngle);
    labelsInputContainer.appendChild(rotationAngleLabelDiv);
    
    var visibleLabelDiv = document.createElement('div');
    var visibleLabel = document.createElement('label');
    visibleLabel.textContent = 'Structure visible:';
    visibleLabelDiv.appendChild(visibleLabel);
    var option1 = document.createElement('option');
    option1.value='Oui';
    option1.textContent='Oui';
    select.appendChild(option1);
    select.style.color = 'blue'; // Set text color to blue
    select.style.width = '250px'; // Set width
    select.style.height = '20px'; // Set width
    select.style.padding = '0px'; // Adjust padding to match select
    select.style.border = '1px solid #ccc'; // Match border style
    select.style.fontSize = '14px'; // Match font size
    select.style.boxSizing = 'border-box'; // Include padding and border in the width
    select.style.backgroundColor='cornsilk';

    var option2 = document.createElement('option');
    option2.value='Non';
    option2.textContent='Non';
    select.appendChild(option2);
    select.style.color = 'blue'; // Set text color to blue
    if (group_data_cube[index].prevVisible==='Oui') {
        option1.selected=true;
        
    } else {

        option2.selected=true;
        
    }

    select.addEventListener('change', updateCubeDimensions);

    select.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
    });

    visibleLabelDiv.appendChild(select);
    labelsInputContainer.appendChild(visibleLabelDiv);

    var specLabelDiv = document.createElement('div');
    var specLabel = document.createElement('label');
    specLabel.textContent = 'Structure:';
    specLabelDiv.appendChild(specLabel);
    var option_1 = document.createElement('option');
    option_1.value='Ceinturée';
    option_1.textContent='Ceinturée';
    select_2.appendChild(option_1);
    select_2.style.color = 'blue'; // Set text color to blue
    var option_2 = document.createElement('option');
    option_2.value='Protégée';
    option_2.textContent='Protégée';
    select_2.appendChild(option_2);
    select_2.style.color = 'blue'; // Set text color to blue
    select_2.style.width = '250px'; // Set width
    select_2.style.height = '20px'; // Set width
    select_2.style.padding = '0px'; // Adjust padding to match select
    select_2.style.border = '1px solid #ccc'; // Match border style
    select_2.style.fontSize = '14px'; // Match font size
    select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
    select_2.style.backgroundColor='cornsilk';


    var option_3 = document.createElement('option');
    option_3.value='Ignorée';
    option_3.textContent='Ignorée';
    select_2.appendChild(option_3);
    select_2.style.color = 'blue'; // Set text color to blue

    var option_4 = document.createElement('option');
    option_4.value='Autre';
    option_4.textContent='Autre';
    select_2.appendChild(option_4);
    select_2.style.color = 'blue'; // Set text color to blue

    if (group_data_cube[index].prevSpec==='Ceinturée') {
        option_1.selected=true;
        
    } else if (group_data_cube[index].prevSpec==='Protégée') {

        option_2.selected=true;
        
    } else if (group_data_cube[index].prevSpec==='Ignorée') {

        option_3.selected=true;

    } else {
        
        option_4.selected=true;

    }

    select_2.addEventListener('change', updateCubeDimensions);

    select_2.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
    });

    specLabelDiv.appendChild(select_2);
    labelsInputContainer.appendChild(specLabelDiv);

    // Create and append label and input fields for cube color
    var colorInputDiv = document.createElement('div');
    //colorInputDiv.style.display = 'flex';
    //colorInputDiv.style.alignItems = 'center';
    var colorLabel = document.createElement('label');
    colorLabel.textContent = 'Couleur: ';
    colorInputDiv.appendChild(colorLabel);
    var colorInput = document.createElement('input');
    colorInput.type = 'color';
    //colorInput.style.marginLeft = '10px';
    colorInput.value = color_cube;
    colorInput.style.width = '250px'; // Set width
    colorInput.style.padding = '5px'; // Adjust padding to match select
    colorInput.style.border = '1px solid #ccc'; // Match border style
    colorInput.style.fontSize = '16px'; // Match font size
    colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width
    colorInput.addEventListener('input', updateCubeColor);

    colorInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
    });

    //colorInput.style.marginLeft = '50px';
    colorInputDiv.appendChild(colorInput);
    labelsInputContainer.appendChild(colorInputDiv);
    ///////////////

    }   else if (group.name=='group_pda') {

        var labelsInputContainer = document.getElementById('label-list');
        var select = document.createElement("select");
        var select_2 = document.createElement("select");
        var select_3 = document.createElement("select");


        // Create and append label and input fields for cube dimensions
        var RenameLabelDiv = document.createElement('div');
        var RenameLabel = document.createElement('label');
        RenameLabel.textContent = 'Renommer:';
        RenameLabel.style.display = 'block'; // Ensure label is on its own line
        RenameLabelDiv.appendChild(RenameLabel);
        var RenameInput = document.createElement('input');
        RenameInput.type = 'text';
        //widthInput.style.marginLeft = '150px';
        RenameInput.placeholder = 'Nom de la structure';
        RenameInput.value = group_data_cube[index].text_new_item;
        //widthInput.style.marginLeft = '50px';
        RenameInput.style.color = 'blue'; // Set text color to blue
        RenameInput.style.display = 'block'; // Ensure label is on its own line
        RenameInput.style.width = '250px'; // Set width
        RenameInput.style.height = '20px'; // Set width
        RenameInput.style.padding = '5px'; // Adjust padding to match select
        RenameInput.style.border = '1px solid #ccc'; // Match border style
        RenameInput.style.fontSize = '14px'; // Match font size
        RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        RenameInput.style.backgroundColor='cornsilk';
        RenameInput.addEventListener('input', updateCubeDimensions);

        RenameInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        RenameLabelDiv.appendChild(RenameInput);
        labelsInputContainer.appendChild(RenameLabelDiv);

        var heightLabelDiv = document.createElement('div');
        var heightLabel = document.createElement('label');
        heightLabel.textContent = 'Hauteur (m):';
        heightLabel.style.display = 'block'; // Ensure label is on its own line
        heightLabelDiv.appendChild(heightLabel);
        var heightInput = document.createElement('input');
        heightInput.type = 'number';
        heightInput.placeholder = 'Entrer la valeur';
        heightInput.value = group_data_cube[index].prevHeight;
        heightInput.style.color = 'blue'; // Set text color to blue
        heightInput.style.display = 'block'; // Ensure label is on its own line
        heightInput.style.width = '250px'; // Set width
        heightInput.style.height = '20px'; // Set width
        heightInput.style.padding = '5px'; // Adjust padding to match select
        heightInput.style.border = '1px solid #ccc'; // Match border style
        heightInput.style.fontSize = '14px'; // Match font size
        heightInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        heightInput.style.backgroundColor='cornsilk';
        heightInput.addEventListener('input', updateCubeDimensions);

        heightInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //heightInput.style.marginLeft = '50px';
        heightLabelDiv.appendChild(heightInput);
        labelsInputContainer.appendChild(heightLabelDiv);

        // Create and append label and input fields for cube position
        var xLabelDiv = document.createElement('div');
        var xLabel = document.createElement('label');
        xLabel.textContent = 'Origine X0 (m):';
        xLabel.style.display = 'block'; // Ensure label is on its own line
        xLabelDiv.appendChild(xLabel);
        var xInput = document.createElement('input');
        xInput.type = 'number';
        xInput.placeholder = 'Entrer la valeur';
        xInput.value =group_data_cube[index].prevPosX ;
        xInput.style.color = 'blue'; // Set text color to blue
        xInput.style.display = 'block'; // Ensure label is on its own line
        xInput.style.width = '250px'; // Set width
        xInput.style.height = '20px'; // Set width
        xInput.style.padding = '5px'; // Adjust padding to match select
        xInput.style.border = '1px solid #ccc'; // Match border style
        xInput.style.fontSize = '14px'; // Match font size
        xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        xInput.style.backgroundColor='cornsilk';
        xInput.addEventListener('input', updateCubeDimensions);

        xInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //xInput.style.marginLeft = '50px';
        xLabelDiv.appendChild(xInput);
        labelsInputContainer.appendChild(xLabelDiv);

        var yLabelDiv = document.createElement('div');
        var yLabel = document.createElement('label');
        yLabel.textContent = 'Origine Y0 (m):';
        yLabel.style.display = 'block'; // Ensure label is on its own line
        yLabelDiv.appendChild(yLabel);
        var yInput = document.createElement('input');
        yInput.type = 'number';
        yInput.placeholder = 'Entrer la valeur';
        yInput.value = group_data_cube[index].prevPosY;
        yInput.style.color = 'blue'; // Set text color to blue
        yInput.style.display = 'block'; // Ensure label is on its own line
        yInput.style.width = '250px'; // Set width
        yInput.style.height = '20px'; // Set width
        yInput.style.padding = '5px'; // Adjust padding to match select
        yInput.style.border = '1px solid #ccc'; // Match border style
        yInput.style.fontSize = '14px'; // Match font size
        yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        yInput.style.backgroundColor='cornsilk';
        yInput.addEventListener('input', updateCubeDimensions);

        yInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //yInput.style.marginLeft = '50px';
        yLabelDiv.appendChild(yInput);
        labelsInputContainer.appendChild(yLabelDiv);

        var zLabelDiv = document.createElement('div');
        var zLabel = document.createElement('label');
        zLabel.textContent = 'Origine Z0 (m):';
        zLabel.style.display = 'block'; // Ensure label is on its own line
        zLabelDiv.appendChild(zLabel);
        var zInput = document.createElement('input');
        zInput.type = 'number';
        zInput.placeholder = 'Entrer la valeur';
        zInput.value = group_data_cube[index].prevPosZ;
        zInput.style.color = 'blue'; // Set text color to blue
        zInput.style.display = 'block'; // Ensure label is on its own line
        zInput.style.width = '250px'; // Set width
        zInput.style.height = '20px'; // Set width
        zInput.style.padding = '5px'; // Adjust padding to match select
        zInput.style.border = '1px solid #ccc'; // Match border style
        zInput.style.fontSize = '14px'; // Match font size
        zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        zInput.style.backgroundColor='cornsilk';
        zInput.addEventListener('input', updateCubeDimensions);

        zInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //zInput.style.marginLeft = '50px';
        zLabelDiv.appendChild(zInput);
        labelsInputContainer.appendChild(zLabelDiv);
        
        var DeltaTLabelDiv = document.createElement('div');
        var DeltaTLabel = document.createElement('label');
        DeltaTLabel.textContent = "Avance à l'amorçage (µs):";
        DeltaTLabel.style.display = 'block'; // Ensure label is on its own line
        DeltaTLabelDiv.appendChild(DeltaTLabel);
        var DeltaTInput = document.createElement('input');
        DeltaTInput.type = 'number';
        DeltaTInput.placeholder = 'Entrer la valeur';
        DeltaTInput.value = group_data_cube[index].prevDeltaT;
        DeltaTInput.style.color = 'blue'; // Set text color to blue
        DeltaTInput.style.display = 'block'; // Ensure label is on its own line
        DeltaTInput.style.width = '250px'; // Set width
        DeltaTInput.style.height = '20px'; // Set width
        DeltaTInput.style.padding = '5px'; // Adjust padding to match select
        DeltaTInput.style.border = '1px solid #ccc'; // Match border style
        DeltaTInput.style.fontSize = '14px'; // Match font size
        DeltaTInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        DeltaTInput.style.backgroundColor='cornsilk';
        DeltaTInput.addEventListener('input', updateCubeDimensions);

        DeltaTInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //zInput.style.marginLeft = '50px';
        DeltaTLabelDiv.appendChild(DeltaTInput);
        labelsInputContainer.appendChild(DeltaTLabelDiv);

        var visibleLabelDiv = document.createElement('div');
        var visibleLabel = document.createElement('label');
        visibleLabel.textContent = 'Structure visible:';
        visibleLabelDiv.appendChild(visibleLabel);
        var option1 = document.createElement('option');
        option1.value='Oui';
        option1.textContent='Oui';
        select.appendChild(option1);
        select.style.color = 'blue'; // Set text color to blue
        var option2 = document.createElement('option');
        option2.value='Non';
        option2.textContent='Non';
        select.appendChild(option2);
        select.style.color = 'blue'; // Set text color to blue
        select.style.width = '250px'; // Set width
        select.style.height = '20px'; // Set width
        select.style.padding = '0px'; // Adjust padding to match select
        select.style.border = '1px solid #ccc'; // Match border style
        select.style.fontSize = '14px'; // Match font size
        select.style.boxSizing = 'border-box'; // Include padding and border in the width
        select.style.backgroundColor='cornsilk';

        if (group_data_cube[index].prevVisible==='Oui') {
            option1.selected=true;
            
        } else {

            option2.selected=true;
            
        }

        select.addEventListener('change', updateCubeDimensions);

        select.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        visibleLabelDiv.appendChild(select);
        labelsInputContainer.appendChild(visibleLabelDiv);

        var specLabelDiv = document.createElement('div');
        var specLabel = document.createElement('label');
        specLabel.textContent = 'Structure:';
        specLabelDiv.appendChild(specLabel);

        var option_3 = document.createElement('option');
        option_3.value='Ignorée';
        option_3.textContent='Ignorée';
        select_2.appendChild(option_3);
        select_2.style.color = 'blue'; // Set text color to blue

        var option_4 = document.createElement('option');
        option_4.value='Autre';
        option_4.textContent='Autre';
        select_2.appendChild(option_4);
        select_2.style.color = 'blue'; // Set text color to blue
        select_2.style.width = '250px'; // Set width
        select_2.style.height = '20px'; // Set width
        select_2.style.padding = '0px'; // Adjust padding to match select
        select_2.style.border = '1px solid #ccc'; // Match border style
        select_2.style.fontSize = '14px'; // Match font size
        select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
        select_2.style.backgroundColor='cornsilk';
            
        if (group_data_cube[index].prevSpec==='Ignorée') {

            option_3.selected=true;

        } else {
            
            option_4.selected=true;

        }

        select_2.addEventListener('change', updateCubeDimensions);

        select_2.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        specLabelDiv.appendChild(select_2);
        labelsInputContainer.appendChild(specLabelDiv);

        //////////////////////////////////////////////////////
        var specLabel2Div = document.createElement('div');
        var specLabel2 = document.createElement('label');
        specLabel2.textContent = 'Installation:';
        specLabel2Div.appendChild(specLabel2);

        var option_4 = document.createElement('option');
        option_4.value='ICPE';
        option_4.textContent='ICPE';
        select_3.appendChild(option_4);
        select_3.style.color = 'blue'; // Set text color to blue

        var option_5 = document.createElement('option');
        option_5.value='Autre';
        option_5.textContent='Autre';
        select_3.appendChild(option_5);
        select_3.style.color = 'blue'; // Set text color to blue
        select_3.style.width = '250px'; // Set width
        select_3.style.height = '20px'; // Set width
        select_3.style.padding = '0px'; // Adjust padding to match select
        select_3.style.border = '1px solid #ccc'; // Match border style
        select_3.style.fontSize = '14px'; // Match font size
        select_3.style.boxSizing = 'border-box'; // Include padding and border in the width
        select_3.style.backgroundColor='cornsilk';
            
        if (group_data_cube[index].prevICPE==='ICPE') {

            option_4.selected=true;

        } else {
            
            option_5.selected=true;

        }

        select_3.addEventListener('change', updateCubeDimensions);

        select_3.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        specLabel2Div.appendChild(select_3);
        labelsInputContainer.appendChild(specLabel2Div);

        /////////////////////////////////////////////////////


        var eplineLabelDiv = document.createElement('div');
        var eplineLabel = document.createElement('label');
        eplineLabel.textContent = 'Epaissue de la ligne (m):';
        eplineLabel.style.display = 'block'; // Ensure label is on its own line
        eplineLabelDiv.appendChild(eplineLabel);
        var eplineInput = document.createElement('input');
        eplineInput.type = 'number';
        eplineInput.placeholder = 'Entrer la valeur';
        eplineInput.value = group_data_cube[index].prevLineWidth;
        eplineInput.step = '0.01'; // Set the step attribute to 0.1
        eplineInput.style.color = 'blue'; // Set text color to blue
        eplineInput.style.display = 'block'; // Ensure label is on its own line
        eplineInput.style.width = '250px'; // Set width
        eplineInput.style.height = '20px'; // Set width
        eplineInput.style.padding = '0px'; // Adjust padding to match select
        eplineInput.style.border = '1px solid #ccc'; // Match border style
        eplineInput.style.fontSize = '14px'; // Match font size
        eplineInput.style.boxSizing = 'border-box'; // Include padding and border in the width
        eplineInput.style.backgroundColor='cornsilk';

        eplineInput.addEventListener('input', updateCubeDimensions);

        eplineInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //heightInput.style.marginLeft = '50px';
        eplineLabelDiv.appendChild(eplineInput);
        labelsInputContainer.appendChild(eplineLabelDiv);

        // Create and append label and input fields for cube color
        var colorInputDiv = document.createElement('div');
        //colorInputDiv.style.display = 'flex';
        //colorInputDiv.style.alignItems = 'center';
        var colorLabel = document.createElement('label');
        colorLabel.textContent = 'Couleur: ';
        colorInputDiv.appendChild(colorLabel);
        var colorInput = document.createElement('input');
        colorInput.type = 'color';
        //colorInput.style.marginLeft = '10px';
        colorInput.value = color_cube;
        colorInput.style.width = '250px'; // Set width
        colorInput.style.padding = '5px'; // Adjust padding to match select
        colorInput.style.border = '1px solid #ccc'; // Match border style
        colorInput.style.fontSize = '16px'; // Match font size
        colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width

        colorInput.addEventListener('input', updateCubeColor);

        colorInput.addEventListener('blur', function() {
            saveState(); // Sauvegarder uniquement à la sortie du champ
        });

        //colorInput.style.marginLeft = '50px';
        colorInputDiv.appendChild(colorInput);
        labelsInputContainer.appendChild(colorInputDiv);
  

    } else if (group.name=='group_pts') {


var labelsInputContainer = document.getElementById('label-list');
var select = document.createElement("select");
var select_2 = document.createElement("select");

// Create and append label and input fields for cube dimensions
var RenameLabelDiv = document.createElement('div');
var RenameLabel = document.createElement('label');
RenameLabel.textContent = 'Renommer:';
RenameLabel.style.display = 'block'; // Ensure label is on its own line
RenameLabelDiv.appendChild(RenameLabel);
var RenameInput = document.createElement('input');
RenameInput.type = 'text';
//widthInput.style.marginLeft = '150px';
RenameInput.placeholder = 'Nom de la structure';
RenameInput.value = group_data_cube[index].text_new_item;
//widthInput.style.marginLeft = '50px';
RenameInput.style.color = 'blue'; // Set text color to blue
RenameInput.style.display = 'block'; // Ensure label is on its own line
RenameInput.style.width = '250px'; // Set width
RenameInput.style.height = '20px'; // Set width
RenameInput.style.padding = '5px'; // Adjust padding to match select
RenameInput.style.border = '1px solid #ccc'; // Match border style
RenameInput.style.fontSize = '14px'; // Match font size
RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
RenameInput.style.backgroundColor='cornsilk';
RenameInput.addEventListener('input', updateCubeDimensions);

RenameInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

RenameLabelDiv.appendChild(RenameInput);
labelsInputContainer.appendChild(RenameLabelDiv);

var heightLabelDiv = document.createElement('div');
var heightLabel = document.createElement('label');
heightLabel.textContent = 'Hauteur (m):';
heightLabel.style.display = 'block'; // Ensure label is on its own line
heightLabelDiv.appendChild(heightLabel);
var heightInput = document.createElement('input');
heightInput.type = 'number';
heightInput.placeholder = 'Entrer la valeur';
heightInput.value = group_data_cube[index].prevHeight;
heightInput.style.color = 'blue'; // Set text color to blue
heightInput.style.display = 'block'; // Ensure label is on its own line
heightInput.style.width = '250px'; // Set width
heightInput.style.height = '20px'; // Set width
heightInput.style.padding = '5px'; // Adjust padding to match select
heightInput.style.border = '1px solid #ccc'; // Match border style
heightInput.style.fontSize = '14px'; // Match font size
heightInput.style.boxSizing = 'border-box'; // Include padding and border in the width
heightInput.style.backgroundColor='cornsilk';
heightInput.addEventListener('input', updateCubeDimensions);

heightInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//heightInput.style.marginLeft = '50px';
heightLabelDiv.appendChild(heightInput);
labelsInputContainer.appendChild(heightLabelDiv);

// Create and append label and input fields for cube position
var xLabelDiv = document.createElement('div');
var xLabel = document.createElement('label');
xLabel.textContent = 'Origine X0 (m):';
xLabel.style.display = 'block'; // Ensure label is on its own line
xLabelDiv.appendChild(xLabel);
var xInput = document.createElement('input');
xInput.type = 'number';
xInput.placeholder = 'Entrer la valeur';
xInput.value =group_data_cube[index].prevPosX ;
xInput.style.color = 'blue'; // Set text color to blue
xInput.style.display = 'block'; // Ensure label is on its own line
xInput.addEventListener('input', updateCubeDimensions);

xInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//xInput.style.marginLeft = '50px';
xLabelDiv.appendChild(xInput);
labelsInputContainer.appendChild(xLabelDiv);

var yLabelDiv = document.createElement('div');
var yLabel = document.createElement('label');
yLabel.textContent = 'Origine Y0 (m):';
yLabel.style.display = 'block'; // Ensure label is on its own line
xInput.style.width = '250px'; // Set width
xInput.style.height = '20px'; // Set width
xInput.style.padding = '5px'; // Adjust padding to match select
xInput.style.border = '1px solid #ccc'; // Match border style
xInput.style.fontSize = '14px'; // Match font size
xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
xInput.style.backgroundColor='cornsilk';

yLabelDiv.appendChild(yLabel);
var yInput = document.createElement('input');
yInput.type = 'number';
yInput.placeholder = 'Entrer la valeur';
yInput.value = group_data_cube[index].prevPosY;
yInput.style.color = 'blue'; // Set text color to blue
yInput.style.display = 'block'; // Ensure label is on its own line
yInput.style.width = '250px'; // Set width
yInput.style.height = '20px'; // Set width
yInput.style.padding = '5px'; // Adjust padding to match select
yInput.style.border = '1px solid #ccc'; // Match border style
yInput.style.fontSize = '14px'; // Match font size
yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
yInput.style.backgroundColor='cornsilk';
yInput.addEventListener('input', updateCubeDimensions);

yInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//yInput.style.marginLeft = '50px';
yLabelDiv.appendChild(yInput);
labelsInputContainer.appendChild(yLabelDiv);

var zLabelDiv = document.createElement('div');
var zLabel = document.createElement('label');
zLabel.textContent = 'Origine Z0 (m):';
zLabel.style.display = 'block'; // Ensure label is on its own line
zLabelDiv.appendChild(zLabel);
var zInput = document.createElement('input');
zInput.type = 'number';
zInput.placeholder = 'Entrer la valeur';
zInput.value = group_data_cube[index].prevPosZ;
zInput.style.color = 'blue'; // Set text color to blue
zInput.style.display = 'block'; // Ensure label is on its own line
zInput.style.width = '250px'; // Set width
zInput.style.height = '20px'; // Set width
zInput.style.padding = '5px'; // Adjust padding to match select
zInput.style.border = '1px solid #ccc'; // Match border style
zInput.style.fontSize = '14px'; // Match font size
zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
zInput.style.backgroundColor='cornsilk';

zInput.addEventListener('input', updateCubeDimensions);

zInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//zInput.style.marginLeft = '50px';
zLabelDiv.appendChild(zInput);
labelsInputContainer.appendChild(zLabelDiv);

var visibleLabelDiv = document.createElement('div');
var visibleLabel = document.createElement('label');
visibleLabel.textContent = 'Structure visible:';
visibleLabelDiv.appendChild(visibleLabel);
var option1 = document.createElement('option');
option1.value='Oui';
option1.textContent='Oui';
select.appendChild(option1);
select.style.color = 'blue'; // Set text color to blue
select.style.width = '250px'; // Set width
select.style.height = '20px'; // Set width
select.style.padding = '0px'; // Adjust padding to match select
select.style.border = '1px solid #ccc'; // Match border style
select.style.fontSize = '14px'; // Match font size
select.style.boxSizing = 'border-box'; // Include padding and border in the width
select.style.backgroundColor='cornsilk';

var option2 = document.createElement('option');
option2.value='Non';
option2.textContent='Non';
select.appendChild(option2);
select.style.color = 'blue'; // Set text color to blue
if (group_data_cube[index].prevVisible==='Oui') {
    option1.selected=true;
    
} else {

    option2.selected=true;
    
}

select.addEventListener('change', updateCubeDimensions);

select.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

visibleLabelDiv.appendChild(select);
labelsInputContainer.appendChild(visibleLabelDiv);

var specLabelDiv = document.createElement('div');
var specLabel = document.createElement('label');
specLabel.textContent = 'Structure:';
specLabelDiv.appendChild(specLabel);

var option_3 = document.createElement('option');
option_3.value='Ignorée';
option_3.textContent='Ignorée';
select_2.appendChild(option_3);
select_2.style.color = 'blue'; // Set text color to blue
select_2.style.width = '250px'; // Set width
select_2.style.height = '20px'; // Set width
select_2.style.padding = '0px'; // Adjust padding to match select
select_2.style.border = '1px solid #ccc'; // Match border style
select_2.style.fontSize = '14px'; // Match font size
select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
select_2.style.backgroundColor='cornsilk';


var option_4 = document.createElement('option');
option_4.value='Autre';
option_4.textContent='Autre';
select_2.appendChild(option_4);
select_2.style.color = 'blue'; // Set text color to blue


    
if (group_data_cube[index].prevSpec==='Ignorée') {

    option_3.selected=true;

} else {
    
    option_4.selected=true;

}

select_2.addEventListener('change', updateCubeDimensions);

select_2.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

specLabelDiv.appendChild(select_2);
labelsInputContainer.appendChild(specLabelDiv);

var eplineLabelDiv = document.createElement('div');
var eplineLabel = document.createElement('label');
eplineLabel.textContent = 'Epaissue de la ligne (m):';
eplineLabel.style.display = 'block'; // Ensure label is on its own line
eplineLabelDiv.appendChild(eplineLabel);
var eplineInput = document.createElement('input');
eplineInput.type = 'number';
eplineInput.placeholder = 'Entrer la valeur';
eplineInput.value = group_data_cube[index].prevLineWidth;
eplineInput.step = '0.01'; // Set the step attribute to 0.1
eplineInput.style.color = 'blue'; // Set text color to blue
eplineInput.style.display = 'block'; // Ensure label is on its own line
eplineInput.style.width = '250px'; // Set width
eplineInput.style.height = '20px'; // Set width
eplineInput.style.padding = '0px'; // Adjust padding to match select
eplineInput.style.border = '1px solid #ccc'; // Match border style
eplineInput.style.fontSize = '14px'; // Match font size
eplineInput.style.boxSizing = 'border-box'; // Include padding and border in the width
eplineInput.style.backgroundColor='cornsilk';

eplineInput.addEventListener('input', updateCubeDimensions);

eplineInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//heightInput.style.marginLeft = '50px';
eplineLabelDiv.appendChild(eplineInput);
labelsInputContainer.appendChild(eplineLabelDiv);


// Create and append label and input fields for cube color
var colorInputDiv = document.createElement('div');
//colorInputDiv.style.display = 'flex';
//colorInputDiv.style.alignItems = 'center';
var colorLabel = document.createElement('label');
colorLabel.textContent = 'Couleur: ';
colorInputDiv.appendChild(colorLabel);
var colorInput = document.createElement('input');
colorInput.type = 'color';
//colorInput.style.marginLeft = '10px';
colorInput.value = color_cube;
colorInput.style.width = '250px'; // Set width
colorInput.style.padding = '5px'; // Adjust padding to match select
colorInput.style.border = '1px solid #ccc'; // Match border style
colorInput.style.fontSize = '16px'; // Match font size
colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width

colorInput.addEventListener('input', updateCubeColor);

colorInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//colorInput.style.marginLeft = '50px';
colorInputDiv.appendChild(colorInput);
labelsInputContainer.appendChild(colorInputDiv);



//////////////////////////////////////////////////////PDA/////////////////////////////////////////////

/////////////////////////////////////////////////////CUBE TOIT CYLINDRIQUE///////////////////////////

}  else if (group.name=='group_cube_cy') {    
    
var labelsInputContainer = document.getElementById('label-list');
var select = document.createElement("select");
var select_2 = document.createElement("select");


// Create and append label and input fields for cube dimensions
var RenameLabelDiv = document.createElement('div');
var RenameLabel = document.createElement('label');
RenameLabel.textContent = 'Renommer:';
RenameLabel.style.display = 'block'; // Ensure label is on its own line
RenameLabelDiv.appendChild(RenameLabel);
var RenameInput = document.createElement('input');
RenameInput.type = 'text';
//widthInput.style.marginLeft = '150px';
RenameInput.placeholder = 'Nom de la structure';
RenameInput.value = group_data_cube[index].text_new_item;
//widthInput.style.marginLeft = '50px';
RenameInput.style.color = 'blue'; // Set text color to blue
RenameInput.style.display = 'block'; // Ensure label is on its own line
RenameInput.style.width = '250px'; // Set width
RenameInput.style.height = '20px'; // Set width
RenameInput.style.padding = '5px'; // Adjust padding to match select
RenameInput.style.border = '1px solid #ccc'; // Match border style
RenameInput.style.fontSize = '14px'; // Match font size
RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
RenameInput.style.backgroundColor='cornsilk';
RenameInput.addEventListener('input', updateCubeDimensions);

RenameInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

RenameLabelDiv.appendChild(RenameInput);
labelsInputContainer.appendChild(RenameLabelDiv);

// Create and append label and input fields for cube dimensions
var widthLabelDiv = document.createElement('div');
var widthLabel = document.createElement('label');
widthLabel.textContent = 'Longueur du cube (m):';
widthLabel.style.display = 'block'; // Ensure label is on its own line
widthLabelDiv.appendChild(widthLabel);
var widthInput = document.createElement('input');
widthInput.type = 'number';
//widthInput.style.marginLeft = '150px';
widthInput.placeholder = 'Entrer la valeur';
widthInput.value = group_data_cube[index].prevWidth;
//widthInput.style.marginLeft = '50px';
widthInput.style.color = 'blue'; // Set text color to blue
widthInput.style.display = 'block'; // Ensure label is on its own line
widthInput.style.width = '250px'; // Set width
widthInput.style.height = '20px'; // Set width
widthInput.style.padding = '5px'; // Adjust padding to match select
widthInput.style.border = '1px solid #ccc'; // Match border style
widthInput.style.fontSize = '14px'; // Match font size
widthInput.style.boxSizing = 'border-box'; // Include padding and border in the width
widthInput.style.backgroundColor='cornsilk';
widthInput.addEventListener('input', updateCubeDimensions);

widthInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

widthLabelDiv.appendChild(widthInput);
labelsInputContainer.appendChild(widthLabelDiv);

var depthLabelDiv = document.createElement('div');
var depthLabel = document.createElement('label');
depthLabel.textContent = 'Largeur du cube (m):';
depthLabel.style.display = 'block'; // Ensure label is on its own line
depthLabelDiv.appendChild(depthLabel);
var depthInput = document.createElement('input');
depthInput.type = 'number';
depthInput.placeholder = 'Entrer la valeur';
depthInput.value = group_data_cube[index].prevDepth;
depthInput.style.color = 'blue'; // Set text color to blue
depthInput.style.display = 'block'; // Ensure label is on its own line
depthInput.style.width = '250px'; // Set width
depthInput.style.height = '20px'; // Set width
depthInput.style.padding = '5px'; // Adjust padding to match select
depthInput.style.border = '1px solid #ccc'; // Match border style
depthInput.style.fontSize = '14px'; // Match font size
depthInput.style.boxSizing = 'border-box'; // Include padding and border in the width
depthInput.style.backgroundColor='cornsilk';
depthInput.addEventListener('input', updateCubeDimensions);

depthInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//depthInput.style.marginLeft = '50px';
depthLabelDiv.appendChild(depthInput);
labelsInputContainer.appendChild(depthLabelDiv);

var heightLabelDiv = document.createElement('div');
var heightLabel = document.createElement('label');
heightLabel.textContent = 'Hauteur du cube (m):';
heightLabel.style.display = 'block'; // Ensure label is on its own line
heightLabelDiv.appendChild(heightLabel);
var heightInput = document.createElement('input');
heightInput.type = 'number';
heightInput.placeholder = 'Entrer la valeur';
heightInput.value = group_data_cube[index].prevHeight;
heightInput.style.color = 'blue'; // Set text color to blue
heightInput.style.display = 'block'; // Ensure label is on its own line
heightInput.style.width = '250px'; // Set width
heightInput.style.height = '20px'; // Set width
heightInput.style.padding = '5px'; // Adjust padding to match select
heightInput.style.border = '1px solid #ccc'; // Match border style
heightInput.style.fontSize = '14px'; // Match font size
heightInput.style.boxSizing = 'border-box'; // Include padding and border in the width
heightInput.style.backgroundColor='cornsilk';
heightInput.addEventListener('input', updateCubeDimensions);

heightInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//heightInput.style.marginLeft = '50px';
heightLabelDiv.appendChild(heightInput);
labelsInputContainer.appendChild(heightLabelDiv);

// Create and append label and input fields for cube position
var xLabelDiv = document.createElement('div');
var xLabel = document.createElement('label');
xLabel.textContent = 'Origine X0 (m):';
xLabel.style.display = 'block'; // Ensure label is on its own line
xLabelDiv.appendChild(xLabel);
var xInput = document.createElement('input');
xInput.type = 'number';
xInput.placeholder = 'Entrer la valeur';
xInput.value =group_data_cube[index].prevPosX ;
xInput.style.color = 'blue'; // Set text color to blue
xInput.style.display = 'block'; // Ensure label is on its own line
xInput.style.width = '250px'; // Set width
xInput.style.height = '20px'; // Set width
xInput.style.padding = '5px'; // Adjust padding to match select
xInput.style.border = '1px solid #ccc'; // Match border style
xInput.style.fontSize = '14px'; // Match font size
xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
xInput.style.backgroundColor='cornsilk';
xInput.addEventListener('input', updateCubeDimensions);

xInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//xInput.style.marginLeft = '50px';
xLabelDiv.appendChild(xInput);
labelsInputContainer.appendChild(xLabelDiv);

var yLabelDiv = document.createElement('div');
var yLabel = document.createElement('label');
yLabel.textContent = 'Origine Y0 (m):';
yLabel.style.display = 'block'; // Ensure label is on its own line
yLabelDiv.appendChild(yLabel);
var yInput = document.createElement('input');
yInput.type = 'number';
yInput.placeholder = 'Entrer la valeur';
yInput.value = group_data_cube[index].prevPosY;
yInput.style.color = 'blue'; // Set text color to blue
yInput.style.display = 'block'; // Ensure label is on its own line
yInput.style.width = '250px'; // Set width
yInput.style.height = '20px'; // Set width
yInput.style.padding = '5px'; // Adjust padding to match select
yInput.style.border = '1px solid #ccc'; // Match border style
yInput.style.fontSize = '14px'; // Match font size
yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
yInput.style.backgroundColor='cornsilk';
yInput.addEventListener('input', updateCubeDimensions);

yInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//yInput.style.marginLeft = '50px';
yLabelDiv.appendChild(yInput);
labelsInputContainer.appendChild(yLabelDiv);

var zLabelDiv = document.createElement('div');
var zLabel = document.createElement('label');
zLabel.textContent = 'Origine Z0 (m):';
zLabel.style.display = 'block'; // Ensure label is on its own line
zLabelDiv.appendChild(zLabel);
var zInput = document.createElement('input');
zInput.type = 'number';
zInput.placeholder = 'Entrer la valeur';
zInput.value = group_data_cube[index].prevPosZ;
zInput.style.color = 'blue'; // Set text color to blue
zInput.style.display = 'block'; // Ensure label is on its own line
zInput.style.width = '250px'; // Set width
zInput.style.height = '20px'; // Set width
zInput.style.padding = '5px'; // Adjust padding to match select
zInput.style.border = '1px solid #ccc'; // Match border style
zInput.style.fontSize = '14px'; // Match font size
zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
zInput.style.backgroundColor='cornsilk';
zInput.addEventListener('input', updateCubeDimensions);

zInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//zInput.style.marginLeft = '50px';
zLabelDiv.appendChild(zInput);
labelsInputContainer.appendChild(zLabelDiv);

var rotationAngleLabelDiv = document.createElement('div');
var rotationAngleLabel = document.createElement('label');
rotationAngleLabel.textContent = 'Angle autour de z (°):';
rotationAngleLabel.style.display = 'block'; // Ensure label is on its own line
rotationAngleLabelDiv.appendChild(rotationAngleLabel);
var rotationAngle = document.createElement('input');
rotationAngle.type = 'number';
rotationAngle.placeholder = 'Entrer la valeur';
rotationAngle.value = group_data_cube[index].prevRotZ;
rotationAngle.style.color = 'blue'; // Set text color to blue
rotationAngle.style.display = 'block'; // Ensure label is on its own line
rotationAngle.style.width = '250px'; // Set width
rotationAngle.style.height = '20px'; // Increase height for better visibility
rotationAngle.style.padding = '5px'; // Add padding for better readability
rotationAngle.style.border = '1px solid #ccc'; // Match border style
rotationAngle.style.fontSize = '14px'; // Increase font size for better readability
rotationAngle.style.boxSizing = 'border-box'; // Include padding and border in the width
rotationAngle.style.backgroundColor = 'cornsilk'; // Light background color for visibility
rotationAngle.addEventListener('input', updateCubeDimensions);

rotationAngle.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//rotationAngle.style.marginLeft = '50px';
rotationAngleLabelDiv.appendChild(rotationAngle);
labelsInputContainer.appendChild(rotationAngleLabelDiv);

var visibleLabelDiv = document.createElement('div');
var visibleLabel = document.createElement('label');
visibleLabel.textContent = 'Structure visible:';
visibleLabelDiv.appendChild(visibleLabel);
var option1 = document.createElement('option');
option1.value='Oui';
option1.textContent='Oui';
select.appendChild(option1);
select.style.color = 'blue'; // Set text color to blue
select.style.width = '250px'; // Set width
select.style.height = '20px'; // Set width
select.style.padding = '0px'; // Adjust padding to match select
select.style.border = '1px solid #ccc'; // Match border style
select.style.fontSize = '14px'; // Match font size
select.style.boxSizing = 'border-box'; // Include padding and border in the width
select.style.backgroundColor='cornsilk';

var option2 = document.createElement('option');
option2.value='Non';
option2.textContent='Non';
select.appendChild(option2);
select.style.color = 'blue'; // Set text color to blue
if (group_data_cube[index].prevVisible==='Oui') {
    option1.selected=true;
    
} else {

    option2.selected=true;
    
}

select.addEventListener('change', updateCubeDimensions);

select.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

visibleLabelDiv.appendChild(select);
labelsInputContainer.appendChild(visibleLabelDiv);

var specLabelDiv = document.createElement('div');
var specLabel = document.createElement('label');
specLabel.textContent = 'Structure:';
specLabelDiv.appendChild(specLabel);
var option_1 = document.createElement('option');
option_1.value='Ceinturée';
option_1.textContent='Ceinturée';
select_2.appendChild(option_1);
select_2.style.color = 'blue'; // Set text color to blue
select_2.style.width = '250px'; // Set width
select_2.style.height = '20px'; // Set width
select_2.style.padding = '0px'; // Adjust padding to match select
select_2.style.border = '1px solid #ccc'; // Match border style
select_2.style.fontSize = '14px'; // Match font size
select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
select_2.style.backgroundColor='cornsilk';

var option_2 = document.createElement('option');
option_2.value='Protégée';
option_2.textContent='Protégée';
select_2.appendChild(option_2);
select_2.style.color = 'blue'; // Set text color to blue

var option_3 = document.createElement('option');
option_3.value='Ignorée';
option_3.textContent='Ignorée';
select_2.appendChild(option_3);
select_2.style.color = 'blue'; // Set text color to blue

var option_4 = document.createElement('option');
option_4.value='Autre';
option_4.textContent='Autre';
select_2.appendChild(option_4);
select_2.style.color = 'blue'; // Set text color to blue

if (group_data_cube[index].prevSpec==='Ceinturée') {
    option_1.selected=true;
    
} else if (group_data_cube[index].prevSpec==='Protégée') {

    option_2.selected=true;
    
} else if (group_data_cube[index].prevSpec==='Ignorée') {

    option_3.selected=true;

} else {
    
    option_4.selected=true;

}

select_2.addEventListener('change', updateCubeDimensions);

select_2.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

specLabelDiv.appendChild(select_2);
labelsInputContainer.appendChild(specLabelDiv);

// Create and append label and input fields for cube color
var colorInputDiv = document.createElement('div');
//colorInputDiv.style.display = 'flex';
//colorInputDiv.style.alignItems = 'center';
var colorLabel = document.createElement('label');
colorLabel.textContent = 'Couleur: ';
colorInputDiv.appendChild(colorLabel);
var colorInput = document.createElement('input');
colorInput.type = 'color';
//colorInput.style.marginLeft = '10px';
colorInput.value = color_cube;
colorInput.style.width = '250px'; // Set width
colorInput.style.padding = '5px'; // Adjust padding to match select
colorInput.style.border = '1px solid #ccc'; // Match border style
colorInput.style.fontSize = '16px'; // Match font size
colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width

colorInput.addEventListener('input', updateCubeColor);

colorInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//colorInput.style.marginLeft = '50px';
colorInputDiv.appendChild(colorInput);
labelsInputContainer.appendChild(colorInputDiv);   


/////////////////////////////////////////////////////CUBE TOIT CYLINDRIQUE//////////////////////////////

} else if (group.name=='group_cone') {


var labelsInputContainer = document.getElementById('label-list');
var select = document.createElement("select");
var select_2 = document.createElement("select");


// Create and append label and input fields for cube dimensions
var RenameLabelDiv = document.createElement('div');
var RenameLabel = document.createElement('label');
RenameLabel.textContent = 'Renommer:';
RenameLabel.style.display = 'block'; // Ensure label is on its own line
RenameLabelDiv.appendChild(RenameLabel);
var RenameInput = document.createElement('input');
RenameInput.type = 'text';
//widthInput.style.marginLeft = '150px';
RenameInput.placeholder = 'Nom de la structure';
RenameInput.value = group_data_cube[index].text_new_item;
//widthInput.style.marginLeft = '50px';
RenameInput.style.color = 'blue'; // Set text color to blue
RenameInput.style.display = 'block'; // Ensure label is on its own line
RenameInput.style.width = '250px'; // Set width
RenameInput.style.height = '20px'; // Set width
RenameInput.style.padding = '5px'; // Adjust padding to match select
RenameInput.style.border = '1px solid #ccc'; // Match border style
RenameInput.style.fontSize = '14px'; // Match font size
RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
RenameInput.style.backgroundColor='cornsilk';
RenameInput.addEventListener('input', updateCubeDimensions);

RenameInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

RenameLabelDiv.appendChild(RenameInput);
labelsInputContainer.appendChild(RenameLabelDiv);

var RadiusLabelDiv = document.createElement('div');
var RadiusLabel = document.createElement('label');
RadiusLabel.textContent = 'Rayon (m):  ';
RadiusLabel.style.display = 'block'; // Ensure label is on its own line
RadiusLabelDiv.appendChild(RadiusLabel);
var RadiusInput = document.createElement('input');
RadiusInput.type = 'number';
//widthInput.style.marginLeft = '150px';
RadiusInput.placeholder = 'Enter value';
RadiusInput.value = group_data_cube[index].prevRadius; 
//widthInput.style.marginLeft = '50px';
RadiusInput.style.color = 'blue'; // Set text color to blue
RadiusInput.style.display = 'block'; // Ensure label is on its own line
RadiusInput.style.width = '250px'; // Set width
RadiusInput.style.height = '20px'; // Set width
RadiusInput.style.padding = '5px'; // Adjust padding to match select
RadiusInput.style.border = '1px solid #ccc'; // Match border style
RadiusInput.style.fontSize = '14px'; // Match font size
RadiusInput.style.boxSizing = 'border-box'; // Include padding and border in the width
RadiusInput.style.backgroundColor='cornsilk';
RadiusInput.addEventListener('input', updateCubeDimensions);

RadiusInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

RadiusLabelDiv.appendChild(RadiusInput);
labelsInputContainer.appendChild(RadiusLabelDiv);

var heightLabelDiv = document.createElement('div');
var heightLabel = document.createElement('label');
heightLabel.textContent = 'Hauteur (m):';
heightLabel.style.display = 'block'; // Ensure label is on its own line
heightLabelDiv.appendChild(heightLabel);
var heightInput = document.createElement('input');
heightInput.type = 'number';
heightInput.placeholder = 'Entrer la valeur';
heightInput.value = group_data_cube[index].prevHeight;
heightInput.style.color = 'blue'; // Set text color to blue
heightInput.style.display = 'block'; // Ensure label is on its own line
heightInput.style.width = '250px'; // Set width
heightInput.style.height = '20px'; // Set width
heightInput.style.padding = '5px'; // Adjust padding to match select
heightInput.style.border = '1px solid #ccc'; // Match border style
heightInput.style.fontSize = '14px'; // Match font size
heightInput.style.boxSizing = 'border-box'; // Include padding and border in the width
heightInput.style.backgroundColor='cornsilk';
heightInput.addEventListener('input', updateCubeDimensions);

heightInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//heightInput.style.marginLeft = '50px';
heightLabelDiv.appendChild(heightInput);
labelsInputContainer.appendChild(heightLabelDiv);

// Create and append label and input fields for cube position
var xLabelDiv = document.createElement('div');
var xLabel = document.createElement('label');
xLabel.textContent = 'Origine X0 (m):';
xLabel.style.display = 'block'; // Ensure label is on its own line
xLabelDiv.appendChild(xLabel);
var xInput = document.createElement('input');
xInput.type = 'number';
xInput.placeholder = 'Entrer la valeur';
xInput.value =group_data_cube[index].prevPosX ;
xInput.style.color = 'blue'; // Set text color to blue
xInput.style.display = 'block'; // Ensure label is on its own line
xInput.style.width = '250px'; // Set width
xInput.style.height = '20px'; // Set width
xInput.style.padding = '5px'; // Adjust padding to match select
xInput.style.border = '1px solid #ccc'; // Match border style
xInput.style.fontSize = '14px'; // Match font size
xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
xInput.style.backgroundColor='cornsilk';
xInput.addEventListener('input', updateCubeDimensions);

xInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//xInput.style.marginLeft = '50px';
xLabelDiv.appendChild(xInput);
labelsInputContainer.appendChild(xLabelDiv);

var yLabelDiv = document.createElement('div');
var yLabel = document.createElement('label');
yLabel.textContent = 'Origine Y0 (m):';
yLabel.style.display = 'block'; // Ensure label is on its own line
yLabelDiv.appendChild(yLabel);
var yInput = document.createElement('input');
yInput.type = 'number';
yInput.placeholder = 'Entrer la valeur';
yInput.value = group_data_cube[index].prevPosY;
yInput.style.color = 'blue'; // Set text color to blue
yInput.style.display = 'block'; // Ensure label is on its own line
yInput.style.width = '250px'; // Set width
yInput.style.height = '20px'; // Set width
yInput.style.padding = '5px'; // Adjust padding to match select
yInput.style.border = '1px solid #ccc'; // Match border style
yInput.style.fontSize = '14px'; // Match font size
yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
yInput.style.backgroundColor='cornsilk';
yInput.addEventListener('input', updateCubeDimensions);

yInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//yInput.style.marginLeft = '50px';
yLabelDiv.appendChild(yInput);
labelsInputContainer.appendChild(yLabelDiv);

var zLabelDiv = document.createElement('div');
var zLabel = document.createElement('label');
zLabel.textContent = 'Origine Z0 (m):';
zLabel.style.display = 'block'; // Ensure label is on its own line
zLabelDiv.appendChild(zLabel);
var zInput = document.createElement('input');
zInput.type = 'number';
zInput.placeholder = 'Entrer la valeur';
zInput.value = group_data_cube[index].prevPosZ;
zInput.style.color = 'blue'; // Set text color to blue
zInput.style.display = 'block'; // Ensure label is on its own line
zInput.style.width = '250px'; // Set width
zInput.style.height = '20px'; // Set width
zInput.style.padding = '5px'; // Adjust padding to match select
zInput.style.border = '1px solid #ccc'; // Match border style
zInput.style.fontSize = '14px'; // Match font size
zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
zInput.style.backgroundColor='cornsilk';
zInput.addEventListener('input', updateCubeDimensions);

zInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//zInput.style.marginLeft = '50px';
zLabelDiv.appendChild(zInput);
labelsInputContainer.appendChild(zLabelDiv);

var visibleLabelDiv = document.createElement('div');
var visibleLabel = document.createElement('label');
visibleLabel.textContent = 'Structure visible:';
visibleLabelDiv.appendChild(visibleLabel);
var option1 = document.createElement('option');
option1.value='Oui';
option1.textContent='Oui';
select.appendChild(option1);
select.style.color = 'blue'; // Set text color to blue
select.style.width = '250px'; // Set width
select.style.height = '20px'; // Set width
select.style.padding = '0px'; // Adjust padding to match select
select.style.border = '1px solid #ccc'; // Match border style
select.style.fontSize = '14px'; // Match font size
select.style.boxSizing = 'border-box'; // Include padding and border in the width
select.style.backgroundColor='cornsilk';

var option2 = document.createElement('option');
option2.value='Non';
option2.textContent='Non';
select.appendChild(option2);
select.style.color = 'blue'; // Set text color to blue
if (group_data_cube[index].prevVisible==='Oui') {
    option1.selected=true;
    
} else {

    option2.selected=true;
    
}

select.addEventListener('change', updateCubeDimensions);

select.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

visibleLabelDiv.appendChild(select);
labelsInputContainer.appendChild(visibleLabelDiv);

var specLabelDiv = document.createElement('div');
var specLabel = document.createElement('label');
specLabel.textContent = 'Structure:';
specLabelDiv.appendChild(specLabel);
var option_1 = document.createElement('option');
option_1.value='Ceinturée';
option_1.textContent='Ceinturée';
select_2.appendChild(option_1);
select_2.style.color = 'blue'; // Set text color to blue
var option_2 = document.createElement('option');
option_2.value='Protégée';
option_2.textContent='Protégée';
select_2.appendChild(option_2);
select_2.style.color = 'blue'; // Set text color to blue
select_2.style.width = '250px'; // Set width
select_2.style.height = '20px'; // Set width
select_2.style.padding = '0px'; // Adjust padding to match select
select_2.style.border = '1px solid #ccc'; // Match border style
select_2.style.fontSize = '14px'; // Match font size
select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
select_2.style.backgroundColor='cornsilk';


var option_3 = document.createElement('option');
option_3.value='Ignorée';
option_3.textContent='Ignorée';
select_2.appendChild(option_3);
select_2.style.color = 'blue'; // Set text color to blue

var option_4 = document.createElement('option');
option_4.value='Autre';
option_4.textContent='Autre';
select_2.appendChild(option_4);
select_2.style.color = 'blue'; // Set text color to blue

if (group_data_cube[index].prevSpec==='Ceinturée') {
    option_1.selected=true;
    
} else if (group_data_cube[index].prevSpec==='Protégée') {

    option_2.selected=true;
    
} else if (group_data_cube[index].prevSpec==='Ignorée') {

    option_3.selected=true;

} else {
    
    option_4.selected=true;

}

select_2.addEventListener('change', updateCubeDimensions);

select_2.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

specLabelDiv.appendChild(select_2);
labelsInputContainer.appendChild(specLabelDiv);


// Create and append label and input fields for cube color
var colorInputDiv = document.createElement('div');
//colorInputDiv.style.display = 'flex';
//colorInputDiv.style.alignItems = 'center';
var colorLabel = document.createElement('label');
colorLabel.textContent = 'Couleur: ';
colorInputDiv.appendChild(colorLabel);
var colorInput = document.createElement('input');
colorInput.type = 'color';
//colorInput.style.marginLeft = '10px';
colorInput.value = color_cube;
colorInput.style.width = '250px'; // Set width
colorInput.style.padding = '5px'; // Adjust padding to match select
colorInput.style.border = '1px solid #ccc'; // Match border style
colorInput.style.fontSize = '16px'; // Match font size
colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width

colorInput.addEventListener('input', updateCubeColor);

colorInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//colorInput.style.marginLeft = '50px';
colorInputDiv.appendChild(colorInput);
labelsInputContainer.appendChild(colorInputDiv);

//////////////////////////////////////////////////////CONE/////////////////////////////////////////////


///////////////////////////////////////////////////SPHERE/////////////////////////////////////////////

} else if (group.name=='group_sphere') {


var labelsInputContainer = document.getElementById('label-list');
var select = document.createElement("select");
var select_2 = document.createElement("select");

// Create and append label and input fields for cube dimensions
var RenameLabelDiv = document.createElement('div');
var RenameLabel = document.createElement('label');
RenameLabel.textContent = 'Renommer:';
RenameLabel.style.display = 'block'; // Ensure label is on its own line
RenameLabelDiv.appendChild(RenameLabel);
var RenameInput = document.createElement('input');
RenameInput.type = 'text';
//widthInput.style.marginLeft = '150px';
RenameInput.placeholder = 'Nom de la structure';
RenameInput.value = group_data_cube[index].text_new_item;
//widthInput.style.marginLeft = '50px';
RenameInput.style.color = 'blue'; // Set text color to blue
RenameInput.style.display = 'block'; // Ensure label is on its own line
RenameInput.style.width = '250px'; // Set width
RenameInput.style.height = '20px'; // Set width
RenameInput.style.padding = '5px'; // Adjust padding to match select
RenameInput.style.border = '1px solid #ccc'; // Match border style
RenameInput.style.fontSize = '14px'; // Match font size
RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
RenameInput.style.backgroundColor='cornsilk';
RenameInput.addEventListener('input', updateCubeDimensions);

RenameInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

RenameLabelDiv.appendChild(RenameInput);
labelsInputContainer.appendChild(RenameLabelDiv);

var RadiusLabelDiv = document.createElement('div');
var RadiusLabel = document.createElement('label');
RadiusLabel.textContent = 'Rayon (m):  ';
RadiusLabel.style.display = 'block'; // Ensure label is on its own line
RadiusLabelDiv.appendChild(RadiusLabel);
var RadiusInput = document.createElement('input');
RadiusInput.type = 'number';
//widthInput.style.marginLeft = '150px';
RadiusInput.placeholder = 'Enter value';
RadiusInput.value = group_data_cube[index].prevRadius; 
//widthInput.style.marginLeft = '50px';
RadiusInput.style.color = 'blue'; // Set text color to blue
RadiusInput.style.display = 'block'; // Ensure label is on its own line
RadiusInput.style.width = '250px'; // Set width
RadiusInput.style.height = '20px'; // Set width
RadiusInput.style.padding = '5px'; // Adjust padding to match select
RadiusInput.style.border = '1px solid #ccc'; // Match border style
RadiusInput.style.fontSize = '14px'; // Match font size
RadiusInput.style.boxSizing = 'border-box'; // Include padding and border in the width
RadiusInput.style.backgroundColor='cornsilk';
RadiusInput.addEventListener('input', updateCubeDimensions);

RadiusInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

RadiusLabelDiv.appendChild(RadiusInput);
labelsInputContainer.appendChild(RadiusLabelDiv);

// Create and append label and input fields for cube position
var xLabelDiv = document.createElement('div');
var xLabel = document.createElement('label');
xLabel.textContent = 'Origine X0 (m):';
xLabel.style.display = 'block'; // Ensure label is on its own line
xLabelDiv.appendChild(xLabel);
var xInput = document.createElement('input');
xInput.type = 'number';
xInput.placeholder = 'Entrer la valeur';
xInput.value =group_data_cube[index].prevPosX ;
xInput.style.color = 'blue'; // Set text color to blue
xInput.style.display = 'block'; // Ensure label is on its own line
xInput.style.width = '250px'; // Set width
xInput.style.height = '20px'; // Set width
xInput.style.padding = '5px'; // Adjust padding to match select
xInput.style.border = '1px solid #ccc'; // Match border style
xInput.style.fontSize = '14px'; // Match font size
xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
xInput.style.backgroundColor='cornsilk';
xInput.addEventListener('input', updateCubeDimensions);

xInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//xInput.style.marginLeft = '50px';
xLabelDiv.appendChild(xInput);
labelsInputContainer.appendChild(xLabelDiv);

var yLabelDiv = document.createElement('div');
var yLabel = document.createElement('label');
yLabel.textContent = 'Origine Y0 (m):';
yLabel.style.display = 'block'; // Ensure label is on its own line
yLabelDiv.appendChild(yLabel);
var yInput = document.createElement('input');
yInput.type = 'number';
yInput.placeholder = 'Entrer la valeur';
yInput.value = group_data_cube[index].prevPosY;
yInput.style.color = 'blue'; // Set text color to blue
yInput.style.display = 'block'; // Ensure label is on its own line
yInput.style.width = '250px'; // Set width
yInput.style.height = '20px'; // Set width
yInput.style.padding = '5px'; // Adjust padding to match select
yInput.style.border = '1px solid #ccc'; // Match border style
yInput.style.fontSize = '14px'; // Match font size
yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
yInput.style.backgroundColor='cornsilk';
yInput.addEventListener('input', updateCubeDimensions);

yInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//yInput.style.marginLeft = '50px';
yLabelDiv.appendChild(yInput);
labelsInputContainer.appendChild(yLabelDiv);

var zLabelDiv = document.createElement('div');
var zLabel = document.createElement('label');
zLabel.textContent = 'Origine Z0 (m):';
zLabel.style.display = 'block'; // Ensure label is on its own line
zLabelDiv.appendChild(zLabel);
var zInput = document.createElement('input');
zInput.type = 'number';
zInput.placeholder = 'Entrer la valeur';
zInput.value = group_data_cube[index].prevPosZ;
zInput.style.color = 'blue'; // Set text color to blue
zInput.style.display = 'block'; // Ensure label is on its own line
zInput.style.width = '250px'; // Set width
zInput.style.height = '20px'; // Set width
zInput.style.padding = '5px'; // Adjust padding to match select
zInput.style.border = '1px solid #ccc'; // Match border style
zInput.style.fontSize = '14px'; // Match font size
zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
zInput.style.backgroundColor='cornsilk';
zInput.addEventListener('input', updateCubeDimensions);

zInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//zInput.style.marginLeft = '50px';
zLabelDiv.appendChild(zInput);
labelsInputContainer.appendChild(zLabelDiv);

var visibleLabelDiv = document.createElement('div');
var visibleLabel = document.createElement('label');
visibleLabel.textContent = 'Structure visible:';
visibleLabelDiv.appendChild(visibleLabel);
var option1 = document.createElement('option');
option1.value='Oui';
option1.textContent='Oui';
select.appendChild(option1);
select.style.color = 'blue'; // Set text color to blue
select.style.width = '250px'; // Set width
select.style.height = '20px'; // Set width
select.style.padding = '0px'; // Adjust padding to match select
select.style.border = '1px solid #ccc'; // Match border style
select.style.fontSize = '14px'; // Match font size
select.style.boxSizing = 'border-box'; // Include padding and border in the width
select.style.backgroundColor='cornsilk';

var option2 = document.createElement('option');
option2.value='Non';
option2.textContent='Non';
select.appendChild(option2);
select.style.color = 'blue'; // Set text color to blue
if (group_data_cube[index].prevVisible==='Oui') {
    option1.selected=true;
    
} else {

    option2.selected=true;
    
}

select.addEventListener('change', updateCubeDimensions);

select.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

visibleLabelDiv.appendChild(select);
labelsInputContainer.appendChild(visibleLabelDiv);

var specLabelDiv = document.createElement('div');
var specLabel = document.createElement('label');
specLabel.textContent = 'Structure:';
specLabelDiv.appendChild(specLabel);

var option_2 = document.createElement('option');
option_2.value='Protégée';
option_2.textContent='Protégée';
select_2.appendChild(option_2);
select_2.style.color = 'blue'; // Set text color to blue
select_2.style.width = '250px'; // Set width
select_2.style.height = '20px'; // Set width
select_2.style.padding = '0px'; // Adjust padding to match select
select_2.style.border = '1px solid #ccc'; // Match border style
select_2.style.fontSize = '14px'; // Match font size
select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
select_2.style.backgroundColor='cornsilk';

var option_3 = document.createElement('option');
option_3.value='Ignorée';
option_3.textContent='Ignorée';
select_2.appendChild(option_3);
select_2.style.color = 'blue'; // Set text color to blue

var option_4 = document.createElement('option');
option_4.value='Autre';
option_4.textContent='Autre';
select_2.appendChild(option_4);
select_2.style.color = 'blue'; // Set text color to blue


    
if (group_data_cube[index].prevSpec==='Protégée') {

    option_2.selected=true;
    
} else if (group_data_cube[index].prevSpec==='Ignorée') {

    option_3.selected=true;

} else {
    
    option_4.selected=true;

}

select_2.addEventListener('change', updateCubeDimensions);

select_2.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

specLabelDiv.appendChild(select_2);
labelsInputContainer.appendChild(specLabelDiv);


// Create and append label and input fields for cube color
var colorInputDiv = document.createElement('div');
//colorInputDiv.style.display = 'flex';
//colorInputDiv.style.alignItems = 'center';
var colorLabel = document.createElement('label');
colorLabel.textContent = 'Couleur: ';
colorInputDiv.appendChild(colorLabel);
var colorInput = document.createElement('input');
colorInput.type = 'color';
colorInput.style.width = '250px'; // Set width
colorInput.style.padding = '5px'; // Adjust padding to match select
colorInput.style.border = '1px solid #ccc'; // Match border style
colorInput.style.fontSize = '16px'; // Match font size
colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width
//colorInput.style.marginLeft = '10px';
colorInput.value = color_cube;
colorInput.addEventListener('input', updateCubeColor);

colorInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//colorInput.style.marginLeft = '50px';
colorInputDiv.appendChild(colorInput);
labelsInputContainer.appendChild(colorInputDiv);

} else if (group.name=='group_cylinder_sp') {


var labelsInputContainer = document.getElementById('label-list');
var select = document.createElement("select");
var select_2 = document.createElement("select");


// Create and append label and input fields for cube dimensions
var RenameLabelDiv = document.createElement('div');
var RenameLabel = document.createElement('label');
RenameLabel.textContent = 'Renommer:';
RenameLabel.style.display = 'block'; // Ensure label is on its own line
RenameLabelDiv.appendChild(RenameLabel);
var RenameInput = document.createElement('input');
RenameInput.type = 'text';
//widthInput.style.marginLeft = '150px';
RenameInput.placeholder = 'Nom de la structure';
RenameInput.value = group_data_cube[index].text_new_item;
//widthInput.style.marginLeft = '50px';
RenameInput.style.color = 'blue'; // Set text color to blue
RenameInput.style.display = 'block'; // Ensure label is on its own line
RenameInput.style.width = '250px'; // Set width
RenameInput.style.height = '20px'; // Set width
RenameInput.style.padding = '5px'; // Adjust padding to match select
RenameInput.style.border = '1px solid #ccc'; // Match border style
RenameInput.style.fontSize = '14px'; // Match font size
RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
RenameInput.style.backgroundColor='cornsilk';

RenameInput.addEventListener('input', updateCubeDimensions);

RenameInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

RenameLabelDiv.appendChild(RenameInput);
labelsInputContainer.appendChild(RenameLabelDiv);

var RadiusLabelDiv = document.createElement('div');
var RadiusLabel = document.createElement('label');
RadiusLabel.textContent = 'Rayon (m):  ';
RadiusLabel.style.display = 'block'; // Ensure label is on its own line
RadiusLabelDiv.appendChild(RadiusLabel);
var RadiusInput = document.createElement('input');
RadiusInput.type = 'number';
//widthInput.style.marginLeft = '150px';
RadiusInput.placeholder = 'Enter value';
RadiusInput.value = group_data_cube[index].prevRadius; 
//widthInput.style.marginLeft = '50px';
RadiusInput.style.color = 'blue'; // Set text color to blue
RadiusInput.style.display = 'block'; // Ensure label is on its own line
RadiusInput.style.width = '250px'; // Set width
RadiusInput.style.height = '20px'; // Set width
RadiusInput.style.padding = '5px'; // Adjust padding to match select
RadiusInput.style.border = '1px solid #ccc'; // Match border style
RadiusInput.style.fontSize = '14px'; // Match font size
RadiusInput.style.boxSizing = 'border-box'; // Include padding and border in the width
RadiusInput.style.backgroundColor='cornsilk';
RadiusInput.addEventListener('input', updateCubeDimensions);

RadiusInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

RadiusLabelDiv.appendChild(RadiusInput);
labelsInputContainer.appendChild(RadiusLabelDiv);

var heightLabelDiv = document.createElement('div');
var heightLabel = document.createElement('label');
heightLabel.textContent = 'Hauteur (m):';
heightLabel.style.display = 'block'; // Ensure label is on its own line
heightLabelDiv.appendChild(heightLabel);
var heightInput = document.createElement('input');
heightInput.type = 'number';
heightInput.placeholder = 'Entrer la valeur';
heightInput.value = group_data_cube[index].prevHeight;
heightInput.style.color = 'blue'; // Set text color to blue
heightInput.style.display = 'block'; // Ensure label is on its own line
heightInput.style.width = '250px'; // Set width
heightInput.style.height = '20px'; // Set width
heightInput.style.padding = '5px'; // Adjust padding to match select
heightInput.style.border = '1px solid #ccc'; // Match border style
heightInput.style.fontSize = '14px'; // Match font size
heightInput.style.boxSizing = 'border-box'; // Include padding and border in the width
heightInput.style.backgroundColor='cornsilk';
heightInput.addEventListener('input', updateCubeDimensions);

heightInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//heightInput.style.marginLeft = '50px';
heightLabelDiv.appendChild(heightInput);
labelsInputContainer.appendChild(heightLabelDiv);

// Create and append label and input fields for cube position
var xLabelDiv = document.createElement('div');
var xLabel = document.createElement('label');
xLabel.textContent = 'Origine X0 (m):';
xLabel.style.display = 'block'; // Ensure label is on its own line
xLabelDiv.appendChild(xLabel);
var xInput = document.createElement('input');
xInput.type = 'number';
xInput.placeholder = 'Entrer la valeur';
xInput.value =group_data_cube[index].prevPosX ;
xInput.style.color = 'blue'; // Set text color to blue
xInput.style.display = 'block'; // Ensure label is on its own line
xInput.style.width = '250px'; // Set width
xInput.style.height = '20px'; // Set width
xInput.style.padding = '5px'; // Adjust padding to match select
xInput.style.border = '1px solid #ccc'; // Match border style
xInput.style.fontSize = '14px'; // Match font size
xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
xInput.style.backgroundColor='cornsilk';
xInput.addEventListener('input', updateCubeDimensions);

xInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//xInput.style.marginLeft = '50px';
xLabelDiv.appendChild(xInput);
labelsInputContainer.appendChild(xLabelDiv);

var yLabelDiv = document.createElement('div');
var yLabel = document.createElement('label');
yLabel.textContent = 'Origine Y0 (m):';
yLabel.style.display = 'block'; // Ensure label is on its own line
yLabelDiv.appendChild(yLabel);
var yInput = document.createElement('input');
yInput.type = 'number';
yInput.placeholder = 'Entrer la valeur';
yInput.value = group_data_cube[index].prevPosY;
yInput.style.color = 'blue'; // Set text color to blue
yInput.style.display = 'block'; // Ensure label is on its own line
yInput.style.width = '250px'; // Set width
yInput.style.height = '20px'; // Set width
yInput.style.padding = '5px'; // Adjust padding to match select
yInput.style.border = '1px solid #ccc'; // Match border style
yInput.style.fontSize = '14px'; // Match font size
yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
yInput.style.backgroundColor='cornsilk';
yInput.addEventListener('input', updateCubeDimensions);

yInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//yInput.style.marginLeft = '50px';
yLabelDiv.appendChild(yInput);
labelsInputContainer.appendChild(yLabelDiv);

var zLabelDiv = document.createElement('div');
var zLabel = document.createElement('label');
zLabel.textContent = 'Origine Z0 (m):';
zLabel.style.display = 'block'; // Ensure label is on its own line
zLabelDiv.appendChild(zLabel);
var zInput = document.createElement('input');
zInput.type = 'number';
zInput.placeholder = 'Entrer la valeur';
zInput.value = group_data_cube[index].prevPosZ;
zInput.style.color = 'blue'; // Set text color to blue
zInput.style.display = 'block'; // Ensure label is on its own line
zInput.style.width = '250px'; // Set width
zInput.style.height = '20px'; // Set width
zInput.style.padding = '5px'; // Adjust padding to match select
zInput.style.border = '1px solid #ccc'; // Match border style
zInput.style.fontSize = '14px'; // Match font size
zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
zInput.style.backgroundColor='cornsilk';
zInput.addEventListener('input', updateCubeDimensions);

zInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//zInput.style.marginLeft = '50px';
zLabelDiv.appendChild(zInput);
labelsInputContainer.appendChild(zLabelDiv);

var visibleLabelDiv = document.createElement('div');
var visibleLabel = document.createElement('label');
visibleLabel.textContent = 'Structure visible:';
visibleLabelDiv.appendChild(visibleLabel);
var option1 = document.createElement('option');
option1.value='Oui';
option1.textContent='Oui';
select.appendChild(option1);
select.style.color = 'blue'; // Set text color to blue
select.style.width = '250px'; // Set width
select.style.height = '20px'; // Set width
select.style.padding = '0px'; // Adjust padding to match select
select.style.border = '1px solid #ccc'; // Match border style
select.style.fontSize = '14px'; // Match font size
select.style.boxSizing = 'border-box'; // Include padding and border in the width
select.style.backgroundColor='cornsilk';

var option2 = document.createElement('option');
option2.value='Non';
option2.textContent='Non';
select.appendChild(option2);
select.style.color = 'blue'; // Set text color to blue
if (group_data_cube[index].prevVisible==='Oui') {
    option1.selected=true;
    
} else {

    option2.selected=true;
    
}

select.addEventListener('change', updateCubeDimensions);

select.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

visibleLabelDiv.appendChild(select);
labelsInputContainer.appendChild(visibleLabelDiv);

var specLabelDiv = document.createElement('div');
var specLabel = document.createElement('label');
specLabel.textContent = 'Structure:';
specLabelDiv.appendChild(specLabel);

var option_2 = document.createElement('option');
option_2.value='Protégée';
option_2.textContent='Protégée';
select_2.appendChild(option_2);
select_2.style.color = 'blue'; // Set text color to blue
select_2.style.width = '250px'; // Set width
select_2.style.height = '20px'; // Set width
select_2.style.padding = '0px'; // Adjust padding to match select
select_2.style.border = '1px solid #ccc'; // Match border style
select_2.style.fontSize = '14px'; // Match font size
select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
select_2.style.backgroundColor='cornsilk';

var option_3 = document.createElement('option');
option_3.value='Ignorée';
option_3.textContent='Ignorée';
select_2.appendChild(option_3);
select_2.style.color = 'blue'; // Set text color to blue

var option_4 = document.createElement('option');
option_4.value='Autre';
option_4.textContent='Autre';
select_2.appendChild(option_4);
select_2.style.color = 'blue'; // Set text color to blue


    
if (group_data_cube[index].prevSpec==='Protégée') {

    option_2.selected=true;
    
} else if (group_data_cube[index].prevSpec==='Ignorée') {

    option_3.selected=true;

} else {
    
    option_4.selected=true;

}

select_2.addEventListener('change', updateCubeDimensions);

select_2.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

specLabelDiv.appendChild(select_2);
labelsInputContainer.appendChild(specLabelDiv);


// Create and append label and input fields for cube color
var colorInputDiv = document.createElement('div');
//colorInputDiv.style.display = 'flex';
//colorInputDiv.style.alignItems = 'center';
var colorLabel = document.createElement('label');
colorLabel.textContent = 'Couleur: ';
colorInputDiv.appendChild(colorLabel);
var colorInput = document.createElement('input');
colorInput.type = 'color';
colorInput.style.width = '250px'; // Set width
colorInput.style.padding = '5px'; // Adjust padding to match select
colorInput.style.border = '1px solid #ccc'; // Match border style
colorInput.style.fontSize = '16px'; // Match font size
colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width
//colorInput.style.marginLeft = '10px';
colorInput.value = color_cube;
colorInput.addEventListener('input', updateCubeColor);

colorInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//colorInput.style.marginLeft = '50px';
colorInputDiv.appendChild(colorInput);
labelsInputContainer.appendChild(colorInputDiv);

} else if (group.name=='group_ca') {

var labelsInputContainer = document.getElementById('label-list');
var select = document.createElement("select");
var select_2 = document.createElement("select");

// Create and append label and input fields for cube dimensions
var RenameLabelDiv = document.createElement('div');
var RenameLabel = document.createElement('label');
RenameLabel.textContent = 'Renommer:';
RenameLabel.style.display = 'block'; // Ensure label is on its own line
RenameLabelDiv.appendChild(RenameLabel);
var RenameInput = document.createElement('input');
RenameInput.type = 'text';
//widthInput.style.marginLeft = '150px';
RenameInput.placeholder = 'Nom de la structure';
RenameInput.value = group_data_cube[index].text_new_item;
//widthInput.style.marginLeft = '50px';
RenameInput.style.color = 'blue'; // Set text color to blue
RenameInput.style.display = 'block'; // Ensure label is on its own line
RenameInput.style.width = '250px'; // Set width
RenameInput.style.height = '20px'; // Set width
RenameInput.style.padding = '5px'; // Adjust padding to match select
RenameInput.style.border = '1px solid #ccc'; // Match border style
RenameInput.style.fontSize = '14px'; // Match font size
RenameInput.style.boxSizing = 'border-box'; // Include padding and border in the width
RenameInput.style.backgroundColor='cornsilk';
RenameInput.addEventListener('input', updateCubeDimensions);

RenameInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

RenameLabelDiv.appendChild(RenameInput);
labelsInputContainer.appendChild(RenameLabelDiv);

var LengthLabelDiv = document.createElement('div');
var LengthLabel = document.createElement('label');
LengthLabel.textContent = 'Longueur (m):';
LengthLabel.style.display = 'block'; // Ensure label is on its own line
LengthLabelDiv.appendChild(LengthLabel);
var LengthInput = document.createElement('input');
LengthInput.type = 'number';
//widthInput.style.marginLeft = '150px';
LengthInput.placeholder = 'Enter value';
LengthInput.value = group_data_cube[index].prevLength; 
//widthInput.style.marginLeft = '50px';
LengthInput.style.color = 'blue'; // Set text color to blue
LengthInput.style.display = 'block'; // Ensure label is on its own line
LengthInput.style.width = '250px'; // Set width
LengthInput.style.height = '20px'; // Set width
LengthInput.style.padding = '5px'; // Adjust padding to match select
LengthInput.style.border = '1px solid #ccc'; // Match border style
LengthInput.style.fontSize = '14px'; // Match font size
LengthInput.style.boxSizing = 'border-box'; // Include padding and border in the width
LengthInput.style.backgroundColor='cornsilk';
LengthInput.addEventListener('input', updateCubeDimensions);

LengthInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

LengthLabelDiv.appendChild(LengthInput);
labelsInputContainer.appendChild(LengthLabelDiv);

// Create and append label and input fields for cube position
var xLabelDiv = document.createElement('div');
var xLabel = document.createElement('label');
xLabel.textContent = 'Origine X0 point départ (m):';
xLabel.style.display = 'block'; // Ensure label is on its own line
xLabelDiv.appendChild(xLabel);
var xInput = document.createElement('input');
xInput.type = 'number';
xInput.placeholder = 'Entrer la valeur';
xInput.value =group_data_cube[index].prevPosX ;
xInput.style.color = 'blue'; // Set text color to blue
xInput.style.display = 'block'; // Ensure label is on its own line
xInput.style.width = '250px'; // Set width
xInput.style.height = '20px'; // Set width
xInput.style.padding = '5px'; // Adjust padding to match select
xInput.style.border = '1px solid #ccc'; // Match border style
xInput.style.fontSize = '14px'; // Match font size
xInput.style.boxSizing = 'border-box'; // Include padding and border in the width
xInput.style.backgroundColor='cornsilk';
xInput.addEventListener('input', updateCubeDimensions);

xInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//xInput.style.marginLeft = '50px';
xLabelDiv.appendChild(xInput);
labelsInputContainer.appendChild(xLabelDiv);

var yLabelDiv = document.createElement('div');
var yLabel = document.createElement('label');
yLabel.textContent = 'Origine Y0 point départ (m):';
yLabel.style.display = 'block'; // Ensure label is on its own line
yLabelDiv.appendChild(yLabel);
var yInput = document.createElement('input');
yInput.type = 'number';
yInput.placeholder = 'Entrer la valeur';
yInput.value = group_data_cube[index].prevPosY;
yInput.style.color = 'blue'; // Set text color to blue
yInput.style.display = 'block'; // Ensure label is on its own line
yInput.style.width = '250px'; // Set width
yInput.style.height = '20px'; // Set width
yInput.style.padding = '5px'; // Adjust padding to match select
yInput.style.border = '1px solid #ccc'; // Match border style
yInput.style.fontSize = '14px'; // Match font size
yInput.style.boxSizing = 'border-box'; // Include padding and border in the width
yInput.style.backgroundColor='cornsilk';
yInput.addEventListener('input', updateCubeDimensions);

yInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//yInput.style.marginLeft = '50px';
yLabelDiv.appendChild(yInput);
labelsInputContainer.appendChild(yLabelDiv);

var zLabelDiv = document.createElement('div');
var zLabel = document.createElement('label');
zLabel.textContent = 'Origine Z0 (m):';
zLabel.style.display = 'block'; // Ensure label is on its own line
zLabelDiv.appendChild(zLabel);
var zInput = document.createElement('input');
zInput.type = 'number';
zInput.placeholder = 'Entrer la valeur';
zInput.value = group_data_cube[index].prevPosZ;
zInput.style.color = 'blue'; // Set text color to blue
zInput.style.display = 'block'; // Ensure label is on its own line
zInput.style.width = '250px'; // Set width
zInput.style.height = '20px'; // Set width
zInput.style.padding = '5px'; // Adjust padding to match select
zInput.style.border = '1px solid #ccc'; // Match border style
zInput.style.fontSize = '14px'; // Match font size
zInput.style.boxSizing = 'border-box'; // Include padding and border in the width
zInput.style.backgroundColor='cornsilk';
zInput.addEventListener('input', updateCubeDimensions);

zInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//zInput.style.marginLeft = '50px';
zLabelDiv.appendChild(zInput);
labelsInputContainer.appendChild(zLabelDiv);

var SagLabelDiv = document.createElement('div');
var SagLabel = document.createElement('label');
SagLabel.textContent = 'Flêche (%):';
SagLabel.style.display = 'block'; // Ensure label is on its own line
SagLabelDiv.appendChild(SagLabel);
var SagInput = document.createElement('input');
SagInput.type = 'number';
SagInput.placeholder = 'Entrer la valeur';
SagInput.value = group_data_cube[index].prevSag;
SagInput.style.color = 'blue'; // Set text color to blue
SagInput.style.display = 'block'; // Ensure label is on its own line
SagInput.style.width = '250px'; // Set width
SagInput.style.height = '20px'; // Set width
SagInput.style.padding = '5px'; // Adjust padding to match select
SagInput.style.border = '1px solid #ccc'; // Match border style
SagInput.style.fontSize = '14px'; // Match font size
SagInput.style.boxSizing = 'border-box'; // Include padding and border in the width
SagInput.style.backgroundColor='cornsilk';
SagInput.addEventListener('input', updateCubeDimensions);

SagInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//heightInput.style.marginLeft = '50px';
SagLabelDiv.appendChild(SagInput);
labelsInputContainer.appendChild(SagLabelDiv);

var heightC1LabelDiv = document.createElement('div');
var heightC1Label = document.createElement('label');
heightC1Label.textContent = 'Hauteur point départ (m):';
heightC1Label.style.display = 'block'; // Ensure label is on its own line
heightC1LabelDiv.appendChild(heightC1Label);
var heightC1Input = document.createElement('input');
heightC1Input.type = 'number';
heightC1Input.placeholder = 'Entrer la valeur';
heightC1Input.value = group_data_cube[index].prevHeight_C_1;
heightC1Input.style.color = 'blue'; // Set text color to blue
heightC1Input.style.display = 'block'; // Ensure label is on its own line
heightC1Input.style.width = '250px'; // Set width
heightC1Input.style.height = '20px'; // Set width
heightC1Input.style.padding = '5px'; // Adjust padding to match select
heightC1Input.style.border = '1px solid #ccc'; // Match border style
heightC1Input.style.fontSize = '14px'; // Match font size
heightC1Input.style.boxSizing = 'border-box'; // Include padding and border in the width
heightC1Input.style.backgroundColor='cornsilk';
heightC1Input.addEventListener('input', updateCubeDimensions);

heightC1Input.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//heightInput.style.marginLeft = '50px';
heightC1LabelDiv.appendChild(heightC1Input);
labelsInputContainer.appendChild(heightC1LabelDiv);

var heightC2LabelDiv = document.createElement('div');
var heightC2Label = document.createElement('label');
heightC2Label.textContent = 'Hauteur point arrivée (m):';
heightC2Label.style.display = 'block'; // Ensure label is on its own line
heightC2LabelDiv.appendChild(heightC2Label);
var heightC2Input = document.createElement('input');
heightC2Input.type = 'number';
heightC2Input.placeholder = 'Entrer la valeur';
heightC2Input.value = group_data_cube[index].prevHeight_C_2;
heightC2Input.style.color = 'blue'; // Set text color to blue
heightC2Input.style.display = 'block'; // Ensure label is on its own line
heightC2Input.style.width = '250px'; // Set width
heightC2Input.style.height = '20px'; // Set width
heightC2Input.style.padding = '5px'; // Adjust padding to match select
heightC2Input.style.border = '1px solid #ccc'; // Match border style
heightC2Input.style.fontSize = '14px'; // Match font size
heightC2Input.style.boxSizing = 'border-box'; // Include padding and border in the width
heightC2Input.style.backgroundColor='cornsilk';
heightC2Input.addEventListener('input', updateCubeDimensions);

heightC2Input.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//heightInput.style.marginLeft = '50px';
heightC2LabelDiv.appendChild(heightC2Input);
labelsInputContainer.appendChild(heightC2LabelDiv);

var rotationAngleLabelDiv = document.createElement('div');
var rotationAngleLabel = document.createElement('label');
rotationAngleLabel.textContent = 'Angle autour de z (°):';
rotationAngleLabel.style.display = 'block'; // Ensure label is on its own line
rotationAngleLabelDiv.appendChild(rotationAngleLabel);
var rotationAngle = document.createElement('input');
rotationAngle.type = 'number';
rotationAngle.placeholder = 'Entrer la valeur';
rotationAngle.value = group_data_cube[index].prevRotZ;
rotationAngle.style.color = 'blue'; // Set text color to blue
rotationAngle.style.display = 'block'; // Ensure label is on its own line
rotationAngle.style.width = '250px'; // Set width
rotationAngle.style.height = '20px'; // Increase height for better visibility
rotationAngle.style.padding = '5px'; // Add padding for better readability
rotationAngle.style.border = '1px solid #ccc'; // Match border style
rotationAngle.style.fontSize = '14px'; // Increase font size for better readability
rotationAngle.style.boxSizing = 'border-box'; // Include padding and border in the width
rotationAngle.style.backgroundColor = 'cornsilk'; // Light background color for visibility
rotationAngle.addEventListener('input', updateCubeDimensions);

rotationAngle.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//rotationAngle.style.marginLeft = '50px';
rotationAngleLabelDiv.appendChild(rotationAngle);
labelsInputContainer.appendChild(rotationAngleLabelDiv);

var eplineLabelDiv = document.createElement('div');
var eplineLabel = document.createElement('label');
eplineLabel.textContent = 'Epaissue de la ligne (m):';
eplineLabel.style.display = 'block'; // Ensure label is on its own line
eplineLabelDiv.appendChild(eplineLabel);
var eplineInput = document.createElement('input');
eplineInput.type = 'number';
eplineInput.placeholder = 'Entrer la valeur';
eplineInput.value = group_data_cube[index].prevLineWidth;
eplineInput.step = '0.01'; // Set the step attribute to 0.1
eplineInput.style.color = 'blue'; // Set text color to blue
eplineInput.style.display = 'block'; // Ensure label is on its own line
eplineInput.style.width = '250px'; // Set width
eplineInput.style.height = '20px'; // Set width
eplineInput.style.padding = '0px'; // Adjust padding to match select
eplineInput.style.border = '1px solid #ccc'; // Match border style
eplineInput.style.fontSize = '14px'; // Match font size
eplineInput.style.boxSizing = 'border-box'; // Include padding and border in the width
eplineInput.style.backgroundColor='cornsilk';
eplineInput.addEventListener('input', updateCubeDimensions);

eplineInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//heightInput.style.marginLeft = '50px';
eplineLabelDiv.appendChild(eplineInput);
labelsInputContainer.appendChild(eplineLabelDiv);

var visibleLabelDiv = document.createElement('div');
var visibleLabel = document.createElement('label');
visibleLabel.textContent = 'Structure visible:';
visibleLabelDiv.appendChild(visibleLabel);
var option1 = document.createElement('option');
option1.value='Oui';
option1.textContent='Oui';
select.appendChild(option1);
select.style.color = 'blue'; // Set text color to blue
var option2 = document.createElement('option');
option2.value='Non';
option2.textContent='Non';
select.appendChild(option2);
select.style.color = 'blue'; // Set text color to blue
select.style.width = '250px'; // Set width
select.style.height = '20px'; // Set width
select.style.padding = '0px'; // Adjust padding to match select
select.style.border = '1px solid #ccc'; // Match border style
select.style.fontSize = '14px'; // Match font size
select.style.boxSizing = 'border-box'; // Include padding and border in the width
select.style.backgroundColor='cornsilk';

if (group_data_cube[index].prevVisible==='Oui') {
    option1.selected=true;
    
} else {

    option2.selected=true;
    
}

select.addEventListener('change', updateCubeDimensions);

select.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

visibleLabelDiv.appendChild(select);
labelsInputContainer.appendChild(visibleLabelDiv);

var specLabelDiv = document.createElement('div');
var specLabel = document.createElement('label');
specLabel.textContent = 'Structure:';
specLabelDiv.appendChild(specLabel);

select_2.style.color = 'blue'; // Set text color to blue
select_2.style.width = '250px'; // Set width
select_2.style.height = '20px'; // Set width
select_2.style.padding = '0px'; // Adjust padding to match select
select_2.style.border = '1px solid #ccc'; // Match border style
select_2.style.fontSize = '14px'; // Match font size
select_2.style.boxSizing = 'border-box'; // Include padding and border in the width
select_2.style.backgroundColor='cornsilk';

var option_2 = document.createElement('option');
option_2.value='Protégée';
option_2.textContent='Protégée';
select_2.appendChild(option_2);
select_2.style.color = 'blue'; // Set text color to blue

var option_3 = document.createElement('option');
option_3.value='Ignorée';
option_3.textContent='Ignorée';
select_2.appendChild(option_3);
select_2.style.color = 'blue'; // Set text color to blue

var option_4 = document.createElement('option');
option_4.value='Autre';
option_4.textContent='Autre';
select_2.appendChild(option_4);
select_2.style.color = 'blue'; // Set text color to blue


    
if (group_data_cube[index].prevSpec==='Protégée') {

    option_2.selected=true;
    
} else if (group_data_cube[index].prevSpec==='Ignorée') {

    option_3.selected=true;

} else {
    
    option_4.selected=true;

}

select_2.addEventListener('change', updateCubeDimensions);

select_2.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

specLabelDiv.appendChild(select_2);
labelsInputContainer.appendChild(specLabelDiv);

// Create and append label and input fields for cube color
var colorInputDiv = document.createElement('div');
//colorInputDiv.style.display = 'flex';
//colorInputDiv.style.alignItems = 'center';
var colorLabel = document.createElement('label');
colorLabel.textContent = 'Couleur: ';
colorInputDiv.appendChild(colorLabel);
var colorInput = document.createElement('input');
colorInput.type = 'color';
//colorInput.style.marginLeft = '10px';
colorInput.value = color_cube;
colorInput.style.width = '250px'; // Set width
colorInput.style.padding = '5px'; // Adjust padding to match select
colorInput.style.border = '1px solid #ccc'; // Match border style
colorInput.style.fontSize = '16px'; // Match font size
colorInput.style.boxSizing = 'border-box'; // Include padding and border in the width
colorInput.addEventListener('input', updateCubeColor);

colorInput.addEventListener('blur', function() {
    saveState(); // Sauvegarder uniquement à la sortie du champ
});

//colorInput.style.marginLeft = '50px';
colorInputDiv.appendChild(colorInput);
labelsInputContainer.appendChild(colorInputDiv);




}





        
        //if (inputdata==1) {

        xInput.dispatchEvent(new Event('input'));
        //yInput.dispatchEvent(new Event('input'));

        //} else if (inputdata==2) {

        //zInput.dispatchEvent(new Event('input'));

        //}
      
        //xInput.dispatchEvent(new Event('input'));
        //yInput.dispatchEvent(new Event('input'));

        //const cube = group.filter(element => element.shape === "cube");

        function updateCubeColor() {

        if (group.name=='group_cube') {
        var color = document.getElementById('label-list').querySelectorAll('input')[8].value;
        } else if (group.name=='group_cube_f') {
        var color = document.getElementById('label-list').querySelectorAll('input')[10].value;
        } else if (group.name=='group_cylinder') {
        var color = document.getElementById('label-list').querySelectorAll('input')[7].value;
        } else if (group.name=='group_cylinderh') {
        var color = document.getElementById('label-list').querySelectorAll('input')[7].value;
        } else if (group.name=='group_pda') {
        var color = document.getElementById('label-list').querySelectorAll('input')[7].value;
        
        } else if (group.name=='group_pts') {
        var color = document.getElementById('label-list').querySelectorAll('input')[6].value;
        
        } else if (group.name=='group_cube_cy') {
        var color = document.getElementById('label-list').querySelectorAll('input')[8].value;
        
        } else if (group.name=='group_cone') {
        var color = document.getElementById('label-list').querySelectorAll('input')[6].value;
        
        } else if (group.name=='group_sphere') {
        var color = document.getElementById('label-list').querySelectorAll('input')[5].value;
        
        } else if (group.name=='group_cylinder_sp') {
        var color = document.getElementById('label-list').querySelectorAll('input')[6].value;
        
        } else if (group.name=='group_ca') {
        var color = document.getElementById('label-list').querySelectorAll('input')[10].value;
        
        }
        
        group.children.forEach(child => {
        originalColor=group_color_data_cube[index];
        child.material.color.set(color); 
        });

        group_color_data_cube[index]=color;

        saveState();

        
        }



        
     
    function updateCubeDimensions() {

        test_snp=0;

 



        if (group.name=='group_cube') {

       ///////////////////////////////////////////////////////CUBE///////////////////////////////////////////////////
        cube=group.children[0];

        textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
        text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
        Longueur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
        prevWidth=document.getElementById('label-list').querySelectorAll('input')[1].value
        Largeur_bat_1= parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
        prevDepth=document.getElementById('label-list').querySelectorAll('input')[2].value
        Hauteur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
        prevHeight=document.getElementById('label-list').querySelectorAll('input')[3].value
        x0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
        prevPosX=document.getElementById('label-list').querySelectorAll('input')[4].value
        y0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[5].value);
        prevPosY=document.getElementById('label-list').querySelectorAll('input')[5].value
        z0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[6].value);
        prevPosZ=document.getElementById('label-list').querySelectorAll('input')[6].value
        alpha=parseFloat(document.getElementById('label-list').querySelectorAll('input')[7].value);
        prevRotZ=document.getElementById('label-list').querySelectorAll('input')[7].value;
        prevVisible=select.value;
        prevSpec=select_2.value;
        group_name='group_cube';

        
        if (Longueur_bat_1 <= 0 || 
        Largeur_bat_1 <= 0 || 
        Hauteur_bat_1 <= 0 || 
        isNaN(Longueur_bat_1) ||
        isNaN(Largeur_bat_1) ||
        isNaN(Hauteur_bat_1) ||
        isNaN(x0_1) ||
        isNaN(y0_1) ||
        isNaN(z0_1) ||
        isNaN(alpha) ||
        textinput==''
    
    ) {
      

    //    if (Longueur_bat_1 <= 0 || Largeur_bat_1 <= 0 || Hauteur_bat_1 <= 0 || ) {
      

           // alert("Insérer une entrée valide");


            return 
        
        

    }


    
        

    if (Longueur_bat_1 !==group_data_cube_float[index].Longueur_bat_1
    || Largeur_bat_1 !==group_data_cube_float[index].Largeur_bat_1
    || prevHeight !==group_data_cube[index].prevHeight
    || x0_1 !==group_data_cube_float[index].x0_1
    || y0_1 !==group_data_cube_float[index].y0_1
    || z0_1 !==group_data_cube_float[index].z0_1
    || alpha !==group_data_cube_float[index].alpha
    || prevSpec !==group_data_cube_float[index].prevSpec

    ) 
    
    
    {

        delete_points();
          
    }

        

        cubeGeometry=new THREE.BoxGeometry(Longueur_bat_1, Hauteur_bat_1,Largeur_bat_1);
        
        var selectedValue=select.value;

        if (selectedValue=='Oui') {

            var structure_visible=true;

        } else {

            var structure_visible=false;


        }

        //var cubeMaterial = new THREE.MeshPhongMaterial({ color: prevColor });
        //var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
        cube.position.set(x0_1, z0_1+Hauteur_bat_1/2, y0_1);
        cube.rotation.y=alpha*Math.PI/180;
        cube.geometry.dispose();
        cube.geometry=cubeGeometry;
        cube.visible=structure_visible;
        newItem.textContent = textinput;

        Hauteur_bat_1=Hauteur_bat_1+z0_1;

        group_data_cube[index]={text_new_item,prevWidth,prevDepth,prevHeight,prevPosX,prevPosY,prevPosZ,prevRotZ,prevVisible,prevSpec,index};
        group_data_cube_float[index]={group_name,Longueur_bat_1,Largeur_bat_1,Hauteur_bat_1,x0_1,y0_1,z0_1,alpha,prevSpec};

        //saveState();
        

        

        ///////////////////////////////////////////////////////CUBE///////////////////////////////////////////////////

        //////////////////////////////////////////////////////FAITAGE/////////////////////////////////////////////////


    }    else if (group.name=='group_cube_f') {

        cube_f=group.children[0];
        gable_1=group.children[1];
        gable_2=group.children[2];
        gable_3=group.children[3];
        gable_4=group.children[4];

        textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
        text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
        Longueur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
        prevWidth=document.getElementById('label-list').querySelectorAll('input')[1].value
        Largeur_bat_1= parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
        prevDepth=document.getElementById('label-list').querySelectorAll('input')[2].value
        Hauteur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
        prevHeight=document.getElementById('label-list').querySelectorAll('input')[3].value
        x0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[5].value);
        prevPosX=document.getElementById('label-list').querySelectorAll('input')[5].value
        y0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[6].value);
        prevPosY=document.getElementById('label-list').querySelectorAll('input')[6].value
        z0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[8].value);
        prevPosZ=document.getElementById('label-list').querySelectorAll('input')[8].value
        alpha=parseFloat(document.getElementById('label-list').querySelectorAll('input')[9].value);
        prevRotZ=document.getElementById('label-list').querySelectorAll('input')[9].value
        HauteurMax_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
        prevHeightMax=document.getElementById('label-list').querySelectorAll('input')[4].value
        yf_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[7].value);
        prevPosYf=document.getElementById('label-list').querySelectorAll('input')[7].value;
        prevVisible=select.value;
        prevSpec=select_2.value;
        group_name='group_cube_f';



        if (Longueur_bat_1 <= 0 ||
        Largeur_bat_1 <= 0 ||
        Hauteur_bat_1 <= 0 ||
        HauteurMax_bat_1 <= 0 ||
        Math.abs(yf_1) >= Largeur_bat_1/2 ||
        textinput=='' ||
        HauteurMax_bat_1<=Hauteur_bat_1 ||
        isNaN(Longueur_bat_1) ||
        isNaN(Largeur_bat_1) ||     
        isNaN(Hauteur_bat_1) || 
        isNaN(HauteurMax_bat_1) || 
        isNaN(x0_1)||
        isNaN(y0_1)||
        isNaN(z0_1)||
        isNaN(yf_1) ||
        isNaN(alpha)) {

            //alert("Insérer une entrée valide");

            return 

        } 

        if (Longueur_bat_1 !==group_data_cube_float[index].Longueur_bat_1
        || Largeur_bat_1 !==group_data_cube_float[index].Largeur_bat_1
        || prevHeight !==group_data_cube[index].prevHeight
        || x0_1 !==group_data_cube_float[index].x0_1
        || y0_1 !==group_data_cube_float[index].y0_1
        || z0_1 !==group_data_cube_float[index].z0_1
        || alpha !==group_data_cube_float[index].alpha
        || prevHeightMax !==group_data_cube[index].prevHeightMax        
        || yf_1 !==group_data_cube_float[index].yf_1 
        || prevSpec !==group_data_cube_float[index].prevSpec

        ) 
        
        
        {

            delete_points();
            
        }

 
        cubeGeometry = new THREE.BoxGeometry(Longueur_bat_1,Hauteur_bat_1,Largeur_bat_1);
        var selectedValue=select.value;

        if (selectedValue=='Oui') {

            var structure_visible=true;


        } else {

            var structure_visible=false;


        }

        cube_f.position.set(x0_1, z0_1+Hauteur_bat_1/2, y0_1);
        cube_f.rotation.y=alpha*Math.PI/180;
        cube_f.geometry.dispose();
        cube_f.geometry=cubeGeometry;
        cube_f.visible=structure_visible;
        gable_1.visible=structure_visible;
        gable_2.visible=structure_visible;
        gable_3.visible=structure_visible;
        gable_4.visible=structure_visible;

        newItem.textContent = textinput;

        var height_g=HauteurMax_bat_1-Hauteur_bat_1
        var x1=0*x0_1-Longueur_bat_1/2
        var x2=0*x0_1+Longueur_bat_1/2

        var y1=0*y0_1-Largeur_bat_1/2
        var y2=0*y0_1+Largeur_bat_1/2

        var z1=0*z0_1+Hauteur_bat_1+height_g

        const pointsMatrix_1 = [
        [x1, 0*z0_1+Hauteur_bat_1, y1],
        [x2, 0*z0_1+Hauteur_bat_1, y1],
        [x2, z1, yf_1+0*y0_1],
        [x1, z1, yf_1+0*y0_1]
        ];

        const pointsMatrix_2 = [
        [x1, z1, yf_1+0*y0_1],
        [x2, z1, yf_1+0*y0_1],
        [x2, 0*z0_1+Hauteur_bat_1, y2],
        [x1, 0*z0_1+Hauteur_bat_1, y2]
            // Add more points as needed
        ];

        const pointsMatrix_3 = [
        [x1, 0*z0_1+Hauteur_bat_1, y1],
        [x1, z1, yf_1+0*y0_1],
        [x1, 0*z0_1+Hauteur_bat_1, y2],
        [x1, 0*z0_1+Hauteur_bat_1, y1],
        ];

        const pointsMatrix_4 = [
        [x2, 0*z0_1+Hauteur_bat_1, y1],
        [x2, z1, yf_1+0*y0_1],
        [x2, 0*z0_1+Hauteur_bat_1, y2],
        [x2, 0*z0_1+Hauteur_bat_1, y1],
        ];

        // Create geometry
        const geometry_1 = new THREE.BufferGeometry();
        const vertices_1 = [];
        for (let i = 0; i < pointsMatrix_1.length; i++) {
            vertices_1.push(pointsMatrix_1[i][0], pointsMatrix_1[i][1], pointsMatrix_1[i][2]);
        }
        geometry_1.setAttribute('position', new THREE.Float32BufferAttribute(vertices_1, 3));
        geometry_1.setIndex([0, 1, 2, 0, 2, 3]); // Define indices for triangles (assuming it's a square surface)
        //gable_1.position.set(x0_1,z0_1,y0_1);
        
        gable_1.rotation.y=alpha*Math.PI/180;
        gable_1.position.set(x0_1, z0_1+0*Hauteur_bat_1/2, y0_1);

        // Create geometry
        const geometry_2 = new THREE.BufferGeometry();
        const vertices_2 = [];
        for (let i = 0; i < pointsMatrix_2.length; i++) {
            vertices_2.push(pointsMatrix_2[i][0], pointsMatrix_2[i][1], pointsMatrix_2[i][2]);
        }
        geometry_2.setAttribute('position', new THREE.Float32BufferAttribute(vertices_2, 3));
        geometry_2.setIndex([0, 1, 2, 0, 2, 3]); // Define indices for triangles (assuming it's a square surface)
        gable_2.rotation.y=alpha*Math.PI/180;
        gable_2.position.set(x0_1, z0_1+0*Hauteur_bat_1/2, y0_1);
        //gable_2.position.set(x0_1,z0_1,y0_1);

        //const position_g_0=new THREE.Vector3(0, 0, 0);

        //const relativeAxisStart = position_g_0.clone().sub(position_g_1);



        // Create geometry
        const geometry_3 = new THREE.BufferGeometry();
        const vertices_3 = [];
        for (let i = 0; i < pointsMatrix_3.length; i++) {
            vertices_3.push(pointsMatrix_3[i][0], pointsMatrix_3[i][1], pointsMatrix_3[i][2]);
        }
        
        geometry_3.setAttribute('position', new THREE.Float32BufferAttribute(vertices_3, 3));
        geometry_3.setIndex([0, 1, 2, 0, 2, 3]); // Define indices for triangles (assuming it's a square surface)
        //const boundingBox = new THREE.Box3().setFromObject(geometry_3);
        //const center = new THREE.Vector3();
        //boundingBox.getCenter(center);
        //geometry_3.computeBoundingBox();

        gable_3.rotation.y=alpha*Math.PI/180;
        gable_3.position.set(x0_1, z0_1+0*Hauteur_bat_1/2, y0_1);
        
        // Create geometry
        const geometry_4 = new THREE.BufferGeometry();
        const vertices_4 = [];
        for (let i = 0; i < pointsMatrix_4.length; i++) {
            vertices_4.push(pointsMatrix_4[i][0], pointsMatrix_4[i][1], pointsMatrix_4[i][2]);
        }
        geometry_4.setAttribute('position', new THREE.Float32BufferAttribute(vertices_4, 3));
        geometry_4.setIndex([0, 1, 2, 0, 2, 3]); // Define indices for triangles (assuming it's a square surface)
        gable_4.rotation.y=alpha*Math.PI/180;
        gable_4.position.set(x0_1, z0_1+0*Hauteur_bat_1/2, y0_1);

        gable_1.geometry.dispose();
        gable_1.geometry=geometry_1

        gable_2.geometry.dispose();
        gable_2.geometry=geometry_2

        gable_3.geometry.dispose();
        gable_3.geometry=geometry_3

        gable_4.geometry.dispose();
        gable_4.geometry=geometry_4;

        Hauteur_bat_1=Hauteur_bat_1+z0_1;
        HauteurMax_bat_1=HauteurMax_bat_1+z0_1;

        group_data_cube[index]={text_new_item,prevWidth,prevDepth,prevHeight,prevPosX,prevPosY,prevPosZ,prevRotZ,prevHeightMax,prevPosYf,prevVisible,prevSpec,index};
        group_data_cube_float[index]={group_name,Longueur_bat_1,Largeur_bat_1,Hauteur_bat_1,x0_1,y0_1,z0_1,alpha,HauteurMax_bat_1,yf_1,prevSpec};

        //saveState();

    }   else if (group.name=='group_cylinder') {

        cylinder_1=group.children[0];

        textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
        text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
        Rayon_sup = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
        prevRadiusTop=document.getElementById('label-list').querySelectorAll('input')[1].value
        Rayon_inf = parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
        prevRadiusBottom=document.getElementById('label-list').querySelectorAll('input')[2].value
        Hauteur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
        prevHeight=document.getElementById('label-list').querySelectorAll('input')[3].value
        x0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
        prevPosX=document.getElementById('label-list').querySelectorAll('input')[4].value
        y0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[5].value);
        prevPosY=document.getElementById('label-list').querySelectorAll('input')[5].value
        z0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[6].value);
        prevPosZ=document.getElementById('label-list').querySelectorAll('input')[6].value;
        prevVisible=select.value;
        prevSpec=select_2.value;
        group_name='group_cylinder';



        if (Hauteur_bat_1 <= 0 ||
        Rayon_sup <=0 ||
        Rayon_inf <=0 ||
        isNaN(Hauteur_bat_1) ||       
        isNaN(Rayon_sup) ||
        isNaN(Rayon_inf) ||
        isNaN(x0_1) ||
        isNaN(y0_1) ||                
        isNaN(z0_1) ||   
        textinput=='') {

            //alert("Insérer une entrée valide");

            return
        
        } 


        if (Rayon_sup !==group_data_cube_float[index].Rayon_sup
        || Rayon_inf !==group_data_cube_float[index].Rayon_inf
        || prevHeight !==group_data_cube[index].prevHeight
        || x0_1 !==group_data_cube_float[index].x0_1
        || y0_1 !==group_data_cube_float[index].y0_1
        || z0_1 !==group_data_cube_float[index].z0_1
        || prevSpec !==group_data_cube_float[index].prevSpec

        ) 
        
        
        {

            delete_points();
            
        }

            var cylinderGeometry_1 = new THREE.CylinderGeometry(Rayon_sup, Rayon_inf, Hauteur_bat_1,32,1, false);
            cylinder_1.position.set(x0_1, z0_1+Hauteur_bat_1/2, y0_1);
            cylinder_1.geometry.dispose();
            cylinder_1.geometry=cylinderGeometry_1;

            var selectedValue=select.value;

            if (selectedValue=='Oui') {

                var structure_visible=true;


            } else {

                var structure_visible=false;


            }

            cylinder_1.visible=structure_visible;
            newItem.textContent = textinput;

            Hauteur_bat_1=Hauteur_bat_1+z0_1;
            group_data_cube[index]={text_new_item,prevRadiusTop,prevRadiusBottom,prevHeight,prevPosX,prevPosY,prevPosZ,prevVisible,prevSpec,index};
            group_data_cube_float[index]={group_name,Rayon_inf,Rayon_sup,Hauteur_bat_1,x0_1,y0_1,z0_1,prevSpec};

            //saveState();


        //////////////////////////////////////////////////////FAITAGE///////////////////////////////////////////////////

        //////////////////////////////////////////////////////CYLINDRE HORIZONTAL///////////////////////////////////////////////////

    }   else if (group.name=='group_cylinderh') {

cylinder_1=group.children[0];

textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
Rayon = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
prevRadius=document.getElementById('label-list').querySelectorAll('input')[1].value
Longueur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
prevLength=document.getElementById('label-list').querySelectorAll('input')[2].value
x0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
prevPosX=document.getElementById('label-list').querySelectorAll('input')[3].value
y0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
prevPosY=document.getElementById('label-list').querySelectorAll('input')[4].value
z0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[5].value);
prevPosZ=document.getElementById('label-list').querySelectorAll('input')[5].value;
alpha = parseFloat(document.getElementById('label-list').querySelectorAll('input')[6].value);
prevRotZ=document.getElementById('label-list').querySelectorAll('input')[6].value;
prevVisible=select.value;
prevSpec=select_2.value;
group_name='group_cylinderh';



if (Longueur_bat_1 <= 0 ||
    Rayon <=0 ||
    isNaN(Rayon) ||
    isNaN(Longueur_bat_1) ||    
    isNaN(x0_1) ||
    isNaN(y0_1) ||                
    isNaN(z0_1) ||   
    isNaN(alpha) ||   
    textinput=='') {

    //alert("Insérer une entrée valide");

    return
        
} 

        if (Rayon !==group_data_cube_float[index].Rayon
        || Longueur_bat_1 !==group_data_cube_float[index].Longueur_bat_1
        || x0_1 !==group_data_cube_float[index].x0_1
        || y0_1 !==group_data_cube_float[index].y0_1
        || z0_1 !==group_data_cube_float[index].z0_1
        || alpha !==group_data_cube_float[index].alpha      
        || prevSpec !==group_data_cube_float[index].prevSpec

        ) 
        
        
        {

            delete_points();
            
        }

    var cylinderGeometry_1 = new THREE.CylinderGeometry(Rayon, Rayon, Longueur_bat_1,32,1, false);
    cylinder_1.rotation.z=Math.PI/2;
    cylinder_1.rotation.y=alpha*Math.PI/180;  
    cylinder_1.position.set(x0_1, z0_1, y0_1);
    cylinder_1.geometry.dispose();
    cylinder_1.geometry=cylinderGeometry_1;

    var selectedValue=select.value;

    if (selectedValue=='Oui') {

        var structure_visible=true;


    } else {

        var structure_visible=false;


    }

    cylinder_1.visible=structure_visible;
    newItem.textContent = textinput;

    group_data_cube[index]={text_new_item,prevRadius,prevLength,prevPosX,prevPosY,prevPosZ,prevRotZ,prevVisible,prevSpec,index};
    group_data_cube_float[index]={group_name,Rayon,Longueur_bat_1,x0_1,y0_1,z0_1,alpha,prevSpec};

    //saveState();


//////////////////////////////////////////////////////CYLINDRE HORIZONTAL///////////////////////////////////////////////////

    }   else if (group.name=='group_pda') {

        ///////////////////////////////////////////////////////PDA///////////////////////////////////////////////////
        cylinder_1=group.children[0];
        cylinder_2=group.children[1];
        cone=group.children[2];

        textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
        text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
        Hauteur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
        prevHeight=document.getElementById('label-list').querySelectorAll('input')[1].value
        x0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
        prevPosX=document.getElementById('label-list').querySelectorAll('input')[2].value
        y0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
        prevPosY=document.getElementById('label-list').querySelectorAll('input')[3].value
        z0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
        prevPosZ=document.getElementById('label-list').querySelectorAll('input')[4].value
        DeltaT = parseFloat(document.getElementById('label-list').querySelectorAll('input')[5].value);
        prevDeltaT=document.getElementById('label-list').querySelectorAll('input')[5].value
        epaisseur_ligne = parseFloat(document.getElementById('label-list').querySelectorAll('input')[6].value);
        prevLineWidth=document.getElementById('label-list').querySelectorAll('input')[6].value;
        prevVisible=select.value;
        prevSpec=select_2.value;
        prevICPE=select_3.value;
        group_name='group_pda';
       
      
        if (Hauteur_bat_1 <= 0 ||
        epaisseur_ligne<=0 ||
        textinput=='' ||
        isNaN(Hauteur_bat_1) ||
        isNaN(x0_1) ||
        isNaN(y0_1) ||                
        isNaN(z0_1) ||
        isNaN(DeltaT) ||
        isNaN(epaisseur_ligne)
   
    
    ) {

           // alert("Insérer une entrée valide");

            return
        
        } 

        if (DeltaT>60 || DeltaT<10 ) {

                alert("La valeur saisie doit être comprise entre 10 µs et 60 µs");

        return

        } 

        if (prevHeight !==group_data_cube[index].prevHeight
        || x0_1 !==group_data_cube_float[index].x0_1
        || y0_1 !==group_data_cube_float[index].y0_1
        || z0_1 !==group_data_cube_float[index].z0_1
        || DeltaT !==group_data_cube_float[index].DeltaT  
        || prevSpec !==group_data_cube_float[index].prevSpec

        ) 
        
        
        {

            delete_points();
            
        }



            var cylinderGeometry_1 = new THREE.CylinderGeometry(epaisseur_ligne, epaisseur_ligne, Hauteur_bat_1,32,1, false);
            cylinder_1.position.set(x0_1, z0_1+Hauteur_bat_1/2, y0_1);
            cylinder_1.geometry.dispose();
            cylinder_1.geometry=cylinderGeometry_1

            var cylinderGeometry_2 = new THREE.CylinderGeometry(2*epaisseur_ligne, 2*epaisseur_ligne, 0.2*Hauteur_bat_1,32,1, false);
            cylinder_2.position.set(x0_1,z0_1+Hauteur_bat_1-0.2*Hauteur_bat_1, y0_1);
            cylinder_2.geometry.dispose();
            cylinder_2.geometry=cylinderGeometry_2
            //scene.add(cylinder_2);

            var coneGeometry = new THREE.ConeGeometry(epaisseur_ligne, 0.20, 32);
            cone.position.set(x0_1, z0_1+Hauteur_bat_1+0.1, y0_1);
            cone.geometry.dispose();
            cone.geometry=coneGeometry
            //scene.add(cone);
            var selectedValue=select.value;

            if (selectedValue=='Oui') {

                var structure_visible=true;


            } else {

                var structure_visible=false;


            }

            cylinder_1.visible=structure_visible;
            cylinder_2.visible=structure_visible;
            cone.visible=structure_visible;

            Hauteur_bat_1=Hauteur_bat_1+z0_1;


            group_data_cube[index]={text_new_item,prevHeight,prevPosX,prevPosY,prevPosZ,prevLineWidth,prevVisible,prevSpec,prevICPE,prevDeltaT,index};
            group_data_cube_float[index]={group_name,Hauteur_bat_1,x0_1,y0_1,z0_1,prevSpec,prevICPE,DeltaT};

            newItem.textContent = textinput;

            //saveState();


        ///////////////////////////////////////////////////////PDA///////////////////////////////////////////////////

        /////////////////////////////////////////////////////PTS/////////////////////////////////////////////////////

    } else if (group.name=='group_pts') {

///////////////////////////////////////////////////////PDA///////////////////////////////////////////////////
cylinder_1=group.children[0];
cone=group.children[1];

textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
Hauteur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
prevHeight=document.getElementById('label-list').querySelectorAll('input')[1].value
x0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
prevPosX=document.getElementById('label-list').querySelectorAll('input')[2].value
y0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
prevPosY=document.getElementById('label-list').querySelectorAll('input')[3].value
z0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
prevPosZ=document.getElementById('label-list').querySelectorAll('input')[4].value
epaisseur_ligne = parseFloat(document.getElementById('label-list').querySelectorAll('input')[5].value);
prevLineWidth=document.getElementById('label-list').querySelectorAll('input')[5].value;
prevVisible=select.value;
prevSpec=select_2.value;
group_name='group_pts';

if (Hauteur_bat_1 <= 0 ||
    epaisseur_ligne<=0 ||
    textinput=='' ||
    isNaN(Hauteur_bat_1) ||
    isNaN(x0_1) ||
    isNaN(y0_1) ||                
    isNaN(z0_1) ||
    isNaN(epaisseur_ligne)
   
    
) {

    //alert("Insérer une entrée valide");

    return

    } 

    if (prevHeight !==group_data_cube[index].prevHeight
        || x0_1 !==group_data_cube_float[index].x0_1
        || y0_1 !==group_data_cube_float[index].y0_1
        || z0_1 !==group_data_cube_float[index].z0_1
        || prevSpec !==group_data_cube_float[index].prevSpec

        ) 
        
        
        {

            delete_points();
            
        }




    var cylinderGeometry_1 = new THREE.CylinderGeometry(epaisseur_ligne, epaisseur_ligne, Hauteur_bat_1,32,1, false);
    cylinder_1.position.set(x0_1, z0_1+Hauteur_bat_1/2, y0_1);
    cylinder_1.geometry.dispose();
    cylinder_1.geometry=cylinderGeometry_1

    var coneGeometry = new THREE.ConeGeometry(epaisseur_ligne, 0.2, 32);
    cone.position.set(x0_1, z0_1+Hauteur_bat_1+0.1, y0_1);
    cone.geometry.dispose();
    cone.geometry=coneGeometry
    //scene.add(cone);

    var selectedValue=select.value;

    if (selectedValue=='Oui') {

        var structure_visible=true;


    } else {

        var structure_visible=false;


    }



    cylinder_1.visible=structure_visible;
    cone.visible=structure_visible;

    Hauteur_bat_1=Hauteur_bat_1+z0_1;

    group_data_cube[index]={text_new_item,prevHeight,prevPosX,prevPosY,prevPosZ,prevLineWidth,prevVisible,prevSpec,index};
    group_data_cube_float[index]={group_name,Hauteur_bat_1,x0_1,y0_1,z0_1,prevSpec};

    newItem.textContent = textinput;

    //saveState();


/////////////////////////////////////////////CUBE TOIT CYLINDRIQUE///////////////////////////////////////////

} else if (group.name=='group_cube_cy') {

cube=group.children[0];
cylinder=group.children[1];

textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
Longueur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
prevWidth=document.getElementById('label-list').querySelectorAll('input')[1].value
Largeur_bat_1= parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
prevDepth=document.getElementById('label-list').querySelectorAll('input')[2].value
Hauteur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
prevHeight=document.getElementById('label-list').querySelectorAll('input')[3].value
x0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
prevPosX=document.getElementById('label-list').querySelectorAll('input')[4].value
y0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[5].value);
prevPosY=document.getElementById('label-list').querySelectorAll('input')[5].value
z0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[6].value);
prevPosZ=document.getElementById('label-list').querySelectorAll('input')[6].value
alpha=parseFloat(document.getElementById('label-list').querySelectorAll('input')[7].value);
prevRotZ=document.getElementById('label-list').querySelectorAll('input')[7].value;
prevVisible=select.value;
prevSpec=select_2.value;
group_name='group_cube_cy';




if (Longueur_bat_1 <= 0 ||
    Largeur_bat_1 <= 0 ||
    Hauteur_bat_1 <= 0 ||
    textinput=='' ||
    isNaN(Longueur_bat_1) ||
    isNaN(Largeur_bat_1) ||
    isNaN(Hauteur_bat_1) || 
    isNaN(x0_1) ||
    isNaN(y0_1) ||                
    isNaN(z0_1) ||
    isNaN(alpha) 
 
    
) {

    //alert("Insérer une entrée valide");

    return

    } 

    if (prevHeight !==group_data_cube[index].prevHeight
        || x0_1 !==group_data_cube_float[index].x0_1
        || y0_1 !==group_data_cube_float[index].y0_1
        || z0_1 !==group_data_cube_float[index].z0_1
        || Longueur_bat_1 !==group_data_cube_float[index].Longueur_bat_1
        || Largeur_bat_1 !==group_data_cube_float[index].Largeur_bat_1
        || prevSpec !==group_data_cube_float[index].prevSpec
        || alpha !==group_data_cube_float[index].alpha

        ) 
        
        
        {

            delete_points();
            
        }

cubeGeometry=new THREE.BoxGeometry(Longueur_bat_1, Hauteur_bat_1,Largeur_bat_1);

var selectedValue=select.value;

if (selectedValue=='Oui') {

    var structure_visible=true;


} else {

    var structure_visible=false;


}
//var cubeMaterial = new THREE.MeshPhongMaterial({ color: prevColor });
//var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
cube.position.set(x0_1, z0_1+Hauteur_bat_1/2, y0_1);
cube.rotation.y=alpha*Math.PI/180;


var radialSegments = 32; // Number of segments around the cylinder
var heightSegments = 1; // Number of segments along the height of the cylinder
var openEnded = false; // Whether the cylinder ends are open or closed
var cylinderGeometry = new THREE.CylinderGeometry(Largeur_bat_1/2, Largeur_bat_1/2, Longueur_bat_1,radialSegments,heightSegments, openEnded);
//var cylinder = new THREE.Mesh(cylinderGeometry, cylinderMaterial);


cylinder.rotation.z=Math.PI/2;
cylinder.rotation.y=alpha*Math.PI/180;

cylinder.position.set(x0_1, z0_1+Hauteur_bat_1, y0_1);

//var rotationAngle=rotationAngle*Math.PI/180

cube.geometry.dispose();
cylinder.geometry.dispose();
cube.geometry=cubeGeometry
cylinder.geometry=cylinderGeometry



cylinder.visible=structure_visible;
cube.visible=structure_visible;


newItem.textContent = textinput;

Hauteur_bat_1=Hauteur_bat_1+z0_1;

group_data_cube[index]={text_new_item,prevWidth,prevDepth,prevHeight,prevPosX,prevPosY,prevPosZ,prevRotZ,prevVisible,prevSpec,index};
group_data_cube_float[index]={group_name,Longueur_bat_1,Largeur_bat_1,Hauteur_bat_1,x0_1,y0_1,z0_1,alpha,prevSpec};

//saveState();


}  else if (group.name=='group_cone') {

///////////////////////////////////////////////////////STRUCTURE CONIQUE///////////////////////////////////////////////////

cone=group.children[0];

textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
Rayon = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
prevRadius=document.getElementById('label-list').querySelectorAll('input')[1].value
Hauteur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
prevHeight=document.getElementById('label-list').querySelectorAll('input')[2].value
x0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
prevPosX=document.getElementById('label-list').querySelectorAll('input')[3].value
y0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
prevPosY=document.getElementById('label-list').querySelectorAll('input')[4].value
z0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[5].value);
prevPosZ=document.getElementById('label-list').querySelectorAll('input')[5].value;
prevVisible=select.value;
prevSpec=select_2.value;
group_name='group_cone';

if (Hauteur_bat_1 <= 0 ||
    Rayon<=0 ||
    textinput=='' ||
    isNaN(Hauteur_bat_1) || 
    isNaN(Rayon) || 
    isNaN(x0_1) ||
    isNaN(y0_1) ||                
    isNaN(z0_1)
    
) {

    //alert("Insérer une entrée valide");

    return

    } 

    if (prevHeight !==group_data_cube[index].prevHeight
        || x0_1 !==group_data_cube_float[index].x0_1
        || y0_1 !==group_data_cube_float[index].y0_1
        || z0_1 !==group_data_cube_float[index].z0_1
        || Rayon !==group_data_cube_float[index].Rayon
        || prevSpec !==group_data_cube_float[index].prevSpec

        ) 
        
        
        {

            delete_points();
            
        }


    var coneGeometry = new THREE.ConeGeometry(Rayon, Hauteur_bat_1, 32);
    cone.position.set(x0_1, z0_1+Hauteur_bat_1/2, y0_1);
    cone.geometry.dispose();
    cone.geometry=coneGeometry
    //scene.add(cone);
    var selectedValue=select.value;

    if (selectedValue=='Oui') {

        var structure_visible=true;


    } else {

        var structure_visible=false;


    }
    
    cone.visible=structure_visible;

    newItem.textContent = textinput;

    Hauteur_bat_1=Hauteur_bat_1+z0_1;

    group_data_cube[index]={text_new_item,prevRadius,prevHeight,prevPosX,prevPosY,prevPosZ,prevVisible,prevSpec,index};
    group_data_cube_float[index]={group_name,Rayon,Hauteur_bat_1,x0_1,y0_1,z0_1,prevSpec};

    //saveState();


/////////////////////////////////////////////STRUCTURE CONIQUE///////////////////////////////////////////

} else if (group.name=='group_sphere') {

///////////////////////////////////////////////////////STRUCTURE CONIQUE///////////////////////////////////////////////////

sphere=group.children[0];

textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
Rayon = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
prevRadius=document.getElementById('label-list').querySelectorAll('input')[1].value
x0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
prevPosX=document.getElementById('label-list').querySelectorAll('input')[2].value
y0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
prevPosY=document.getElementById('label-list').querySelectorAll('input')[3].value
z0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
prevPosZ=document.getElementById('label-list').querySelectorAll('input')[4].value;
prevVisible=select.value;
prevSpec=select_2.value;
group_name='group_sphere';


if (Rayon<=0 ||
    textinput=='' ||
    isNaN(Rayon) || 
    isNaN(x0_1) ||
    isNaN(y0_1) ||                
    isNaN(z0_1)
    
) {

   // alert("Insérer une entrée valide");

    return

    } 

    if (Rayon !==group_data_cube_float[index].Rayon
        || x0_1 !==group_data_cube_float[index].x0_1
        || y0_1 !==group_data_cube_float[index].y0_1
        || z0_1 !==group_data_cube_float[index].z0_1
        || prevSpec !==group_data_cube_float[index].prevSpec

        ) 
        
        
        {

            delete_points();
            
        }

    var sphereGeometry = new THREE.SphereGeometry(Rayon, 32, 32);
    sphere.position.set(x0_1, z0_1, y0_1);
    sphere.geometry.dispose();
    sphere.geometry=sphereGeometry
    //scene.add(cone);
    var selectedValue=select.value;
    
    if (selectedValue=='Oui') {

    var structure_visible=true;


    } else {

    var structure_visible=false;

    }

    sphere.visible=structure_visible;

    newItem.textContent = textinput;

    group_data_cube[index]={text_new_item,prevRadius,prevPosX,prevPosY,prevPosZ,prevVisible,prevSpec,index};
    group_data_cube_float[index]={group_name,Rayon,x0_1,y0_1,z0_1,prevSpec};

    //saveState();


/////////////////////////////////////////////STRUCTURE SPHERIQUE///////////////////////////////////////////

} else if (group.name=='group_cylinder_sp') {

///////////////////////////////////////////////////////STRUCTURE CYLINDRIQUE A TOIT SPHERIQUE///////////////////////////////////////////////////

sphere=group.children[0];
cylinder_1=group.children[1];


textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
Rayon = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
prevRadius=document.getElementById('label-list').querySelectorAll('input')[1].value
Hauteur_bat_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
prevHeight=document.getElementById('label-list').querySelectorAll('input')[2].value
x0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
prevPosX=document.getElementById('label-list').querySelectorAll('input')[3].value
y0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
prevPosY=document.getElementById('label-list').querySelectorAll('input')[4].value
z0_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[5].value);
prevPosZ=document.getElementById('label-list').querySelectorAll('input')[5].value;
prevVisible=select.value;
prevSpec=select_2.value;
group_name='group_cylinder_sp';




if (Rayon<=0 ||
    Hauteur_bat_1<=0 ||
    textinput=='' ||
    isNaN(Rayon) || 
    isNaN(Hauteur_bat_1) || 
    isNaN(x0_1) ||
    isNaN(y0_1) ||                
    isNaN(z0_1)
    
) {

   // alert("Insérer une entrée valide");

    return

    } 

    if (Rayon !==group_data_cube_float[index].Rayon
        || x0_1 !==group_data_cube_float[index].x0_1
        || y0_1 !==group_data_cube_float[index].y0_1
        || z0_1 !==group_data_cube_float[index].z0_1
        || prevHeight !==group_data_cube[index].prevHeight
        || prevSpec !==group_data_cube_float[index].prevSpec

        ) 
        
        
        {

            delete_points();
            
        }


    var sphereGeometry = new THREE.SphereGeometry(Rayon, 32, 32);
    sphere.position.set(x0_1, z0_1+Hauteur_bat_1, y0_1);
    sphere.geometry.dispose();
    sphere.geometry=sphereGeometry
    //scene.add(cone);

    var cylinderGeometry_1 = new THREE.CylinderGeometry(Rayon, Rayon, Hauteur_bat_1,32,1, false);
    cylinder_1.position.set(x0_1, z0_1+Hauteur_bat_1/2, y0_1);
    cylinder_1.geometry.dispose();
    cylinder_1.geometry=cylinderGeometry_1

    var selectedValue=select.value;
    
    if (selectedValue=='Oui') {

    var structure_visible=true;


    } else {

    var structure_visible=false;

    }

    cylinder_1.visible=structure_visible;
    sphere.visible=structure_visible;

    Hauteur_bat_1=Hauteur_bat_1+z0_1;

    group_data_cube[index]={text_new_item,prevRadius,prevHeight,prevPosX,prevPosY,prevPosZ,prevVisible,prevSpec,index};
    group_data_cube_float[index]={group_name,Rayon,Hauteur_bat_1,x0_1,y0_1,z0_1,prevSpec};

    newItem.textContent = textinput;

    //saveState();


/////////////////////////////////////////////STRUCTURE CYLINDRIQUE A TOIT SPHERIQUE///////////////////////////////////////////

} else if (group.name=='group_ca') {


curveObject=group.children[0];


textinput=document.getElementById('label-list').querySelectorAll('input')[0].value;
text_new_item=document.getElementById('label-list').querySelectorAll('input')[0].value;
Longueur_C = parseFloat(document.getElementById('label-list').querySelectorAll('input')[1].value);
prevLength=document.getElementById('label-list').querySelectorAll('input')[1].value
X0_C = parseFloat(document.getElementById('label-list').querySelectorAll('input')[2].value);
prevPosX=document.getElementById('label-list').querySelectorAll('input')[2].value
Y0_C = parseFloat(document.getElementById('label-list').querySelectorAll('input')[3].value);
prevPosY=document.getElementById('label-list').querySelectorAll('input')[3].value
Z0_C = parseFloat(document.getElementById('label-list').querySelectorAll('input')[4].value);
prevPosZ=document.getElementById('label-list').querySelectorAll('input')[4].value
Sag_C = parseFloat(document.getElementById('label-list').querySelectorAll('input')[5].value)*Longueur_C/100;
prevSag=document.getElementById('label-list').querySelectorAll('input')[5].value
Hauteur_C_1 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[6].value);
prevHeight_C_1=document.getElementById('label-list').querySelectorAll('input')[6].value
Hauteur_C_2 = parseFloat(document.getElementById('label-list').querySelectorAll('input')[7].value);
prevHeight_C_2=document.getElementById('label-list').querySelectorAll('input')[7].value
alpha_C = (parseFloat(document.getElementById('label-list').querySelectorAll('input')[8].value))*Math.PI/180;
prevRotZ=document.getElementById('label-list').querySelectorAll('input')[8].value
epaisseur_ligne = parseFloat(document.getElementById('label-list').querySelectorAll('input')[9].value);
prevLineWidth=document.getElementById('label-list').querySelectorAll('input')[9].value;
prevVisible=select.value;
prevSpec=select_2.value;
group_name='group_ca';



if (Longueur_C<=0 ||
    Hauteur_C_1<=0 ||
    Hauteur_C_2<=0 ||
    epaisseur_ligne<=0 ||
    Sag_C<=0 ||
    Sag_C>(0.1*Longueur_C) ||
    textinput=='' ||
    isNaN(Longueur_C) || 
    isNaN(Hauteur_C_1) || 
    isNaN(Hauteur_C_2) || 
    isNaN(alpha_C) || 
    isNaN(Sag_C) ||
    isNaN(X0_C) ||
    isNaN(Y0_C) ||                
    isNaN(Z0_C)
        
) {

    

    //alert("Insérer une entrée valide");

    return

    } 

    if (Hauteur_C_1>=Hauteur_C_2) {
        if (Sag_C>=Hauteur_C_2+Z0_C)  {

            //alert("Insérer une entrée valide");

            return



        }

    }

    if (Hauteur_C_1<Hauteur_C_2) {
        if (Sag_C>=Hauteur_C_1+Z0_C)  {

            //alert("Insérer une entrée valide");

            return



        }

    }

    if (Longueur_C !==group_data_cube_float[index].Longueur_C
        || X0_C !==group_data_cube_float[index].X0_C
        || Y0_C !==group_data_cube_float[index].Y0_C
        || Z0_C !==group_data_cube_float[index].Z0_C
        || Sag_C !==group_data_cube_float[index].Sag_C
        || prevHeight_C_1 !==group_data_cube[index].prevHeight_C_1
        || prevHeight_C_2 !==group_data_cube[index].prevHeight_C_2
        || alpha_C !==group_data_cube_float[index].alpha_C
        || prevSpec !==group_data_cube_float[index].prevSpec

        ) 
        
        
        {

            delete_points();
            
        }

       // group_data_cube_float[index]={group_name,Longueur_C,X0_C,Y0_C,Z0_C,Sag_C,Hauteur_C_1,Hauteur_C_2,alpha_C,epaisseur_ligne,prevSpec};





    const points = [];
 
    var z_cc=0.;
    var X1_cc=0.;
    var Y1_cc=0.;
    var vv=1.
    var nombre_points=22

    


    SD=Sag_C/(Sag_C+Math.abs(Hauteur_C_1-Hauteur_C_2)) 
    X0=Math.sqrt(SD)*Longueur_C/(1+Math.sqrt(SD))
    D=2*(Longueur_C-X0)

    
   
        for (let i = 1; i < nombre_points; i++) {

            xx=(i-1)*Longueur_C/20+X0_C

     
            if (Hauteur_C_1<=Hauteur_C_2) {

                z_cc=Hauteur_C_1-Sag_C+4*((Sag_C+Math.abs(Hauteur_C_1-Hauteur_C_2))/Math.pow(D,2))*Math.pow((xx-X0-X0_C),2)+Z0_C;
                X1_cc=(xx-X0_C)*Math.cos(-alpha_C)-(Y0_C-Y0_C)*Math.sin(-alpha_C)+X0_C;
                Y1_cc=(xx-X0_C)*Math.sin(-alpha_C)+(Y0_C-Y0_C)*Math.cos(-alpha_C)+Y0_C;
                const vectors_c=[X1_cc, z_cc, Y1_cc]; // Adjust the position of vectors as needed
                var vecteur = vectors_c
                points.push(vecteur);
                //addToMatrix(points, vectors_c);
            


            }
             
                
            else {

                z_cc=Hauteur_C_2-Sag_C+4*((Sag_C+Math.abs(Hauteur_C_1-Hauteur_C_2))/Math.pow(D,2))*Math.pow(xx-(Longueur_C-X0)-X0_C,2)+Z0_C;
                X1_cc=(xx-X0_C)*Math.cos(-alpha_C)-(Y0_C-Y0_C)*Math.sin(-alpha_C)+X0_C;
                Y1_cc=(xx-X0_C)*Math.sin(-alpha_C)+(Y0_C-Y0_C)*Math.cos(-alpha_C)+Y0_C;
                const vectors_c=[X1_cc, z_cc, Y1_cc]; // Adjust the position of vectors as needed
                var vecteur = vectors_c
                points.push(vecteur);
                //addToMatrix(points, vectors_c);


            }


        }


        // Convert points to Three.js vectors
        var curvePoints = points.map(function(point) {
            return new THREE.Vector3(point[0], point[1], point[2]);
        });

        // Create a curve geometry
        var curve = new THREE.CatmullRomCurve3(curvePoints);

        // Create a curve path
        var curvePath = new THREE.CurvePath();
        curvePath.add(curve);

        // Create a Catmull-Rom curve
        var curve = new THREE.CatmullRomCurve3(curvePoints);

        // Create a tube geometry to extrude the curve
        var tubeGeometry = new THREE.TubeGeometry(curve, 100, prevLineWidth, 8, false);

        // Create a material for the tube
        //var tubeMaterial = new THREE.MeshBasicMaterial({ color: prevColor });

        // Create a mesh using the tube geometry and material
        //var curveObject = new THREE.Mesh(tubeGeometry, tubeMaterial);
        curveObject.geometry.dispose();
        curveObject.geometry=tubeGeometry

        var selectedValue=select.value;
        
        if (selectedValue=='Oui') {

        var structure_visible=true;


        } else {

        var structure_visible=false;

        }

        curveObject.visible=structure_visible;

        Hauteur_C_1=Hauteur_C_1+Z0_C;
        Hauteur_C_2=Hauteur_C_2+Z0_C;
        
        group_data_cube[index]={text_new_item,prevLength,prevPosX,prevPosY,prevPosZ,prevSag,prevHeight_C_1,prevHeight_C_2,prevRotZ,prevLineWidth,prevVisible,prevSpec,index};
        group_data_cube_float[index]={group_name,Longueur_C,X0_C,Y0_C,Z0_C,Sag_C,Hauteur_C_1,Hauteur_C_2,alpha_C,epaisseur_ligne,prevSpec};


        newItem.textContent = textinput;

        //saveState();





}


    if (let_dynamic_results===true) {


        programme_principal();


    };




            




        }





       



    }


    ///////////////////////////////BOUTON STRUCTURE CUBIQUE//////////////////////////////////////////////////////////////////


        function structure_cubique(){

            structure_cubique_1('10','10','10','0','0','0','0','#6B6B6B',0.0,'Oui','Autre',0)
 
        }

    ///////////////////////////////BOUTON STRUCTURE CUBIQUE///////////////////////////////////////////////////////////////////

        
    ///////////////////////////////CREATION STRUCTURE CUBIQUE//////////////////////////////////////////////////////////////////

        function structure_cubique_1(prevWidth, prevHeight, prevDepth, prevPosX, prevPosY, prevPosZ,prevRotZ,prevColor,offset_g,prevVisible,prevSpec,index0) {
                       
            hideInputFields();

            const itemList_cube = document.getElementById('item-list');
            itemList_cube.addEventListener('click', handleItemClick);
            const newItem_cube = document.createElement('li');
            document.addEventListener('keydown', handleKeyPress);
            newItem_cube.className = 'item';
            itemList_cube.appendChild(newItem_cube);
         
 
            if (shape_creation==true) {

                newItem_cube.textContent=group_data_cube[index0].text_new_item;
                
                
            } else if (shape_duplicate==true) {

                newItem_cube.textContent='Copie '+group_data_cube[index0].text_new_item;
            } else {

                newItem_cube.textContent = 'Structure cubique N° ' + (itemCounter_cube + 1);

            }


            text_new_item=newItem_cube.textContent
   
            Longueur_bat_1 = parseFloat(prevWidth);
            Largeur_bat_1= parseFloat(prevDepth);
            Hauteur_bat_1 = parseFloat(prevHeight);
            x0_1 = parseFloat(prevPosX);
            y0_1 = parseFloat(prevPosY);
            z0_1 = parseFloat(prevPosZ);
            alpha=parseFloat(prevRotZ);

            var cubeGeometry = new THREE.BoxGeometry(Longueur_bat_1,Hauteur_bat_1,Largeur_bat_1);
            var cubeMaterial = new THREE.MeshPhongMaterial({ color: prevColor });
            var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
            cube.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1/2, y0_1+offset_g);
            cube.rotation.y=alpha*Math.PI/180;
            
            if (prevVisible==='Oui') {

                cube.visible=true;
            } else {

                cube.visible=false;
            }

            var group_cube = new THREE.Group();

            group_cube.add(cube);

            groups_data.push({newItem:newItem_cube,group:group_cube});
                    
            const index = groups_data.findIndex(group => group.newItem === newItem_cube);
           
            //const {group,item}=groups[index];
   
            scene.add(group_cube);

            group_cube.name='group_cube';

            group_name='group_cube';

            Hauteur_bat_1=Hauteur_bat_1+z0_1;

            group_data_cube[index]={text_new_item,prevWidth,prevDepth,prevHeight,prevPosX,prevPosY,prevPosZ,prevRotZ,prevVisible,prevSpec,index};
            group_data_cube_float[index]={group_name,Longueur_bat_1,Largeur_bat_1,Hauteur_bat_1,x0_1,y0_1,z0_1,alpha,prevSpec};
            group_color_data_cube[index]=prevColor;

            //renderer.render(scene, camera);
            
            itemCounter_cube++;

            if (saveState_test === false && shape_creation === false) {

                saveState();

            }


                    
        if (let_dynamic_results===true) {


            programme_principal();


        };
    

        }

        ///////////////////////////////CREATION STRUCTURE CUBIQUE//////////////////////////////////////////////////////////////////


        ///////////////////////////////BOUTON STRUCTURE FAITAGE//////////////////////////////////////////////////////////////////


            function Structure_faitage() {

            structure_faitage_1('10','5','10','0','0','0','0','10','0','#8B4513',0.0,'Oui','Autre',0)

        }

        ///////////////////////////////BOUTON STRUCTURE FAITAGE///////////////////////////////////////////////////////////////////


        ///////////////////////////////CREATION STRUCTURE FAITAGE//////////////////////////////////////////////////////////////////

        function structure_faitage_1(prevWidth, prevHeight, prevDepth, prevPosX, prevPosY, prevPosZ,prevRotZ,prevHeightMax,prevPosYf,prevColor,offset_g,prevVisible,prevSpec,index0) {


            hideInputFields();

            const itemList_faitage = document.getElementById('item-list');
            itemList_faitage.addEventListener('click', handleItemClick);
            const newItem_faitage = document.createElement('li');
            document.addEventListener('keydown', handleKeyPress);
            newItem_faitage.className = 'item';
            itemList_faitage.appendChild(newItem_faitage);
            
            if (shape_creation==true) {
                
                newItem_faitage.textContent=group_data_cube[index0].text_new_item;
            } else if (shape_duplicate==true) {

                newItem_faitage.textContent='Copie '+group_data_cube[index0].text_new_item;

            } else {

                newItem_faitage.textContent = 'Structure avec faîtage N° ' + (itemCounter_f + 1);

            }

            text_new_item=newItem_faitage.textContent;

            Longueur_bat_1 = parseFloat(prevWidth);
            Largeur_bat_1= parseFloat(prevDepth);
            Hauteur_bat_1 = parseFloat(prevHeight);
            x0_1 = parseFloat(prevPosX)+offset_g;
            y0_1 = parseFloat(prevPosY)+offset_g;
            z0_1 = parseFloat(prevPosZ);
            alpha=parseFloat(prevRotZ);
            HauteurMax_bat_1 = parseFloat(prevHeightMax);
            yf_1=parseFloat(prevPosYf);
            
            var cubeGeometry1 = new THREE.BoxGeometry(Longueur_bat_1,Hauteur_bat_1,Largeur_bat_1);
            var cubeMaterial1 = new THREE.MeshPhongMaterial({ color: prevColor });
            var cube_f = new THREE.Mesh(cubeGeometry1, cubeMaterial1);
            cube_f.position.set(x0_1, z0_1+Hauteur_bat_1/2, y0_1);
            cube_f.rotation.y=alpha*Math.PI/180;
            //scene.add(cube1);

            var height_g=HauteurMax_bat_1-Hauteur_bat_1;
            var x1=x0_1-Longueur_bat_1/2;
            var x2=x0_1+Longueur_bat_1/2;

            var y1=y0_1-Largeur_bat_1/2;
            var y2=y0_1+Largeur_bat_1/2;

            var z1=z0_1+Hauteur_bat_1+height_g;

            const pointsMatrix_1 = [
            [x1, z0_1+Hauteur_bat_1, y1],
            [x2, z0_1+Hauteur_bat_1, y1],
            [x2, z1, yf_1+y0_1],
            [x1, z1, yf_1+y0_1]
            ];

            const pointsMatrix_2 = [
            [x1, z1, yf_1+y0_1],
            [x2, z1, yf_1+y0_1],
            [x2, z0_1+Hauteur_bat_1, y2],
            [x1, z0_1+Hauteur_bat_1, y2]
            // Add more points as needed
            ];

            const pointsMatrix_3 = [
            [x1, z0_1+Hauteur_bat_1, y1],
            [x1, z1, yf_1+y0_1],
            [x1, z0_1+Hauteur_bat_1, y2],
            [x1, z0_1+Hauteur_bat_1, y1],
            ];

            const pointsMatrix_4 = [
            [x2, z0_1+Hauteur_bat_1, y1],
            [x2, z1, yf_1+y0_1],
            [x2, z0_1+Hauteur_bat_1, y2],
            [x2, z0_1+Hauteur_bat_1, y1],
            ];

            // Create geometry
            const geometry_1 = new THREE.BufferGeometry();
            const vertices_1 = [];
            for (let i = 0; i < pointsMatrix_1.length; i++) {
              vertices_1.push(pointsMatrix_1[i][0], pointsMatrix_1[i][1], pointsMatrix_1[i][2]);
            }
            geometry_1.setAttribute('position', new THREE.Float32BufferAttribute(vertices_1, 3));
            geometry_1.setIndex([0, 1, 2, 0, 2, 3]); // Define indices for triangles (assuming it's a square surface)

            // Create material
            const material_1 = new THREE.MeshBasicMaterial({color: prevColor, side: THREE.DoubleSide});

            // Create mesh
            const gable_1 = new THREE.Mesh(geometry_1, material_1);
            gable_1.rotation.y=alpha*Math.PI/180;

            // Create geometry
            const geometry_2 = new THREE.BufferGeometry();
            const vertices_2 = [];
            for (let i = 0; i < pointsMatrix_2.length; i++) {
              vertices_2.push(pointsMatrix_2[i][0], pointsMatrix_2[i][1], pointsMatrix_2[i][2]);
            }
            geometry_2.setAttribute('position', new THREE.Float32BufferAttribute(vertices_2, 3));
            geometry_2.setIndex([0, 1, 2, 0, 2, 3]); // Define indices for triangles (assuming it's a square surface)

            // Create material
            const material_2 = new THREE.MeshBasicMaterial({color: prevColor, side: THREE.DoubleSide});

            // Create mesh
            const gable_2 = new THREE.Mesh(geometry_2, material_2);
            gable_2.rotation.y=alpha*Math.PI/180;
            //scene.add(surface);

            // Create geometry
            const geometry_3 = new THREE.BufferGeometry();
            const vertices_3 = [];
            for (let i = 0; i < pointsMatrix_3.length; i++) {
              vertices_3.push(pointsMatrix_3[i][0], pointsMatrix_3[i][1], pointsMatrix_3[i][2]);
            }
            geometry_3.setAttribute('position', new THREE.Float32BufferAttribute(vertices_3, 3));
            geometry_3.setIndex([0, 1, 2, 0, 2, 3]); // Define indices for triangles (assuming it's a square surface)

            // Create material
            const material_3 = new THREE.MeshBasicMaterial({color: 0xA26A42, side: THREE.DoubleSide});

            // Create mesh
            const gable_3 = new THREE.Mesh(geometry_3, material_3);
            gable_3.rotation.y=alpha*Math.PI/180;
            //scene.add(surface);

            
 
            // Create geometry
            const geometry_4 = new THREE.BufferGeometry();
            const vertices_4 = [];
            for (let i = 0; i < pointsMatrix_4.length; i++) {
              vertices_4.push(pointsMatrix_4[i][0], pointsMatrix_4[i][1], pointsMatrix_4[i][2]);
            }
            geometry_4.setAttribute('position', new THREE.Float32BufferAttribute(vertices_4, 3));
            geometry_4.setIndex([0, 1, 2, 0, 2, 3]); // Define indices for triangles (assuming it's a square surface)

            // Create material
            const material_4 = new THREE.MeshBasicMaterial({color: 0xA26A42, side: THREE.DoubleSide});

            // Create mesh
            const gable_4 = new THREE.Mesh(geometry_4, material_4);
            gable_4.rotation.y=alpha*Math.PI/180;

            if (prevVisible==='Oui') {

            cube_f.visible=true;
            gable_1.visible=true;
            gable_2.visible=true;
            gable_3.visible=true;
            gable_4.visible=true;

            } else {

            cube_f.visible=false;
            gable_1.visible=false;
            gable_2.visible=false;
            gable_3.visible=false;
            gable_4.visible=false;


            }


            group_cube_f=new THREE.Group();

            group_cube_f.add(cube_f);
            group_cube_f.add(gable_1);
            group_cube_f.add(gable_2);
            group_cube_f.add(gable_3);
            group_cube_f.add(gable_4);

            groups_data.push({newItem:newItem_faitage,group:group_cube_f});

            const index = groups_data.findIndex(group => group.newItem === newItem_faitage);


            group_color_data_cube[index]=prevColor;
  
            scene.add(group_cube_f);

            group_cube_f.name='group_cube_f';
            var group_name='group_cube_f';

            
            //renderer.render(scene, camera);

            Hauteur_bat_1=Hauteur_bat_1+z0_1;
            HauteurMax_bat_1=HauteurMax_bat_1+z0_1;

            group_data_cube[index]={text_new_item,prevWidth,prevDepth,prevHeight,prevPosX,prevPosY,prevPosZ,prevRotZ,prevHeightMax,prevPosYf,prevVisible,prevSpec,index};
            group_data_cube_float[index]={group_name,Longueur_bat_1,Largeur_bat_1,Hauteur_bat_1,x0_1,y0_1,z0_1,alpha,HauteurMax_bat_1,yf_1,prevSpec};


            itemCounter_f++;

            if (saveState_test === false && shape_creation === false) {

                saveState();

            }


        if (let_dynamic_results===true) {


            programme_principal();


        };


        }

        ///////////////////////////////CREATION STRUCTURE FAITAGE//////////////////////////////////////////////////////////////////

        
        ////////////////////////////////BOUTON STRUCTURE CYLINDRIQUE//////////////////////////////////////////////////////////////

        function structure_cylindrique(){

            structure_cylindrique_1 ('10','10','10','0','0','0','#004B54',0.0,'Oui','Autre',0);

        }

        ////////////////////////////////BOUTON STRUCTURE CYLINDRIQUE//////////////////////////////////////////////////////////////

        ///////////////////////////////CREATION STRUCTURE CYLINDRIQUE/////////////////////////////////////////////////////////////


        function structure_cylindrique_1 (prevRadiusTop, prevRadiusBottom, prevHeight, prevPosX, prevPosY, prevPosZ, prevColor, offset_g,prevVisible,prevSpec,index0) {
    

        hideInputFields();

        const itemList_cylinder = document.getElementById('item-list');
        itemList_cylinder.addEventListener('click', handleItemClick);
        const newItem_cylinder = document.createElement('li');
        document.addEventListener('keydown', handleKeyPress);
        newItem_cylinder.className = 'item';
        itemList_cylinder.appendChild(newItem_cylinder);
        

        if (shape_creation==true) {
                
            newItem_cylinder.textContent=group_data_cube[index0].text_new_item;
            } else if (shape_duplicate==true) {

                newItem_cylinder.textContent='Copie '+group_data_cube[index0].text_new_item;

            } else {

                newItem_cylinder.textContent = 'Structure cylindrique N° ' + (itemCounter_cy+1);

            }



        text_new_item=newItem_cylinder.textContent;

        Hauteur_bat_1 = parseFloat(prevHeight);
        Rayon_sup=parseFloat(prevRadiusTop);
        Rayon_inf=parseFloat(prevRadiusBottom);
        x0_1 = parseFloat(prevPosX);
        y0_1 = parseFloat(prevPosY);
        z0_1 = parseFloat(prevPosZ);

        var prevHeight_1 = Hauteur_bat_1; // Height of the cylinder
        var radialSegments_1 = 32; // Number of segments around the cylinder
        var heightSegments_1 = 1; // Number of segments along the height of the cylinder
        var openEnded_1 = false; // Whether the cylinder ends are open or closed

        var cylinderGeometry_1 = new THREE.CylinderGeometry(Rayon_sup, Rayon_inf, Hauteur_bat_1,radialSegments_1,heightSegments_1, openEnded_1);
        var cylinderMaterial_1 = new THREE.MeshPhongMaterial({ color: prevColor });
        var cylinder_1 = new THREE.Mesh(cylinderGeometry_1, cylinderMaterial_1);
        cylinder_1.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1/2, y0_1+offset_g);
        
        if (prevVisible==='Oui') {

        cylinder_1.visible=true;
        } else {

        cylinder_1.visible=false;
        }

            
        var group_cylinder = new THREE.Group();
        group_cylinder.add(cylinder_1);
        groups_data.push({newItem:newItem_cylinder,group:group_cylinder});
            
        const index = groups_data.findIndex(group => group.newItem === newItem_cylinder);
       
        group_color_data_cube[index]=prevColor;

        scene.add(group_cylinder);
            
        group_cylinder.name='group_cylinder';
        var group_name='group_cylinder';

        Hauteur_bat_1=Hauteur_bat_1+z0_1;
        group_data_cube[index]={text_new_item,prevRadiusTop,prevRadiusBottom,prevHeight,prevPosX,prevPosY,prevPosZ,prevVisible,prevSpec,index};
        group_data_cube_float[index]={group_name,Rayon_sup,Rayon_inf,Hauteur_bat_1,x0_1,y0_1,z0_1,prevSpec};


        itemCounter_cy++;

        if (saveState_test === false && shape_creation === false) {

            saveState();

        }


        if (let_dynamic_results===true) {


            programme_principal();


        };

        }

        ///////////////////////////////CREATION STRUCTURE CYLINDRIQUE/////////////////////////////////////////////////////////////


                function structure_cylindrique_h(){

            structure_cylindrique_h_1 ('5','10','0','0','0','0','#664568',0.0,'Oui','Autre',0);

        }

        ////////////////////////////////BOUTON STRUCTURE CYLINDRIQUE//////////////////////////////////////////////////////////////

        ///////////////////////////////CREATION STRUCTURE CYLINDRIQUE HORIZONTALE/////////////////////////////////////////////////////////////


        function structure_cylindrique_h_1 (prevRadius, prevLength,prevPosX, prevPosY, prevPosZ,prevRotZ, prevColor, offset_g,prevVisible,prevSpec,index0) {
 

        hideInputFields();

        const itemList_cylinderh = document.getElementById('item-list');
        itemList_cylinderh.addEventListener('click', handleItemClick);
        const newItem_cylinderh = document.createElement('li');
        document.addEventListener('keydown', handleKeyPress);
        newItem_cylinderh.className = 'item';
        itemList_cylinderh.appendChild(newItem_cylinderh);
        

        if (shape_creation==true) {
                
            newItem_cylinderh.textContent=group_data_cube[index0].text_new_item;
            } else if (shape_duplicate==true) {

                newItem_cylinderh.textContent='Copie '+group_data_cube[index0].text_new_item;

            } else {

                newItem_cylinderh.textContent = 'Structure cylindrique horizontale N° ' + (itemCounter_cyh+1);

            }



        text_new_item=newItem_cylinderh.textContent;

        Longueur_bat_1 = parseFloat(prevLength);
        Rayon=parseFloat(prevRadius);
        x0_1 = parseFloat(prevPosX);
        y0_1 = parseFloat(prevPosY);
        z0_1 = parseFloat(prevPosZ);
        alpha=parseFloat(prevRotZ);

        var radialSegments_1 = 32; // Number of segments around the cylinder
        var heightSegments_1 = 1; // Number of segments along the height of the cylinder
        var openEnded_1 = false; // Whether the cylinder ends are open or closed

        var cylinderGeometry_1 = new THREE.CylinderGeometry(Rayon, Rayon, Longueur_bat_1,radialSegments_1,heightSegments_1, openEnded_1);
        var cylinderMaterial_1 = new THREE.MeshPhongMaterial({ color: prevColor });
        var cylinder_1 = new THREE.Mesh(cylinderGeometry_1, cylinderMaterial_1);
        cylinder_1.rotation.z=Math.PI/2;
        cylinder_1.rotation.y=alpha*Math.PI/180;  
        cylinder_1.position.set(x0_1+offset_g, z0_1, y0_1+offset_g);
        
        if (prevVisible==='Oui') {

        cylinder_1.visible=true;
        } else {

        cylinder_1.visible=false;
        }

            
        var group_cylinderh = new THREE.Group();
        group_cylinderh.add(cylinder_1);
        groups_data.push({newItem:newItem_cylinderh,group:group_cylinderh});
            
        const index = groups_data.findIndex(group => group.newItem === newItem_cylinderh);
       
        group_color_data_cube[index]=prevColor;

        scene.add(group_cylinderh);
            
        group_cylinderh.name='group_cylinderh';
        var group_name='group_cylinderh';

        
        group_data_cube[index]={text_new_item,prevRadius,prevLength,prevPosX,prevPosY,prevPosZ,prevRotZ,prevVisible,prevSpec,index};
        group_data_cube_float[index]={group_name,Rayon,Longueur_bat_1,x0_1,y0_1,z0_1,alpha,prevSpec};


        itemCounter_cyh++;

        if (saveState_test === false && shape_creation === false) {

            saveState();

        }


        if (let_dynamic_results===true) {


            programme_principal();


        };

        }




        ///////////////////////////////////////BOUTON PDA/////////////////////////////////////////////////////////////////////////

        function PDA(){

            PDA_1 ('5','0','0','10','0.1','#1A383D',0.0,'Oui','Autre','ICPE','60',0)

        }

        ///////////////////////////////////////BOUTON PDA/////////////////////////////////////////////////////////////////////////


        ///////////////////////////////////////CREATION PDA/////////////////////////////////////////////////////////////////////////

        function PDA_1(prevHeight,prevPosX, prevPosY, prevPosZ,prevLineWidth,prevColor,offset_g,prevVisible,prevSpec,prevICPE,prevDeltaT,index0) {

            hideInputFields();

            const itemList_pda = document.getElementById('item-list');
            itemList_pda.addEventListener('click', handleItemClick);
            const newItem_pda = document.createElement('li');
            document.addEventListener('keydown', handleKeyPress);
            newItem_pda.className = 'item';
            itemList_pda.appendChild(newItem_pda);
            

            if (shape_creation==true) {
                
                newItem_pda.textContent=group_data_cube[index0].text_new_item;
                } else if (shape_duplicate==true) {
    
                    newItem_pda.textContent='Copie '+group_data_cube[index0].text_new_item;
    
                } else {
    
                    newItem_pda.textContent = 'PDA N° ' + (itemCounter_pda + 1);
    
                }



            text_new_item=newItem_pda.textContent
            

            Hauteur_bat_1 = parseFloat(prevHeight);
            x0_1 = parseFloat(prevPosX);
            y0_1 = parseFloat(prevPosY);
            z0_1 = parseFloat(prevPosZ);
            epaisseur_ligne = parseFloat(prevLineWidth);
            DeltaT=parseFloat(prevDeltaT);

            //alert('Hello, world!');
            // Create cube 1
            var radiusTop_1 = epaisseur_ligne; // Radius of the cylinder's top
            var radiusBottom_1 = epaisseur_ligne; // Radius of the cylinder's bottom
            var prevHeight_1 = Hauteur_bat_1; // Height of the cylinder
            var radialSegments_1 = 32; // Number of segments around the cylinder
            var heightSegments_1 = 1; // Number of segments along the height of the cylinder
            var openEnded_1 = false; // Whether the cylinder ends are open or closed

            var cylinderGeometry_1 = new THREE.CylinderGeometry(radiusTop_1, radiusBottom_1, Hauteur_bat_1,radialSegments_1,heightSegments_1, openEnded_1);
            var cylinderMaterial_1 = new THREE.MeshPhongMaterial({ color: prevColor });
            var cylinder_1 = new THREE.Mesh(cylinderGeometry_1, cylinderMaterial_1);
            cylinder_1.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1/2, y0_1+offset_g);
            //scene.add(cylinder_1);

            var radiusTop_2 = 2*epaisseur_ligne; // Radius of the cylinder's top
            var radiusBottom_2 = 2*epaisseur_ligne; // Radius of the cylinder's bottom
            var height_2 = 0.2*prevHeight_1; // Height of the cylinder
            var radialSegments_2 = 32; // Number of segments around the cylinder
            var heightSegments_2 = 1; // Number of segments along the height of the cylinder
            var openEnded_2 = false; // Whether the cylinder ends are open or closed
            var cylinderGeometry_2 = new THREE.CylinderGeometry(radiusTop_2, radiusBottom_2, height_2,radialSegments_2,heightSegments_2, openEnded_2);
            var cylinderMaterial_2 = new THREE.MeshPhongMaterial({ color: prevColor });
            var cylinder_2 = new THREE.Mesh(cylinderGeometry_2, cylinderMaterial_2);
            cylinder_2.position.set(x0_1+offset_g,z0_1+Hauteur_bat_1-height_2, y0_1+offset_g);
            //scene.add(cylinder_2);

            var coneGeometry = new THREE.ConeGeometry(epaisseur_ligne, 0.2, 32);
            var coneMaterial = new THREE.MeshPhongMaterial({ color: prevColor });
            var cone = new THREE.Mesh(coneGeometry, coneMaterial);
            cone.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1+0.1, y0_1+offset_g);
            //scene.add(cone);

            var group_pda = new THREE.Group();
            group_pda.add(cylinder_1);
            group_pda.add(cylinder_2);
            group_pda.add(cone);
            groups_data.push({newItem:newItem_pda,group:group_pda});
            
            const index = groups_data.findIndex(group => group.newItem === newItem_pda);


            group_color_data_cube[index]=prevColor;
            //group_scene.add(group_pda);
            scene.add(group_pda);
            group_pda.name='group_pda';
            group_name='group_pda';

            Hauteur_bat_1=Hauteur_bat_1+z0_1;

            group_data_cube[index]={text_new_item,prevHeight,prevPosX,prevPosY,prevPosZ,prevLineWidth,prevVisible,prevSpec,prevICPE,prevDeltaT,index};
            group_data_cube_float[index]={group_name,Hauteur_bat_1,x0_1,y0_1,z0_1,prevSpec,prevICPE,DeltaT};

            if (prevVisible==='Oui') {

            cone.visible=true;
            cylinder_1.visible=true;
            cylinder_2.visible=true;

            } else {

            cone.visible=false;
            cylinder_1.visible=false;
            cylinder_2.visible=false;

            }



            itemCounter_pda++;

        if (saveState_test === false && shape_creation === false) {

            saveState();

        }

        if (let_dynamic_results===true) {


            programme_principal();


        };





        }

        ///////////////////////////////////////CREATION PDA/////////////////////////////////////////////////////////////////////////



        ///////////////////////////////////////BOUTON PTS/////////////////////////////////////////////////////////////////////////

        function PTS(){

PTS_1 ('5','0','0','10','0.1','#302C2C',0.0,'Oui','Autre',0)

}

///////////////////////////////////////BOUTON PTS/////////////////////////////////////////////////////////////////////////


///////////////////////////////////////CREATION PTS/////////////////////////////////////////////////////////////////////////

function PTS_1(prevHeight,prevPosX, prevPosY, prevPosZ,prevLineWidth,prevColor,offset_g,prevVisible,prevSpec,index0) {

hideInputFields();

const itemList_pts = document.getElementById('item-list');
itemList_pts.addEventListener('click', handleItemClick);
const newItem_pts = document.createElement('li');
document.addEventListener('keydown', handleKeyPress);
newItem_pts.className = 'item';
itemList_pts.appendChild(newItem_pts);


if (shape_creation==true) {
                
    newItem_pts.textContent=group_data_cube[index0].text_new_item;
                } else if (shape_duplicate==true) {
    
                    newItem_pts.textContent='Copie '+group_data_cube[index0].text_new_item;
    
                } else {
    
                    newItem_pts.textContent = 'PTS N° ' + (itemCounter_pts + 1);
    
                }


text_new_item=newItem_pts.textContent


Hauteur_bat_1 = parseFloat(prevHeight);
x0_1 = parseFloat(prevPosX);
y0_1 = parseFloat(prevPosY);
z0_1 = parseFloat(prevPosZ);
epaisseur_ligne=parseFloat(prevLineWidth);

//alert('Hello, world!');
// Create cube 1
var radiusTop_1 = epaisseur_ligne; // Radius of the cylinder's top
var radiusBottom_1 = epaisseur_ligne; // Radius of the cylinder's bottom
var prevHeight_1 = Hauteur_bat_1; // Height of the cylinder
var radialSegments_1 = 32; // Number of segments around the cylinder
var heightSegments_1 = 1; // Number of segments along the height of the cylinder
var openEnded_1 = false; // Whether the cylinder ends are open or closed

var cylinderGeometry_1 = new THREE.CylinderGeometry(radiusTop_1, radiusBottom_1, Hauteur_bat_1,radialSegments_1,heightSegments_1, openEnded_1);
var cylinderMaterial_1 = new THREE.MeshPhongMaterial({ color: prevColor });
var cylinder_1 = new THREE.Mesh(cylinderGeometry_1, cylinderMaterial_1);
cylinder_1.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1/2, y0_1+offset_g);
//scene.add(cylinder_1);

var coneGeometry = new THREE.ConeGeometry(epaisseur_ligne, 0.2, 32);
var coneMaterial = new THREE.MeshPhongMaterial({ color: prevColor });
var cone = new THREE.Mesh(coneGeometry, coneMaterial);
cone.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1+0.1, y0_1+offset_g);
//scene.add(cone);

var group_pts = new THREE.Group();
group_pts.add(cylinder_1);
group_pts.add(cone);
groups_data.push({newItem:newItem_pts,group:group_pts});


const index = groups_data.findIndex(group => group.newItem === newItem_pts);
group_color_data_cube[index]=prevColor;
//group_scene.add(group_pda);
scene.add(group_pts);
group_pts.name='group_pts'
var group_name='group_pts';
Hauteur_bat_1=Hauteur_bat_1+z0_1;

group_data_cube[index]={text_new_item,prevHeight,prevPosX,prevPosY,prevPosZ,prevLineWidth,prevVisible,prevSpec,index};
group_data_cube_float[index]={group_name,Hauteur_bat_1,x0_1,y0_1,z0_1,prevSpec};

if (prevVisible==='Oui') {

cone.visible=true;
cylinder_1.visible=true;

} else {

cone.visible=false;
cylinder_1.visible=false;
}




itemCounter_pts++;

if (saveState_test === false && shape_creation === false) {

    saveState();

}

if (let_dynamic_results===true) {


    programme_principal();


};


}

///////////////////////////////////////CREATION PTS/////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////BOUTON CUBE TOIT CYLINDRIQUE////////////////////////////////////////////


function structure_cubique_cy (){

structure_cubique_cy_1('10','5','10','0','0','0','0','#304350',0.0,'Oui','Autre',0)

}

///////////////////////////////BOUTON STRUCTURE CUBIQUE TOIT CYLINDRIQUE///////////////////////////////////////////////////////////////////


///////////////////////////////CREATION STRUCTURE CUBIQUE TOIT CYLINDRIQUE//////////////////////////////////////////////////////////////////

function structure_cubique_cy_1 (prevWidth, prevHeight, prevDepth,prevPosX, prevPosY, prevPosZ,prevRotZ,prevColor,offset_g,prevVisible,prevSpec,index0) {



hideInputFields();

const itemList_cube_cy = document.getElementById('item-list');
itemList_cube_cy.addEventListener('click', handleItemClick);
const newItem_cube_cy = document.createElement('li');
document.addEventListener('keydown', handleKeyPress);
newItem_cube_cy.className = 'item';
itemList_cube_cy.appendChild(newItem_cube_cy);


if (shape_creation==true) {
                
    newItem_cube_cy.textContent=group_data_cube[index0].text_new_item;
                            } else if (shape_duplicate==true) {
                
                                newItem_cube_cy.textContent='Copie '+group_data_cube[index0].text_new_item;
                
                            } else {
                
                                newItem_cube_cy.textContent = 'Structure cubique à toit cylindrique N° ' + (itemCounter_tcy + 1);
                
                            }
            


text_new_item=newItem_cube_cy.textContent

Longueur_bat_1 = parseFloat(prevWidth);
Largeur_bat_1= parseFloat(prevDepth);
Hauteur_bat_1 = parseFloat(prevHeight);
x0_1 = parseFloat(prevPosX);
y0_1 = parseFloat(prevPosY);
z0_1 = parseFloat(prevPosZ);
alpha=parseFloat(prevRotZ);

var cubeGeometry = new THREE.BoxGeometry(Longueur_bat_1,Hauteur_bat_1,Largeur_bat_1);
var cubeMaterial = new THREE.MeshPhongMaterial({ color: prevColor });
var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
cube.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1/2, y0_1+offset_g);
cube.rotation.y=alpha*Math.PI/180;

//const clippingPlane = new THREE.Plane(new THREE.Vector3(0, -2, 0), 1); // (normal, distance)
//const clipGeometry = new THREE.PlaneGeometry(1000, 1000);
//const clipMaterial = new THREE.MeshBasicMaterial({color: 0xffffff, side: THREE.DoubleSide});
//const clipPlaneMesh = new THREE.Mesh(clipGeometry, clipMaterial);
//clipPlaneMesh.position.y = -0.01; // just below the cylinder to avoid z-fighting
//clipPlaneMesh.rotation.x = Math.PI / 2; // Rotate to make it vertical

//scene.add(clipPlaneMesh);


var radialSegments = 32; // Number of segments around the cylinder
var heightSegments = 1; // Number of segments along the height of the cylinder
var openEnded = false; // Whether the cylinder ends are open or closed
var cylinderGeometry = new THREE.CylinderGeometry(Largeur_bat_1/2, Largeur_bat_1/2, Longueur_bat_1,radialSegments,heightSegments, openEnded);
var cylinderMaterial = new THREE.MeshPhongMaterial({ color: prevColor});
var cylinder = new THREE.Mesh(cylinderGeometry, cylinderMaterial);

cylinder.rotation.z=Math.PI/2;
cylinder.rotation.y=alpha*Math.PI/180;
cylinder.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1, y0_1+offset_g);

//var rotationAngle=rotationAngle*Math.PI/180



var group_cube_cy = new THREE.Group();

group_cube_cy.add(cube);
group_cube_cy.add(cylinder);

groups_data.push({newItem:newItem_cube_cy,group:group_cube_cy});

const index = groups_data.findIndex(group => group.newItem === newItem_cube_cy);

//const {group,item}=groups[index];



scene.add(group_cube_cy);

group_cube_cy.name='group_cube_cy';
var group_name='group_cube_cy';

Hauteur_bat_1=Hauteur_bat_1+z0_1;

group_data_cube[index]={text_new_item,prevWidth,prevDepth,prevHeight,prevPosX,prevPosY,prevPosZ,prevRotZ,prevVisible,prevSpec,index};

group_data_cube_float[index]={group_name,Longueur_bat_1,Largeur_bat_1,Hauteur_bat_1,x0_1,y0_1,z0_1,alpha,prevSpec};
group_color_data_cube[index]=prevColor;

//renderer.render(scene, camera);
            
if (prevVisible==='Oui') {

    cube.visible=true;
    cylinder.visible=true;

} else {

    cube.visible=false;
    cylinder.visible=false;
}


itemCounter_tcy++;

if (saveState_test === false && shape_creation === false) {

    saveState();

}

if (let_dynamic_results===true) {


programme_principal();


};


}

//////////////////////////////////////////////////////CREATION CUBE TOIT CYLINDRIQUE////////////////////////////////////////////



        ////////////////////////////////BOUTON STRUCTURE CONIQUE//////////////////////////////////////////////////////////////

        function structure_conique(){

structure_conique_1 ('5','10','0','0','0','#474700',0.0,'Oui','Autre',0);

}

////////////////////////////////BOUTON STRUCTURE CONIQUE//////////////////////////////////////////////////////////////

///////////////////////////////CREATION STRUCTURE CONIQUE/////////////////////////////////////////////////////////////


function structure_conique_1 (prevRadius, prevHeight, prevPosX, prevPosY, prevPosZ, prevColor, offset_g,prevVisible,prevSpec,index0) {


hideInputFields();

const itemList_cone = document.getElementById('item-list');
itemList_cone.addEventListener('click', handleItemClick);
const newItem_cone = document.createElement('li');
document.addEventListener('keydown', handleKeyPress);
newItem_cone.className = 'item';
itemList_cone.appendChild(newItem_cone);



if (shape_creation==true) {
                
    newItem_cone.textContent=group_data_cube[index0].text_new_item;
} else if (shape_duplicate==true) {
                            
    newItem_cone.textContent='Copie '+group_data_cube[index0].text_new_item;
                            
} else {
                            
    newItem_cone.textContent = 'Structure conique N° ' + (itemCounter_co+1);
                            
}

text_new_item=newItem_cone.textContent;

Hauteur_bat_1 = parseFloat(prevHeight);
Rayon=parseFloat(prevRadius);
x0_1 = parseFloat(prevPosX);
y0_1 = parseFloat(prevPosY);
z0_1 = parseFloat(prevPosZ);

var coneGeometry = new THREE.ConeGeometry(Rayon, Hauteur_bat_1, 32);
var coneMaterial = new THREE.MeshPhongMaterial({ color: prevColor });
var cone = new THREE.Mesh(coneGeometry, coneMaterial);
cone.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1/2, y0_1+offset_g);

var group_cone = new THREE.Group();
group_cone.add(cone);
groups_data.push({newItem:newItem_cone,group:group_cone});

const index = groups_data.findIndex(group => group.newItem === newItem_cone);



group_color_data_cube[index]=prevColor;

scene.add(group_cone);

group_cone.name='group_cone';
var group_name='group_cone';

if (prevVisible==='Oui') {

cone.visible=true;


} else {

cone.visible=false;


}

Hauteur_bat_1=Hauteur_bat_1+z0_1;
group_data_cube[index]={text_new_item,prevRadius,prevHeight,prevPosX,prevPosY,prevPosZ,prevVisible,prevSpec,index};
group_data_cube_float[index]={group_name,Rayon,Hauteur_bat_1,x0_1,y0_1,z0_1,prevSpec};

itemCounter_co++;

if (saveState_test === false && shape_creation === false) {

    saveState();

}

if (let_dynamic_results===true) {


programme_principal();


};

}         

////////////////////////////////BOUTON STRUCTURE SPHERIQUE//////////////////////////////////////////////////////////////
function structure_spherique(){

structure_spherique_1 ('5','0','0','5','#402E48',0.0,'Oui','Autre',0);

}

////////////////////////////////BOUTON STRUCTURE SPHERIQUE//////////////////////////////////////////////////////////////

///////////////////////////////CREATION STRUCTURE SPHERIQUE/////////////////////////////////////////////////////////////


function structure_spherique_1 (prevRadius, prevPosX, prevPosY, prevPosZ, prevColor, offset_g,prevVisible,prevSpec,index0) {


hideInputFields();

const itemList_sphere = document.getElementById('item-list');
itemList_sphere.addEventListener('click', handleItemClick);
const newItem_sphere = document.createElement('li');
document.addEventListener('keydown', handleKeyPress);
newItem_sphere.className = 'item';
itemList_sphere.appendChild(newItem_sphere);


if (shape_creation==true) {
                
    newItem_sphere.textContent=group_data_cube[index0].text_new_item;
} else if (shape_duplicate==true) {
                                        
    newItem_sphere.textContent='Copie '+group_data_cube[index0].text_new_item;
                                        
} else {
                                        
    newItem_sphere.textContent = 'Structure spherique N° ' + (itemCounter_sp+1);
                                        
}


text_new_item=newItem_sphere.textContent;

Rayon=parseFloat(prevRadius);
x0_1 = parseFloat(prevPosX);
y0_1 = parseFloat(prevPosY);
z0_1 = parseFloat(prevPosZ);

var sphereGeometry = new THREE.SphereGeometry(Rayon, 32, 32);
var sphereMaterial = new THREE.MeshPhongMaterial({ color: prevColor });
var sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
sphere.position.set(x0_1+offset_g, z0_1, y0_1+offset_g);

var group_sphere = new THREE.Group();
group_sphere.add(sphere);
groups_data.push({newItem:newItem_sphere,group:group_sphere});

const index = groups_data.findIndex(group => group.newItem === newItem_sphere);


scene.add(group_sphere);

group_sphere.name='group_sphere';
group_name='group_sphere';

group_data_cube[index]={text_new_item,prevRadius,prevPosX,prevPosY,prevPosZ,prevVisible,prevSpec,index};
group_data_cube_float[index]={group_name,Rayon,x0_1,y0_1,z0_1,prevSpec};

group_color_data_cube[index]=prevColor;

if (prevVisible==='Oui') {

sphere.visible=true;


} else {

sphere.visible=false;

}


itemCounter_sp++;

if (saveState_test === false && shape_creation === false) {

    saveState();

}

if (let_dynamic_results===true) {


programme_principal();


};

}

///////////////////////////////CREATION STRUCTURE SPHERIQUE/////////////////////////////////////////////////////////////

////////////////////////////////BOUTON STRUCTURE SPHERIQUE//////////////////////////////////////////////////////////////
function structure_cylindrique_sp(){

structure_cylindrique_sp_1 ('5','5','0','0','0','#284333',0.0,'Oui','Autre',0);

}

////////////////////////////////BOUTON STRUCTURE SPHERIQUE//////////////////////////////////////////////////////////////

///////////////////////////////CREATION STRUCTURE SPHERIQUE/////////////////////////////////////////////////////////////


function structure_cylindrique_sp_1 (prevRadius, prevHeight,prevPosX, prevPosY, prevPosZ, prevColor, offset_g,prevVisible,prevSpec,index0) {


hideInputFields();

const itemList_cylinder_sp = document.getElementById('item-list');
itemList_cylinder_sp.addEventListener('click', handleItemClick);
const newItem_cylinder_sp = document.createElement('li');
document.addEventListener('keydown', handleKeyPress);
newItem_cylinder_sp.className = 'item';
itemList_cylinder_sp.appendChild(newItem_cylinder_sp);


if (shape_creation==true) {
                
    newItem_cylinder_sp.textContent=group_data_cube[index0].text_new_item;
} else if (shape_duplicate==true) {
                                                    
    newItem_cylinder_sp.textContent='Copie '+group_data_cube[index0].text_new_item;
                                                    
} else {
                                                    
    newItem_cylinder_sp.textContent = 'Structure cylindrique à toit sphérique N° ' + (itemCounter_tsp+1);
                                                    
}


text_new_item=newItem_cylinder_sp.textContent;

Rayon=parseFloat(prevRadius);
Hauteur_bat_1=parseFloat(prevHeight);
x0_1 = parseFloat(prevPosX);
y0_1 = parseFloat(prevPosY);
z0_1 = parseFloat(prevPosZ);

var sphereGeometry = new THREE.SphereGeometry(Rayon, 32, 32);
var sphereMaterial = new THREE.MeshPhongMaterial({ color: prevColor });
var sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
sphere.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1, y0_1+offset_g);

var cylinderGeometry_1 = new THREE.CylinderGeometry(Rayon, Rayon, Hauteur_bat_1,32,1, false);
var cylinderMaterial_1 = new THREE.MeshPhongMaterial({ color: prevColor });
var cylinder_1 = new THREE.Mesh(cylinderGeometry_1, cylinderMaterial_1);
cylinder_1.position.set(x0_1+offset_g, z0_1+Hauteur_bat_1/2, y0_1+offset_g);



var group_cylinder_sp = new THREE.Group();
group_cylinder_sp.add(cylinder_1);
group_cylinder_sp.add(sphere);

groups_data.push({newItem:newItem_cylinder_sp,group:group_cylinder_sp});



const index = groups_data.findIndex(group => group.newItem === newItem_cylinder_sp);


scene.add(group_cylinder_sp);

group_cylinder_sp.name='group_cylinder_sp';
group_name='group_cylinder_sp';

Hauteur_bat_1=Hauteur_bat_1+z0_1;
group_data_cube[index]={text_new_item,prevRadius,prevHeight,prevPosX,prevPosY,prevPosZ,prevVisible,prevSpec,index};
group_data_cube_float[index]={group_name,Rayon,Hauteur_bat_1,x0_1,y0_1,z0_1,prevSpec};

group_color_data_cube[index]=prevColor;

if (prevVisible==='Oui') {

sphere.visible=true;
cylinder_1.visible=true;


} else {

sphere.visible=false;
cylinder_1.visible=false;

}



itemCounter_tsp++;

if (saveState_test === false && shape_creation === false) {

    saveState();

}

if (let_dynamic_results===true) {


programme_principal();


};

} 

///////////////////////////////CREATION STRUCTURE SPHERIQUE/////////////////////////////////////////////////////////////

//////////////////////////////BOUTON CABLE AERIEN/////////////////////////////////////////////////////////////////////////////

function cable_aerien() {

    cable_aerien_1('5','5','20','5','0','0','0','0.0','0.1','#9DC0D2',0.0,'Oui','Autre',0);
}

//////////////////////////////BOUTON CABLE AERIEN////////////////////////////////////////////////////////////////////////////


function cable_aerien_1(prevHeight_C_1,prevHeight_C_2,prevLength,prevSag,prevPosX,prevPosY,prevPosZ,prevRotZ,prevLineWidth,prevColor,offset_g,prevVisible,prevSpec,index0) {

    const itemList_ca = document.getElementById('item-list');
    itemList_ca.addEventListener('click', handleItemClick);
    const newItem_ca = document.createElement('li');
    document.addEventListener('keydown', handleKeyPress);
    newItem_ca.className = 'item';
    itemList_ca.appendChild(newItem_ca);
    

    if (shape_creation==true) {
                
        newItem_ca.textContent=group_data_cube[index0].text_new_item;

    } else if (shape_duplicate==true) {
                                                                
        newItem_ca.textContent='Copie '+group_data_cube[index0].text_new_item;
                                                                
    } else {
                                                                
        newItem_ca.textContent = 'Câble aérien N° ' + (itemCounter_ca+1);
                                                                
    }

    text_new_item=newItem_ca.textContent;
   
    Longueur_C=parseFloat(prevLength);
    X0_C = parseFloat(prevPosX);
    Y0_C = parseFloat(prevPosY);
    Z0_C = parseFloat(prevPosZ);
    Sag_C=parseFloat(prevSag)*Longueur_C/100;
    Hauteur_C_1=parseFloat(prevHeight_C_1);
    Hauteur_C_2=parseFloat(prevHeight_C_2);
    alpha_C=parseFloat(prevRotZ)*Math.PI/180;
    epaisseur_ligne=parseFloat(prevLineWidth);

    const points = [];
 
    var z_cc=0.;
    var X1_cc=0.;
    var Y1_cc=0.;
    var vv=1.
    var nombre_points=22

    if (Sag_C<=0) {

    Sag_C=0.00001;

    }

    SD=Sag_C/(Sag_C+Math.abs(Hauteur_C_1-Hauteur_C_2)) 
    X0=Math.sqrt(SD)*Longueur_C/(1+Math.sqrt(SD))
    D=2*(Longueur_C-X0)
   
        for (let i = 1; i < nombre_points; i++) {

            xx=(i-1)*Longueur_C/20+X0_C

     
            if (Hauteur_C_1<=Hauteur_C_2) {

                z_cc=Hauteur_C_1-Sag_C+4*((Sag_C+Math.abs(Hauteur_C_1-Hauteur_C_2))/Math.pow(D,2))*Math.pow((xx-X0-X0_C),2)+Z0_C;
                X1_cc=(xx-X0_C)*Math.cos(-alpha_C)-(Y0_C-Y0_C)*Math.sin(-alpha_C)+X0_C;
                Y1_cc=(xx-X0_C)*Math.sin(-alpha_C)+(Y0_C-Y0_C)*Math.cos(-alpha_C)+Y0_C;
                const vectors_c=[X1_cc+offset_g, z_cc, Y1_cc+offset_g]; // Adjust the position of vectors as needed
                var vecteur = vectors_c
                points.push(vecteur);
                //addToMatrix(points, vectors_c);
            


            }


             
                
            else {

                z_cc=Hauteur_C_2-Sag_C+4*((Sag_C+Math.abs(Hauteur_C_1-Hauteur_C_2))/Math.pow(D,2))*Math.pow(xx-(Longueur_C-X0)-X0_C,2)+Z0_C;
                X1_cc=(xx-X0_C)*Math.cos(-alpha_C)-(Y0_C-Y0_C)*Math.sin(-alpha_C)+X0_C;
                Y1_cc=(xx-X0_C)*Math.sin(-alpha_C)+(Y0_C-Y0_C)*Math.cos(-alpha_C)+Y0_C;
                const vectors_c=[X1_cc+offset_g, z_cc, Y1_cc+offset_g]; // Adjust the position of vectors as needed
                var vecteur = vectors_c
                points.push(vecteur);
                //addToMatrix(points, vectors_c);



            }


        }


        // Convert points to Three.js vectors
        var curvePoints = points.map(function(point) {
            return new THREE.Vector3(point[0], point[1], point[2]);
        });

        // Create a curve geometry
        var curve = new THREE.CatmullRomCurve3(curvePoints);

        // Create a curve path
        var curvePath = new THREE.CurvePath();
        curvePath.add(curve);

        // Create a Catmull-Rom curve
        var curve = new THREE.CatmullRomCurve3(curvePoints);

        // Create a tube geometry to extrude the curve
        var tubeGeometry = new THREE.TubeGeometry(curve, 100, prevLineWidth, 8, false);

        // Create a material for the tube
        var tubeMaterial = new THREE.MeshBasicMaterial({ color: prevColor });

        // Create a mesh using the tube geometry and material
        var curveObject = new THREE.Mesh(tubeGeometry, tubeMaterial);


        

    var group_ca = new THREE.Group();
    group_ca.add(curveObject);
    //scene.add(group_ca);

    groups_data.push({newItem:newItem_ca,group:group_ca});



    const index = groups_data.findIndex(group => group.newItem === newItem_ca);
    

    scene.add(group_ca);

    group_ca.name='group_ca';
    group_name='group_ca';
    Hauteur_C_1=Hauteur_C_1+Z0_C;
    Hauteur_C_2=Hauteur_C_2+Z0_C;


    

    group_data_cube[index]={text_new_item,prevLength,prevPosX,prevPosY,prevPosZ,prevSag,prevHeight_C_1,prevHeight_C_2,prevRotZ,prevLineWidth,prevVisible,prevSpec,index};
    group_data_cube_float[index]={group_name,Longueur_C,X0_C,Y0_C,Z0_C,Sag_C,Hauteur_C_1,Hauteur_C_2,alpha_C,epaisseur_ligne,prevSpec}; 

    group_color_data_cube[index]=prevColor;

    if (prevVisible==='Oui') {

        curveObject.visible=true;



    } else {

        curveObject.visible=false;


    }


    itemCounter_ca++;

    if (saveState_test === false && shape_creation === false) {

        saveState();

    }

if (let_dynamic_results===true) {


    programme_principal();


};



}



    
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

     


function Points_espace(positions) {
    // Supprimer les points répétitifs
    const uniquePositions = [];

    
    const positionSet = new Set(); // Utilisation d'un Set pour vérifier l'unicité des points

    for (let i = 0; i < positions.length; i += 3) {
        const x = positions[i];
        const y = positions[i + 1];
        const z = positions[i + 2];

        // Créer une clé unique pour chaque point
        const key = `${x.toFixed(5)}_${y.toFixed(5)}_${z.toFixed(5)}`;

        if (!positionSet.has(key)) {
            positionSet.add(key); // Ajouter la clé au Set
            uniquePositions.push(x, y, z); // Ajouter les coordonnées au tableau
        }
    }

    console.log(positions.length,uniquePositions.length)



    // Créer la géométrie avec les points uniques
    var pointsGeometry = new THREE.BufferGeometry();
    pointsGeometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(uniquePositions), 3));

    // Matériau des points
    var pointsMaterial = new THREE.ShaderMaterial({
        uniforms: {
            color: { value: new THREE.Color(couleur_resultats) },
            pointSize: { value: 10.0 }, // Taille ajustable
            alpha: { value: 1 } // Transparence ajustable (entre 0.0 et 1.0)

        },
        vertexShader: `
            uniform float pointSize;
            void main() {
                gl_PointSize = pointSize;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,
        fragmentShader: `
            uniform vec3 color;
            uniform float alpha;
            void main() {
                vec2 coord = gl_PointCoord - vec2(0.5);
                if (length(coord) > 0.5) discard;
                gl_FragColor = vec4(color, alpha);
        }`,
        transparent: true, // Activer la transparence pour permettre la transparence dans le rendu
        //opacity:0.8
    });

    // Créer et ajouter les points à la scène
    const points = new THREE.Points(pointsGeometry, pointsMaterial);
    group_scene.add(points);
    scene.add(points);
    points.name = 'points';

    // Gérer l'état des boutons en fonction de l'existence des positions
    if (uniquePositions.length === 0) {
        document.getElementById('results').disabled = false;
        document.getElementById('results').classList.remove('disabled');
        document.getElementById('results').classList.add('enabled');
    } else {
        document.getElementById('results').disabled = true;
        document.getElementById('results').classList.add('disabled');
    }
}


////////////////////////////////////////////SAVE SHAPES////////////////////////////////////////////////////////////////////

const maxUndoRedoStackSize = 20;
let undoStack = [];
let redoStack = [];
let saveState_test = false;
document.getElementById('previous').classList.add('disabled');
document.getElementById('next').classList.add('disabled');
document.getElementById('previous').disabled = true;
document.getElementById('next').disabled = true;

var previousState = {
    group_data_cube : JSON.parse(JSON.stringify(group_data_cube || [])),
    group_color_data_cube  : JSON.parse(JSON.stringify(group_color_data_cube || [])),
    group_data_cube_float   : JSON.parse(JSON.stringify( group_data_cube_float || [])),
    nomsociete : nomsociete || null,
    nomprojet : nomprojet || null,
    nomredacteur : nomredacteur || null,
    niveauprotection : niveauprotection || null,
    courantimpulsionnel : courantimpulsionnel || null,
    rayonspherefictive : rayonspherefictive || null,
    Nombre_points : Nombre_points || null,
    Couleur_scene : Couleur_scene || null,
    couleur_grille : couleur_grille || null,
    couleur_object : couleur_object || null,
    couleur_resultats : couleur_resultats || null,
    classnamecourant : classnamecourant || null

};


//undoStack.push(JSON.stringify(previousState));  


function saveState () {

    document.getElementById('previous').classList.remove('disabled','enabled');
    document.getElementById('previous').disabled = false;
    document.getElementById('next').classList.remove('disabled','enabled');
    document.getElementById('next').classList.add('disabled');
    document.getElementById('next').disabled = true;

    //console.log('savestate')

    const currentState = {
    group_data_cube : JSON.parse(JSON.stringify(group_data_cube || [])),
    group_color_data_cube  : JSON.parse(JSON.stringify(group_color_data_cube || [])),
    group_data_cube_float   : JSON.parse(JSON.stringify( group_data_cube_float || [])),
    nomsociete : nomsociete || null,
    nomprojet : nomprojet || null,
    nomredacteur : nomredacteur || null,
    niveauprotection : niveauprotection || null,
    courantimpulsionnel : courantimpulsionnel || null,
    rayonspherefictive : rayonspherefictive || null,
    Nombre_points : Nombre_points || null,
    Couleur_scene : Couleur_scene || null,
    couleur_grille : couleur_grille || null,
    couleur_object : couleur_object || null,
    couleur_resultats : couleur_resultats || null,
    classnamecourant : classnamecourant || null



    }

    // Vérifier si l'état actuel est différent de l'état précédent
    if ((!_.isEqual(previousState, currentState) && saveState_test === false)) {

        if (undoStack.length >= maxUndoRedoStackSize) {
            undoStack.shift(); // Supprimez l'état le plus ancien
        }


        undoStack.push(JSON.stringify(previousState));  
        


        // Ajouter l'état précédent à la pile des undo
        //undoStack.push(JSON.stringify(previousState));  

        redoStack = [];

        redoStack.push(JSON.stringify(currentState));  

        // Mettre à jour l'état précédent avec l'état actuel
        previousState = currentState;

        delete_points();
        clearLine();
        counter_regle = false;
        startPoint = null;
        endPoint = null;
        Points_m = [];

        document.getElementById('sceneContainer').removeEventListener('click', handleMouseClick);

        document.getElementById('rulerButton').disabled = false;
        document.getElementById('rulerButton').classList.add('enabled');

        var button = document.getElementById('rulerButton');
        button.title="Mesurer une distance";

        document.getElementById('messageBox').style.display = 'none';

        if (fileName) {

            save();

        }
        

    }


}


function next() {

    delete_points();
    clearLine();
    counter_regle = false;
    startPoint = null;
    endPoint = null;
    Points_m = [];

    document.getElementById('sceneContainer').removeEventListener('click', handleMouseClick);

    document.getElementById('rulerButton').disabled = false;
    document.getElementById('rulerButton').classList.add('enabled');

    var button = document.getElementById('rulerButton');
    button.title="Mesurer une distance";

    saveState_test = !saveState_test;

    if (redoStack.length > 2) {

        const nextState = redoStack.pop();
        undoStack.push(nextState);

        // Parse and restore the next state
        const restoredState = JSON.parse(redoStack[redoStack.length-1]);

        restoreState(restoredState);

        document.getElementById('previous').classList.remove('disabled','enabled');
        //document.getElementById('next').classList.add('disabled');
        document.getElementById('previous').disabled = false;

        //console.log(undoStack.length,redoStack.length);


    } else if (redoStack.length === 2) {

        const nextState = redoStack.pop();
        undoStack.push(nextState);

        // Parse and restore the next state
        const restoredState = JSON.parse(redoStack[redoStack.length-1]);

        restoreState(restoredState);

        document.getElementById('next').classList.remove('disabled','enabled');
        document.getElementById('next').classList.add('disabled');
        document.getElementById('next').disabled = true;
        //undoStack.pop();

        document.getElementById('previous').classList.remove('disabled','enabled');
        //document.getElementById('next').classList.add('disabled');
        document.getElementById('previous').disabled = false;

        //console.log(undoStack.length,redoStack.length);

    }

    saveState_test = !saveState_test;
}

function previous() {

    delete_points();
    clearLine();
    counter_regle = false;
    startPoint = null;
    endPoint = null;
    Points_m = [];

    document.getElementById('sceneContainer').removeEventListener('click', handleMouseClick);

    document.getElementById('rulerButton').disabled = false;
    document.getElementById('rulerButton').classList.add('enabled');

    var button = document.getElementById('rulerButton');
    button.title="Mesurer une distance";

    saveState_test = !saveState_test;


    if (undoStack.length > 1) {


        const lastState = undoStack.pop();
        redoStack.push(lastState);

        // Parse and restore the previous state
        const restoredState = JSON.parse(lastState);
        
        restoreState(restoredState);

        document.getElementById('next').classList.remove('disabled','enabled');
        document.getElementById('next').disabled = false;

        //console.log(undoStack.length,redoStack.length);

 

    } else if (undoStack.length === 1) {

        const lastState = undoStack.pop();
        redoStack.push(lastState);

        // Parse and restore the previous state
        const restoredState = JSON.parse(lastState);
        
        restoreState(restoredState);


        document.getElementById('previous').classList.remove('disabled','enabled');
        document.getElementById('previous').classList.add('disabled');
        document.getElementById('previous').disabled = true;

        document.getElementById('next').classList.remove('disabled','enabled');
        document.getElementById('next').disabled = false;

        //console.log(undoStack.length,redoStack.length);


    }




    saveState_test = !saveState_test;
}

function restoreState(state) {

    clearScene();

    //nouvel ajout
    selectedItem_2=null;
    //

    group_data_cube = state.group_data_cube || [];
    group_color_data_cube = state.group_color_data_cube || [];
    group_data_cube_float = state.group_data_cube_float || [];
    nomsociete = state.nomsociete || null;
    nomprojet = state.nomprojet || null;
    nomredacteur = state.nomredacteur || null;
    niveauprotection = state.niveauprotection || null;
    courantimpulsionnel = state.courantimpulsionnel || null;
    rayonspherefictive = state.rayonspherefictive || null;
    Nombre_points = state.Nombre_points || null;
    Couleur_scene = state.Couleur_scene || null;
    couleur_grille = state.couleur_grille || null;
    couleur_object = state.couleur_object || null; 
    couleur_resultats = state.couleur_resultats || null;
    classnamecourant = state.classnamecourant || null;

    previousState = {
    group_data_cube : JSON.parse(JSON.stringify(group_data_cube || [])),
    group_color_data_cube  : JSON.parse(JSON.stringify(group_color_data_cube || [])),
    group_data_cube_float   : JSON.parse(JSON.stringify( group_data_cube_float || [])),
    nomsociete : nomsociete || null,
    nomprojet : nomprojet || null,
    nomredacteur : nomredacteur || null,
    niveauprotection : niveauprotection || null,
    courantimpulsionnel : courantimpulsionnel || null,
    rayonspherefictive : rayonspherefictive || null,
    Nombre_points : Nombre_points || null,
    Couleur_scene : Couleur_scene || null,
    couleur_grille : couleur_grille || null,
    couleur_object : couleur_object || null,
    couleur_resultats : couleur_resultats || null,
    classnamecourant : classnamecourant || null

    };

    

    document.getElementById('niveau-protection').value = niveauprotection;
    document.getElementById('courant-impulsionnel').value = courantimpulsionnel;
    document.getElementById('rayon-sphere-fictive').value = rayonspherefictive;
    document.getElementById('courant-impulsionnel').className = classnamecourant;
    document.getElementById('rayon-sphere-fictive').className = classnamecourant;

    document.getElementById('Couleur_scene').value = Couleur_scene;

    renderer.setClearColor(Couleur_scene, 1); // Updates the background color of the scene

    document.getElementById('Couleur_grille').value = couleur_grille;
    document.getElementById('Couleur_object').value = couleur_object;
    document.getElementById('Couleur_resultats').value = couleur_resultats;
    document.getElementById('resolution').value = Nombre_points.toFixed(0);
    document.getElementById('resolution-value').textContent = Nombre_points.toFixed(0);
    document.getElementById('nom_projet').value = nomprojet;
    document.getElementById('nom_redacteur').value = nomredacteur;
    document.getElementById('nom_societe').value = nomsociete;
        
    // Clear and recreate scene elements
    //clearScene(); // Custom function to remove all elements from the scene
    displayShapes(); // Custom function to add all elements back based on the restored state
}


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function delete_points() {

    document.getElementById('dragObjectButton').disabled = false;
    document.getElementById('dragObjectButton').classList.remove('disabled');
    document.getElementById('dragObjectButton').classList.add('enabled');

    document.getElementById('dragObjectButton_z').disabled = false;
    document.getElementById('dragObjectButton_z').classList.remove('disabled');
    document.getElementById('dragObjectButton_z').classList.add('enabled');

    //document.getElementById('run').disabled = false;
    //document.getElementById('run').classList.remove('disabled');
    //document.getElementById('run').classList.add('enabled');

    document.getElementById('results').disabled = false;
    document.getElementById('results').enabled = false;
    document.getElementById('results').classList.remove('disabled');
    document.getElementById('results').classList.remove('enabled');
    
    
            if (points !== null) {


                                scene.remove(points);

                if (points.geometry) {
                    points.geometry.dispose();  // Libérer la mémoire de la géométrie
                }

                if (points.material) {
                    points.material.dispose();  // Libérer la mémoire du matériau
                }
                //points.Geometry.dispose(); // Dispose BufferGeometry
                //points.Material.dispose(); // Dispose PointsMaterial
                points = null;
                //render()
                //render(); // Re-render scene
            }


                // Parcourir tous les objets enfants de la scène
    for (let i = scene.children.length - 1; i >= 0; i--) {
        const object = scene.children[i];

        // Vérifier si l'objet a le nom 'points'
        if (object.name === 'points') {
            scene.remove(object);  // Supprimer l'objet de la scène

            // Libérer la mémoire de la géométrie et du matériau
            if (object.geometry) object.geometry.dispose();
            if (object.material) object.material.dispose();
        }
    }

    // Re-rendu de la scène si nécessaire
   // renderer.render(scene, camera);





    }
        

        selectedItem_2=null;

        

        function handleItemClick(event) {
        const selectedItem = event.target;

        //const index=groups_data.findInex(group)
        const index = groups_data.findIndex(group => group.newItem === selectedItem);


        //const {group,newItem}=groups_data[index];


        if (index>=0 && index < groups_data.length) {

 
        
//        const A=group_data_cube[index];

        const {group,newItem}=groups_data[index];

        var highlightOverlay = document.getElementById("highlightOverlay");

        if (group.name=='group_cube') {
            var clickedButton = document.getElementById("cube");
        } else if (group.name=='group_cube_f') {
            var clickedButton = document.getElementById("cube_f");
        } else if (group.name=='group_pda') {
            var clickedButton = document.getElementById("pda");
        } else if (group.name=='group_cylinder') {
            var clickedButton = document.getElementById("cylinder");
        } else if (group.name=='group_cylinderh') {
            var clickedButton = document.getElementById("cylinderh");
        } else if (group.name=='group_cylinder_sp') {
            var clickedButton = document.getElementById("cylinder_sp");
        } else if (group.name=='group_cube_cy') {
            var clickedButton = document.getElementById("cube_cy");
        } else if (group.name=='group_ca') {
            var clickedButton = document.getElementById("ca");
        } else if (group.name=='group_pts') {
            var clickedButton = document.getElementById("pts");
        } else if (group.name=='group_cone') {
            var clickedButton = document.getElementById("cone");
        } else if (group.name=='group_sphere') {
            var clickedButton = document.getElementById("sphere");
        } else if (group.name=='group_cylinder_sp') {
            var clickedButton = document.getElementById("cylinder_sp");
        } 

        
        //var clickedButton = document.getElementById("cube");
        //var previouslyHighlightedButton = document.querySelector(".custom-button.highlighted");

        // Add "highlighted" class to the clicked button
        clickedButton.classList.add("highlighted");

        // Position the overlay relative to the clicked button
        highlightOverlay.style.top = clickedButton.offsetTop + "px";
        highlightOverlay.style.left = clickedButton.offsetLeft + "px";

        // Show the overlay
        highlightOverlay.style.display = "block";


       

        show_input_fields (selectedItem,group,index);

        //var color_cube=group_color_data_cube[index];


        renderer.domElement.addEventListener('click', function() {
        onMouseClick(index,selectedItem,group,group_color_data_cube[index]); // Pass the index as an argument to handleItemClick
    });

        

       if (selectedItem.classList.contains('selected')) {
        //selectedItem.classList.add('selected');

 
            show_input_fields (selectedItem,group,index);

            document.getElementById('dragObjectButton').disabled = false;
            document.getElementById('dragObjectButton').classList.remove('disabled');
            document.getElementById('dragObjectButton').classList.add('enabled');

            document.getElementById('dragObjectButton_z').disabled = false;
            document.getElementById('dragObjectButton_z').classList.remove('disabled');
            document.getElementById('dragObjectButton_z').classList.add('enabled');
            
            document.getElementById('SelectObjectButton').disabled = false;
            document.getElementById('SelectObjectButton').classList.remove('disabled');
            document.getElementById('SelectObjectButton').classList.add('enabled');
   
            
     } else {


        const selectedItems = document.querySelectorAll('.selected');

        selectedItems.forEach(item => {
        item.classList.remove('selected');
        });

            selectedItem.classList.add('selected');

            

            
        if (selectedItem_2 && selectedItem_2!==selectedItem) {



            selectedItem_2.classList.remove('selected');
            const index_2 = groups_data.findIndex(group => group.newItem === selectedItem_2);

            if (index_2==-1){

                return


            }
            const {group,item}=groups_data[index_2];


            group.children.forEach(child => {
            originalColor=group_color_data_cube[index_2];
            child.material.color.set(originalColor); // set original color

            });

            

        }

            selectedItem_2=selectedItem;


            show_input_fields (selectedItem,group,index);


            group.children.forEach(function(child) {
            child.material.color.set(couleur_object); // Set highlight color
            
            

            });

            index_x[0]=index;

           

            document.getElementById('dragObjectButton').disabled = true;
            document.getElementById('dragObjectButton').classList.add('disabled');

            document.getElementById('dragObjectButton_z').disabled = true;
            document.getElementById('dragObjectButton_z').classList.add('disabled');

            document.getElementById('SelectObjectButton').disabled = true;
            document.getElementById('SelectObjectButton').classList.add('disabled');


        }

    }

    

    }


    


    function onMouseClick(index,selectedItem,group) {



        hideInputFields();

        document.getElementById('dragObjectButton').disabled = false;
        document.getElementById('dragObjectButton').classList.remove('disabled');
        document.getElementById('dragObjectButton').classList.add('enabled');

        document.getElementById('dragObjectButton_z').disabled = false;
        document.getElementById('dragObjectButton_z').classList.remove('disabled');
        document.getElementById('dragObjectButton_z').classList.add('enabled');

        document.getElementById('SelectObjectButton').disabled = false;
        document.getElementById('SelectObjectButton').classList.remove('disabled');
        document.getElementById('SelectObjectButton').classList.add('enabled');

        const selectedItems = document.querySelectorAll('.selected');

        // Loop through each selected item and remove the "selected" class
        selectedItems.forEach(item => {
        item.classList.remove('selected');
        

        });

    
    group.children.forEach(function(child) {
    child.material.color.set(group_color_data_cube[index]); // Set original color

    });
   
    renderer.domElement.removeEventListener('click',onMouseClick);




    saveState();

   

    
            
}



        // Function to handle item selection and deletion
        function handleKeyPress(event) {
        const selectedItem = document.querySelector('#item-list .selected');
        if (!selectedItem) return;

        // Handle the key press
        if (event.key === 'Delete') {

            const index = groups_data.findIndex(group => group.newItem === selectedItem);
            const {group,newItem}=groups_data[index];
            scene.remove(group);
            
            selectedItem.remove();

            groups_data.splice(index, 1);
            group_data_cube.splice(index,1);
            group_data_cube_float.splice(index,1);
            group_color_data_cube.splice(index,1);

            if (group.name=='group_cube') {

                itemCounter_cube=itemCounter_cube-1;


            } else if (group.name=='group_cube_f') {

                itemCounter_f=itemCounter_f-1;


            } else if (group.name=='group_cylinder') {

                itemCounter_cy=itemCounter_cy-1;

            } else if (group.name=='group_cylinderh') {

                itemCounter_cyh=itemCounter_cyh-1;

            } else if (group.name=='group_pda') {

                itemCounter_pda=itemCounter_pda-1;


            } else if (group.name=='group_pts') {

                itemCounter_pts=itemCounter_pts-1;


            } else if (group.name=='group_cube_cy') {

                itemCounter_tcy=itemCounter_tcy-1;


            } else if (group.name=='group_cone') {

                itemCounter_co=itemCounter_co-1;


            } else if (group.name=='group_sphere') {

                itemCounter_sp=itemCounter_sp-1;


            } else if (group.name=='group_cylinder_sp') {

                itemCounter_tsp=itemCounter_tsp-1;


            } else if (group.name=='group_ca') {

                itemCounter_ca=itemCounter_ca-1;


            }

            delete_points();


            selectedItem_2=null;


            saveState();
     

            hideInputFields();

            //render();

            return selectedItem_2;

 
        }

  
    }


    function delete_object () {
        const selectedItem = document.querySelector('#item-list .selected');
        if (!selectedItem) {

            return;

        } else {

    
            const index = groups_data.findIndex(group => group.newItem === selectedItem);
            const {group,newItem}=groups_data[index];
            scene.remove(group);
            



            
            selectedItem.remove();


            groups_data.splice(index, 1);
            group_data_cube.splice(index,1);
            group_data_cube_float.splice(index,1);
            group_color_data_cube.splice(index,1);

            if (group.name=='group_cube') {

                itemCounter_cube=itemCounter_cube-1;


            } else if (group.name=='group_cube_f') {

                itemCounter_f=itemCounter_f-1;


            } else if (group.name=='group_cylinder') {

                itemCounter_cy=itemCounter_cy-1;

            } else if (group.name=='group_cylinderh') {

                itemCounter_cyh=itemCounter_cyh-1;

            } else if (group.name=='group_pda') {

                itemCounter_pda=itemCounter_pda-1;


            } else if (group.name=='group_pts') {

                itemCounter_pts=itemCounter_pts-1;


            } else if (group.name=='group_cube_cy') {

                itemCounter_tcy=itemCounter_tcy-1;


            } else if (group.name=='group_cone') {

                itemCounter_co=itemCounter_co-1;


            } else if (group.name=='group_sphere') {

                itemCounter_sp=itemCounter_sp-1;


            } else if (group.name=='group_cylinder_sp') {

                itemCounter_tsp=itemCounter_tsp-1;


            } else if (group.name=='group_ca') {

                itemCounter_ca=itemCounter_ca-1;


            }

            delete_points();

            selectedItem_2=null;
     

            hideInputFields();

            saveState();

            //render();

            return selectedItem_2;

 
        }

  
    }


    ////////////////////////////////////////////ruler to measure distance///////////////////////////

    let startPoint = null;
    let endPoint = null;

    const rulerButton = document.getElementById('rulerButton');
    let points_m = [];
    let line;
    let point1Mesh;
    let point2Mesh;


    function createLine() {

    //const line = new THREE.Line(lineGeometry, lineMaterial);
    //line.computeLineDistances(); // Necessary for dashed lines

    const material = new THREE.LineDashedMaterial({ color: 0xffffff, dashSize: 1, gapSize: 1 });
    const geometry = new THREE.BufferGeometry().setFromPoints(points_m);
    
    line = new THREE.Line(geometry, material);


    const pointMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });

    // Create geometry for the points
    const pointGeometry = new THREE.SphereGeometry(0.2, 32, 32);

    point1Mesh = new THREE.Mesh(pointGeometry, pointMaterial);
    point1Mesh.position.copy(points_m[0]);
    scene.add(point1Mesh);

    point2Mesh = new THREE.Mesh(pointGeometry, pointMaterial);
    point2Mesh.position.copy(points_m[1]);
    scene.add(point2Mesh);


    scene.add(line);

    //renderer.render(scene, camera);
  

    setTimeout(() => {
    var message_box = "Point 1 : " + 
        "x = " + point1Mesh.position.x.toFixed(2) + " m, " + 
        "y = " + point1Mesh.position.z.toFixed(2) + " m, " + 
        "z = " + point1Mesh.position.y.toFixed(2) + " m\n" +
        "Point 2 : " + 
        "x = " + point2Mesh.position.x.toFixed(2) + " m, " + 
        "y = " + point2Mesh.position.z.toFixed(2) + " m, " + 
        "z = " + point2Mesh.position.y.toFixed(2) + " m\n" +
        "Distance entre les points 1 et 2 = " + distance.toFixed(2) + " m";

    //alert(message_box);

    document.getElementById('messageContent').innerText = message_box;
    document.getElementById('messageBox').style.display = 'block';
    
    }, 10); // Délai minimal pour laisser le temps au navigateur de rendre la scène

    // Masquer la boîte après 3 secondes
    setTimeout(() => {
    messageBox.style.display = 'none';
    clearLine();
    counter_regle = false;
    startPoint = null;
    endPoint = null;
    Points_m = [];

    document.getElementById('sceneContainer').removeEventListener('click', handleMouseClick);

    document.getElementById('rulerButton').disabled = false;
    document.getElementById('rulerButton').classList.add('enabled');

    var button = document.getElementById('rulerButton');
    button.title="Mesurer une distance";

    }, 5000); // 5000 ms = 5 secondes

    
    
  }

  function clearLine() {
    if (line || point1Mesh || point2Mesh) {
      scene.remove(line);
      scene.remove(point1Mesh);
      scene.remove(point2Mesh);
      //line.geometry.dispose();
      //line.material.dispose();
      line = null;
      point1Mesh=null;
      point2Mesh=null;
      startPoint = null;
      endPoint = null;

      Points_m = [];
      //points_m=[];
      var button = document.getElementById('rulerButton');
      button.title="Mesurer une distance";
      
      //render();
    }
  }

  counter_regle=false;
  counter_regle_2=false;
  offset_x=40;
  offset_y=7.62;


  






  function handleMouseClick(event) {

        
    //const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector3();
    const mouse1 = new THREE.Vector3();
    var rect = event.target.getBoundingClientRect();
    mouse.x = ((event.clientX - rect.left)/renderer.domElement.clientWidth) * 2 - 1;
    mouse1.x=((event.clientX - rect.left));
    mouse.y = -((event.clientY - rect.top)/renderer.domElement.clientHeight) * 2 + 1;
    mouse1.y=-((event.clientY - rect.top));
    mouse.z=0.5;
    mouse1.z=0.;

    


    mouse.unproject(camera);



    const raycaster = new THREE.Raycaster();
    raycaster.set(camera.position, mouse.sub(camera.position).normalize());
    //raycaster.setFromCamera(mouse, camera);

    // Find intersection point with scene objects
    const intersects = raycaster.intersectObjects(scene.children,true);

    

    if (intersects.length > 0) {
        // Calculate distance from camera position to intersection point
        var intersectionPoint = intersects[0].point;


    }



      if (!startPoint) {
                startPoint = intersectionPoint;

                
                //startPoint_1=intersectionPoint;
                

                points_m.push(startPoint);

                var button = document.getElementById('rulerButton');
                button.title="Cliquer sur le point d'arrivée"
                
                //clearLine()
            } else {
                // If startPoint is set, set endPoint and measure distance
                endPoint = intersectionPoint;

                points_m.push(endPoint);


                //Calculate distance between startPoint and endPoint
                distance = (startPoint.distanceTo(endPoint));
                createLine();

                // Reset startPoint and endPoint for the next measurement
                startPoint = null;
                endPoint = null;
                
                points_m = []
                counter_regle_2=true

                document.getElementById('sceneContainer').removeEventListener('click', handleMouseClick);

                document.getElementById('rulerButton').disabled = false;
                document.getElementById('rulerButton').classList.remove('disabled');
                document.getElementById('rulerButton').classList.add('enabled');

                var button = document.getElementById('rulerButton');
                button.title="Retirer la ligne représentant la distance"


                
                
            }







      
    //}

    
  

}


 

  function handleRulerButtonClick() {

    clearLine();

   
    if (!counter_regle){

    delete_points();
   
    document.getElementById('sceneContainer').addEventListener('click', handleMouseClick);
    
    document.getElementById('rulerButton').disabled = true;
    document.getElementById('rulerButton').classList.add('disabled');

    var button = document.getElementById('rulerButton');
    button.title="Cliquer sur le point de départ"

    

    counter_regle=true;

}
else {



    document.getElementById('sceneContainer').removeEventListener('click', handleMouseClick);



    counter_regle=false;

    points_m = [];
    point1Mesh=null;
    point2Mesh=null;




}


  }

  //document.getElementById('sceneContainer').addEventListener('click', handleMouseClick);
  
  rulerButton.addEventListener('click', handleRulerButtonClick);

    ////////////////////////////////////////////////////////////////////////////////////////////////


    var inputdata=null;

  

    function drag(inputdata) {
    
    var inputdata=inputdata;

        delete_points();
        clearLine();
        counter_regle = false;
        startPoint = null;
        endPoint = null;
        Points_m = [];

        document.getElementById('sceneContainer').removeEventListener('click', handleMouseClick);

        document.getElementById('rulerButton').disabled = false;
        document.getElementById('rulerButton').classList.add('enabled');

        var button = document.getElementById('rulerButton');
        button.title="Mesurer une distance";

        document.getElementById('messageBox').style.display = 'none';
        

   

    
    // Inside the drag function, set up the event listener
    document.getElementById('sceneContainer').addEventListener('click', handleMouseClick_drag);
}



    function handleMouseClick_drag() {

        //delete_points();

        let_dynamic_results=false;
       
        var button = document.getElementById('updateresults');
        button.classList.remove('disabled'); // Remove the 'disabled' class
        button.style.backgroundImage = "url('photos/run-2.jpg')"; // Reset background image
        button.title="Lancer le calcul dynamique";
    
        if (selectedObject) {

            selectedObject=null;

            document.getElementById('sceneContainer').removeEventListener('click',handleMouseClick_drag);
 
            return
   
           
        }

                
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        //const moveMouse=new THREE.Vector2()

        mouse.x = ((event.clientX - renderer.domElement.offsetLeft + 0.5) / window.innerWidth) * 2 - 1;
        mouse.y = -((event.clientY - renderer.domElement.offsetTop + 0.5) / window.innerHeight) * 2 + 1;
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(scene.children,true);
        
    
        if (intersects.length>0) {



        var intersect_object=intersects[0].object;


        if (intersect_object.name=='gridHelper' || intersect_object.name=='floor' || intersect_object.parent.name=='xAxis' || intersect_object.parent.name=='yAxis' || intersect_object.parent.name=='zAxis' || intersect_object.name=='points') {

        return

        }


        selectedObject=intersects[0].object;

        selectedObject.parent.children.forEach(function(child) {
        child.material.color.set(couleur_object); // Set highlight color
 
        });

        
        const index = groups_data.findIndex(item => item.group === selectedObject.parent);

        const {group, newItem}=groups_data[index];

        newItem.classList.add('selected');

        index_x[0]=index;

        hideInputFields();

        renderer.domElement.addEventListener('click', function() {
        onMouseClick(index,newItem,group,group_color_data_cube[index]); // Pass the index as an argument to handleItemClick
        });

 


        show_input_fields (newItem,group,index);



    }


    }  

    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    //const moveMouse=new THREE.Vector2()
    const moveMouse=new THREE.Vector2();
    const intersection = new THREE.Vector3();

    selectedObject=null;
    
    document.getElementById('sceneContainer').addEventListener('mousemove',function() {      ///////// Listen to mouse move ////////////////////////////

    mouse.x = ((event.clientX - renderer.domElement.offsetLeft + 0*0.5) / window.innerWidth) * 2 - 1;
    mouse.y = -((event.clientY - renderer.domElement.offsetTop + 0*0.5) / window.innerHeight) * 2 + 1;

    // Update raycaster
    raycaster.setFromCamera(mouse, camera);

    if (selectedObject){
        

        //controls.enabled = false;

        if (inputdata==1) {

           // let_dynamic_results=false;

        raycaster.ray.intersectPlane(new THREE.Plane(new THREE.Vector3(0, 1, 0), 0), intersection); 
        var xx=intersection.x.toFixed(2).toString();
        var yy=intersection.z.toFixed(2).toString();
        group_data_cube[index_x[0]].prevPosX=xx;
        group_data_cube[index_x[0]].prevPosY=yy;
        const {group, newItem}=groups_data[index_x[0]];
        show_input_fields (newItem,group,index_x[0]);
        
        } else if (inputdata==2) {

          //  let_dynamic_results=false;

            raycaster.ray.intersectPlane(new THREE.Plane(new THREE.Vector3(0, 0, 1), 0), intersection); 
            //var xx=intersection.x.toFixed(2).toString();
            var zz=intersection.y.toFixed(2).toString();
            group_data_cube[index_x[0]].prevPosZ=zz;
            const {group, newItem}=groups_data[index_x[0]];
            show_input_fields (newItem,group,index_x[0]);

        }


        
    }



    });///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////






//////////////////////////////////////////////TRANSLATION BUTTON//////////////////////////////////////////

//controls.enableRotate = true; // Disable rotation
//controls.enablePan = false; // Enable panning
controls.mouseButtons = { ORBIT: THREE.MOUSE.LEFT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.RIGHT };
controls_mouse =true


    // Button event listener for toggling panning
    document.getElementById('panButton').addEventListener('click', function() {
        //controls.enabled = !controls.enabled; // Toggle OrbitControls

        if (controls_mouse) {

            
            //controls.enableRotate=!controls.enableRotate
            //controls.enablePan=!controls.enablePan
            //controls_mouse = !controls_mouse
            controls_mouse = !controls_mouse
            

            controls.mouseButtons = { ORBIT: THREE.MOUSE.RIGHT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.LEFT };
        } else {
            

            controls.mouseButtons = { ORBIT: THREE.MOUSE.LEFT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.RIGHT };

            controls_mouse = !controls_mouse

            controls.update();

            
            
            //controls.reset()
        }
    });


    //////////////////////////////////////////////RESET BUTTON//////////////////////////////////////////

    function reset() {

        //camera.position.set(camera_position, camera_position, camera_position); // Default top view
        //camera.lookAt(0, 0, 0);
        controls.mouseButtons = { ORBIT: THREE.MOUSE.LEFT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.RIGHT };
        controls.reset();
        //camera.position.set(camera_position, camera_position, camera_position); // Default top view
        //camera.lookAt(camera_position, camera_position, camera_position);
        //scene.rotation.set(0, 0, 0); // Reset scene rotation
        //var initialCameraPosition = camera.lookAt(camera_position, camera_position, camera_position);

        camera.position.copy(initialCameraPosition);
        //camera.rotation.copy(initialCameraRotation);
        scene.rotation.set(0, 0, 0); // Reset scene rotation
        camera.fov = initialFov;
        camera.updateProjectionMatrix(); // Update projection matrix to apply changes


        renderer.render(scene, camera);



        //init()

    }

//////////////////////////////////////////////////////////////////////////////////////////////////////////

   //////////////////////////////////////////////ANIMATION BUTTON//////////////////////////////////////////


let rotationX = 0;
const maxRotationX = Math.PI / 6; // 30 degrees (π/6 radians)

let isAnimating = false;

    // Animation loop
 
    // Button for animation
    const animationButton = document.getElementById('animationButton');
    animationButton.addEventListener('click', function() {
        isAnimating = !isAnimating;
        //animationButton.textContent = isAnimating ? 'Stop Animation' : 'Start Animation';
        if (isAnimating) {

            var button = document.getElementById('animationButton');
            //button.classList.remove('disabled'); // Remove the 'disabled' class
            button.style.backgroundImage = "url('photos/animation-2.jpg')"; // Reset background image
            button.title="arrêter l'animation"
            
            animate();
            //isAnimating = false;
        } 

        else {

            var button = document.getElementById('animationButton');
            //button.classList.remove('disabled'); // Remove the 'disabled' class
            button.style.backgroundImage = "url('photos/animation.jpg')"; // Reset background image
            button.title="animer la scène"

        }
    });






//////////////////////////////////////////////////////////////////////////////////////////////////////////



        animate();



        ///////////////////////////////////////////////////SELECTION BUTTOM//////////////////////////////////////////////////////////////////////

        function selection () {
            document.getElementById('sceneContainer').addEventListener('click', selection_object);

        }

        

        selectedObject_2=null;

        index_x=[];

        function selection_object () {


            

            
            if (selectedObject_2) {

            
                selectedObject_2=null;

                document.getElementById('sceneContainer').removeEventListener('click', selection_object);


            return;

            }


        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        mouse.x = ((event.clientX - renderer.domElement.offsetLeft + 0*0.5) / window.innerWidth) * 2 - 1;
        mouse.y = -((event.clientY - renderer.domElement.offsetTop + 0*0.5) / window.innerHeight) * 2 + 1;
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(scene.children,true);

            if (intersects.length>0) {

            const intersect_object=intersects[0].object;

            if (intersect_object.name==='gridHelper' || intersect_object.name=='floor' || intersect_object.parent.name==='xAxis' || intersect_object.parent.name==='yAxis' || intersect_object.parent.name==='zAxis' || intersect_object.name==='points') {

            return;
            }

        selectedObject_2=intersect_object;
        selectedObject_2.parent.children.forEach(function(child) {
        child.material.color.set(couleur_object); // Set highlight color

        });

        const index = groups_data.findIndex(item => item.group === selectedObject_2.parent);
        
        

        const {group, newItem}=groups_data[index];

        newItem.classList.add('selected');

        //hideInputFields();

        renderer.domElement.addEventListener('click', function() {
        onMouseClick(index,newItem,group,group_color_data_cube[index]); // Pass the index as an argument to handleItemClick
        });
        
        index_x[0]=index;

        show_input_fields (newItem,group,index);
       

        }


        

    };








//document.getElementById("myButton").addEventListener("click", duplicate_2);

var shape_duplicate=false;
function duplicate() {

    delete_points();

    shape_duplicate=!shape_duplicate

index=index_x[0];


if (index !== undefined) { 

const {group, newItem}=groups_data[index];

//function structure_cubique_1(prevWidth, prevHeight, prevDepth, prevPosX, prevPosY, prevPosZ,prevRotZ, prevColor)

//var A1=Object.values(group_data_cube[index]);
var color_cube=group_color_data_cube[index];

if (group.name=='group_cube') {
structure_cubique_1 (group_data_cube[index].prevWidth, group_data_cube[index].prevHeight, group_data_cube[index].prevDepth, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ,group_data_cube[index].prevRotZ,color_cube,offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,index);

} else if (group.name=='group_cube_f') {
structure_faitage_1 (group_data_cube[index].prevWidth, group_data_cube[index].prevHeight, group_data_cube[index].prevDepth, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ,group_data_cube[index].prevRotZ,group_data_cube[index].prevHeightMax,group_data_cube[index].prevPosYf,color_cube,offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,index);

} else if (group.name=='group_cylinder') {

structure_cylindrique_1 (group_data_cube[index].prevRadiusTop,group_data_cube[index].prevRadiusBottom,group_data_cube[index].prevHeight,group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ,color_cube,offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,index);

} else if (group.name=='group_cylinderh') {

structure_cylindrique_h_1 (group_data_cube[index].prevRadius, group_data_cube[index].prevLength,prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ,group_data_cube[index].prevRotZ, color_cube, offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,index)

} else if (group.name=='group_pda') {
PDA_1(group_data_cube[index].prevHeight,group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ,group_data_cube[index].prevLineWidth,color_cube,offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,group_data_cube[index].prevICPE,group_data_cube[index].prevDeltaT,index);
} else if (group.name=='group_pts') {
PTS_1(group_data_cube[index].prevHeight,group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ,group_data_cube[index].prevLineWidth,color_cube,offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,index);
} else if (group.name=='group_cube_cy') {
    structure_cubique_cy_1(group_data_cube[index].prevWidth,group_data_cube[index].prevHeight,group_data_cube[index].prevDepth,group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ,group_data_cube[index].prevRotZ,color_cube,offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,index);

} else if (group.name=='group_cone') {
structure_conique_1(group_data_cube[index].prevRadius,group_data_cube[index].prevHeight,group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ,color_cube,offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,index);

} else if (group.name=='group_sphere') {
structure_spherique_1(group_data_cube[index].prevRadius,group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ,color_cube,offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,index);

} else if (group.name=='group_cylinder_sp') {
structure_cylindrique_sp_1(group_data_cube[index].prevRadius,group_data_cube[index].prevHeight,group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ,color_cube,offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,index);

} else if (group.name=='group_ca') {

 cable_aerien_1(group_data_cube[index].prevHeight_C_1,group_data_cube[index].prevHeight_C_2,group_data_cube[index].prevLength,group_data_cube[index].prevSag,group_data_cube[index].prevPosX,group_data_cube[index].prevPosY,group_data_cube[index].prevPosZ,group_data_cube[index].prevRotZ,group_data_cube[index].prevLineWidth,color_cube,offset_g=0.5,group_data_cube[index].prevVisible,group_data_cube[index].prevSpec,index) 


}

}

shape_duplicate=!shape_duplicate

};




/////////////////////////////////////PROGRAMME PRINCIPAL/////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

async function programme_principal() {

    test_snp=1;

    var Z=[];
    //var positions= [];
    snp=[];
    var element_saved=false;
    var o1=null;
    var zk=null;
    var ref_1;
    var ref_2;

    delete_points();


const Rayon_p = parseFloat(document.getElementById('rayon-sphere-fictive').value);




if (group_data_cube_float.length===0) {

    var message_box = "Absence de structures !";
    Swal.fire({
        html: message_box,
        icon: "warning",
        customClass: {
        icon: 'custom-icon'
        }
    });

   // alert('Absence de structures !');

    return


}

document.getElementById('dragObjectButton').disabled = true;
document.getElementById('dragObjectButton').classList.add('disabled');

//document.getElementById('run').disabled = true;
//document.getElementById('run').classList.add('disabled');

            // Envoie une requête POST au serveur Node.js
    const response = await fetch('/programme_principal_sphere_fictive1', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({Rayon_p,group_data_cube_float,group_data_cube,Nombre_points})
            });



            // Attend la réponse du serveur
            const result = await response.json();
            
            const positions =result.positions;
            snp = result.snp;

            


Points_espace(positions);


    if (let_dynamic_results===false) {


        if (snp.length>0) {

            //var message_box="Structures non protégées:" + '\n' + "-"+ snp.join('\n-');
            var message_box = "<u><b>Structures non protégées:</u></b><br>- " + snp.join("<br>- ");
            //alert(message)
            //document.getElementById('messageContent').innerText = message_box;
            //document.getElementById('messageBox').style.display = 'block';
            Swal.fire({
                html: message_box,
            icon: "warning",
            customClass: {
                icon: 'custom-icon'
            }
            });

        } else {

            //alert("Structures non protégées:" + '\n'+"Aucune");
            Swal.fire({
            html: "<u><b>Structures non protégées:</u></b><br> Aucune",
            icon: "warning",
            customClass: {
                icon: 'custom-icon'
            }
            });

            //var message_box="Structures non protégées:" + '\n'+"Aucune";
            //alert(message)
            //document.getElementById('messageContent').innerText = message_box;
            //document.getElementById('messageBox').style.display = 'block';

        }


    }

}



////////////////////////////////////////PROGRAMME PRINCIPAL//////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//const aa=groups_data;

function new_file() {

    window.open('SPHERE_FICTIVE_VERSION_FINALE_29 11 24 SERVEUR.html', '_blank');
}


let fileHandle;



// Save function
async function save() {

    niveauprotection = document.getElementById('niveau-protection').value;
    courantimpulsionnel = document.getElementById('courant-impulsionnel').value;
    rayonspherefictive = document.getElementById('rayon-sphere-fictive').value;
    classnamecourant = document.getElementById('courant-impulsionnel').className;

    


    const data = {
        group_data_cube,
        group_color_data_cube,
        group_data_cube_float,
        nomredacteur,
        nomsociete,
        nomprojet,
        courantimpulsionnel,
        niveauprotection,
        rayonspherefictive,
        camera_position,
        taille_mailles,
        Nombre_points,
        Couleur_scene,
        couleur_grille,
        couleur_object,
        couleur_resultats,
        classnamecourant,
        mission_sf:'sf'
    };

    const jsonData = JSON.stringify(data, null, 2);
    const blob = new Blob([jsonData], { type: 'application/json' });

    try {

 
        if (!fileHandle) {

            const suggestedName = fileName || 'sf_calcul_sphere_fictive.json'; // Use stored fileName or default
            // If no file handle, ask the user to pick a file and save for the first time
            fileHandle = await showSaveFilePicker({
            suggestedName: suggestedName,
                types: [{
                    description: 'JSON Files',
                    accept: { 'application/json': ['.json'] },
                }],
            });

            fileName = fileHandle.name; // Store the new file name if a new file is picked
        }

        // Create a writable stream and write the blob to the file
        const writableStream = await fileHandle.createWritable();
        await writableStream.write(blob);
        await writableStream.close();
        //alert('Fichier enregistré avec succès.');
    } catch (err) {
        if (err.name === 'AbortError') {
            //console.warn('Ouverture du fichier a été abandonnée.');
        } else {
            //console.error('Erreur de lecture du fichier:', err);
        }
    }
}

// Save As function
async function save_as() {

    niveauprotection = document.getElementById('niveau-protection').value;
    courantimpulsionnel = document.getElementById('courant-impulsionnel').value;
    rayonspherefictive = document.getElementById('rayon-sphere-fictive').value;
    classnamecourant = document.getElementById('courant-impulsionnel').className;


    const data = {
        group_data_cube,
        group_color_data_cube,
        group_data_cube_float,
        nomredacteur,
        nomsociete,
        nomprojet,
        courantimpulsionnel,
        niveauprotection,
        rayonspherefictive,
        camera_position,
        taille_mailles,
        Nombre_points,
        Couleur_scene,
        couleur_grille,
        couleur_object,
        couleur_resultats,
        classnamecourant,
        mission_sf:'sf'
    };

    const jsonData = JSON.stringify(data, null, 2);
    const blob = new Blob([jsonData], { type: 'application/json' });

    if (window.showSaveFilePicker) {
        // Use File System Access API if available
        try {
            // Open a file picker to select the file to save
            const suggestedName = fileName || 'sf_calcul_sphere_fictive.json'; // Use stored fileName or default

            fileHandle = await showSaveFilePicker({
                suggestedName: suggestedName,
                types: [{
                    description: 'JSON Files',
                    accept: { 'application/json': ['.json'] },
                }],
            });

            fileName = fileHandle.name; // Store the file name

            // Create a writable stream and write the blob to the file
            const writableStream = await fileHandle.createWritable();
            await writableStream.write(blob);
            await writableStream.close();
            
            //alert('Fichier enregistré avec succès.');
        } catch (err) {
            if (err.name === 'AbortError') {
                //console.warn('Ouverture du fichier a été abandonnée.');
            } else {
                //console.error('Erreur de lecture du fichier:', err);
            }
        }
    } else {
        // Fallback for browsers without File System Access API
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'sf_calcul_sphere_fictive.json';
        a.click();
        URL.revokeObjectURL(url);
    }
}

//document.getElementById('openShapesButton').addEventListener('click', () => {
   // document.getElementById('openShapes').click();
//});

//let fileHandle; // Declare this globally to reuse in the save function

let fileName;

document.getElementById('openShapesButton').addEventListener('click', async (event) => {
    try {
        // Open file picker and get the file handle
        [fileHandle] = await window.showOpenFilePicker({
            types: [{
                description: 'JSON Files',
                accept: { 'application/json': ['.json'] },
            }],
        });

        fileName = fileHandle.name; // Store the file name

        const file = await fileHandle.getFile(); // Get the file object from the file handle

        // Read the contents of the file
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);

                const prefixeAttendu = 'sf_';
                if (!data.mission_sf || (!file.name.startsWith(prefixeAttendu))) {
                    alert('Fichier invalide');
                    return;
                }

                clearScene();

                undoStack = [];
                redoStack = [];
                saveState_test = false;
                
                delete_points();

                // Replace the existing arrays with the loaded data
                group_data_cube = data.group_data_cube || [];
                group_color_data_cube = data.group_color_data_cube || [];
                group_data_cube_float = data.group_data_cube_float || [];
                nomsociete = data.nomsociete;
                nomprojet = data.nomprojet;
                nomredacteur = data.nomredacteur;
                niveauprotection = data.niveauprotection;
                courantimpulsionnel = data.courantimpulsionnel;
                rayonspherefictive = data.rayonspherefictive;
                camera_position = data.camera_position;
                taille_mailles = data.taille_mailles;
                Nombre_points = data.Nombre_points;
                Couleur_scene = data.Couleur_scene;
                couleur_grille = data.couleur_grille;
                couleur_object = data.couleur_object;
                couleur_resultats = data.couleur_resultats;
                classnamecourant = data.classnamecourant;



                previousState = {
                    group_data_cube : JSON.parse(JSON.stringify(group_data_cube || [])),
                    group_color_data_cube  : JSON.parse(JSON.stringify(group_color_data_cube || [])),
                    group_data_cube_float   : JSON.parse(JSON.stringify( group_data_cube_float || [])),
                    nomsociete : nomsociete || null,
                    nomprojet : nomprojet || null,
                    nomredacteur : nomredacteur || null,
                    niveauprotection : niveauprotection || null,
                    courantimpulsionnel : courantimpulsionnel || null,
                    rayonspherefictive : rayonspherefictive || null,
                    Nombre_points : Nombre_points || null,
                    Couleur_scene : Couleur_scene || null,
                    couleur_grille : couleur_grille || null,
                    couleur_object : couleur_object || null,
                    couleur_resultats : couleur_resultats || null,
                    classnamecourant : classnamecourant || null
                };
                

                // Convert string values to numbers where applicable
                group_data_cube.forEach((item, index) => {
                    item.prevWidth = parseFloat(item.prevWidth);
                    item.prevDepth = parseFloat(item.prevDepth);
                    item.prevHeight = parseFloat(item.prevHeight);
                    item.prevPosX = parseFloat(item.prevPosX);
                    item.prevPosY = parseFloat(item.prevPosY);
                    item.prevPosZ = parseFloat(item.prevPosZ);
                    item.prevRotZ = parseFloat(item.prevRotZ);
                });

                document.getElementById('niveau-protection').value = niveauprotection;
                document.getElementById('courant-impulsionnel').value = courantimpulsionnel;
                document.getElementById('rayon-sphere-fictive').value = rayonspherefictive;
                document.getElementById('courant-impulsionnel').className = classnamecourant;
                document.getElementById('rayon-sphere-fictive').className = classnamecourant;

                document.getElementById('Couleur_scene').value = Couleur_scene;

                renderer.setClearColor(Couleur_scene, 1); // Updates the background color of the scene

                document.getElementById('Couleur_grille').value = couleur_grille;
                document.getElementById('Couleur_object').value = couleur_object;
                document.getElementById('Couleur_resultats').value = couleur_resultats;

                document.getElementById('camera-position').value = camera_position.toFixed(0);
                camera.position.set(camera_position, camera_position, camera_position);
                camera.lookAt(0, 0, 0);
                controls.update();

                document.getElementById('camera-position-value').textContent = camera_position.toFixed(0);

                document.getElementById('taille_mailles').value = taille_mailles.toFixed(0);
                document.getElementById('taille_mailles-value').textContent = taille_mailles.toFixed(0);
                meshgrid(taille_mailles);

                document.getElementById('resolution').value = Nombre_points.toFixed(0);
                document.getElementById('resolution-value').textContent = Nombre_points.toFixed(0);

                document.getElementById('nom_projet').value = nomprojet;
                document.getElementById('nom_redacteur').value = nomredacteur;
                document.getElementById('nom_societe').value = nomsociete;

                document.getElementById('previous').classList.remove('enabled','disabled');
                document.getElementById('next').classList.remove('enabled','disabled');
                document.getElementById('previous').classList.add('disabled');
                document.getElementById('next').classList.add('disabled');
                document.getElementById('previous').disabled = true;
                document.getElementById('next').disabled = true;

                displayShapes();

            } catch (error) {
                alert('Fichier invalide');
            }
        };

        reader.onerror = function() {
           // alert('Erreur de lecture du fichier');
        };

        reader.readAsText(file);

    } catch (error) {
        //console.error('Erreur lors de l\'ouverture du fichier:', error);
        //alert('Erreur lors de l\'ouverture du fichier.');
    }
});




var shape_creation = false;

function displayShapes() {
    shape_creation = !shape_creation;

    for (let o = 0; o <= group_data_cube.length - 1; o++) {
        const index = o;
        const color_cube = group_color_data_cube[index];
        const group_name = group_data_cube_float[index]?.group_name;

        if (group_name) {
            switch (group_name) {
                case 'group_cube':
                    structure_cubique_1(group_data_cube[index].prevWidth, group_data_cube[index].prevHeight, group_data_cube[index].prevDepth, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevRotZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cube_f':
                    structure_faitage_1(group_data_cube[index].prevWidth, group_data_cube[index].prevHeight, group_data_cube[index].prevDepth, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevRotZ, group_data_cube[index].prevHeightMax, group_data_cube[index].prevPosYf, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cylinder':
                    structure_cylindrique_1(group_data_cube[index].prevRadiusTop, group_data_cube[index].prevRadiusBottom, group_data_cube[index].prevHeight, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                    case 'group_cylinderh':
                    structure_cylindrique_h_1(group_data_cube[index].prevRadius, group_data_cube[index].prevLength, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevRotZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                    case 'group_pda':
                    PDA_1(group_data_cube[index].prevHeight, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevLineWidth, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, group_data_cube[index].prevICPE, group_data_cube[index].prevDeltaT, index);
                    break;
                case 'group_pts':
                    PTS_1(group_data_cube[index].prevHeight, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevLineWidth, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cube_cy':
                    structure_cubique_cy_1(group_data_cube[index].prevWidth, group_data_cube[index].prevHeight, group_data_cube[index].prevDepth, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevRotZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cone':
                    structure_conique_1(group_data_cube[index].prevRadius, group_data_cube[index].prevHeight, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_sphere':
                    structure_spherique_1(group_data_cube[index].prevRadius, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cylinder_sp':
                    structure_cylindrique_sp_1(group_data_cube[index].prevRadius, group_data_cube[index].prevHeight, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_ca':
                    cable_aerien_1(group_data_cube[index].prevHeight_C_1, group_data_cube[index].prevHeight_C_2, group_data_cube[index].prevLength, group_data_cube[index].prevSag, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevRotZ, group_data_cube[index].prevLineWidth, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                default:
                    console.warn(`Unknown group name: ${group_name}`);
            }
        } else {
            console.warn(`Missing group name for index: ${index}`);
        }
    }

    shape_creation = !shape_creation;
}

function clearScene() {
    for (let o = 0; o < groups_data.length; o++) {
        const { group, newItem } = groups_data[o];
        scene.remove(group);
        newItem.remove();
    }

    // Clear the arrays
    groups_data = [];
    group_data_cube = [];
    group_data_cube_float = [];
    group_color_data_cube = [];
    output=[];
}


//////////////////////IMPORT SHAPES ///////////////////////////////////
//document.getElementById('ImportShapesButton').addEventListener('click', () => {
 //   document.getElementById('ImportShapes').click();
//});

document.getElementById('ImportShapesButton').addEventListener('click', (event) => {

    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'application/json';
    input.onchange = function(event) {
    const file = event.target.files[0];

    if (file.type !== 'application/json') {
        alert('Fichier invalide');
        return; // Stop further execution if the file is not a valid JSON
    }

    const reader = new FileReader();
    reader.onload = function(e) {

    try {
    const data = JSON.parse(e.target.result);

    const prefixeAttendu = 'sf_';
    const prefixeAttendupda = 'sfa_';

    if ((!data.mission_sf && !data.mission_sfa) || !((file.name.startsWith(prefixeAttendu)) || (file.name.startsWith(prefixeAttendupda)))) {


        alert('Fichier invalide');



        return


    }

    const newGroupDataCube = data.group_data_cube || [];
    const newGroupColorDataCube = data.group_color_data_cube || [];
    const newGroupDataCubeFloat = data.group_data_cube_float || [];

    // Append new data to the existing arrays
    const startIdx = group_data_cube.length;
    group_data_cube.push(...newGroupDataCube);
    group_color_data_cube.push(...newGroupColorDataCube);
    group_data_cube_float.push(...newGroupDataCubeFloat);

    // Update the display with only the new data
    displayNewShapes(startIdx, newGroupDataCube.length);

    saveState();

    
 
    } catch (error) {
        
       alert('Fichier invalide');
       return;

    }

    };

    reader.onerror = function() {
        alert('Erreur de lecture du fichier');
    };




    reader.readAsText(file);

    };

    input.click();
    
 
});

// Function to validate the data structure
//function isValidData(data) {
  //  return Array.isArray(data.group_data_cube) &&
    //    Array.isArray(data.group_color_data_cube) &&
    //    Array.isArray(data.group_data_cube_float);
//}

var shape_creation = false;

function displayNewShapes(startIdx, newShapesCount) {
    shape_creation = !shape_creation;

    for (let o = startIdx; o < startIdx + newShapesCount; o++) {
        const index = o;
        const color_cube = group_color_data_cube[index];
        const group_name = group_data_cube_float[index]?.group_name;

        if (group_name) {
            switch (group_name) {
                case 'group_cube':
                    structure_cubique_1(group_data_cube[index].prevWidth, group_data_cube[index].prevHeight, group_data_cube[index].prevDepth, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevRotZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cube_f':
                    structure_faitage_1(group_data_cube[index].prevWidth, group_data_cube[index].prevHeight, group_data_cube[index].prevDepth, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevRotZ, group_data_cube[index].prevHeightMax, group_data_cube[index].prevPosYf, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cylinderh':
                    structure_cylindrique_h_1(group_data_cube[index].prevRadius, group_data_cube[index].prevLength, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevRotZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cylinder':
                    structure_cylindrique_1(group_data_cube[index].prevRadiusTop, group_data_cube[index].prevRadiusBottom, group_data_cube[index].prevHeight, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_pda':
                    PDA_1(group_data_cube[index].prevHeight, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevLineWidth, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, group_data_cube[index].prevICPE, group_data_cube[index].prevDeltaT, index);
                    break;
                case 'group_pts':
                    PTS_1(group_data_cube[index].prevHeight, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevLineWidth, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cube_cy':
                    structure_cubique_cy_1(group_data_cube[index].prevWidth, group_data_cube[index].prevHeight, group_data_cube[index].prevDepth, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevRotZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cone':
                    structure_conique_1(group_data_cube[index].prevRadius, group_data_cube[index].prevHeight, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_sphere':
                    structure_spherique_1(group_data_cube[index].prevRadius, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_cylinder_sp':
                    structure_cylindrique_sp_1(group_data_cube[index].prevRadius, group_data_cube[index].prevHeight, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                case 'group_ca':
                    cable_aerien_1(group_data_cube[index].prevHeight_C_1, group_data_cube[index].prevHeight_C_2, group_data_cube[index].prevLength, group_data_cube[index].prevSag, group_data_cube[index].prevPosX, group_data_cube[index].prevPosY, group_data_cube[index].prevPosZ, group_data_cube[index].prevRotZ, group_data_cube[index].prevLineWidth, color_cube, 0, group_data_cube[index].prevVisible, group_data_cube[index].prevSpec, index);
                    break;
                default:
                    console.warn(`Unknown group name: ${group_name}`);
            }
        } else {
            console.warn(`Missing group name for index: ${index}`);
        }
    }

    shape_creation = !shape_creation;
}

function clearScene() {
    for (let o = 0; o < groups_data.length; o++) {
        const { group, newItem } = groups_data[o];
        scene.remove(group);
        newItem.remove();
    }

    // Clear the arrays
    groups_data = [];
    group_data_cube = [];
    group_data_cube_float = [];
    group_color_data_cube = [];
    output=[];
    itemCounter_cube = 0;
    itemCounter_f = 0;
    itemCounter_cy = 0;
    itemCounter_cyh = 0;
    itemCounter_tsp = 0;
    itemCounter_tcy = 0;
    itemCounter_co = 0;
    itemCounter_sp = 0;
    itemCounter_pda = 0;
    itemCounter_pts = 0;
    itemCounter_ca = 0;
    selectedItem_2 = null;
    selectedObject_2=null;
}





























        
    </script>
</body>
</html>
