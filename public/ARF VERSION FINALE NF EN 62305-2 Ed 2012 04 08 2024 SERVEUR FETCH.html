<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluation du risque foudre R1 - Norme NF EN 62305-2 Ed.2012</title>
    <style>
        .body {
            
  
            display:flex;
            margin: 0;
            padding:0;
            font-family: Arial, sans-serif;
            overflow: hidden;



        }

        .main-container {
            
            display: flex;
            flex-direction: row;
            flex: 1;
            overflow: hidden;

        }
        
        .left-container {
            background-color: #e8e8e8;
            padding: 10px;
            border-right: 1px solid #ccc;
            display: flex;
            width: 20%;
            height:98vh;

            flex-direction: column;
            border: 1px solid #ccc;
            box-sizing: border-box;
            font-family: Arial, sans-serif;

        }

        .left-top-container {
            flex: 0 1 auto;
            background-color: #e8e8e8;
            padding: 10px;
            border-bottom: 1px solid #ccc;
            display: flex;
            height: 20%;

        }

        .left-bottom-container {
            flex: 0 1 auto;
            background-color: #e8e8e8;
            padding:10px;
            border: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            margin-top:10px;
   
            box-sizing: border-box;

        }

        .densite_foudroiement_container {
            flex: 0 1 auto;
            background-color: #e8e8e8;
            padding: 10px;
            border: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            margin-top:10px;

        }

        .nom_projet_container {
            flex: 0 1 auto;
            background-color: #e8e8e8;
            padding: 10px;
            border: 1px solid #ccc;
            
            flex-direction: column;
            box-sizing: border-box;
            margin-top:10px;
            text-align: center; /* Align label text to the right */

        }

        .left_input_data {

            background-color:cornsilk;
            padding: 10px;
            border: 1px solid #dddddd;
            width:200px;
            color:blue;
            text-align: center; /* Align label text to the right */
            height:5px;


        }

        .dropdown_menu_container_items {
            
            background-color: #e8e8e8;
            padding: 10px;
            border: 1px solid #ccc;
            
            flex-direction: row;
            box-sizing: border-box;
            margin-top:10px;
            text-align: center; /* Align label text to the right */
            
           

        }        

        .center-container {
            flex: 1;
            background-color: #e8e8e8;
            padding: 10px;
            height: 98vh;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
            border: 1px solid #ccc;
            box-sizing: border-box;



        }

        .right-container {

            width: 33%;

            background-color: #ffffff;
            padding: 10px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            height:98vh;

        }

        .chart-container {
            flex: 1 1 auto;
            margin-bottom: 20px;
            display: flex;
            height:49%;
            justify-content: center;
            align-items: center;
            border: 1px solid #ccc;
            box-sizing: border-box;

        }

        .chart-container:last-child {
            margin-bottom: 0;
        }

        .dropdown-container {
            text-align: center; /* Center dropdown menu text */

        }

        .dropdown_container_label {
        font-weight: bold;
        padding:10px;


        }



        #dropdown-menu-line, #dropdown-menu-zone {
            padding: 8px; /* Adjust padding around the dropdown menu */
            font-size: 14px; /* Adjust font size */
            width: 400px; /* Set a fixed width for the dropdown menu */
            height: 35px; /* Set a fixed visible height for the dropdown box */
            margin-top:10px;
            margin-bottom:10px;
            overflow-y: auto; /* Add vertical scrollbar if options exceed height */
        }

        #dropdown-menu-risque {
            padding: 8px; /* Adjust padding around the dropdown menu */
            font-size: 14px; /* Adjust font size */
            width: 300px; /* Set a fixed width for the dropdown menu */
            height: 35px; /* Set a fixed visible height for the dropdown box */
            margin-top:10px;
            margin-bottom:10px;
            margin-left:10px;
            justify-content: center;
            overflow-y: auto; /* Add vertical scrollbar if options exceed height */
        }

        .button-risque {

            padding: 10px; /* Adjust padding around the dropdown menu */
            height: 35px; /* Set a fixed visible height for the dropdown box */
            background:rgb(193, 193, 193);
            color:rgb(0, 0, 0);
            font-size: 14px; /* Adjust font size */
            justify-content: center;
            padding:8px;
            margin-top:10px;
            margin-bottom:10px;
            margin-left:10px




        }



        
        #dropdown-menu-mesures,#dropdown-menu-zone-mesures {
            padding: 1px; /* Adjust padding around the dropdown menu */
            font-size: 14px; /* Adjust font size */
            width: 400px; /* Set a fixed width for the dropdown menu */
            height: 25px; /* Set a fixed visible height for the dropdown box */
            margin-top:10px;
            margin-bottom:10px;
            overflow-y: auto; /* Add vertical scrollbar if options exceed height */
            background-color: cornsilk;
        }


        .button {
            padding: 10px;
            margin-bottom: 10px;
            background-color: #8f9dac;
            color: rgb(0, 0, 0);
            font-weight: bold; /* Mettre le texte en gras */
            border: none;
            border-radius: 25px; /* Make the buttons rounded */
            cursor: pointer;
        }

        .button_mesures_protection {
            padding: 10px;
            background-color: #8f9dac;
            color: rgb(0, 0, 0);
            font-weight: bold; /* Mettre le texte en gras */
            border: none;
            border-radius: 25px; /* Make the buttons rounded */
            cursor: pointer;
        }

 



        .button:hover {
            background-color: #d5d82f;
        }

        .result_button {
            padding: 10px;
            margin-bottom: 10px;
            background-color: rgba(1, 99, 21, 0.5);
            height: 40px; /* Set a fixed height */
            color:white;
            font-weight: bold; /* Mettre le texte en gras */
            border: none;
            border-radius: 25px; /* Make the buttons rounded */
            cursor: none;
        }

        .result_button_gray {
            padding: 10px;
            margin-bottom: 10px;
            background-color: #cccccc;
            height: 40px; /* Set a fixed height */

            font-weight: bold; /* Mettre le texte en gras */
            border: none;
            border-radius: 25px; /* Make the buttons rounded */
            cursor: none;
        }



        .result_button_np {
            padding: 10px;
            margin-bottom: 10px;
            background-color: rgba(255, 0, 0, 0.5);
            height: 40px; /* Set a fixed height */
            color:white;
            font-weight: bold; /* Mettre le texte en gras */
            border: none;
            border-radius: 25px; /* Make the buttons rounded */
            cursor: none;
        }




        .custom-button_item-add {
            background-image: url("photos/add_item.jpg");
            height: 35px; /* Set a fixed height */
            width:35px;
            padding: 10px;
            cursor: pointer;
            margin-left:1px;
            margin-right:1px;
            margin-top:10px;

            border: none;
            background-size: cover; /* Ensure the image covers the button */


        }

        .custom-button_item-remove {
            background-image: url("photos/remove_item.jpg");
            height: 35px; /* Set a fixed height */
            width:35px;
            padding: 10px;
            cursor: pointer;
            margin-left:1px;
            margin-right:1px;
            margin-top:10px;

            border: black;
            background-size: cover; /* Ensure the image covers the button */


        }

        .custom-button_item-rename {
            background-image: url("photos/rename_item.jpg");
            height: 35px; /* Set a fixed height */
            width:35px;
            padding: 10px;
            cursor: pointer;
            margin-left:1px;
            margin-right:1px;
            margin-top:10px;

            border: none;
            background-size: cover; /* Ensure the image covers the button */


        }



        .button_item:hover {
            background-color: #0056b3;
        }






        canvas {
            max-width: 100%; /* Ensure canvas does not exceed container width */
        }
#canvas_structure_complexe {
    width: 100%; /* Occupy full width of its container */
    height: 60vh; /* Occupy 60% of the viewport height */
    max-width: 100%; /* Ensure it does not exceed the viewport width */
    max-height: 60vh; /* Ensure it does not exceed 60% of viewport height */
    border: 1px solid #ccc; /* Optional: Add a border for clarity */
    overflow: hidden; /* Hide any overflow content */

}
        #newNameInput {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        box-sizing: border-box;
    }

    .btn-container {
        text-align: center;
    }

    .btn-container button {
        padding: 10px;
        background-color: #0f9c29;
        color: #fff;
        border: none;
        border-radius: 25px;
        cursor: pointer;
    }

    .btn-container button:hover {
        background-color: #28be14;
    }

 
    /* Modal for renaming item */
    .modal {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4); /* Black background with opacity */
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 40%; /* Adjust width as needed */
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
        position: relative;
        border-radius: 10px;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    #dropdown-menu, #newNameInput {
            margin: 10px 0;
            padding: 5px;
            width: 100%;
            max-width: 200px; /* Adjust the max-width as needed */
        }

   
    
    .hidden-buttons {
        display: none;
    margin-top: 10px; /* Space between the container and its surroundings */
    justify-content: center;
    align-items: center;
    flex-direction: row;
    border: 1px solid #ccc;
    gap: 10px; /* Space between buttons */
    padding: 10px; /* Padding inside the container */
    box-sizing: border-box; /* Ensure padding is included in the width and height */


    }

    .custom-button {
            background-size: cover;
            background-position: center;
            width: 130px;
            height: 140px;
            border: 2px solid #000;
            cursor: pointer;
        }
    
    .custom-button-selected {

        background-size: cover;
            background-position: center;
            width: 130px;
            height: 140px;
            border: 2px solid #a40202;
            cursor: pointer;

    }

    .custom-button-1 {
        background-image: url("photos/cube_simple.jpg");

    }

    .custom-button-2 {
        background-image: url("photos/cube_simple_edicule.jpg");

    }

    .custom-button-3 {
        background-image: url("photos/cylindre_simple.jpg");
 
    }

    .custom-button-4 {
        background-image: url("photos/cylindre_simple_edicule.jpg");

    }

    .custom-button-5 {
        background-image: url("photos/structure_complexe.jpg");
        width: 170px;

    }

    .clicked {
        background-color: #d5d82f; /* Change the border color */
    }

            /* Styles for the new window */
    .popup_cube_simple {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        width: 500px; /* Set the width of the popup */
        height: 600px; /* Set the height of the popup */
        display: none;
        box-sizing: border-box; /* Include padding in width and height */
        overflow: auto; /* Add scroll if content overflows */
    }

    .popup_cylindre_simple {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        width: 500px; /* Set the width of the popup */
        height: 680px; /* Set the height of the popup */
        display: none;
        box-sizing: border-box; /* Include padding in width and height */
        overflow: auto; /* Add scroll if content overflows */
    }


    /* Styles for the new window */
    .popup_cube_edicule {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        width: 500px; /* Set the width of the popup */
        height: 620px; /* Set the height of the popup */
        display: none;
        box-sizing: border-box; /* Include padding in width and height */
        overflow: auto; /* Add scroll if content overflows */
    }

    .popup_cylindre_edicule {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        width: 500px; /* Set the width of the popup */
        height: 640px; /* Set the height of the popup */
        display: none;
        box-sizing: border-box; /* Include padding in width and height */
        overflow: auto; /* Add scroll if content overflows */
    }

    .popup_structure_complexe {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw; /* Set the width to 100% of the viewport width */
    height: 100vh; /* Set the height to 100% of the viewport height */
    background-color: white;
    padding: 20px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    display: none;
    box-sizing: border-box; /* Include padding in width and height */
    overflow: auto; /* Add scroll if content overflows */
    }

    .popup_pertes_Lt_Lo_Lf {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        width: 900px; /* Set the width of the popup */
        height: 250px; /* Set the height of the popup */
        display: none;
        box-sizing: border-box; /* Include padding in width and height */
        overflow: auto; /* Add scroll if content overflows */
    }

    .popup_risque_incendie {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        width: 900px; /* Set the width of the popup */
        height: 460px; /* Set the height of the popup */
        display: none;
        box-sizing: border-box; /* Include padding in width and height */
        
    }



    
    /* Style for the image */
    .popup_cube_simple img {
    max-width: 100%; /* Make the image responsive */
    height: auto; /* Maintain aspect ratio */
    display: block;
    margin: 0 auto 20px; /* Center the image and add some space below */
    }

    /* Style for the image */
    .popup_cylindre_simple img {
    max-width: 100%; /* Make the image responsive */
    height: auto; /* Maintain aspect ratio */
    display: block;
    margin: 0 auto 20px; /* Center the image and add some space below */
    }

    /* Style for the image */
    .popup_cylindre_edicule img {
    max-width: 100%; /* Make the image responsive */
    height: auto; /* Maintain aspect ratio */
    display: block;
    margin: 0 auto 20px; /* Center the image and add some space below */
    }

    /* Style for the image */
    .popup_cube_edicule img {
    max-width: 100%; /* Make the image responsive */
    height: auto; /* Maintain aspect ratio */
    display: block;
    margin: 0 auto 20px; /* Center the image and add some space below */
    }

    /* Styles for the title */
    .popup-title {
    margin: -20px -20px 20px;
    padding: 10px 20px;
    background-color:#0daa20;
    color: white;
    font-size: 15px;
    text-align: left;

    }

    /* Style for form elements */
    .form-group {
    display: flex;
    margin-bottom: 10px;
    }

    .form-group label {
        flex: 2; /* Allow input to take up more space */
    padding: 5px; /* Add padding for better appearance */
    box-sizing: border-box; /* Ensure padding is included in width */
    width: 100%; /* Fill the remaining width */
    }

    .form-group input {
        flex: 1; /* Take up remaining space */
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 3px;
        max-width: 150px; /* Set maximum width */
        box-sizing: border-box; /* Include padding and border in width */
        font-size: 13px; /* Reduce font size */
        color: blue;

        }


    /* Overlay style */
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255); /* Fully transparent */
        display: none;
        z-index: 999;
        }

        .button-container {
            display: flex;
            gap: 10px;
        }
        .button_exposition {
            margin: 5px;
            padding: 10px;
            background-color: #0daa20;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .button_exposition:hover {
            background-color: #5beb8b;
        }

        .output-results {
            display: flex;
            justify-content: space-between; /* Adjust as per your spacing needs */
            align-items: center;
            margin-top: 10px; /* Adjust spacing between form inputs and output results */
        }

        .output-results label {
            margin-right: 10px; /* Adjust spacing between label and input */

        }

    .center_container_options {

        margin-top:20px;
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #ccc;
        padding: 10px;

    }




    #shapesContainer {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #ccc;
        padding: 10px;
    }


.button_shape  {
        padding: 10px;
        background-color: #000000;
        width:80px;
        color: #fff;
        border-radius: 10px;
        cursor: pointer;
        margin-top:5px;
        margin-bottom:10px;
    }

.button_shape:hover {
        background-color: #656565;
    }

h2#resultat_structure_complexe_Ad {
    display: inline-block; /* Display as inline block to align with buttons */
    vertical-align: middle; /* Align vertically to middle of buttons */
    margin-left: 10px; /* Adjust margin between buttons and result */
    font-size:12px;
    color:red; 
}

h2#resultat_structure_complexe_Am {
    display: inline-block; /* Display as inline block to align with buttons */
    vertical-align: middle; /* Align vertically to middle of buttons */
    margin-left: 10px; /* Adjust margin between buttons and result */
    font-size:12px;
    color:green; 
}


.input-label-complexe {
            display: inline-block;
            margin-right: 10px; /* Adjust margin between label and input */
            text-align: right; /* Align label text to the right */
            font-size:14px
        }

.input-label-complexe {
    display: inline-block;
    margin-right: 10px; /* Adjust margin between label and input */
    text-align: right; /* Align label text to the right */
    font-size:14px
}

.input-label-complexe-bis {
    display: inline-block;
    margin-right: 10px; /* Adjust margin between label and input */
    text-align: right; /* Align label text to the right */
    font-size:14px;
    font-weight: bold; /* Make label text bold */
}

.small-color-input {
    width: 20px;  /* Adjust the width as needed */
    height: 20px; /* Adjust the height as needed */
    padding: 0;
    margin: 0;
  }


#center-container-options {

    display:none;
    max-height: 800px;
    margin: 0 auto; /* Center the container */
    flex-direction: column;
    border: 1px solid #ccc;
    padding: 10px;
    box-sizing: border-box; /* Ensure padding is included in the width */
    margin-top: 10px;
    

}

.center_container_options_b {
    display: flex;
    align-items: center;
    padding:10px;
    

}

.center_container_options_b select, .center_container_options_b input {
    
    padding:5px;
    font-size: 13px;
    box-sizing: border-box; /* Ensure padding is included in the width */

}

.center_container_options_b select {


    padding:5px;
    width:450px;
    color:blue;
    background-color: cornsilk;
    border: 1px solid #ccc; /* Thin border */

}

.center_container_options_b input {
    background-color: cornsilk;
    width: 60px; /* Set a fixed width for the input element */
    padding:5px;
    margin: 10px;
    border: 1px solid #ccc; /* Thin border */
    color:blue;
}

.center_container_options_b_text {
    background-color: cornsilk;
    width: 60px; /* Set a fixed width for the input element */
    padding:5px;
    margin: 10px;
    border: 1px solid #ccc; /* Thin border */
}

.grayed-out-mailles {
    background-color: #e0e0e0; /* Light gray background */
    color: #a0a0a0 !important; /* Gray text color */
    pointer-events: none; /* Disable interactions */
    width: 60px; /* Set a fixed width for the input element */
    padding:5px;
    margin: 10px;
    border: none; /* Remove default border */
    
}

.grayed-out-mailles-KS2 {
    background-color: #e0e0e0; /* Light gray background */
    color: #a0a0a0 !important; /* Gray text color */
    pointer-events: none; /* Disable interactions */
    width: 60px; /* Set a fixed width for the input element */
    padding:1px;

    border: none; /* Remove default border */
    
}

.mailles-KS2 {
    background-color: cornsilk;
    color:blue;
    pointer-events: none; /* Disable interactions */
    width: 60px; /* Set a fixed width for the input element */
    padding:1px;
    border: 1px solid #ccc; /* Thin border */
    
}






.titre_label {

    margin: 10px;
    font-weight: bold;
    font-size:13px;


}

.titre_label_mesures {

margin: 10px;
font-weight: bold;
font-size:14px;
text-align: center;
text-decoration: underline;


}

.titre_label_KS2 {

margin: 10px;
font-weight: bold;
font-size:12px;


}

.titre_label_mailles {

margin: 10px;
font-weight: bold;
font-size:13px;
color: #a0a0a0 !important; /* Gray text color */


}


.titre_label_mailles_KS2 {

font-weight: bold;
font-size:12px;
color: #a0a0a0 !important; /* Gray text color */

}



#facteur_emplacement_label {

margin: 10px;
font-weight: bold;


}


.line_container {

    display:none;
    max-height: 100%;
    margin: 0 auto; /* Center the container */
    flex-direction: column;
    border: 1px solid #ccc;
    padding: 10px;
    box-sizing: border-box; /* Ensure padding is included in the width */
    margin-top: 10px;
    overflow-y: scroll;
    

}

.zone_container {

display:none;
max-height: 100%;
margin: 0 auto; /* Center the container */
flex-direction: column;
border: 1px solid #ccc;
padding: 10px;
box-sizing: border-box; /* Ensure padding is included in the width */
margin-top: 10px;
overflow-y: scroll;


}

.mesures_container {

display:none;
max-height: 100%;
margin: 0 auto; /* Center the container */
flex-direction: column;
border: 1px solid #ccc;
padding: 10px;
box-sizing: border-box; /* Ensure padding is included in the width */
margin-top: 10px;
overflow-y: scroll;




}





.dropdow_menu_line {

display:flex;
max-height: 200px;
flex-direction: row;
margin: 0 auto; /* Center the container */
border: 1px solid #ccc;
padding: 10px;
box-sizing: border-box; /* Ensure padding is included in the width */
margin-top: 10px;
margin-bottom: 10px;

}

.dropdow_menu_risque {

display:flex;
max-height: 200px;
flex-direction: row;
margin: 0 auto; /* Center the container */
border: 1px solid #ccc;
padding: 10px;
box-sizing: border-box; /* Ensure padding is included in the width */
margin-top: 10px;
margin-bottom: 10px;

}

.dropdow_menu_risque_bis {

display:flex;
max-height: 200px;
flex-direction: column;
margin: 0 auto; /* Center the container */
border: 1px solid #ccc;
padding: 10px;
box-sizing: border-box; /* Ensure padding is included in the width */
margin-top: 10px;
margin-bottom: 10px;

}




.line_container_input_data {

display:flex;
flex-direction: column;
margin: 10px;
border: 1px solid #ccc;
padding: 10px;
margin-top: 10px;
margin-bottom: 10px;
box-sizing: border-box; /* Ensure padding is included in the width */

}


.longueur_ligne_container {

display:flex;
flex-direction: column;
margin: 10px;
border: 1px solid #ccc;
padding: 10px;
margin-top: 10px;
margin-bottom: 10px;
box-sizing: border-box; /* Ensure padding is included in the width */



}

.longueur_ligne_container_items {

display:flex;
flex-direction: column;
margin: 10px;
border: 1px solid #ccc;
padding: 10px;
margin-top: 10px;
margin-bottom: 10px;
box-sizing: border-box; /* Ensure padding is included in the width */
align-items: center;


}


.longueur_ligne_container_mesures {

display:flex;
flex-direction: column;
margin: 10px;
border: 1px solid #7b7b7b;
padding: 10px;
margin-top: 10px;
margin-bottom: 10px;
box-sizing: border-box; /* Ensure padding is included in the width */


}


.select_field {

background-color: cornsilk;
color:blue;
width:250px;
border: 1px solid #ccc; /* Thin border */

}


.input_select_lines {

background-color: cornsilk;
color:blue;
width:50px;
border: none; /* Remove default border */
border: 1px solid #ccc; /* Thin border */

}

.input_select_lines_gray_out_zone_ext {

    background-color: #e0e0e0; /* Light gray background */
    color: #a0a0a0 !important; /* Gray text color */
    width:50px;
    border: none; /* Remove default border */
    

}



.label_input_field {
font-size:14px

}

.grayed-out {
    background-color: #e0e0e0; /* Light gray background */
    color: #a0a0a0 !important; /* Gray text color */
    pointer-events: none; /* Disable interactions */
    border: none; /* Remove default border */

    width:250px;
    
}

.grayed-out-label {
    color: #a0a0a0; /* Gray text color */
    font-size:14px
}




.checkbox-container {
    display: flex;
    flex-direction: column;
    font-size:14px;

}


.checkbox-container input[type="checkbox"] {
    accent-color: cornsilk; /* Sets the inside color of the checkbox */
    color: black; /* Sets the text color next to the checkbox */
}

/* Adjust the space between checkbox items */
    .checkbox-item {
    margin: 3px 0; /* Adjust the margin as needed */
    display: flex; /* Ensure checkbox and label are inline */
    align-items: center; /* Align items vertically */
    }

    /* Ensure checkboxes and labels are styled appropriately */
    .checkbox-item input[type="checkbox"] {
    margin-right: 3px; /* Space between checkbox and label */
    }

/*Dropdown menu with checkboxes*/

.dropdown {
    position: relative;
    display: inline-block;
}

 
.dropdown button {

    padding:1px;
    width:350px;
    color:blue;
    background-color: cornsilk;
    border: 1px solid #ccc; /* Thin border */
    font-family: Arial, sans-serif;
    font-size:13px;
    text-align: left;
    position:relative;
    padding-left:5px;
        


    }

    .dropdown button::after {
            content: '';
            position: absolute;
            right: 10px; /* Adjust the position as needed */
            top: 40%;
            transform: translateY(-50%) rotate(45deg); /* Center and rotate the arrow */
            pointer-events: none; /* Prevent arrow from blocking button clicks */
            border: solid blue;
            border-width: 0 1.5px 1.5px 0;
            display: inline-block;
            padding: 3px;
            font-size:10px;


    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: cornsilk;
        width:350px;
        box-shadow: 0px 8px 16px 0px rgba(5, 5, 5, 0.2);
        font-family: Arial, sans-serif;
        z-index: 1;
        font-size:13px;
        color:blue;



    }


    .dropdown-content div:hover {
        background-color: rgb(247, 225, 138);
    }

    .dropdown-content input[type="checkbox"] {
        margin-right: 10px;
        accent-color: cornsilk; /* Sets the inside color of the checkbox */
        color: black; /* Sets the text color next to the checkbox */
    }

    .show {
        display: block;
    }

    .title_result_amp_smp_p {

        color:rgba(1, 138, 6, 0.5);
        font-size:14px;
        text-align: center;
        font-weight: bold;
        padding:10px;
       
    }

    .title_result_amp_smp_np {

        color:rgba(251, 0, 0, 0.5);
        font-size:14px;
        text-align: center;
        font-weight: bold;
        padding:10px;
       
    }

    .title_result_amp_smp_gr {

        color:#c6c5c5;
        font-size:14px;
        text-align: center;
        font-weight: bold;
        padding:10px;


        
    }


    .custom-button-save {
            background-image: url("photos/save.jpg");
            background-size: cover;
            background-position: center;
            width: 40px;
            height: 40px;
            padding:20px;
            
            border: 1px solid #989898;
            cursor: pointer;
    }

    .custom-button-save-as {
            background-image: url("photos/save_as.jpg");
            background-size: cover;
            background-position: center;
            width: 40px;
            height: 40px;
            padding:20px;
            
            border: 1px solid #989898;
            cursor: pointer;
    }

    .custom-button-open {
            background-image: url("photos/open_file_arf.jpg");
            background-size: cover;
            background-position: center;
            width: 40px;
            height: 40px;
            padding:20px;
            
            border: 1px solid #989898;
            cursor: pointer;
    }

    .custom-button-print {
            background-image: url("photos/print_definitions.jpg");
            background-size: cover;
            background-position: center;
            padding:20px;
            width: 40px;
            height: 40px;
            
            border: 1px solid #989898;
            cursor: pointer;
    }

    .custom-button-printD {
            background-image: url("photos/print_definitions.jpg");
            background-size: cover;
            background-position: center;
            padding:20px;
            width: 40px;
            height: 40px;
            
            border: 1px solid #989898;
            cursor: pointer;
    }

    .custom-button-newfile {
            background-image: url("photos/nouveau_fichier.jpg");
            background-size: cover;
            background-position: center;
            padding:20px;
            width: 40px;
            height: 40px;
            
            border: 1px solid #989898;
            cursor: pointer;
    }


    @media print {
            @page {
                margin-left: 1cm;
                margin-right: 1cm;
                margin-top: 1cm;
                margin-bottom: 1cm;
            }
            body {
                margin: 0;
            }
            .page-number:after {
                content: counter(page);
            }
            .page-number {
                position: fixed;
                bottom: 0;
                width: 100%;
                text-align: center;
            }
        }

    .spaced-lines {
        line-height: 1.0; /* Adjust this value to increase or decrease spacing */
    }
    .spaced-lines br {
        display: block;
        margin-top: 0px; /* Adjust this value to increase or decrease spacing */
        margin-bottom: 0px; /* Adjust this value to increase or decrease spacing */
    }

    .disabled-label {
        color: rgb(150, 150, 150);

    }

    .shape-properties1 {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        border: 1px solid #ccc;
        gap: 10px;
        padding:5px;
        margin-bottom:5px;

    }

    .shape-properties1 label {
        width: 100px;
        text-align: right;
        margin-right: 10px;
        font-size:14px;
    }

    .shape-properties1 input[type="number"] {
        width: 50px;
        color:blue;
    }


    .shape-properties1 input[type="color"] {
        width: 20px;
        margin-left: 10px;

    }

    .shape-properties1 button {
        margin-left: 10px;
    }

        
    .shape-properties1 .input-label-complexe-bis-1 {
    display: inline-block;
    text-align: left;
    width: 250px;
    }



    


   

    </style>
</head>
<body>

<div class="main-container">
 
    <div class="left-container">

        <div class="nom_projet_container">

            <button class="custom-button custom-button-newfile" title="Nouveau Fichier" onclick="new_file()"></button>
            <button class="custom-button custom-button-save" title="Enregistrer" onclick="save()"></button>
            <button class="custom-button custom-button-save-as" title="Enregistrer sous" onclick="save_as()"></button>
            <button class="custom-button custom-button-open" title="Ouvrir" onclick="openFile()"></button>
            <button class="custom-button custom-button-print" title="Afficher/Imprimer les résultats" id="print"></button>


        </div>
     
            
            <div class="nom_projet_container">

                <label for="input1" class="dropdown_container_label">Nom du projet</label>
                <!-- Input element for the second pair -->
                           
                <div>
                <input type="text" class="left_input_data" id="nom_projet"  value="Projet N°">
                </div>

            </div>

            <div class="nom_projet_container">

                <label for="input1" class="dropdown_container_label">Nom et prénom du rédacteur</label>
                <!-- Input element for the second pair -->
                           
                <div>
                <input type="text" class="left_input_data" id="nom_redacteur"  value="Nom Prénom">
                </div>

            </div>

            <div class="nom_projet_container">

                <label for="input1" class="dropdown_container_label">Nom de la société</label>
                <!-- Input element for the second pair -->
                           
                <div>
                <input type="text" class="left_input_data" id="nom_societe"  value="Nom de la société">
                </div>

            </div>

            <div class="nom_projet_container">
            <label for="input2" class="dropdown_container_label">Densité de foudroiement (Impacts/an/km<sup>2</sup>)</label>
            <!-- Input element for the second pair -->
            <input type="number" class="left_input_data" id="densite_foudroiement"  value="1.0">
            </div>

            <div class="nom_projet_container">
            <label for="input3" class="dropdown_container_label">Nom du bâtiment</label>
            <!-- Input element for the second pair -->
            <input type="text" class="left_input_data" id="nom_batiment"  value="Bâtiment N°">

            </div>


        <div class="left-bottom-container">
            <button class="button" id="structure">STRUCTURE</button>
            <button class="button" id="services">SERVICES</button>
            <button class="button" id="zones">ZONES</button>
            <button class="button" id="mesures">MESURES DE PROTECTION</button>
        </div>

        <div class="densite_foudroiement_container">
            <label id="input-resulat-smp" class="title_result_amp_smp_gr">Risque R1 sans mesures de protection </label>
            <button class="result_button_gray" id="resultat-R1-smp"></button>

        </div>

        <div class="densite_foudroiement_container">
            <label id="input-resulat-amp" class="title_result_amp_smp_gr">Risque R1 avec mesures de protection </label>
            <button class="result_button_gray" id="resultat-R1-amp"></button>

        </div>

        
    
    </div>
        
    <div class="center-container" id="center-container-id">
        
        <div class="hidden-buttons" id="surface_exposition_button_container">
            <button class="custom-button custom-button-1" title="Structure cubique simple" id="cube_simple"></button>
            <button class="custom-button custom-button-2" title="Structure cubique avec édicule" id="cube_simple_edicule"></button>
            <button class="custom-button custom-button-3" title="Structure cylindrique simple" id="cylindre_simple"></button>
            <button class="custom-button custom-button-4" title="Structure cylindrique avec édicule" id="cylindre_edicule"></button>
            <button class="custom-button custom-button-5" title="Structure complexe" id="forme_complexe"></button>

        </div>
 
    
        <div class="center_container_options" id="center-container-options">

            <div class="longueur_ligne_container">
                <div>
                <label class="titre_label" id="facteur_emplacement_label">Emplacement relatif de la structure (Cd)</label>
                </div>

                <div class="center_container_options_b" id="center-container-options-b">

                    <select id="facteur-emplacement-options">
                        <option value="0.25">Structure entourée d'objets plus hauts</option>
                        <option value="0.5">Structure entourée d'objets de la même hauteur ou plus petits</option>
                        <option value="1">Structure isolée </option>
                        <option value="2">Structure isolé au sommet d'une colline ou sur un monticule</option> 
                    
                    </select>
                    <input id="display-value-emplacement-options" class="option-value-emplacement" type="text" readonly>
                    
                </div>

            </div>

            <div class="longueur_ligne_container">

                <div>
                    <label class="titre_label" id="facteur_emplacement_label_spf">Système de protection contre la foudre SPF (PB)</label>
                </div>
        
                <div class="center_container_options_b" id="center-container-options-b-spf">
        
                    <select id="systeme-spf-options" onclick="">
                        <option value="1">Structure non protégée par SPF</option>
                        <option value="2">SPF niveau IV</option>
                        <option value="3">SPF niveau III</option>
                        <option value="4">SPF niveau II</option>
                        <option value="5">SPF niveau I</option>
                        <option value="6" title="Structure avec dispositif de capture de niveau I et avec armatures en métal continues ou en béton armé agissant comme descentes naturelles">SPF niveau I+</option>
                            
                        <option value="7" title="Structure avec toiture métallique ou avec dispositif de capture,possibilité d'inclure des composants naturels, assurant une protection complète des matériels sur le toit contre les coups de foudre directs et armatures en métal continues ou en béton armé agissant comme descentes naturelles">SPF niveau I++</option>
                        
                    </select>
                    <input class="option-value-emplacement" id="display-value-spf-options"  type="text" readonly>
                        
                </div>




            </div>



            <div class="longueur_ligne_container">

                <div>
                    <label class="titre_label" id="facteur_emplacement_label_ecran_spatial" >Ecran spatial extérieur (KS1)</label>
                </div>
        
                <div class="center_container_options_b" id="center-container-options-b">

                    <select id="systeme-ecran-options" onclick="">
                        <option value="1">Pas d'écran spatial</option>
                        <option value="2">Ecran métallique continu d'une épaisseur 0.1 mm &le;e &lt; 0.5 mm</option>
                        <option value="3">Ecran métallique continu d'une épaisseur e &ge; 0.5 mm</option>
                        <option value="4">Ecran maillé</option>
  
                    </select>

                    <input class="option-value-emplacement" id="display-value-ecran-options"  type="text" readonly>


                        
                </div>


            </div>



            <div class="longueur_ligne_container">


                <div>
                    <label class="titre_label_mailles" id="taille-mailles-label">Taille des mailles de l'écran w(m)</label>
                </div>

                

                    <div>
                        <!-- Input element for the second pair -->
                        <input type="number"  class="grayed-out-mailles" id="taille-mailles-input"  style="color: blue;" value="5.0" step="0.1">
            
                    </div>

               


            </div>   
            
            






        </div>




        <div class="overlay" id="overlay-cube-simple"></div>
    
        <div class="popup_cube_simple" id="popup-cube-simple">
            <div class="popup-title">Surface d'exposition - Structure cubique simple</div>
            <img src="photos/surface_exposition_simple.jpg" alt="Local Image">
            
            <div class="form-group">
                <label for="longueur_cube_simple">Longueur (m):</label>
                <input type="number" id="longueur_cube_simple" value="10">
            </div>
            
            <div class="form-group">
                <label for="largeur_cube_simple">Largeur (m): </label>
                <input type="number" id="largeur_cube_simple" value="10">
            </div>
            
            <div class="form-group">
                <label for="hauteur_cube_simple">Hauteur (m): </label>
                <input type="number" id="hauteur_cube_simple" value="10">
            </div>

            <div class="output-results">
                <label for="resultat_cube_simple_Ad">Ad (m<sup>2</sup>):</label>
                <input type="number" id="resultat_cube_simple_Ad" value="4127.43" readonly>
            </div>
            
            <div class="output-results">
                <label for="resultat_cube_simple_Am">Am (m<sup>2</sup>):</label>
                <input type="number" id="resultat_cube_simple_Am" value="805398.16" readonly>
            </div>
            
            <div>
                <button class="button_exposition" id="validate-popup-btn-cube-simple">Valider</button>
                <button class="button_exposition" id="close-popup-btn-cube-simple">Fermer</button>

            </div>
            
        </div>


        <div class="overlay" id="overlay-cylindre-simple"></div>
    
        <div class="popup_cylindre_simple" id="popup-cylindre-simple">
            <div class="popup-title">Surface d'exposition - Structure cylindrique simple</div>
            <img src="photos/surface_exposition_cylindre_simple.jpg" alt="Local Image">
            
            <div class="form-group">
                <label for="rayon_cylindre_simple">Rayon (m):</label>
                <input type="number" id="rayon_cylindre_simple" value="10">
            </div>
            
            <div class="form-group">
                <label for="hauteur_cylindre_simple">Hauteur (m): </label>
                <input type="number" id="hauteur_cylindre_simple" value="10">
            </div>

            <div class="output-results">
                <label for="resultat_cylindre_simple_Ad">Ad (m<sup>2</sup>):</label>
                <input type="number" id="resultat_cylindre_simple_Ad" value="5026.55" readonly>
            </div>
            
            <div class="output-results">
                <label for="resultat_cylindre_simple_Am">Am (m<sup>2</sup>):</label>
                <input type="number" id="resultat_cylindre_simple_Am" value="817128.25" readonly>
            </div>
            
            <div>
                <button class="button_exposition" id="validate-popup-btn-cylindre-simple">Valider</button>
                <button class="button_exposition" id="close-popup-btn-cylindre-simple">Fermer</button>

            </div>
            
        </div>


        <div class="overlay" id="overlay-cylindre-edicule"></div>
    
        <div class="popup_cylindre_edicule" id="popup-cylindre-edicule">
            <div class="popup-title">Surface d'exposition - Structure cylindrique avec édicule</div>
            <img src="photos/surface_exposition_cylindre_edicule.jpg" alt="Local Image">
            
            <div class="form-group">
                <label for="rayon_cylindre_edicule">Rayon (m):</label>
                <input type="number" id="rayon_cylindre_edicule" value="10">
            </div>
            
            <div class="form-group">
                <label for="hauteur_min_cylindre_edicule">Hauteur min (m): </label>
                <input type="number" id="hauteur_min_cylindre_edicule" value="10">
            </div>

            <div class="form-group">
                <label for="hauteur_max_cylindre_edicule">Hauteur max (m): </label>
                <input type="number" id="hauteur_max_cylindre_edicule" value="15">
            </div>            

            <div class="output-results">
                <label for="resultat_cylindre_edicule_Ad">Ad (m<sup>2</sup>):</label>
                <input type="number" id="resultat_cylindre_edicule_Ad" value="5026.55" readonly>
            </div>
            
            <div class="output-results">
                <label for="resultat_cylindre_edicule_Am">Am (m<sup>2</sup>):</label>
                <input type="number" id="resultat_cylindre_edicule_Am" value="817128.25" readonly>
            </div>
            
            <div>
                <button class="button_exposition" id="validate-popup-btn-cylindre-edicule">Valider</button>
                <button class="button_exposition" id="close-popup-btn-cylindre-edicule">Fermer</button>

            </div>
            
        </div>




        <div class="overlay" id="overlay-cube-edicule"></div>
    
        <div class="popup_cube_edicule" id="popup-cube-edicule">
            <div class="popup-title">Surface d'exposition - Structure cubique avec édicule</div>
            <img src="photos/surface_exposition_cube_edicule.jpg" alt="Local Image">
            
            <div class="form-group">
                <label for="longueur_cube_edicule">Longueur (m):</label>
                <input type="number" id="longueur_cube_edicule" value="10">
            </div>
            
            <div class="form-group">
                <label for="largeur_cube_edicule">Largeur (m): </label>
                <input type="number" id="largeur_cube_edicule" value="10">
            </div>
            
            <div class="form-group">
                <label for="hauteur_cube_edicule">Hauteur min (m): </label>
                <input type="number" id="hauteur_min_cube_edicule" value="10">
            </div>

            <div class="form-group">
                <label for="hauteur_cube_edicule">Hauteur max (m): </label>
                <input type="number" id="hauteur_max_cube_edicule" value="15">
            </div>

            <div class="output-results">
                <label for="resultat_cube_edicule_Ad">Ad (m<sup>2</sup>):</label>
                <input type="number" id="resultat_cube_edicule_Ad" value="6361.72" readonly>
            </div>
            
            <div class="output-results">
                <label for="resultat_cube_edicule_Am">Am (m<sup>2</sup>):</label>
                <input type="number" id="resultat_cube_edicule_Am" value="805398.16" readonly>
            </div>
            
            <div>
                <button class="button_exposition" id="validate-popup-btn-cube-edicule">Valider</button>
                <button class="button_exposition" id="close-popup-btn-cube-edicule">Fermer</button>

            </div>
            
        </div>



        <div class="overlay" id="overlay-structure-complexe"></div>
        <div class="popup_structure_complexe" id="popup-structure-complexe">
            <div class="popup-title">Surface d'exposition - Structure complexe</div>

            <canvas id="canvas_structure_complexe"></canvas>

            <div id="form-group-structure-complexe">
                <div>
                    <button class="button_shape" title="Créer une structure cubique" onclick="addRectangle()">Cube</button>
                    <button class="button_shape" title="Créer une structure cylindrique" onclick="addCircle()">Cylindre</button>
                    <h2 id="resultat_structure_complexe_Ad"></h2>
                    <h2 id="resultat_structure_complexe_Am"></h2>

                </div>
                <div id="shapesContainer">
                    <div id="rectangles"></div>
                </div>
            </div>
       
          
            <button class="button_exposition" id="validate-popup-btn-structure-complexe">Valider</button>
            <button class="button_exposition" id="close-popup-btn-structure-complexe">Fermer</button>
        </div>



        


    
    
    
        <div class="line_container" id="line-container">

            <div class="dropdow_menu_line" id="dropdow-menu-line">

                <button class="custom-button_item-add" id="add-line-btn" title="Ajouter une ligne" ></button>
                <label for="dropdown-menu-line"></label>
                <select id="dropdown-menu-line">

                    <option>Ligne N° 1</option>

                <!-- Initial options will be added dynamically -->
                </select>
                <button class="custom-button_item-remove" id="delete-item-btn-line" title="Supprimer la ligne" onclick="removeline()" ></button>
                <button class="custom-button_item-rename" id="rename-item-btn-line" title="Renommer la ligne" onclick="renameline()" ></button>

            </div>

 
            <div class="longueur_ligne_container">

                <div>
                    <label for="longueur-ligne" class="label_input_field">Longueur de la ligne (m)</label>
                </div>

                <div>
                    <!-- Input element for the second pair -->
                    <input type="number" class="select_field" id="longueur-ligne" style="color: blue;" value="1000.0">
        
                </div>

            </div>

 
            <div class="longueur_ligne_container">

                <div>
                    <label id="type_environnement" class="label_input_field">Type d'environnement de la ligne (Ce)</label>
                </div>

                <div>
                
                    <select class="select_field" id="environnement-ligne" onclick="">

                        <option value="0.01">Urbain avec bâtiments de grande hauteur</option>
                        <option value="0.1">Urbain</option>
                        <option value="0.5">Suburbain</option>
                        <option value="1.0">Rural</option>
                
                    </select>

                    <input id="display-value-environnement-ligne" class="input_select_lines" type="text" readonly>

                </div>

            </div>


            <div class="longueur_ligne_container">

                <div>
                    <label id="facteur_installation" class="label_input_field">Facteur d'installation (Ci)</label>
                </div>

                <div>
                
                    <select class="select_field" id="facteur-installation-ligne" onclick="">

                        <option value="1.0">Aérien</option>
                        <option value="0.5">Enterré</option>
                        <option value="0.01">Câbles enterrés entièrement posés dans un réseau maillé de terre</option>

                
                    </select>

                    
                    <input id="display-value-installation-ligne" class="input_select_lines" type="text" readonly>

                </div>

            </div>


            <div class="longueur_ligne_container">

                <div>
                    <label id="facteur_tranformateur" class="label_input_field">Facteur de transformateur (Ct)</label>
                </div>

                <div>
                
                    <select class="select_field" id="facteur-transformateur" onclick="">

                        <option value="0.2">Service de puissance HT (avec transformateur HT/BT)</option>
                        <option value="1.0">Service de puissance BT, de communication ou de transmission de données</option>

                
                    </select>

                    
                    <input id="display-value-facteur-transformateur" class="input_select_lines" type="text" readonly>

                </div>

            </div>


            <div class="longueur_ligne_container">

                <div>
                    <label id="dimensions_batiment_autre_extremite" class="label_input_field">Dimensions de la structure à l'autre extrémité de la ligne</label>
                </div>

                <div>

                    <label id="longueur_batiment_autre_extremite" class="label_input_field">Longueur (m)</label>

                    <input type="number" id="display-value-longueur-batiment" class="input_select_lines" style="color: blue;" value="10.0">

                    <label id="largeur_batiment_autre_extremite" class="label_input_field">Largeur (m)</label>

                    <input type="number" id="display-value-largeur-batiment" class="input_select_lines" style="color: blue;" value="10.0">

                    <label id="hauteur_batiment_autre_extremite" class="label_input_field">Hauteur (m)</label>

                    <input type="number" id="display-value-hauteur-batiment" class="input_select_lines" style="color: blue;" value="10.0">


                </div>

            </div>



            <div class="longueur_ligne_container">

                <div>
                    <label id="emplacement_relatif_extremite" class="label_input_field">Emplacement relatif de la structure à l'autre extrémité de la ligne (Cda)</label>
                </div>

                <div>
                
                    <select class="select_field" id="emplacement-relatif-extremite" onclick="">

                        <option value="0.25">Structure entourée d'objets plus hauts</option>
                        <option value="0.5">Structure entourée d'objets de la même hauteur ou plus petits</option>
                        <option value="1">Structure isolée </option>
                        <option value="2">Structure isolé au sommet d'une colline ou sur un monticule</option> 

                
                    </select>

                    
                    <input id="display-value-facteur-emplacement-extremite" class="input_select_lines" type="text" readonly>

                </div>

            </div>









            <div class="longueur_ligne_container">

                <div>
                    <label id="parafoudres_coordonnes" class="label_input_field">Parafoudres coordonnés (P PARAFOUDRE)</label>
                </div>

                <div>
                
                    <select class="select_field" id="parafoudres-coordonnes_select" onclick="">

                        <option value="1.00">Pas de parafoudres coordonnés</option>
                        <option value="0.05">Niveau de protection III-IV</option>
                        <option value="0.02">Niveau de protection II</option>
                        <option value="0.01">Niveau de protection I</option>
                        <option value="0.005" title="Parafoudres présentant des caractéristiques supérieures à celles d'un niveau de protection I">Niveau de protection I+</option>
                        <option value="0.001" title="Parafoudres présentant des caractéristiques supérieures à celles d'un niveau de protection I">Niveau de protection I++</option>
                
                    </select>

                    
                    <input id="display-value-pspd" class="input_select_lines" type="text" readonly>

                </div>

            </div>


            <div class="longueur_ligne_container">

                <div>
                    <label id="parafoudres_equipotentialite" class="label_input_field">Parafoudres d'équipotentialité (PEB)</label>
                </div>

                <div>
                
                    <select class="select_field" id="parafoudres-equipotentialite_select" onclick="">

                        <option value="1.00">Pas de parafoudres d'équipotentialité</option>
                        <option value="0.05">Niveau de protection III-IV</option>
                        <option value="0.02">Niveau de protection II</option>
                        <option value="0.01">Niveau de protection I</option>
                        <option value="0.005" title="Parafoudres présentant des caractéristiques supérieures à celles d'un niveau de protection I">Niveau de protection I+</option>
                        <option value="0.001" title="Parafoudres présentant des caractéristiques supérieures à celles d'un niveau de protection I">Niveau de protection I++</option>
                
                    </select>

                    
                    <input id="display-value-equipotentialite" class="input_select_lines" type="text" readonly>

                </div>

            </div>


            <div class="longueur_ligne_container">

                <div>
                    <label id="type_cablage_interne" class="label_input_field">Type de câblage interne (KS3)</label>
                </div>

                <div>
                
                    <select class="select_field" id="type-cablage-interne-select" onclick="">

                        <option value="1.0">Câble non blindé - Pas de préccaution de cheminement afin d'éviter des boucles</option>
                        <option value="0.2">Câble non blindé - Préccaution de cheminement afin d'éviter des boucles de grande taille</option>
                        <option value="0.01">Câble non blindé - Préccaution de cheminement afin d'éviter des boucles</option>
                        <option value="0.0001" title="à condition que les blindages et les conduits métalliques soient reliés à une borne d'équipotentialité à ses deux 
                        extrémités, et que le matériel soit connecté à la même borne d'équipotentialité">Câbles blindés et câbles cheminant dans des conduits métalliques</option>

                
                    </select>

                    
                    <input id="display-value-ks3" class="input_select_lines" type="text" readonly>

                </div>

            </div>

            <div class="longueur_ligne_container">

                <div>
                    <label id="interfaces_isolement" class="label_input_field">Interface d'isolement (PMS)</label>
                </div>

                <div>
                
                    <select class="select_field" id="interfaces_isolement_select" onclick="">

                        <option value="1.00">Matériels non équipés d'interfaces d'isolement (transformateurs d'isolement, fibre optiques, optocoupleurs, etc.)</option>
                        <option value="0.00">Matériels équipés d'interfaces d'isolement (transformateurs d'isolement, fibre optiques, optocoupleurs, etc.)</option>

                
                    </select>

                    
                    <input id="display-value-interfaces-isolement" class="input_select_lines" type="text" readonly>

                </div>

            </div>




            <div class="longueur_ligne_container">

                <div>
                    <label id="tension_assignee_chocs" class="label_input_field">Tension assignée aux chocs de foudre du matériel (KS4)</label>
                </div>

                <div>
                
                    <select class="select_field" id="tension-assignee-chocs" onclick="">

                        <option value="1.0">Uw=1.0 kV</option>
                        <option value="1.5">Uw=1.5 kV</option>
                        <option value="2.5">Uw=2.5 kV</option>
                        <option value="4.0">Uw=4.0 kV</option>
                        <option value="6.0">Uw=6.0 kV</option>
                
                    </select>

                    <input id="display-value-uw" class="input_select_lines" type="text" readonly>




                </div>

            </div>
            

            <div class="longueur_ligne_container">

                <div>
                    <label id="resistance_ecran" class="label_input_field">Type de câblage externe (PLD)</label>
                </div>

                <div>
                
                    <select class="select_field" id="resistance-ecran-pld" onclick="">

                        <option value="1">Service aérien ou enterré, non blindé ou blindé, dont le 
                            blindage n’est pas relié à la borne d’équipotentialité à 
                            laquelle le matériel est connecté</option>
                         <option value="2">Service aérien ou enterré blindé - Blindage relié à la borne d'équipotentialité - Blindage d'une résistance Rs &gt; 20 Ω/km</option>
                        <option value="3">Service aérien ou enterré blindé - Blindage relié à la borne d'équipotentialité - Blindage d'une résistance 5 &lt;Rs &le; 20 Ω/km</option>
                        <option value="4">Service aérien ou enterré blindé - Blindage relié à la borne d'équipotentialité - Blindage d'une résistance 1 &lt; Rs &le; 5 Ω/km</option>
                        <option value="5">Service aérien ou enterré blindé - Blindage relié à la borne d'équipotentialité - Blindage d'une résistance Rs &le; 1 Ω/km</option>
                
                    </select>
                    <label id="resistance_ecran_pld" class="label_input_field">PLD</label>
                    <input id="display-value-pld" class="input_select_lines" type="text" readonly>


                </div>

            </div>

            <div class="longueur_ligne_container">

                <div>
                    <label id="resistance_ecran" class="label_input_field">Type de câblage externe (PLI)</label>
                </div>

                <div>
                
                    <select class="select_field" id="resistance-ecran-pli" onclick="">

                        <option value="1">Service de puissance</option>
                         <option value="2">Service de communication</option>
                
                    </select>
                    <label id="resistance_ecran_pli" class="label_input_field">PLI</label>
                    <input id="display-value-pli" class="input_select_lines" type="text" readonly>


                </div>

            </div>

            <div class="longueur_ligne_container">

                <div>
                    <label id="conditions_blindage" class="label_input_field">Facteurs associés aux conditions de blindage, de mise à la terre et d'isolation (CLD/CLI)</label>
                </div>

                <div>
                
                    <select class="select_field" id="conditions-blindage-cld-cli" onclick="">

                        <option value="1">Service aérien non blindé - Connexion à l'entrée non définie</option>
                        <option value="2">Service enterré non blindé - Connexion à l'entrée non définie</option>
                        <option value="3">Service de puissance à neutre mis 
                            à la terre en plusieurs 
                            emplacements - Service non connecté à l'entrée</option>
                        <option value="4">Service enterré blindé (de 
                            puissance ou de communication) - Blindage non relié à la borne d’équipotentialité à 
                            laquelle le matériel est connecté</option>

                        <option value="5">Service aérien blindé (de 
                            puissance ou de communication) - Blindage non relié à la borne d’équipotentialité à 
                            laquelle le matériel est connecté</option>
                            
                        <option value="6">Service enterré blindé (de 
                            puissance ou de communication) - Blindage relié à la borne d’équipotentialité à laquelle le 
                            matériel est connecté</option>
                        <option value="7">Service aérien blindé (de 
                            puissance ou de communication) - Blindage relié à la borne d’équipotentialité à laquelle le 
                            matériel est connecté</option>
                        <option value="8">Câble de protection contre la 
                            foudre ou câblage dans les 
                            conduits ou canalisations 
                            métalliques de câble de protection 
                            contre la foudre - Blindage relié à la borne d’équipotentialité à laquelle le 
                            matériel est connecté</option>
                        <option value="9">Pas de service extérieur - Pas de connexion aux services extérieurs (réseaux 
                            autonomes)</option>
                        <option value="10">Tout type de service - Interface d’isolement selon la norme NF EN 62305-4</option>

 
                    </select>
                    <label id="conditions_blindage_cld" class="label_input_field">CLD</label>
                    <input id="display-value-cld" class="input_select_lines" type="text" readonly>

                    <label id="conditions_blindage_cli" class="label_input_field">CLI</label>
                    <input id="display-value-cli" class="input_select_lines" type="text" readonly>


                </div>

            </div>



          




        </div>



        <!--zone container-->
        <div class="zone_container" id="zone-container">


            <div class="dropdow_menu_line" id="dropdow-menu-zone">

                <button class="custom-button_item-add" id="add-zone-btn" title="Ajouter une zone" ></button>
                <label for="dropdown-menu-zone"></label>
                <select id="dropdown-menu-zone">

                    <option>Zone N° 1</option>

                <!-- Initial options will be added dynamically -->
                </select>
                <button class="custom-button_item-remove" id="delete-zone-btn" title="Supprimer la zone" onclick="removezone()" ></button>
                <button class="custom-button_item-rename" id="rename-zone-btn" title="Renommer la zone" onclick="renamezone()" ></button>

            </div>
        

            <div class="longueur_ligne_container">

                <div>
                    <label id="perte_contact_pas_int" class="label_input_field">Pertes dues aux tensions de contact et de pas (Lt)</label>
                </div>

                <div>
                
                    <select class="select_field" id="perte-contact-pas-int" onclick="">

                        <option value="1">Valeur typique</option>
                        <option value="2">Autre</option>

                
                    </select>

                    
                    <input id="display-value-perte-contact-pas-int" class="input_select_lines" type="text" readonly>

                </div>

            </div>


            <!--pertes dues aux dommages physiques -->
            <div class="longueur_ligne_container">

                <div>
                    <label id="perte_dommages_physiques" class="label_input_field">Pertes dues aux dommages physiques (Lf)</label>
                </div>

                <div>
                
                    <select class="select_field" id="perte-dommages-physiques" onclick="">

                        <option value="1">Valeur typique pour hôpital, hôtel, école, bâtiment civil 10⁻¹</option>
                        <option value="2">Valeur typique pour bâtiment industriel ou commercial 2×10⁻²</option>
                        <option value="3">Valeur typique pour bâtiment publique de loisir, église, musée 5×10⁻²</option>
                        <option value="4">Valeur typique pour bâtiments autres 10⁻²</sup></option>
                        <option value="5">Autre</option>
                
                    </select>

                    
                    <input id="display-value-dommages-physiques-int" class="input_select_lines" type="text" readonly>

                </div>

            </div>



            <!--pertes dues à la défaillance d'équipements -->
            <div class="longueur_ligne_container">

                <div>
                    <label id="perte_defaillance_equipements" class="label_input_field">Pertes dues à la défaillance d'équipements (Lo)</label>
                </div>

                <div>
                
                    <select class="select_field" id="perte-defaillance-equipements" onclick="">

                        <option value="1">Aucune</option>
                        <option value="2">Valeur typique pour structure à risque d'explosion 10⁻¹</option>
                        <option value="3">Valeur typique pour unité de soins intensifs et bloc opératoire d'hôpital 10⁻²</sup></option>
                        <option value="4">Valeur typique pour autres parties d'hôpitaux 10⁻³</option>
                        <option value="5">Autre</option>
                
                    </select>

                    
                    <input id="display-value-defaillance-equipements" class="input_select_lines" type="text" readonly>

                </div>

            </div>


            <div class="longueur_ligne_container">

                <div>

                    <label id="nombre_personnes_nz" class="label_input_field">Nombre de personnes dans la zone</label>
    
                    <input type="number" id="display-value-nz" class="input_select_lines" style="color: blue;" value="10.0">
    
                    <label id="duree_tz" class="label_input_field"> Durée annuelle en heures de présence des personnes dans la zone</label>
    
                    <input type="number" id="display-value-tz" class="input_select_lines" style="color: blue;" value="8760.0">
    
    
                </div>
    

            </div>



            <!--Type de danger particulier -->
            <div class="longueur_ligne_container">

                <div>
                    <label id="type_danger_particulier" class="label_input_field">Type de danger particulier (hz)</label>
                </div>

                <div>
                
                    <select class="select_field" id="type_danger_particulier_hz" onclick="">

                        <option value="1">Pas de danger particulier</option>
                        <option value="2" title="par exemple, structure limitée à deux étages et nombre de personnes 
                        inférieur à 100">Faible niveau de panique</option>
                        <option value="3" title="par exemple, structures destinées à des événements culturels ou sportifs 
                        avec un nombre de personnes compris entre 100 et 1 000">Niveau de panique moyen</option>
                        <option value="4" title="par exemple, structures avec personnes immobilisées, hôpitaux">Difficulté d'évacuation</sup></option>
                        <option value="5" title="par exemple, structures destinées à des événements culturels ou sportifs 
                        avec un nombre de personnes supérieur à 1 000">Niveau de panique élevé</option>
               
                    </select>

                    
                    <input id="display-value-type-danger-particulier" class="input_select_lines" type="text" readonly>

                </div>

            </div>

            <!--Facteur de réduction du risque incendie -->
            <div class="longueur_ligne_container">

                <div>
                    <label id="reduction_risque_incendie" class="label_input_field">Facteur de réduction du risque incendie (rf)</label>
                </div>

                <div>
                
                    <select class="select_field" id="type_risque_incendie" onclick="">

                        <option value="1">Aucun</option>
                        <option value="2">Faible</option>
                        <option value="3">Ordinaire</option>
                        <option value="4">Elevé</sup></option>
                        <option value="5">Explosion - Zones ATEX 2, 22</option>
                        <option value="6">Explosion - Zones ATEX 1, 21</option>
                        <option value="7">Explosion - Zones ATEX 0, 20</option>
                        <option value="8">Valeur affinée</option>


                
                    </select>
                    
                    <input id="display-value-reduction-risque-incendie" class="input_select_lines" type="text" readonly>
                    <button id="calcul-charge-calorifique" title="Valeur affinée">...</button>

                </div>

            </div>

            <!--Précautions prises contre le risque incendie -->
            <div class="longueur_ligne_container">

                <div>
                    <label id="precaution-risque-incendie" class="label_input_field">Précautions prises contre le risque incencie (rp)</label>
                </div>

                <div>
                
                    <select class="select_field" id="precaution_risque_incendie" onclick="">

                        <option value="1">Pas de disposition</option>
                        <option value="2">Une des dispositions suivantes:extincteurs,installations d'extinction fixes déclenchées manuellement, installations manuelles d'alarme, prises d'eau, compartiments étanches, voies d'évacuation protégées</option>
                        <option value="3" title="Seulement si elles sont protégées contre les surtensions ou d'autres dommages et si le temps d’intervention des 
                        pompiers est inférieur à 10 min">Une des dispositions suivantes:installations d'extinction fixes déclenchées automatiquement, installations d'alarme automatiques</option>
                
                    </select>

                    
                    <input id="display-value-precaution-risque-incendie" class="input_select_lines" type="text" readonly>

                </div>

            </div>


            <div class="longueur_ligne_container">

                <form id="computationFormLFE" class="spaced-lines">

                <div class="checkbox-container">

                    <label id="labelincludeOptionPertes" class="label_input_field">
                        <input type="checkbox" id="includeOptionPertes" class="label_input_field">
                        Inclure les pertes pour l'environnement (LFE)
                    </label>

                    <br>

                    <label  id="labelincludeOptionNoteINERIS" class="disabled-label">
                        <input type="checkbox" id="includeOptionNoteINERIS" class="disabled-label">
                        Inclure les coefficients rp, rf et l'efficacité du système de détection d'orages (PTWS) pour le calcul des pertes LFE [Note INERIS 2015]
                    </label>  
    
                </div>

                <br>

                <div>

                    <label id="pertes_lfe" class="grayed-out-label"> Pourcentage moyen de victimes blessées par dommages physiques à l’extérieur de la structure (%)</label>
                    <br>
                    <input id="display-value-lfe" class="grayed-out" style="color: blue;" value="10.0">
        
                </div>

                <br>

                <div>

   
                    <label id="te_lfe" class="grayed-out-label"> Durée annuelle en heures de présence des personnes à l’extérieur de la structure</label>
                    <br>
                    <input id="display-te-lfe" class="grayed-out" style="color: blue;" value="8760.0">
        
                </div>

                <br>

                <div>
  
                    <label id="ptws_lfe" class="grayed-out-label">Efficacité du système de détection d'orage s'il existe (PTWS) (%)</label>

                </div>

                <div>
    
                    <input id="display-ptws-lfe" class="grayed-out" style="color: blue;" value="0.0">
        
                </div>


                </form>


    

            </div>

            <!--facteur de réduction dues au type de sol ou de plancher -->
            <div class="longueur_ligne_container">

                <div>
                    <label id="facteur_reduction_sol" class="label_input_field">Facteur de réduction dû au type de sol ou de plancher (rt)</label>
                </div>

                <div>
                
                    <select class="select_field" id="facteur-reduction-sol" onclick="">

                        <option value="1">Sol agricole, béton - Résistance de contact &le; 1 kΩ</option>
                        <option value="2">Sol en marbre, céramique - Résistance de contact 1-10 kΩ</option>
                        <option value="3">Sol en gravier, moquette, tapis - Résistance de contact 10-100 kΩ</option>
                        <option value="4">Sol en asphalte, linoléum, bois - Résistance de contact &ge;100 kΩ</option>
                
                    </select>

                    
                    <input id="display-value-facteur-reduction-sol" class="input_select_lines" type="text" readonly>

                </div>

            </div>

            <div class="longueur_ligne_container">

                <div>
                    <label class="label_input_field" id="facteur_emplacement_label_ecran_spatial" >Ecran spatial extérieur (KS2)</label>
                </div>
        
                <div class="label_input_field" id="blindage-interne-KS2">

                    <select class="select_field" id="systeme-ecran-interne" onclick="">
                        <option value="1">Pas de blindage spatial</option>
                        <option value="2">Blindage métallique continu d'une épaisseur e &ge; 0.1 mm</option>
                        <option value="3">Blindage métallique continu d'une épaisseur e &lt; 0.1 mm</option>
                        <option value="4">Ecran maillé</option>

  
                    </select>

                    <input class="input_select_lines" id="display-value-ecra-interne-options"  type="text" readonly>


                        
                </div>


            </div>

            <div class="longueur_ligne_container">


                <div>
                    <label class="titre_label_mailles_KS2" id="taille-mailles-label-KS2">Taille des mailles de l'écran w(m)</label>
                </div>

                

                    <div>
                        <!-- Input element for the second pair -->
                        <input type="number"  class="grayed-out-mailles-KS2" id="taille-mailles-KS2-input"  style="color: blue;" value="5.00" step="0.1">
            
                    </div>

            


            </div>   
            



            <div class="overlay" id="overlay-risque-incendie"></div>
            <div class="popup_risque_incendie" id="popup-risque-incendie">
                <div class="popup-title">Calcul de la charge calorifique </div>

                <div class="dropdow_menu_risque_bis">
                
                <div class="form-group">
                    <label for="surface_zone">Surface de la zone (m<sup>2</sup>):</label>
                    <input class="input_select_lines" type="text" id="surface_zone" value="10.0">
                </div>

                </div>


                <div class="dropdow_menu_risque" id="dropdow-menu-risque">

                    <button class="button-risque"  id="add-risque-btn" title="Ajouter un produit" >Ajouter un produit</button>
                    <label for="dropdown-menu-risque"></label>
                    <select id="dropdown-menu-risque">
    
                        <option>Produit N° 1</option>
    
                    <!-- Initial options will be added dynamically -->
                    </select>
                    <button class="button-risque" id="delete-risque-btn" title="Supprimer le produit" onclick="removeproduit()" >Supprimer le produit</button>
                    <button class="button-risque" id="rename-risque-btn" title="Renommer le produit" onclick="renameproduit()" >Renommer le produit</button>
    
                </div>


                <div class="dropdow_menu_risque_bis">


                <div class="form-group">
                    <label for="potentiel_zone">Potentiel Calorifique du produit (MJ/kg):</label>
                    <input class="input_select_lines" type="text" id="potentiel_zone" value="0">
                </div>

                <div class="form-group">
                    <label for="quantite_zone">Quantité du produit (kg):</label>
                    <input class="input_select_lines" type="text" id="quantite_zone" value="0">
                </div>


                </div>

                <div class="dropdow_menu_risque_bis">
                <div class="form-group">
                    <label for="charge_zone">Charge calorifique (MJ/m<sup>2</sup>):</label>
                    <input type="text" readonly id="charge_zone" value="0" >
                </div>

                </div>

                
   
                 <div>
                    <button class="button_exposition" id="validate-popup-btn-risque-incendie">Valider</button>
                    <button class="button_exposition" id="close-popup-btn-risque-incendie">Fermer</button>
    
                </div>
                
            </div>




            <!--Mesures de protection contre les tensions de toucher et de pas  -->
            <div class="longueur_ligne_container">

                <div>
                    <label id="facteur_mesures_pa" class="label_input_field">Mesures de protection contre les tensions de toucher et de pas - Impacts sur la structure (PA)</label>
                </div>

                <div class="dropdown">
                    <button onclick="toggleDropdown()">Selectionner une ou plusieurs mesures</button>
                    <div id="dropdownContent" class="dropdown-content">
                        <div>
                            <input type="checkbox" id="option1" name="option1" value="1">
                            <label for="option1">Pas de mesures de protection</label>
                        </div>
                        <div>
                            <input type="checkbox" id="option2" name="option2" value="2">
                            <label for="option2">Isolation électrique du conducteur exposé</label>
                        </div>
                        <div>
                            <input type="checkbox" id="option3" name="option3" value="3">
                            <label for="option3">Sol équipotentiel efficace</label>
                        </div>
                        <div>
                            <input type="checkbox" id="option4" name="option4" value="4">
                            <label for="option4">Plaques d'avertissement</label>
                        </div>
                
                        <div>
                            <input type="checkbox" id="option5" name="option4" value="5">
                            <label for="option5">Restrictions physiques</label>
                        </div>
                
                        <div>
                            <input type="checkbox" id="option6" name="option4" value="6">
                            <label for="option6">Armatures utilisées comme conducteur de descente</label>
                        </div>
                    </div>


                    <input class="input_select_lines" id="display-value-pa-options"  type="text" readonly>

                </div>

                

            </div>

                       <!--Mesures de protection contre les tensions de toucher et de pas  -->
            <div class="longueur_ligne_container">

                <div>
                    <label id="facteur_mesures_ptu" class="label_input_field">Mesures de protection contre les tensions de toucher et de pas - Impacts sur le service (PTU)</label>
                </div>

                <div class="dropdown">
                    <button onclick="toggleDropdownptu()">Selectionner une ou plusieurs mesures</button>
                    <div id="dropdownContentptu" class="dropdown-content">
                        <div>
                            <input type="checkbox" id="optionptu1" name="option1" value="1">
                            <label for="optionptu1">Pas de mesures de protection</label>
                        </div>
                        <div>
                            <input type="checkbox" id="optionptu2" name="option2" value="2">
                            <label for="optionptu2">Notices d'avertissement</label>
                        </div>
                        <div>
                            <input type="checkbox" id="optionptu3" name="option3" value="3">
                            <label for="optionptu3">Isolation électrique</label>
                        </div>
                        <div>
                            <input type="checkbox" id="optionptu4" name="option4" value="4">
                            <label for="optionptu4">Restrictions physiques</label>
                        </div>
                
  
                    </div>


                    <input class="input_select_lines" id="display-value-ptu-options"  type="text" readonly>

                </div>

                

            </div>







            <div class="longueur_ligne_container">


                <div class="checkbox-container" id="checkbox-container">
                    <label id="comment-line" class="label_input_field">Selectionner les services rattachées à la zone</label>
                    <!-- Checkboxes will be added here dynamically -->
                </div>

                <div id="selected-data-container"></div>


            </div>





        </div>


        <div class="mesures_container" id="mesures-container">

            <div class="longueur_ligne_container_mesures">

                <div>
                    <label class="titre_label_mesures" id="facteur_emplacement_label_spf">STRUCTURE</label>
                </div>


                <div class="longueur_ligne_container">

                    <div>
                        <label class="label_input_field" id="facteur_emplacement_label_spf_mesures">Système de protection contre la foudre SPF (PB)</label>
                    </div>
            
                    <div class="label_input_field" id="center-container-options-b-spf-mesures">
            
                        <select class="select_field" id="systeme-spf-options-mesures" onclick="">
                            <option value="1">Structure non protégée par SPF</option>
                            <option value="2">SPF niveau IV</option>
                            <option value="3">SPF niveau III</option>
                            <option value="4">SPF niveau II</option>
                            <option value="5">SPF niveau I</option>
                            <option value="6" title="Structure avec dispositif de capture de niveau I et avec armatures en métal continues ou en béton armé agissant comme descentes naturelles">SPF niveau I+</option>
                            <option value="7" title="Structure avec toiture métallique ou avec dispositif de capture,possibilité d'inclure des composants naturels, assurant une protection complète des matériels sur le toit contre les coups de foudre directs et armatures en métal continues ou en béton armé agissant comme descentes naturelles">SPF niveau I++</option>
                            
                        </select>

                        <input class="input_select_lines" id="display-value-spf-options-mesures"  type="text" readonly>
                            
                    </div>


                </div>


                <div class="longueur_ligne_container">

                    <div>
                        <label class="label_input_field" id="facteur_emplacement_label_ecran_spatial-mesures" >Ecran spatial extérieur (KS1)</label>
                    </div>
            
                    <div class="label_input_field" id="center-container-options-b-mesures">

                        <select class="select_field" id="systeme-ecran-options-mesures" onclick="">
                            <option value="1">Pas d'écran spatial</option>
                            <option value="2">Ecran métallique continu d'une épaisseur 0.1 mm &le;e &lt; 0.5 mm</option>
                            <option value="3">Ecran métallique continu d'une épaisseur e &ge; 0.5 mm</option>
                            <option value="4">Ecran maillé</option>
    
                        </select>

                        <input class="input_select_lines" id="display-value-ecran-options-mesures"  type="text" readonly>


                            
                    </div>


                </div>

                <div class="longueur_ligne_container">


                    <div>
                        <label class="titre_label_mailles_KS2" id="taille-mailles-label-mesures">Taille des mailles de l'écran w(m)</label>
                    </div>

                    

                        <div>
                            <!-- Input element for the second pair -->
                            <input type="number"  class="grayed-out-mailles-KS2" id="taille-mailles-input-mesures"  style="color: blue;" value="5.0" step="0.1">
                
                        </div>

                


                </div>  

            </div>

            <div class="longueur_ligne_container_mesures">

                <div>
                    <label class="titre_label_mesures" id="facteur_emplacement_label_spf">SERVICES</label>
                </div>



                <div class="longueur_ligne_container_items" id="dropdow-menu-line-mesures">
                


                    <label for="dropdown-menu-mesures"></label>
                    <select id="dropdown-menu-mesures">

                        <option> </option>

                    <!-- Initial options will be added dynamically -->
                    </select>
 
                </div>

                <div class="longueur_ligne_container">

                    <div>
                        <label id="parafoudres_coordonnes_mesures" class="label_input_field">Parafoudres coordonnés (P PARAFOUDRE)</label>
                    </div>

                    <div>
                    
                        <select class="select_field" id="parafoudres-coordonnes_select_mesures" onclick="">

                            <option value="1.00">Pas de parafoudres coordonnés</option>
                            <option value="0.05">Niveau de protection III-IV</option>
                            <option value="0.02">Niveau de protection II</option>
                            <option value="0.01">Niveau de protection I</option>
                            <option value="0.005" title="Parafoudres présentant des caractéristiques supérieures à celles d'un niveau de protection I">Niveau de protection I+</option>
                            <option value="0.001" title="Parafoudres présentant des caractéristiques supérieures à celles d'un niveau de protection I">Niveau de protection I++</option>
                    
                        </select>

                        
                        <input id="display-value-pspd-mesures" class="input_select_lines" type="text" readonly>

                    </div>

                </div>


                <div class="longueur_ligne_container">

                    <div>
                        <label id="parafoudres_equipotentialite_mesures" class="label_input_field">Parafoudres d'équipotentialité (PEB)</label>
                    </div>

                    <div>
                    
                        <select class="select_field" id="parafoudres-equipotentialite_select_mesures" onclick="">

                            <option value="1.00">Pas de parafoudres d'équipotentialité</option>
                            <option value="0.05">Niveau de protection III-IV</option>
                            <option value="0.02">Niveau de protection II</option>
                            <option value="0.01">Niveau de protection I</option>
                            <option value="0.005" title="Parafoudres présentant des caractéristiques supérieures à celles d'un niveau de protection I">Niveau de protection I+</option>
                            <option value="0.001" title="Parafoudres présentant des caractéristiques supérieures à celles d'un niveau de protection I">Niveau de protection I++</option>
                    
                        </select>

                        
                        <input id="display-value-equipotentialite-mesures" class="input_select_lines" type="text" readonly>

                    </div>

                </div>


                <div class="longueur_ligne_container">

                    <div>
                        <label id="type_cablage_interne_mesures" class="label_input_field">Type de câblage interne (KS3)</label>
                    </div>
    
                    <div>
                    
                        <select class="select_field" id="type-cablage-interne-select-mesures" onclick="">
    
                            <option value="1.0">Câble non blindé - Pas de préccaution de cheminement afin d'éviter des boucles</option>
                            <option value="0.2">Câble non blindé - Préccaution de cheminement afin d'éviter des boucles de grande taille</option>
                            <option value="0.01">Câble non blindé - Préccaution de cheminement afin d'éviter des boucles</option>
                            <option value="0.0001" title="à condition que les blindages et les conduits métalliques soient reliés à une borne d'équipotentialité à ses deux 
                            extrémités, et que le matériel soit connecté à la même borne d'équipotentialité">Câbles blindés et câbles cheminant dans des conduits métalliques</option>
    
                    
                        </select>
    
                        
                        <input id="display-value-ks3-mesures" class="input_select_lines" type="text" readonly>
    
                    </div>
    
                </div>



                <div class="longueur_ligne_container">

                    <div>
                        <label id="interfaces_isolement_mesures" class="label_input_field">Interface d'isolement (PMS)</label>
                    </div>
    
                    <div>
                    
                        <select class="select_field" id="interfaces_isolement_select_mesures" onclick="">
    
                            <option value="1.00">Matériels non équipés d'interfaces d'isolement (transformateurs d'isolement, fibre optiques, optocoupleurs, etc.)</option>
                            <option value="0.00">Matériels équipés d'interfaces d'isolement (transformateurs d'isolement, fibre optiques, optocoupleurs, etc.)</option>
   
                    
                        </select>
    
                        
                        <input id="display-value-interfaces-isolement-mesures" class="input_select_lines" type="text" readonly>
    
                    </div>
    
                </div>



                <div class="longueur_ligne_container">

                    <div>
                        <label id="resistance_ecran_mesures" class="label_input_field">Type de câblage externe (PLD)</label>
                    </div>
    
                    <div>
                    
                        <select class="select_field" id="resistance-ecran-pld-mesures" onclick="">
    
                            <option value="1">Service aérien ou enterré, non blindé ou blindé, dont le 
                                blindage n’est pas relié à la borne d’équipotentialité à 
                                laquelle le matériel est connecté</option>
                             <option value="2">Service aérien ou enterré blindé - Blindage relié à la borne d'équipotentialité - Blindage d'une résistance Rs &gt; 20 Ω/km</option>
                            <option value="3">Service aérien ou enterré blindé - Blindage relié à la borne d'équipotentialité - Blindage d'une résistance 5 &lt;Rs &le; 20 Ω/km</option>
                            <option value="4">Service aérien ou enterré blindé - Blindage relié à la borne d'équipotentialité - Blindage d'une résistance 1 &lt; Rs &le; 5 Ω/km</option>
                            <option value="5">Service aérien ou enterré blindé - Blindage relié à la borne d'équipotentialité - Blindage d'une résistance Rs &le; 1 Ω/km</option>

                        </select>
                        <label id="resistance_ecran_pld_mesures" class="label_input_field">PLD</label>
                        <input id="display-value-pld-mesures" class="input_select_lines" type="text" readonly>
    
    
    
                    </div>
    
                </div>


 



                <div class="longueur_ligne_container">

                    <div>
                        <label id="conditions_blindage_mesures" class="label_input_field">Facteurs associés aux conditions de blindage, de mise à la terre et d'isolation (CLD/CLI)</label>
                    </div>
    
                    <div>
                    
                        <select class="select_field" id="conditions-blindage-cld-cli-mesures" onclick="">
    
                            <option value="1">Service aérien non blindé - Connexion à l'entrée non définie</option>
                            <option value="2">Service enterré non blindé - Connexion à l'entrée non définie</option>
                            <option value="3">Service de puissance à neutre mis 
                                à la terre en plusieurs 
                                emplacements - Service non connecté à l'entrée</option>
                            <option value="4">Service enterré blindé (de 
                                puissance ou de communication) - Blindage non relié à la borne d’équipotentialité à 
                                laquelle le matériel est connecté</option>
    
                            <option value="5">Service aérien blindé (de 
                                puissance ou de communication) - Blindage non relié à la borne d’équipotentialité à 
                                laquelle le matériel est connecté</option>
                                
                            <option value="6">Service enterré blindé (de 
                                puissance ou de communication) - Blindage relié à la borne d’équipotentialité à laquelle le 
                                matériel est connecté</option>
                            <option value="7">Service aérien blindé (de 
                                puissance ou de communication) - Blindage relié à la borne d’équipotentialité à laquelle le 
                                matériel est connecté</option>
                            <option value="8">Câble de protection contre la 
                                foudre ou câblage dans les 
                                conduits ou canalisations 
                                métalliques de câble de protection 
                                contre la foudre - Blindage relié à la borne d’équipotentialité à laquelle le 
                                matériel est connecté</option>
                            <option value="9">Pas de service extérieur - Pas de connexion aux services extérieurs (réseaux 
                                autonomes)</option>
                            <option value="10">Tout type de service - Interface d’isolement selon la norme NF EN 62305-4</option>
    
     
                        </select>
                        <label id="conditions_blindage_cld_mesures" class="label_input_field">CLD</label>
                        <input id="display-value-cld-mesures" class="input_select_lines" type="text" readonly>
    
                        <label id="conditions_blindage_cli_mesures" class="label_input_field">CLI</label>
                        <input id="display-value-cli-mesures" class="input_select_lines" type="text" readonly>
    
    
                    </div>
    
                </div>
    

    






            </div>


            <div class="longueur_ligne_container_mesures">

                <div>
                    <label class="titre_label_mesures" id="facteur_emplacement_label_spf">ZONES</label>
                </div>




                <div class="longueur_ligne_container_items" id="dropdow-menu-zone-mesures">


                    <label for="dropdown-menu-zone-mesures"></label>
                    <select id="dropdown-menu-zone-mesures">

                        <option> </option>

                    <!-- Initial options will be added dynamically -->
                    </select>
 
                </div>

                <div class="longueur_ligne_container">

                    <div>
                        <label id="precaution-risque-incendie-mesures" class="label_input_field">Précautions prises contre le risque incencie (rp)</label>
                    </div>
    
                    <div>
                    
                        <select class="select_field" id="precaution_risque_incendie_mesures" onclick="">
    
                            <option value="1">Pas de disposition</option>
                            <option value="2">Une des dispositions suivantes:extincteurs,installations d'extinction fixes déclenchées manuellement, installations manuelles d'alarme, prises d'eau, compartiments étanches, voies d'évacuation protégées</option>
                            <option value="3">Une des dispositions suivantes:installations d'extinction fixes déclenchées automatiquement, installations d'alarme automatiques</option>
                    
                        </select>
    
                        
                        <input id="display-value-precaution-risque-incendie-mesures" class="input_select_lines" type="text" readonly>
    
                    </div>
    
                </div>


                <div class="longueur_ligne_container">

                    <div>
  
                        <label id="ptws_lfe_mesures" class="label_input_field">Efficacité du système de détection d'orage (PTWS) pour le calcul des pertes (LFE) (%)</label>
    
                    </div>
    
                    <div>
        
                        <input id="display-ptws-lfe-mesures" class="select_field" style="color: blue;" value="0.0">
            
                    </div>
    

    
                </div>



    
                <!--facteur de réduction dues au type de sol ou de plancher -->
                <div class="longueur_ligne_container">
    
                    <div>
                        <label id="facteur_reduction_sol_mesures" class="label_input_field">Facteur de réduction dû au type de sol ou de plancher (ra ou ru)</label>
                    </div>
    
                    <div>
                    
                        <select class="select_field" id="facteur-reduction-sol-mesures" onclick="">
    
                            <option value="1">Sol agricole, béton - Résistance de contact &le; 1 kΩ</option>
                            <option value="2">Sol en marbre, céramique - Résistance de contact 1-10 kΩ</option>
                            <option value="3">Sol en gravier, moquette, tapis - Résistance de contact 10-100 kΩ</option>
                            <option value="4">Sol en asphalte, linoléum, bois - Résistance de contact &ge;100 kΩ</option>
                    
                        </select>
    
                        
                        <input id="display-value-facteur-reduction-sol-mesures" class="input_select_lines" type="text" readonly>
    
                    </div>
    
                </div>
    
                <div class="longueur_ligne_container">
    
                    <div>
                        <label class="label_input_field" id="facteur_emplacement_label_ecran_spatial_mesures" >Ecran spatial extérieur (KS2)</label>
                    </div>
            
                    <div class="label_input_field" id="blindage-interne-KS2-mesures">
    
                        <select class="select_field" id="systeme-ecran-interne-mesures" onclick="">
                            <option value="1">Pas de blindage spatial</option>
                            <option value="2">Blindage métallique continu d'une épaisseur e &ge; 0.1 mm</option>
                            <option value="3">Blindage métallique continu d'une épaisseur e &lt; 0.1 mm</option>
                            <option value="4">Ecran maillé</option>
      
                        </select>
    
                        <input class="input_select_lines" id="display-value-ecra-interne-options-mesures"  type="text" readonly>
    
    
                            
                    </div>
    
    
                </div>
    
                <div class="longueur_ligne_container">
    
    
                    <div>
                        <label class="titre_label_mailles_KS2" id="taille-mailles-label-KS2-mesures">Taille des mailles de l'écran w(m)</label>
                    </div>
    
                    
    
                        <div>
                            <!-- Input element for the second pair -->
                            <input type="number"  class="grayed-out-mailles-KS2" id="taille-mailles-KS2-input-mesures"  style="color: blue;" value="5.0" step="0.1">
                
                        </div>
    
                
    
    
                </div>   


                <!--Mesures de protection contre les tensions de toucher et de pas  -->
                <div class="longueur_ligne_container">

                    <div>
                        <label id="facteur_mesures_pa_mesures" class="label_input_field">Mesures de protection contre les tensions de toucher et de pas - Impacts sur la structure (PA)</label>
                    </div>

                    <div class="dropdown">
                        <button onclick="toggleDropdown_mesures()">Selectionner une ou plusieurs mesures</button>
                        <div id="dropdownContent_mesures" class="dropdown-content">
                            <div>
                                <input type="checkbox" id="option1-mesures" name="option1" value="1">
                                <label for="option1-mesures">Pas de mesures de protection</label>
                            </div>
                            <div>
                                <input type="checkbox" id="option2-mesures" name="option2" value="2">
                                <label for="option2-mesures">Isolation électrique du conducteur exposé</label>
                            </div>
                            <div>
                                <input type="checkbox" id="option3-mesures" name="option3" value="3">
                                <label for="option3-mesures">Sol équipotentiel efficace</label>
                            </div>
                            <div>
                                <input type="checkbox" id="option4-mesures" name="option4" value="4">
                                <label for="option4-mesures">Plaques d'avertissement</label>
                            </div>
                    
                            <div>
                                <input type="checkbox" id="option5-mesures" name="option4" value="5">
                                <label for="option5-mesures">Restrictions physiques</label>
                            </div>
                    
                            <div>
                                <input type="checkbox" id="option6-mesures" name="option4" value="6">
                                <label for="option6-mesures">Armatures utilisées comme conducteur de descente</label>
                            </div>
                        </div>


                        <input class="input_select_lines" id="display-value-pa-options-mesures"  type="text" readonly>

                    </div>

                    

                </div>


                <div class="longueur_ligne_container">

                    <div>
                        <label id="facteur_mesures_ptu_mesures" class="label_input_field">Mesures de protection contre les tensions de toucher et de pas - Impacts sur le service (PTU)</label>
                    </div>

                    <div class="dropdown">
                        <button onclick="toggleDropdownptu_mesures()">Selectionner une ou plusieurs mesures</button>
                        <div id="dropdownContentptu_mesures" class="dropdown-content">
                            <div>
                                <input type="checkbox" id="optionptu1-mesures" name="optionptu1" value="1">
                                <label for="optionptu1-mesures">Pas de mesures de protection</label>
                            </div>
                            <div>
                                <input type="checkbox" id="optionptu2-mesures" name="optionptu2" value="2">
                                <label for="optionptu2-mesures">Notices d'avertissement</label>
                            </div>
                            <div>
                                <input type="checkbox" id="optionptu3-mesures" name="optionptu3" value="3">
                                <label for="optionptu3-mesures">Isolation électrique</label>
                            </div>
                            <div>
                                <input type="checkbox" id="optionptu4-mesures" name="optionptu4" value="4">
                                <label for="optionptu4-mesures">Restrictions physiques </label>
                            </div>
                    
                        </div>


                        <input class="input_select_lines" id="display-value-ptu-options-mesures"  type="text" readonly>

                    </div>

                    

                </div>




                    








            </div>

 












 










        </div>




















    </div>
        
<div class="right-container">
        <div class="chart-container">
            <canvas id="chart1" width="400" height="400"></canvas>
        </div>
            
        <div class="chart-container">
            <canvas id="chart2" width="400" height="400"></canvas>
        </div>
        
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

<script>

var Add=0.;
var Amm=0.;
var Ad=0.;
var Am=0.;
var Nm=0.;
var Ada=0.;
var NDa=0.;
var ND=0.;
var Al=0.;
var NL=0.;
var Ai=0.;
var Nl=0.;
var offset=500;
var itemCounter=2;
var lineCounter=2;
var zoneCounter=2;
var risqueCounter=2;

var R1=0.;
var RT=1e-5;
var RA=0.;
var RB=0.;
var RC=0.;
var RU=0.;
var RV=0;
var RW=0.;
var RZ=0.;

var R1S=0.;
var RAS=0.;
var RBS=0.;
var RCS=0.;
var RMS=0.;
var RUS=0.;
var RVS=0;
var RWS=0.;
var RZS=0.;

var R1A=0.;
var RAA=0.;
var RBA=0.;
var RCA=0.;
var RMA=0.0;
var RUA=0.;
var RVA=0;
var RWA=0.;
var RZA=0.;
var Risque_R1_S=[RAS,RBS,RCS,RMS,RUS,RVS,RWS,RZS,R1S,RT];
var Risque_R1_A=[RAA,RBA,RCA,RMA,RUA,RVA,RWA,RZA,R1A,RT];
var selected_lines={};
var produits_data={};

var Cd=1.0;
var PB=1.0;
var PBA=1.0;
var KS1=1.0;
var KS1A=1.0;
var KS2=1.0;
let rectangleCount = 0;
let circleCount = 0;
let rectangleCounti = 0;
let circleCounti = 0;
var minX,minY,maxX,maxY;
var lineData ={};
var lineDataA ={};
var lineData_float ={};
var zoneData ={};
var zoneDatafloat={};
var zoneDataA ={};
var zoneDatafloatA ={};
var Ng=1.0;
var nomProjet;
var Ha=10.;
var Hb=10.;
var peb_test_am;
var peb_test_sm;
var structure_selectionne=1;
var nt=1.0;
var test_open=0;

document.addEventListener('DOMContentLoaded', (event) => {
    document.getElementById('structure').click();
});

let fileHandle;

async function save() {

    const nomprojet = document.getElementById('nom_projet').value;
    const nomredacteur = document.getElementById('nom_redacteur').value;
    const nomsociete = document.getElementById('nom_societe').value;
    const densitefoudroiement = document.getElementById('densite_foudroiement').value;
    const nombatiment = document.getElementById('nom_batiment').value;
    const longueurcubesimple = document.getElementById('longueur_cube_simple').value;
    const largeurcubesimple = document.getElementById('largeur_cube_simple').value;
    const hauteurcubesimple = document.getElementById('hauteur_cube_simple').value;
    const resultatcubesimpleAd = document.getElementById('resultat_cube_simple_Ad').value;
    const resultatcubesimpleAm = document.getElementById('resultat_cube_simple_Am').value;
    const longueurcubeedicule = document.getElementById('longueur_cube_edicule').value;
    const largeurcubeedicule = document.getElementById('largeur_cube_edicule').value;
    const hauteurmincubeedicule = document.getElementById('hauteur_min_cube_edicule').value;
    const hauteurmaxcubeedicule = document.getElementById('hauteur_max_cube_edicule').value;
    const resultatcubeediculeAd = document.getElementById('resultat_cube_edicule_Ad').value;
    const resultatcubeediculeAm = document.getElementById('resultat_cube_edicule_Am').value;

    const rayoncylindresimple = document.getElementById('rayon_cylindre_simple').value;
    const hauteurcylindresimple = document.getElementById('hauteur_cylindre_simple').value;
    const resultatcylindresimpleAd = document.getElementById('resultat_cylindre_simple_Ad').value;
    const resultatcylindresimpleAm = document.getElementById('resultat_cylindre_simple_Am').value;

    const rayoncylindreedicule = document.getElementById('rayon_cylindre_edicule').value;
    const hauteurmincylindreedicule = document.getElementById('hauteur_min_cylindre_edicule').value;
    const hauteurmaxcylindreedicule = document.getElementById('hauteur_max_cylindre_edicule').value;
    const resultatcylindreediculeAd = document.getElementById('resultat_cylindre_edicule_Ad').value;
    const resultatcylindreediculeAm = document.getElementById('resultat_cylindre_edicule_Am').value;

    const shapesContainer = document.getElementById('rectangles');
    const shapes = shapesContainer.children;

    const shapesArray = Array.from(shapes).map(shape => {
        
        const shapeId = shape.id;
        
        const type = shapeId.startsWith('rect') ? 'rectangle' : 'circle';
        const label=document.getElementById(`${shapeId}Label`).innerText;
        const x = document.getElementById(`${shapeId}x`).value;
        const y = document.getElementById(`${shapeId}y`).value;
        const height = document.getElementById(`${shapeId}H`).value;
        const color = document.getElementById(`${shapeId}Color`).value;
        
        if (type === 'rectangle') {
            const length = document.getElementById(`${shapeId}L`).value;
            const width = document.getElementById(`${shapeId}W`).value;
            return { label, id: shapeId, type, x, y, length, width, height, color };
        } else {
            const radius = document.getElementById(`${shapeId}r`).value;
            return { label, id: shapeId, type, x, y, radius, height, color };
        }


        
        
    });

    const facteuremplacementoptions = document.getElementById('facteur-emplacement-options').value;
    const displayvalueemplacementoptions = document.getElementById('display-value-emplacement-options').value;

    const systemespfoptions=document.getElementById('systeme-spf-options').value;
    const displayvaluespfoptions=document.getElementById('display-value-spf-options').value;
    const systemeecranoptions=document.getElementById('systeme-ecran-options').value;
    const displayvalueecranoptions=document.getElementById('display-value-ecran-options').value;
    const taillemaillesinput=document.getElementById('taille-mailles-input').value;
    const taillemaillesinputClassName=document.getElementById('taille-mailles-input').className;

    const systemespfoptionsmesures=document.getElementById('systeme-spf-options-mesures').value;
    const displayvaluespfoptionsmesures=document.getElementById('display-value-spf-options-mesures').value;
    const systemeecranoptionsmesures=document.getElementById('systeme-ecran-options-mesures').value;
    const displayvalueecranoptionsmesures=document.getElementById('display-value-ecran-options-mesures').value;
    const taillemaillesinputmesures=document.getElementById('taille-mailles-input-mesures').value;
    const taillemaillesinputClassNamemesures=document.getElementById('taille-mailles-input-mesures').className;
    const taillemailleslabelClassNamemesures=document.getElementById('taille-mailles-label-mesures').className;

    

    dropdownMenuLineOptions=[];
    dropdownMenuZoneOptions=[];

    const dropdownMenuLine = document.getElementById('dropdown-menu-line');
    const dropdownMenuZone = document.getElementById('dropdown-menu-zone');

    for (let i = 0; i < dropdownMenuLine.options.length; i++) {
        
        dropdownMenuLineOptions.push(dropdownMenuLine.options[i].text);
        
    }

    for (let i = 0; i < dropdownMenuZone.options.length; i++) {
        
        dropdownMenuZoneOptions.push(dropdownMenuZone.options[i].text);
        
    }



    const dataarf = {

        mission:'arf',
        nom_projet: nomprojet,
        nom_redacteur: nomredacteur,
        nom_societe: nomsociete,
        densite_foudroiement:densitefoudroiement,
        nom_batiment:nombatiment,

        longueur_cube_simple:longueurcubesimple,
        largeur_cube_simple:largeurcubesimple,
        hauteur_cube_simple:hauteurcubesimple,
        resultat_cube_simple_Ad:resultatcubesimpleAd,
        resultat_cube_simple_Am:resultatcubesimpleAm,

        longueur_cube_edicule:longueurcubeedicule,
        largeur_cube_edicule:largeurcubeedicule,
        hauteur_min_cube_edicule:hauteurmincubeedicule,
        hauteur_max_cube_edicule:hauteurmaxcubeedicule,
        resultat_cube_edicule_Ad:resultatcubeediculeAd,
        resultat_cube_edicule_Am:resultatcubeediculeAm,

        rayon_cylindre_simple:rayoncylindresimple,
        hauteur_cylindre_simple:hauteurcylindresimple,
        resultat_cylindre_simple_Ad:resultatcylindresimpleAd,
        resultat_cylindre_simple_Am:resultatcylindresimpleAm,

        rayon_cylindre_edicule:rayoncylindreedicule,
        hauteur_min_cylindre_edicule:hauteurmincylindreedicule,
        hauteur_max_cylindre_edicule:hauteurmaxcylindreedicule,
        resultat_cylindre_edicule_Ad:resultatcylindreediculeAd,
        resultat_cylindre_edicule_Am:resultatcylindreediculeAm,
        //rectangles:rectangles,
        //circles:circles,
        shapesArray:shapesArray,
        Ad:Ad,
        Add:Add,
        Am:Am,
        Amm:Amm,
        Ng:Ng,
        Cd:Cd,
        PB:PB,
        PBA:PBA,
        KS1:KS1,
        KS1A:KS1A,
        Ha:Ha,
        circleCount:circleCount,
        rectangleCount:rectangleCount,
        circleCounti:circleCounti,
        rectangleCounti:rectangleCounti,
        structure_selectionne:structure_selectionne,
        facteur_emplacement_options:facteuremplacementoptions,
        display_value_emplacement_options:displayvalueemplacementoptions,

        systeme_spf_options:systemespfoptions,
        display_value_spf_options:displayvaluespfoptions,
        systeme_ecran_options:systemeecranoptions,
        display_value_ecran_options:displayvalueecranoptions,
        taille_mailles_input:taillemaillesinput,
        taille_mailles_input_ClassName:taillemaillesinputClassName,

        systeme_spf_options_mesures:systemespfoptionsmesures,
        display_value_spf_options_mesures:displayvaluespfoptionsmesures,
        systeme_ecran_options_mesures:systemeecranoptionsmesures,
        display_value_ecran_options_mesures:displayvalueecranoptionsmesures,
        taille_mailles_input_mesures:taillemaillesinputmesures,
        taille_mailles_input_ClassName_mesures:taillemaillesinputClassNamemesures,
        taille_mailles_label_ClassName_mesures:taillemailleslabelClassNamemesures,

        dropdown_Menu_Line_Options:dropdownMenuLineOptions,
        dropdown_Menu_Zone_Options:dropdownMenuZoneOptions,
        selected_lines1:selected_lines,
        produits_data1:produits_data,
        lineData1:lineData,
        lineDataA1:lineDataA,
        lineData_float1:lineData_float,
        zoneData1:zoneData,
        zoneDatafloat1:zoneDatafloat,
        zoneDataA1:zoneDataA,
        zoneDatafloatA1:zoneDatafloatA,
        lineCounter1:lineCounter,
        zoneCounter1:zoneCounter


    };


    
    const jsonData = JSON.stringify(dataarf, null, 2);
    const blob = new Blob([jsonData], { type: 'application/json' });

    try {
        if (!fileHandle) {
            // If no file handle, ask the user to pick a file and save for the first time
            fileHandle = await showSaveFilePicker({
                suggestedName:  fileName || 'arf2_Evaluation_Risque_Foudre_Batiment_xxx.json',// Use stored fileName or default
                types: [{
                    description: 'JSON Files',
                    accept: { 'application/json': ['.json'] },
                }],
            });

            fileName = fileHandle.name; // Store the new file name if a new file is picked
        }

        // Create a writable stream and write the blob to the file
        const writableStream = await fileHandle.createWritable();
        await writableStream.write(blob);
        await writableStream.close();
        //alert('Fichier enregistré avec succès.');
    } catch (err) {
        if (err.name === 'AbortError') {
            //console.warn('Ouverture du fichier a été abandonnée.');
        } else {
            //console.error('Erreur de lecture du fichier:', err);
        }
    }

   
   
 
}


async function save_as() {

    
const nomprojet = document.getElementById('nom_projet').value;
const nomredacteur = document.getElementById('nom_redacteur').value;
const nomsociete = document.getElementById('nom_societe').value;
const densitefoudroiement = document.getElementById('densite_foudroiement').value;
const nombatiment = document.getElementById('nom_batiment').value;
const longueurcubesimple = document.getElementById('longueur_cube_simple').value;
const largeurcubesimple = document.getElementById('largeur_cube_simple').value;
const hauteurcubesimple = document.getElementById('hauteur_cube_simple').value;
const resultatcubesimpleAd = document.getElementById('resultat_cube_simple_Ad').value;
const resultatcubesimpleAm = document.getElementById('resultat_cube_simple_Am').value;
const longueurcubeedicule = document.getElementById('longueur_cube_edicule').value;
const largeurcubeedicule = document.getElementById('largeur_cube_edicule').value;
const hauteurmincubeedicule = document.getElementById('hauteur_min_cube_edicule').value;
const hauteurmaxcubeedicule = document.getElementById('hauteur_max_cube_edicule').value;
const resultatcubeediculeAd = document.getElementById('resultat_cube_edicule_Ad').value;
const resultatcubeediculeAm = document.getElementById('resultat_cube_edicule_Am').value;

const rayoncylindresimple = document.getElementById('rayon_cylindre_simple').value;
const hauteurcylindresimple = document.getElementById('hauteur_cylindre_simple').value;
const resultatcylindresimpleAd = document.getElementById('resultat_cylindre_simple_Ad').value;
const resultatcylindresimpleAm = document.getElementById('resultat_cylindre_simple_Am').value;

const rayoncylindreedicule = document.getElementById('rayon_cylindre_edicule').value;
const hauteurmincylindreedicule = document.getElementById('hauteur_min_cylindre_edicule').value;
const hauteurmaxcylindreedicule = document.getElementById('hauteur_max_cylindre_edicule').value;
const resultatcylindreediculeAd = document.getElementById('resultat_cylindre_edicule_Ad').value;
const resultatcylindreediculeAm = document.getElementById('resultat_cylindre_edicule_Am').value;

const shapesContainer = document.getElementById('rectangles');
const shapes = shapesContainer.children;

const shapesArray = Array.from(shapes).map(shape => {
    
    const shapeId = shape.id;
    
    const type = shapeId.startsWith('rect') ? 'rectangle' : 'circle';
    const label=document.getElementById(`${shapeId}Label`).innerText;
    const x = document.getElementById(`${shapeId}x`).value;
    const y = document.getElementById(`${shapeId}y`).value;
    const height = document.getElementById(`${shapeId}H`).value;
    const color = document.getElementById(`${shapeId}Color`).value;
    
    if (type === 'rectangle') {
        const length = document.getElementById(`${shapeId}L`).value;
        const width = document.getElementById(`${shapeId}W`).value;
        return { label, id: shapeId, type, x, y, length, width, height, color };
    } else {
        const radius = document.getElementById(`${shapeId}r`).value;
        return { label, id: shapeId, type, x, y, radius, height, color };
    }


    
    
});

const facteuremplacementoptions = document.getElementById('facteur-emplacement-options').value;
const displayvalueemplacementoptions = document.getElementById('display-value-emplacement-options').value;

const systemespfoptions=document.getElementById('systeme-spf-options').value;
const displayvaluespfoptions=document.getElementById('display-value-spf-options').value;
const systemeecranoptions=document.getElementById('systeme-ecran-options').value;
const displayvalueecranoptions=document.getElementById('display-value-ecran-options').value;
const taillemaillesinput=document.getElementById('taille-mailles-input').value;
const taillemaillesinputClassName=document.getElementById('taille-mailles-input').className;

const systemespfoptionsmesures=document.getElementById('systeme-spf-options-mesures').value;
const displayvaluespfoptionsmesures=document.getElementById('display-value-spf-options-mesures').value;
const systemeecranoptionsmesures=document.getElementById('systeme-ecran-options-mesures').value;
const displayvalueecranoptionsmesures=document.getElementById('display-value-ecran-options-mesures').value;
const taillemaillesinputmesures=document.getElementById('taille-mailles-input-mesures').value;
const taillemaillesinputClassNamemesures=document.getElementById('taille-mailles-input-mesures').className;
const taillemailleslabelClassNamemesures=document.getElementById('taille-mailles-label-mesures').className;



dropdownMenuLineOptions=[];
dropdownMenuZoneOptions=[];

const dropdownMenuLine = document.getElementById('dropdown-menu-line');
const dropdownMenuZone = document.getElementById('dropdown-menu-zone');

for (let i = 0; i < dropdownMenuLine.options.length; i++) {
    
    dropdownMenuLineOptions.push(dropdownMenuLine.options[i].text);
    
}

for (let i = 0; i < dropdownMenuZone.options.length; i++) {
    
    dropdownMenuZoneOptions.push(dropdownMenuZone.options[i].text);
    
}

const dataarf = {
    mission:'arf',
    nom_projet: nomprojet,
    nom_redacteur: nomredacteur,
    nom_societe: nomsociete,
    densite_foudroiement:densitefoudroiement,
    nom_batiment:nombatiment,

    longueur_cube_simple:longueurcubesimple,
    largeur_cube_simple:largeurcubesimple,
    hauteur_cube_simple:hauteurcubesimple,
    resultat_cube_simple_Ad:resultatcubesimpleAd,
    resultat_cube_simple_Am:resultatcubesimpleAm,

    longueur_cube_edicule:longueurcubeedicule,
    largeur_cube_edicule:largeurcubeedicule,
    hauteur_min_cube_edicule:hauteurmincubeedicule,
    hauteur_max_cube_edicule:hauteurmaxcubeedicule,
    resultat_cube_edicule_Ad:resultatcubeediculeAd,
    resultat_cube_edicule_Am:resultatcubeediculeAm,

    rayon_cylindre_simple:rayoncylindresimple,
    hauteur_cylindre_simple:hauteurcylindresimple,
    resultat_cylindre_simple_Ad:resultatcylindresimpleAd,
    resultat_cylindre_simple_Am:resultatcylindresimpleAm,

    rayon_cylindre_edicule:rayoncylindreedicule,
    hauteur_min_cylindre_edicule:hauteurmincylindreedicule,
    hauteur_max_cylindre_edicule:hauteurmaxcylindreedicule,
    resultat_cylindre_edicule_Ad:resultatcylindreediculeAd,
    resultat_cylindre_edicule_Am:resultatcylindreediculeAm,
    //rectangles:rectangles,
    //circles:circles,
    shapesArray:shapesArray,
    Ad:Ad,
    Am:Am,
    Ad:Ad,
    Add:Add,
    Am:Am,
    Amm:Amm,
    Ng:Ng,
    Cd:Cd,
    PB:PB,
    PBA:PBA,
    KS1:KS1,
    KS1A:KS1A,
    Ha:Ha,
    circleCount:circleCount,
    rectangleCount:rectangleCount,
    circleCounti:circleCounti,
    rectangleCounti:rectangleCounti,
    structure_selectionne:structure_selectionne,
    facteur_emplacement_options:facteuremplacementoptions,
    display_value_emplacement_options:displayvalueemplacementoptions,

    systeme_spf_options:systemespfoptions,
    display_value_spf_options:displayvaluespfoptions,
    systeme_ecran_options:systemeecranoptions,
    display_value_ecran_options:displayvalueecranoptions,
    taille_mailles_input:taillemaillesinput,
    taille_mailles_input_ClassName:taillemaillesinputClassName,

    systeme_spf_options_mesures:systemespfoptionsmesures,
    display_value_spf_options_mesures:displayvaluespfoptionsmesures,
    systeme_ecran_options_mesures:systemeecranoptionsmesures,
    display_value_ecran_options_mesures:displayvalueecranoptionsmesures,
    taille_mailles_input_mesures:taillemaillesinputmesures,
    taille_mailles_input_ClassName_mesures:taillemaillesinputClassNamemesures,
    taille_mailles_label_ClassName_mesures:taillemailleslabelClassNamemesures,

    dropdown_Menu_Line_Options:dropdownMenuLineOptions,
    dropdown_Menu_Zone_Options:dropdownMenuZoneOptions,
    selected_lines1:selected_lines,
    produits_data1:produits_data,
    lineData1:lineData,
    lineDataA1:lineDataA,
    lineData_float1:lineData_float,
    zoneData1:zoneData,
    zoneDatafloat1:zoneDatafloat,
    zoneDataA1:zoneDataA,
    zoneDatafloatA1:zoneDatafloatA,
    lineCounter1:lineCounter,
    zoneCounter1:zoneCounter


};



const jsonData = JSON.stringify(dataarf, null, 2);
const blob = new Blob([jsonData], { type: 'application/json' });


if (window.showSaveFilePicker) {
        // Use File System Access API if available
        try {

            const suggestedName = fileName || 'arf2_Evaluation_Risque_Foudre_Batiment_xxx.json'; // Use stored fileName or default
            // Open a file picker to select the file to save
            fileHandle = await showSaveFilePicker({
                suggestedName: suggestedName,
                types: [{
                    description: 'JSON Files',
                    accept: { 'application/json': ['.json'] },
                }],
            });

            fileName = fileHandle.name; // Store the file name

            // Create a writable stream and write the blob to the file
            const writableStream = await fileHandle.createWritable();
            await writableStream.write(blob);
            await writableStream.close();
            
            //alert('Fichier enregistré avec succès.');
        } catch (err) {
            if (err.name === 'AbortError') {
                //console.warn('Ouverture du fichier a été abandonnée.');
            } else {
                //console.error('Erreur de lecture du fichier:', err);
            }
        }
    } else {
        // Fallback for browsers without File System Access API
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'arf2_Evaluation_Risque_Foudre_Batiment_xxx.json';
        a.click();
        URL.revokeObjectURL(url);
    }


}

let fileName;

async function openFile() {

    var test_open=1;

    let shapesContainerDiv = document.getElementById('rectangles');


    // Clear all content within the selected div
    shapesContainerDiv.innerHTML = '';

    canvas_structure_complexe = document.getElementById('canvas_structure_complexe');
    canvas_structure_complexe.innerHTML = '';

    //const input = document.createElement('input');
    //input.type = 'file';
    //input.accept = 'application/json';
    //input.onchange = function(event) {
    //const file = event.target.files[0];

    try {
        // Open file picker and get the file handle
        [fileHandle] = await window.showOpenFilePicker({
            types: [{
                description: 'JSON Files',
                accept: { 'application/json': ['.json'] },
            }],
        });

    //if (file.type !== 'application/json') {
    //    alert('Fichier invalide');
    //    return; // Stop further execution if the file is not a valid JSON
    //}

    fileName = fileHandle.name; // Store the file name

    const file = await fileHandle.getFile(); // Get the file object from the file handle

    const reader = new FileReader();
    reader.onload = function(e) {

    try {
    const dataarf = JSON.parse(e.target.result);

    aa=dataarf.mission

    const prefixeAttendu = 'arf2_';


    if (!dataarf.mission || (!file.name.startsWith(prefixeAttendu))) {

        alert('Fichier invalide');

        return


    }
    
    document.getElementById('nom_projet').value = dataarf.nom_projet;
    document.getElementById('nom_redacteur').value = dataarf.nom_redacteur;
    document.getElementById('nom_societe').value = dataarf.nom_societe;
    document.getElementById('densite_foudroiement').value = dataarf.densite_foudroiement;
    document.getElementById('nom_batiment').value = dataarf.nom_batiment;

    document.getElementById('longueur_cube_simple').value = dataarf.longueur_cube_simple;
    document.getElementById('largeur_cube_simple').value = dataarf.largeur_cube_simple;
    document.getElementById('hauteur_cube_simple').value = dataarf.hauteur_cube_simple;
    document.getElementById('resultat_cube_simple_Ad').value = dataarf.resultat_cube_simple_Ad;
    document.getElementById('resultat_cube_simple_Am').value = dataarf.resultat_cube_simple_Am;

    document.getElementById('longueur_cube_edicule').value = dataarf.longueur_cube_edicule;
    document.getElementById('largeur_cube_edicule').value = dataarf.largeur_cube_edicule;
    document.getElementById('hauteur_max_cube_edicule').value = dataarf.hauteur_max_cube_edicule;
    document.getElementById('hauteur_min_cube_edicule').value = dataarf.hauteur_min_cube_edicule;
    document.getElementById('resultat_cube_edicule_Ad').value = dataarf.resultat_cube_edicule_Ad;
    document.getElementById('resultat_cube_edicule_Am').value = dataarf.resultat_cube_edicule_Am;

    document.getElementById('rayon_cylindre_simple').value = dataarf.rayon_cylindre_simple;
    document.getElementById('hauteur_cylindre_simple').value = dataarf.hauteur_cylindre_simple;
    document.getElementById('resultat_cylindre_edicule_Ad').value = dataarf.resultat_cylindre_simple_Ad;
    document.getElementById('resultat_cylindre_edicule_Am').value = dataarf.resultat_cylindre_simple_Am;

    document.getElementById('rayon_cylindre_edicule').value = dataarf.rayon_cylindre_edicule;
    document.getElementById('hauteur_max_cylindre_edicule').value = dataarf.hauteur_max_cylindre_edicule;
    document.getElementById('hauteur_min_cylindre_edicule').value = dataarf.hauteur_min_cylindre_edicule;
    document.getElementById('resultat_cylindre_edicule_Ad').value = dataarf.resultat_cylindre_edicule_Ad;
    document.getElementById('resultat_cylindre_edicule_Am').value = dataarf.resultat_cylindre_edicule_Am;
    rectangles=[];
    circles=[];
    shapesArray=dataarf.shapesArray;

    circleCount=dataarf.circleCount
    rectangleCount=dataarf.rectangleCount;
    circleCounti=dataarf.circleCounti
    rectangleCounti=dataarf.rectangleCounti;
    structure_selectionne=dataarf.structure_selectionne;
    
    //const shapesContainer = document.getElementById('rectangles');
    //const shapes = shapesContainer.children;
    
    
    icercle =0;
    irectangle =0;

    for (let i = 0; i < shapesArray.length; i++) {
    
    
    const shape = shapesArray[i];
    
    const shapeId = shape.type === 'rectangle' ? `rect${irectangle + 1}` : `circle${icercle + 1}`;

    if (shape.type === 'rectangle'){

        irectangle++


    } else {

        icercle++
    }

    const div = document.createElement('div');
    div.id = shapeId;

    const label=shape.label;

    if (shape.type ==='rectangle') {

        div.innerHTML = `
    <div class="shape-properties1">
        <label id="${shapeId}Label" class="input-label-complexe-bis-1">${label} </label>
        <label class="input-label-complexe"> Centre X0 (m):</label>
        <input type="number" id="${shapeId}x" value="${shape.x}" onchange="checkvalues('x0',this)" onfocus="highlightcolorrectangles(${irectangle})" onblur="create_shapes()">
        <label class="input-label-complexe"> Centre Y0 (m):</label>
        <input type="number" id="${shapeId}y" value="${shape.y}" onchange="checkvalues('y0',this)" onfocus="highlightcolorrectangles(${irectangle})" onblur="create_shapes()">
        <label class="input-label-complexe"> Longueur (m):</label>
        <input type="number" id="${shapeId}L" value="${shape.length}" onchange="checkvalues('L',this)" onfocus="highlightcolorrectangles(${irectangle})" onblur="create_shapes()">
        <label class="input-label-complexe"> Largeur (m):</label>
        <input type="number" id="${shapeId}W" value="${shape.width}" onchange="checkvalues('W',this)" onfocus="highlightcolorrectangles(${irectangle})" onblur="create_shapes()">
         <label class="input-label-complexe"> Hauteur (m):</label>
        <input type="number" id="${shapeId}H" value="${shape.height}" onchange="checkvalues('H',this)" onfocus="highlightcolorrectangles(${irectangle})" onblur="create_shapes()">
        <button type="button" onclick="this.focus(); deleteShape('${shapeId}','${shape.type}')" onmouseover="highlightcolorrectangles(${irectangle})" onmouseout="highlightcolorrectangles(null);" onblur="create_shapes()">Supprimer</button>
        <button type="button" onclick="this.focus(); renameShape('${shapeId}Label')" onmouseover="highlightcolorrectangles(${irectangle})" onmouseout="highlightcolorrectangles(null);" onblur="create_shapes()">Renommer</button>
        <input type="color" title="Couleur" id="${shapeId}Color" value="${shape.color}" class="small-color-input" onmouseover="highlightcolorrectangles(${irectangle})" onmouseout="highlightcolorrectangles(null);" onblur="create_shapes()">


    </div>
    `;


    } else {

        div.innerHTML = `
    <div class="shape-properties1">
        <label id="${shapeId}Label" class="input-label-complexe-bis-1">${label} </label>
        <label class="input-label-complexe"> Centre X0 (m):</label>
        <input type="number" id="${shapeId}x" value="${shape.x}" onchange="checkvalues('x0',this)" onfocus="highlightcolorcircles(${icercle})" onblur="create_shapes()">
        <label class="input-label-complexe"> Centre Y0 (m):</label>
        <input type="number" id="${shapeId}y" value="${shape.y}" onchange="checkvalues('y0',this)" onfocus="highlightcolorcircles(${icercle})" onblur="create_shapes()">
        <label class="input-label-complexe"> Rayon (m):</label>
        <input type="number" id="${shapeId}r" value="${shape.radius}" onchange="checkvalues('rayon',this)" onfocus="highlightcolorcircles(${icercle})" onblur="create_shapes()">
        <label class="input-label-complexe"> Hauteur (m):</label>
        <input type="number" id="${shapeId}H" value="${shape.height}" onchange="checkvalues('H',this)" onfocus="highlightcolorcircles(${icercle})" onblur="create_shapes()">
        <button type="button" onclick="this.focus(); deleteShape('${shapeId}','${shape.type}')" onmouseover="highlightcolorcircles(${icercle});" onmouseout="highlightcolorcircles(null);" onblur="create_shapes()">Supprimer</button>
        <button type="button" onclick="this.focus(); renameShape('${shapeId}Label')" onmouseover="highlightcolorcircles(${icercle});" onmouseout="highlightcolorcircles(null);" onblur="create_shapes()">Renommer</button>
        <input type="color" title="Couleur" id="${shapeId}Color" value="${shape.color}" class="small-color-input" onmouseover="highlightcolorcircles(${icercle});" onmouseout="highlightcolorcircles(null);" onblur="create_shapes()">

    </div>
    `;


    }
    
   

   


    if (shape.type==='rectangle') {

        x=parseFloat(shape.x);
        y=parseFloat(shape.y);
        L=parseFloat(shape.length);
        W=parseFloat(shape.width);
        H=parseFloat(shape.height);
        Color=shape.color;

        rectangles.push({ x, y, L, W, H, Color });

    } else {

        x=parseFloat(shape.x);
        y=parseFloat(shape.y);
        r=parseFloat(shape.radius);
        H=parseFloat(shape.height);
        Color=shape.color;

        circles.push({ x, y, r, H, Color });

    }

    document.getElementById('rectangles').appendChild(div);

    addInputListeners(shapeId);

    }


   
    drawShapes(rectangles, circles);

    Ad = dataarf.Ad;
    Am = dataarf.Am;
    Add = dataarf.Add;
    Amm = dataarf.Amm;
    Ng = dataarf.Ng;
    Cd=dataarf.Cd;
    PB=dataarf.PB;
    PBA=dataarf.PBA;
    KS1=dataarf.KS1;
    KS1A=dataarf.KS1A;
    Ha=dataarf.Ha;

    document.getElementById('resultat_structure_complexe_Ad').innerHTML = `Ad (m<sup>2</sup>): ${Ad.toFixed(2)}`;
    document.getElementById('resultat_structure_complexe_Am').innerHTML = `Am (m<sup>2</sup>): ${Am.toFixed(2)}`;

    if (structure_selectionne===1) {

        document.getElementById('cube_simple').style.borderColor = 'black';
        document.getElementById('cube_simple_edicule').style.borderColor = 'lightgray';
        document.getElementById('cylindre_simple').style.borderColor = 'lightgray';
        document.getElementById('cylindre_edicule').style.borderColor = 'lightgray';
        document.getElementById('forme_complexe').style.borderColor = 'lightgray';




    } else if (structure_selectionne===2) {

        document.getElementById('cube_simple').style.borderColor = 'lightgray';
        document.getElementById('cube_simple_edicule').style.borderColor = 'black';
        document.getElementById('cylindre_simple').style.borderColor = 'lightgray';
        document.getElementById('cylindre_edicule').style.borderColor = 'lightgray';
        document.getElementById('forme_complexe').style.borderColor = 'lightgray';


    } else if (structure_selectionne===3) {

        document.getElementById('cube_simple').style.borderColor = 'lightgray';
        document.getElementById('cube_simple_edicule').style.borderColor = 'lightgray';
        document.getElementById('cylindre_simple').style.borderColor = 'black';
        document.getElementById('cylindre_edicule').style.borderColor = 'lightgray';
        document.getElementById('forme_complexe').style.borderColor = 'lightgray';


    } else if (structure_selectionne===4) {

        document.getElementById('cube_simple').style.borderColor = 'lightgray';
        document.getElementById('cube_simple_edicule').style.borderColor = 'lightgray';
        document.getElementById('cylindre_simple').style.borderColor = 'lightgray';
        document.getElementById('cylindre_edicule').style.borderColor = 'black';
        document.getElementById('forme_complexe').style.borderColor = 'lightgray';


    } else if (structure_selectionne===5) {

        document.getElementById('cube_simple').style.borderColor = 'lightgray';
        document.getElementById('cube_simple_edicule').style.borderColor = 'lightgray';
        document.getElementById('cylindre_simple').style.borderColor = 'lightgray';
        document.getElementById('cylindre_edicule').style.borderColor = 'lightgray';
        document.getElementById('forme_complexe').style.borderColor = 'black';


    }

    document.getElementById('facteur-emplacement-options').value=dataarf.facteur_emplacement_options;
    document.getElementById('display-value-emplacement-options').value=dataarf.display_value_emplacement_options;

    document.getElementById('systeme-spf-options').value=dataarf.systeme_spf_options;
    document.getElementById('display-value-spf-options').value=dataarf.display_value_spf_options;

    document.getElementById("systeme-ecran-options").value=dataarf.systeme_ecran_options;
    document.getElementById('display-value-ecran-options').value=dataarf.display_value_ecran_options;
    document.getElementById('taille-mailles-input').value=dataarf.taille_mailles_input;
    document.getElementById('taille-mailles-input').className=dataarf.taille_mailles_input_ClassName;
    
    dropdown_Menu_Line_Options=dataarf.dropdown_Menu_Line_Options;
    dropdown_Menu_Zone_Options=dataarf.dropdown_Menu_Zone_Options;

    lineData={};
    lineData_float={};
    zoneData={};
    zoneDatafloat={};
    zoneDataA={};
    zoneDatafloatA={};
    selected_lines={};


    let dropdown = document.getElementById('dropdown-menu-line');
        dropdown.innerHTML = ''; // Clear existing options
        dropdown_Menu_Line_Options.forEach(optionText => {
        let option = document.createElement('option');
        option.text = optionText;
        dropdown.add(option);

    });

    let dropdownZ = document.getElementById('dropdown-menu-zone');
        dropdownZ.innerHTML = ''; // Clear existing options
        dropdown_Menu_Zone_Options.forEach(optionText => {
        let option = document.createElement('option');
        option.text = optionText;
        dropdownZ.add(option);
    });



    selected_lines=dataarf.selected_lines1;
    produits_data=dataarf.produits_data1;
    

    lineData=dataarf.lineData1;
    lineDataA=dataarf.lineDataA1;
    lineData_float=dataarf.lineData_float1;
    zoneData=dataarf.zoneData1;
    zoneDatafloat=dataarf.zoneDatafloat1;
    zoneDataA=dataarf.zoneDataA1;
    zoneDatafloatA=dataarf.zoneDatafloatA1;
    produits_data=dataarf.produits_data1;

    const selectedLine = dropdown.options[0].text;
    const selectedZone = dropdownZ.options[0].text;

    lineCounter=dataarf.lineCounter1;

    /////////////////////////////////////////////////////////

    /////////////////////DONNEES LIGNES/////////////////////

    document.getElementById('longueur-ligne').value = lineData[selectedLine]["longueurLigne"];

document.getElementById('facteur-installation-ligne').value = lineData[selectedLine]["facteurInstallationLigne"];
document.getElementById('display-value-installation-ligne').value = lineData[selectedLine]["facteurInstallationLigneValeur"];

document.getElementById('environnement-ligne').value = lineData[selectedLine]["typeEnvironnementLigne"];
document.getElementById('display-value-environnement-ligne').value = lineData[selectedLine]["typeEnvironnementLigneValeur"];

document.getElementById('facteur-transformateur').value = lineData[selectedLine]["facteurTransformateur"];
document.getElementById('display-value-facteur-transformateur').value = lineData[selectedLine]["facteurTransformateurValeur"]; 

document.getElementById('display-value-longueur-batiment').value = lineData[selectedLine]["longueurStructureExt"]; 
document.getElementById('display-value-largeur-batiment').value = lineData[selectedLine]["largeurStructureExt"]; 
document.getElementById('display-value-hauteur-batiment').value = lineData[selectedLine]["hauteurStructureExt"]; 

document.getElementById('emplacement-relatif-extremite').value = lineData[selectedLine]["emplacementRelatifStructureExt"];
document.getElementById('display-value-facteur-emplacement-extremite').value = lineData[selectedLine]["emplacementRelatifStructureExtValeur"];

document.getElementById('parafoudres-coordonnes_select').value = lineData[selectedLine]["parafoudresCoordonnesPspd"];
document.getElementById('display-value-pspd').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];

document.getElementById('parafoudres-equipotentialite_select').value = lineData[selectedLine]["parafoudresPEB"];
document.getElementById('display-value-equipotentialite').value = lineData[selectedLine]["parafoudresPEBValeur"];

document.getElementById('type-cablage-interne-select').value = lineData[selectedLine]["typeCablageInterne"];
document.getElementById('display-value-ks3').value = lineData[selectedLine]["typeCablageInterneValeur"];

document.getElementById('tension-assignee-chocs').value = lineData[selectedLine]["tensionAssignee"];

document.getElementById('display-value-uw').value = lineData[selectedLine]["tensionAssigneeValeur"];

document.getElementById('interfaces_isolement_select').value = lineData[selectedLine]["interfacesIsolement"];
document.getElementById('display-value-interfaces-isolement').value = lineData[selectedLine]["interfacesIsolementValeur"];

document.getElementById('interfaces_isolement_select_mesures').value = lineDataA[selectedLine]["interfacesIsolement"];
document.getElementById('display-value-interfaces-isolement-mesures').value = lineDataA[selectedLine]["interfacesIsolementValeur"];

document.getElementById('resistance-ecran-pld').value = lineData[selectedLine]["typeCablageExternePLD"];
document.getElementById('resistance-ecran-pli').value = lineData[selectedLine]["typeCablageExternePLI"];
document.getElementById('display-value-pld').value = lineData[selectedLine]["typeCablageExternePLDValeur"];
document.getElementById('display-value-pli').value = lineData[selectedLine]["typeCablageExternePLIValeur"];

document.getElementById('conditions-blindage-cld-cli-mesures').value = lineDataA[selectedLine]["typeCablageExternePLD"];
document.getElementById('display-value-cld-mesures').value = lineDataA[selectedLine]["conditionsBlindageCLDValeur"];
document.getElementById('display-value-cli-mesures').value = lineDataA[selectedLine]["conditionsBlindageCLIValeur"];

document.getElementById('conditions-blindage-cld-cli').value = lineData[selectedLine]["typeCablageExternePLD"];
document.getElementById('display-value-cld').value = lineData[selectedLine]["conditionsBlindageCLDValeur"];
document.getElementById('display-value-cli').value = lineData[selectedLine]["conditionsBlindageCLIValeur"];

document.getElementById('parafoudres-coordonnes_select_mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspd"];
document.getElementById('display-value-pspd-mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"];

document.getElementById('parafoudres-equipotentialite_select_mesures').value = lineDataA[selectedLine]["parafoudresPEB"];
document.getElementById('display-value-equipotentialite-mesures').value = lineDataA[selectedLine]["parafoudresPEBValeur"];

document.getElementById('type-cablage-interne-select-mesures').value = lineDataA[selectedLine]["typeCablageInterne"];
document.getElementById('display-value-ks3-mesures').value = lineDataA[selectedLine]["typeCablageInterneValeur"];

document.getElementById('resistance-ecran-pld-mesures').value = lineDataA[selectedLine]["typeCablageExternePLD"];
document.getElementById('display-value-pld-mesures').value = lineDataA[selectedLine]["typeCablageExternePLDValeur"];



    /////////////////////DONNEES ZONES/////////////////////


    document.getElementById('perte-contact-pas-int').value =zoneData[selectedZone]["PertesLtZoneInt"];
    document.getElementById('display-value-perte-contact-pas-int').value = zoneData[selectedZone]["PertesLtZoneIntValeur"];

    document.getElementById('perte-dommages-physiques').value =zoneData[selectedZone]["PertesLfZone"];
    document.getElementById('display-value-dommages-physiques-int').value = zoneData[selectedZone]["PertesLfZoneValeur"];

    document.getElementById('perte-defaillance-equipements').value =zoneData[selectedZone]["PertesLoZone"];
    document.getElementById('display-value-defaillance-equipements').value = zoneData[selectedZone]["PertesLoZoneValeur"];

    document.getElementById('display-value-nz').value=zoneDatafloat[selectedZone]["nz"];
    document.getElementById('display-value-tz').value=zoneDatafloat[selectedZone]["tz"];

    document.getElementById('type_danger_particulier_hz').value =zoneData[selectedZone]["TypeDangerParticulier"];
    document.getElementById('display-value-type-danger-particulier').value = zoneData[selectedZone]["TypeDangerParticulierValeur"];

    document.getElementById('type_risque_incendie').value =zoneData[selectedZone]["FacteurRisqueIncendie"];
    document.getElementById('display-value-reduction-risque-incendie').value = zoneData[selectedZone]["FacteurRisqueIncendieValeur"];

    document.getElementById('precaution_risque_incendie').value =zoneData[selectedZone]["PrecautionsRisqueIncendie"];
    document.getElementById('display-value-precaution-risque-incendie').value = zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"];

    document.getElementById('facteur-reduction-sol').value =zoneData[selectedZone]["FacteurReductionToucherPas"];
    document.getElementById('display-value-facteur-reduction-sol').value = zoneData[selectedZone]["FacteurReductionToucherPasValeur"];

    document.getElementById('systeme-ecran-interne').value =zoneData[selectedZone]["EcranSpatialKS2"];
    document.getElementById('display-value-ecra-interne-options').value = zoneData[selectedZone]["EcranSpatialKS2Valeur"];

    
    document.getElementById('display-value-pa-options').value = zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"];
    document.getElementById('option1').checked=zoneData[selectedZone]["option1_checked"];
    document.getElementById('option2').checked=zoneData[selectedZone]["option2_checked"];
    document.getElementById('option3').checked=zoneData[selectedZone]["option3_checked"];
    document.getElementById('option4').checked=zoneData[selectedZone]["option4_checked"];
    document.getElementById('option5').checked=zoneData[selectedZone]["option5_checked"];
    document.getElementById('option6').checked=zoneData[selectedZone]["option6_checked"];

    document.getElementById('display-value-ptu-options').value = zoneData[selectedZone]["FacteurReductionToucherPasPTUValeur"];
    document.getElementById('optionptu1').checked=zoneData[selectedZone]["optionptu1_checked"];
    document.getElementById('optionptu2').checked=zoneData[selectedZone]["optionptu2_checked"];
    document.getElementById('optionptu3').checked=zoneData[selectedZone]["optionptu3_checked"];
    document.getElementById('optionptu4').checked=zoneData[selectedZone]["optionptu4_checked"];


    document.getElementById('precaution_risque_incendie_mesures').value =zoneDataA[selectedZone]["PrecautionsRisqueIncendie"];
    document.getElementById('display-value-precaution-risque-incendie-mesures').value = zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"];

    document.getElementById('facteur-reduction-sol-mesures').value =zoneDataA[selectedZone]["FacteurReductionToucherPas"];
    document.getElementById('display-value-facteur-reduction-sol-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"];

    document.getElementById('systeme-ecran-interne-mesures').value =zoneDataA[selectedZone]["EcranSpatialKS2"];
    document.getElementById('display-value-ecra-interne-options-mesures').value = zoneDataA[selectedZone]["EcranSpatialKS2Valeur"];

    document.getElementById('display-value-pa-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"];  
    document.getElementById('option1-mesures').checked=zoneDataA[selectedZone]["option1_checked"];
    document.getElementById('option2-mesures').checked=zoneDataA[selectedZone]["option2_checked"];
    document.getElementById('option3-mesures').checked=zoneDataA[selectedZone]["option3_checked"];
    document.getElementById('option4-mesures').checked=zoneDataA[selectedZone]["option4_checked"];
    document.getElementById('option5-mesures').checked=zoneDataA[selectedZone]["option5_checked"];
    document.getElementById('option6-mesures').checked=zoneDataA[selectedZone]["option6_checked"];

    document.getElementById('display-value-ptu-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPTUValeur"];
    document.getElementById('optionptu1-mesures').checked=zoneDataA[selectedZone]["optionptu1_checked"];
    document.getElementById('optionptu2-mesures').checked=zoneDataA[selectedZone]["optionptu2_checked"];
    document.getElementById('optionptu3-mesures').checked=zoneDataA[selectedZone]["optionptu3_checked"];
    document.getElementById('optionptu4-mesures').checked=zoneDataA[selectedZone]["optionptu4_checked"];

    document.getElementById('pertes_lfe').className=zoneData[selectedZone]["ClassNameLFELabel"];
    document.getElementById('display-value-lfe').className=zoneData[selectedZone]["ClassNameLFEInput"];
    document.getElementById('te_lfe').className=zoneData[selectedZone]["ClassNameTeLabel"];
    document.getElementById('display-te-lfe').className=zoneData[selectedZone]["ClassNameTeInput"];
    document.getElementById('display-value-lfe').value=zoneData[selectedZone]["PertesLFE"];
    document.getElementById('display-te-lfe').value=zoneData[selectedZone]["PertesTeLFE"];
    document.getElementById('includeOptionPertes').checked=zoneData[selectedZone]["CheckedLFE"];
    document.getElementById('includeOptionNoteINERIS').checked=zoneData[selectedZone]["CheckedINERIS"];
    document.getElementById('includeOptionNoteINERIS').disabled=zoneData[selectedZone]["DisabledCheckboxINERIS"];
    document.getElementById('labelincludeOptionNoteINERIS').className=zoneData[selectedZone]["LabelCheckboxINERIS"];
    document.getElementById('ptws_lfe').className=zoneData[selectedZone]["ClassNamePTWSLabel"];
    document.getElementById('display-ptws-lfe').className=zoneData[selectedZone]["ClassNamePTWSInput"];
    document.getElementById('display-ptws-lfe').value=zoneData[selectedZone]["PTWSLFE"];



    create_risque_container ();

    document.getElementById('surface_zone').value =zoneData[selectedZone]["ZoneSurface"];
    document.getElementById('potentiel_zone').value =produits_data[selectedZone]["Produit N° 1"]["PotentielCalorifique"];
    document.getElementById('quantite_zone').value =produits_data[selectedZone]["Produit N° 1"]["QuantiteProduit"];
    document.getElementById('charge_zone').value =zoneData[selectedZone]["ChargeCalorifique"];

    const checkboxContainer=document.getElementById('checkbox-container');
    
    const checkboxes = checkboxContainer.querySelectorAll('.checkbox-item');

    checkboxes.forEach(checkbox => {
        checkboxContainer.removeChild(checkbox);
    });


    for (let i = 0; i < dropdown.options.length; i++) {

        
        // Add new checkbox for the new line
        const checkboxDiv = document.createElement('div');
        //checkboxDiv.className = 'checkbox-container';
        checkboxDiv.className = 'checkbox-item'; 
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = dropdown.options[i].text;
        checkbox.name = dropdown.options[i].text;
            //checkbox.className = 'checkbox-container';
        
        const label = document.createElement('label');
        label.htmlFor = checkbox.name;
        label.appendChild(document.createTextNode(checkbox.name));
        checkboxDiv.appendChild(checkbox);
        checkboxDiv.appendChild(label);
        checkboxContainer.appendChild(checkboxDiv);
        checkbox.checked=selected_lines[selectedZone][checkbox.name];
   
        
    
    }


    document.getElementById('dropdown-menu-risque').innerHTML='';

    document.getElementById('surface_zone').value =zoneData[selectedZone]["ZoneSurface"];
    document.getElementById('charge_zone').value =zoneData[selectedZone]["ChargeCalorifique"];

    const dropdownMenuRisque = document.getElementById('dropdown-menu-risque');

    //const options = document.getElementById('dropdown-menu-risque').options;   

    for (let i = 0; i < Object.keys(produits_data[selectedZone]).length; i++) {

        const produit_name=Object.keys(produits_data[selectedZone])[i];

        const option_product = document.createElement('option');
        option_product.value=produit_name;
        option_product.textContent=produit_name;

        dropdownMenuRisque.appendChild(option_product);
        dropdownMenuRisque.value=produit_name;

        document.getElementById('potentiel_zone').value =produits_data[selectedZone][produit_name]["PotentielCalorifique"];
        document.getElementById('quantite_zone').value =produits_data[selectedZone][produit_name]["QuantiteProduit"];


    }
     
    

    zoneCounter=dataarf.zoneCounter1;




    ////////////////////////////////////////////////////////////////////////

    /////////////////////DONNEES MESURES DE PROTECTION/////////////////////

    document.getElementById('systeme-spf-options-mesures').value=dataarf.systeme_spf_options_mesures;
    document.getElementById('display-value-spf-options-mesures').value=dataarf.display_value_spf_options_mesures;
    document.getElementById('systeme-ecran-options-mesures').value=dataarf.systeme_ecran_options_mesures;
    document.getElementById('display-value-ecran-options-mesures').value=dataarf.display_value_ecran_options_mesures;
    document.getElementById('taille-mailles-input-mesures').value=dataarf.taille_mailles_input_mesures;
    document.getElementById('taille-mailles-input-mesures').className=dataarf.taille_mailles_input_ClassName_mesures;
    document.getElementById('taille-mailles-label-mesures').className=dataarf.taille_mailles_label_ClassName_mesures;


    ///////////////////////////////////////////////////////////////////////





  
    
    

    updateResults();



    } catch (error) {
        
       alert('Fichier invalide');
       return;

    }

    };

    reader.onerror = function() {
        //alert('Erreur de lecture du fichier');
    };




    reader.readAsText(file);



    } catch (error) {
        //console.error('Erreur lors de l\'ouverture du fichier:', error);
        //alert('Erreur lors de l\'ouverture du fichier.');
    }

    //input.click();
}






document.getElementById('print').addEventListener('click', function () {

    //getCheckedLineData();
    showData();

});

//document.getElementById('printD').addEventListener('click', function () {

//getCheckedLineData();
//showDataD();

//});


function new_file() {


    window.open('ARF VERSION FINALE NF EN 62305-2 Ed 2012 04 08 2024 SERVEUR FETCH.html', '_blank');
    

}


function showData() {
    //const checkedData = getCheckedLineData();

    

    const newWindow = window.open('aaaaa', '_blank');
    

    const newDoc = newWindow.document;

    // Obtenir la date actuelle
    const currentDate = new Date();
    const formattedDate = currentDate.toLocaleDateString('fr-FR', {
        Année: 'numeric',
        Mois: 'long',
        Jour: 'numeric'
    });

    

    versionlogicielle='ELP-RA-24-07-01A';
    normeReference='NF EN 62305-2 Ed. 2006';

    var forme_structure;

    if (structure_selectionne===1) {

        forme_structure='Structure cubique simple';

    } else if (structure_selectionne===2) {

        forme_structure='Structure cubique avec édicule';

    } else if (structure_selectionne===3) {

        forme_structure='Structure cylindrique simple';

    } else if (structure_selectionne===4) {

        forme_structure='Structure cylindrique avec édicule';

    } else if (structure_selectionne===5) {

        forme_structure='Structure de forme complexe';
    }





    const html = `
        <html>
        <head>
            <title>Evaluation du risque foudre - Risque R1 - ${nomBatiment} </title>
                <style>
                  @media print {
                        @page {
                            margin-left: 1cm;
                            margin-right: 1cm;
                            margin-top: 2cm;
                            margin-bottom: 1cm;
                        }
                        body {
                            margin: 0;
                        }
                        .page-number:after {
                            content: counter(page);
                        }
                        .page-number {
                            position: fixed;
                            bottom: 0;
                            width: 100%;
                            text-align: center;
                        }
                    }

                    
                    /* Optional: Additional CSS styles for the output window */
                </style>
        </head>
        <body>

                <h3 style="text-decoration: underline;text-align: center;">DONNEES DE SORTIE LOGICIELLE</h3>
                <p style="text-align: center">Version logicielle: <span style="color: blue;">${versionlogicielle}</p>
                <p style="text-align: center">Nom du projet: <span style="color: blue;">${nomProjet}</p>
                <p style="text-align: center">Nom du bâtiment: <span style="color: blue;">${nomBatiment}</p>

                <h4 style="text-decoration: underline;">DONNEES GENERALES</h4>
                <p>Date: <span style="color: blue;">${formattedDate}</span></p>
                <p>Norme de référence: <span style="color: blue;">${normeReference}</span></p>
                <p>Nom et prénom du rédacteur: <span style="color: blue;">${nomRedacteur}</span></p>
                <p>Nom de la société: <span style="color: blue;">${nomSociete}</span></p>
                <p style="margin-bottom: 20px;">Densité de foudroiement: <span style="color: blue;">${Ng.toFixed(2)} /an/km<sup>2</sup></span></p>

                <h4>= = = = = = = = = = = = = = DONNEES SANS MESURES DE PROTECTION = = = = = = = = = = = = = =</h4>    
                <h4 style="text-decoration: underline;">DONNEES DE LA STRUCTURE</h4>
                <p>Forme de la structure: <span style="color: blue;">${forme_structure}</span></p>
                <p>Nombre de personnes présentes dans la structure: <span style="color: blue;">${nt}</span></p>
                <div id="strucutres-data-container"></div>
                <p>Surface d'exposition - Coups de foudre sur la structure (Ad): <span style="color: blue;">${Ad.toFixed(2)} m<sup>2</sup></span></p>
                <p>Surface d'exposition - Coups de foudre à proximité de la structure (Am): <span style="color: blue;">${Am.toFixed(2)} m<sup>2</sup></span></p>
                <p>Emplacement relatif (Cd): <span style="color: blue;">${Cd.toFixed(2)}</span></p>
                <p>Système de protection contre la foudre SPF (PB): <span style="color: blue;">${PB.toFixed(3)}</span></p>
                <p>Ecran spatial extérieur (KS1): <span style="color: blue;">${KS1.toFixed(5)}</span></p>
                <p>Nombre d'évènements annuels moyens dangereux dus aux coups de foudre sur la structure (Nd): <span style="color: blue;">${ND.toFixed(2)} /an/km<sup>2</sup></sup> </span></p>
                <p>Nombre d'évènements annuels moyens dangereux dus aux coups de foudre à proximité de la structure (Nm): <span style="color: blue;">${Nm.toFixed(2)} /an/km<sup>2</sup></span></p>

                <h4 style="text-decoration: underline;">DONNEES DES SERVICES</h4>
                 <div id="line-data-container"></div>

                <h4 style="text-decoration: underline;">DONNEES DES ZONES</h4>
                <div id="zone-data-container"></div>

                <h4 style="text-decoration: underline;">RISQUES TOTAUX</h4>
                <div id="zone-data-totaux-container"></div>

                <h4>= = = = = = = = = = = = = = DONNEES AVEC MESURES DE PROTECTION = = = = = = = = = = = = = =</h4>
                <h4 style="text-decoration: underline;">DONNEES DE LA STRUCTURE</h4>
                <p>Système de protection contre la foudre SPF (PB): <span style="color: blue;">${PBA.toFixed(3)}</span></p>
                <p>Ecran spatial extérieur (KS1): <span style="color: blue;">${KS1A.toFixed(5)}</span></p>

                <h4 style="text-decoration: underline;">DONNEES DES SERVICES</h4>
                 <div id="line-data-container-a"></div>

                <h4 style="text-decoration: underline;">DONNEES DES ZONES</h4>
                <div id="zone-data-container-a"></div>

                <h4 style="text-decoration: underline;">RISQUES TOTAUX</h4>
                <div id="zone-data-totaux-container-a"></div>


           
        </body>
        </html>
    `;


    
    newDoc.open();
        
    newDoc.write(html);
    newDoc.close();

    // Suppression des en-têtes et pieds de page
    //newWindow.document.body.style.margin = "0";


    // Impression du contenu
    //newWindow.print();



    newWindow.onload = function () {


        const dropdownMenuLine = document.getElementById('dropdown-menu-line');
        const dropdownMenuZone = document.getElementById('dropdown-menu-zone');
  
        const options = dropdownMenuLine.options;
        const options_zone = dropdownMenuZone.options;

        const lineDataContainer = newDoc.getElementById('line-data-container');
        const zoneDataContainer = newDoc.getElementById('zone-data-container');
        const zoneDataTotauxContainer = newDoc.getElementById('zone-data-totaux-container');

        const lineDataContainerA = newDoc.getElementById('line-data-container-a');
        const zoneDataContainerA = newDoc.getElementById('zone-data-container-a');
        const zoneDataTotauxContainerA = newDoc.getElementById('zone-data-totaux-container-a');
        const strucutresdatacontainer = newDoc.getElementById('strucutres-data-container');
        const chargecalorifiquedata = newDoc.getElementById('charge-calorifique-data');

        if (structure_selectionne===1) {

            const longueur = document.getElementById('longueur_cube_simple').value;
            const largeur = document.getElementById('largeur_cube_simple').value;
            const hauteur = document.getElementById('hauteur_cube_simple').value;

            strucutresdatacontainer.innerHTML = `
                <div style="white-space: nowrap;">
                <p style="display: inline-block; margin-right: 10px;">Longueur (L): <span style="color: blue;">${longueur} m</span></p>
                <p style="display: inline-block; margin-right: 10px;">Largeur (W): <span style="color: blue;">${largeur} m</span></p>
                <p style="display: inline-block; margin-right: 10px;">Hauteur (H): <span style="color: blue;">${hauteur} m</span></p>
                </div>

                `;




        } else if (structure_selectionne===2) {

            const longueur = document.getElementById('longueur_cube_edicule').value;
            const largeur = document.getElementById('largeur_cube_edicule').value;
            const hauteurmin = document.getElementById('hauteur_min_cube_edicule').value;
            const hauteurmax = document.getElementById('hauteur_max_cube_edicule').value;


            strucutresdatacontainer.innerHTML = `
                <div style="white-space: nowrap;">
                <p style="display: inline-block; margin-right: 10px;">Longueur (L): <span style="color: blue;">${longueur} m</span></p>
                <p style="display: inline-block; margin-right: 10px;">Largeur (W): <span style="color: blue;">${largeur} m</span></p>
                <p style="display: inline-block; margin-right: 10px;">Hauteur min (H): <span style="color: blue;">${hauteurmin} m</span></p>
                <p style="display: inline-block; margin-right: 10px;">Hauteur max (H): <span style="color: blue;">${hauteurmax} m</span></p>

                </div>

                `;




        } else if (structure_selectionne===3) {

            const rayon = document.getElementById('rayon_cylindre_simple').value;
            const hauteur = document.getElementById('hauteur_cylindre_simple').value;



            strucutresdatacontainer.innerHTML = `
                <div style="white-space: nowrap;">
                <p style="display: inline-block; margin-right: 10px;">Rayon (R): <span style="color: blue;">${rayon} m</span></p>
                <p style="display: inline-block; margin-right: 10px;">Hauteur (H): <span style="color: blue;">${hauteur} m</span></p>


                </div>

                `;




        } else if (structure_selectionne===4) {

            const rayon = document.getElementById('rayon_cylindre_edicule').value;
            const hauteurmin = document.getElementById('hauteur_min_cylindre_edicule').value;
            const hauteurmax = document.getElementById('hauteur_max_cylindre_edicule').value;



            strucutresdatacontainer.innerHTML = `
                <div style="white-space: nowrap;">
                <p style="display: inline-block; margin-right: 10px;">Rayon (R): <span style="color: blue;">${rayon} m</span></p>
                <p style="display: inline-block; margin-right: 10px;">Hauteur min (Hmin): <span style="color: blue;">${hauteurmin} m</span></p>
                <p style="display: inline-block; margin-right: 10px;">Hauteur max (Hmax): <span style="color: blue;">${hauteurmax} m</span></p>



                </div>

                `;




        } else if (structure_selectionne===5) {

            strucutresdatacontainer.innerHTML += `
                <p style="display: inline-block; margin-right: 10px;">Structure composée de:</span></p>
                
            `;


            const shapesContainer = document.getElementById('rectangles');
            const shapes = shapesContainer.children;

            for (let i = 0; i < shapes.length; i++) {
    
    
                const shape = shapes[i];

                const shapeId = shape.id;
        
                const type = shapeId.startsWith('rect') ? 'rectangle' : 'circle';


                
                 if (type==='rectangle') {

                    const label=document.getElementById(`${shapeId}Label`).innerText;
                    const length = document.getElementById(`${shapeId}L`).value;
                    const width = document.getElementById(`${shapeId}W`).value;
                    const x = document.getElementById(`${shapeId}x`).value;
                    const y = document.getElementById(`${shapeId}y`).value;
                    const height = document.getElementById(`${shapeId}H`).value;
                    

                    strucutresdatacontainer.innerHTML += `
                    
                    <div style="display: flex; flex-wrap: wrap;"> 
                    <p style="margin: 0 10px 0 0; padding: 0;">${label}</span></p> 
                    <p style="margin: 0 10px 0 0; padding: 0;">Longueur (L): <span style="color: blue;">${length} m</span></p>
                    <p style="margin: 0 10px 0 0; padding: 0;">Largeur (W): <span style="color: blue;">${width} m</span></p>
                    <p style="margin: 0 10px 0 0; padding: 0;">Hauteur (H): <span style="color: blue;">${height} m</span></p>
                    <p style="margin: 0 10px 0 0; padding: 0;">Position (X0): <span style="color: blue;">${x} m</span></p>
                    <p style="margin: 0 10px 0 0; padding: 0;">Position (Y0): <span style="color: blue;">${y} m</span></p>
                    </div>

                `;


       
                } else {

                    const label=document.getElementById(`${shapeId}Label`).innerText;
                    const rayon = document.getElementById(`${shapeId}r`).value;
                    const x = document.getElementById(`${shapeId}x`).value;
                    const y = document.getElementById(`${shapeId}y`).value;
                    const hauteur = document.getElementById(`${shapeId}H`).value;
                 
                    strucutresdatacontainer.innerHTML += `
                     
                    <div style="display: flex; flex-wrap: wrap;">
                    <p style="margin: 0 10px 0 0; padding: 0;">${label}</span></p>
                    <p style="margin: 0 10px 0 0; padding: 0;">Rayon (R): <span style="color: blue;">${rayon} m</span></p>
                    <p style="margin: 0 10px 0 0; padding: 0;">Hauteur (H): <span style="color: blue;">${hauteur} m</span></p>
                    <p style="margin: 0 10px 0 0; padding: 0;">Position (X0): <span style="color: blue;">${x} m</span></p>
                    <p style="margin: 0 10px 0 0; padding: 0;">Position (Y0): <span style="color: blue;">${y} m</span></p>
                    </div>

                    `;


                }



                }



        } 



  
        for (let i = 0; i < options.length; i++) {
            const selectedLine = options[i].text;

            if (lineData[selectedLine]) {
                const longueurligne=lineData[selectedLine]["longueurLigne"];
                const facteurInstallationLigneValeur = lineData[selectedLine]["facteurInstallationLigneValeur"];
                const facteurTransformateurValeur = lineData[selectedLine]["facteurTransformateurValeur"];
                const typeEnvironnementLigneValeur = lineData[selectedLine]["typeEnvironnementLigneValeur"];
                const emplacementRelatifStructureExtValeur = lineData[selectedLine]["emplacementRelatifStructureExtValeur"];
                const longueurbatiment = lineData[selectedLine]["longueurStructureExt"];
                const largeurbatiment = lineData[selectedLine]["largeurStructureExt"];
                const hauteurbatiment = lineData[selectedLine]["hauteurStructureExt"];
                const peb = lineData[selectedLine]["parafoudresPEBValeur"];
                const pspd = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
                const ks3 = lineData[selectedLine]["typeCablageInterneValeur"];
                const ks4 = lineData[selectedLine]["tensionAssigneeValeur"];
                const interface_isolement = lineData[selectedLine]["interfacesIsolementValeur"];
                const interface_isolementA = lineDataA[selectedLine]["interfacesIsolementValeur"];

                const pld = lineData[selectedLine]["typeCablageExternePLDValeur"];
                const pli = lineData[selectedLine]["typeCablageExternePLIValeur"];
                const plda = lineDataA[selectedLine]["typeCablageExternePLDValeur"];
                const plia = lineDataA[selectedLine]["typeCablageExternePLIValeur"];
                const cld = lineData[selectedLine]["conditionsBlindageCLDValeur"];
                const cli = lineData[selectedLine]["conditionsBlindageCLIValeur"];
                const clda = lineDataA[selectedLine]["conditionsBlindageCLDValeur"];
                const clia = lineDataA[selectedLine]["conditionsBlindageCLIValeur"];

                const pebA = lineDataA[selectedLine]["parafoudresPEBValeur"];
                const pspdA = lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"];
                const ks3A = lineDataA[selectedLine]["typeCablageInterneValeur"];
                const pldA = lineDataA[selectedLine]["typeCablageExternePLDValeur"];

                const Al = lineData[selectedLine]["Al"];
                const NL = lineData[selectedLine]["NL"];
                const Ai = lineData[selectedLine]["Ai"];
                const Nl = lineData[selectedLine]["Nl"];
                const Ada=lineData[selectedLine]["Ada"];
                const NDa=lineData[selectedLine]["NDa"];
                const kms=lineData[selectedLine]["KMS"];
                const pms=lineData[selectedLine]["PMS"];
                const pm=lineData[selectedLine]["PM"];
                const pu=lineData[selectedLine]["PU"];
                const pv=lineData[selectedLine]["PV"];
                const pw=lineData[selectedLine]["PW"];
                const pz=lineData[selectedLine]["PZ"];
                const pc=lineData[selectedLine]["PC"];

                const kmsA=lineDataA[selectedLine]["KMS"];
                const pmsA=lineDataA[selectedLine]["PMS"];
                const pmA=lineDataA[selectedLine]["PM"];
                const puA=lineDataA[selectedLine]["PU"];
                const pvA=lineDataA[selectedLine]["PV"];
                const pwA=lineDataA[selectedLine]["PW"];
                const pzA=lineDataA[selectedLine]["PZ"];
                const pcA=lineDataA[selectedLine]["PC"];

                



                    lineDataContainer.innerHTML += `
                    <h4 style="text-decoration: underline;">${selectedLine}</span></h4>
                    <p>Longueur du service: <span style="color: blue;">${longueurligne} m</span></p>
                    <p>Emplacement relatif de la structure à l'autre bout du service (Cda): <span style="color: blue;">${emplacementRelatifStructureExtValeur}</span></p>
                    <p>Longueur de la structure à l'autre bout du service (L): <span style="color: blue;">${longueurbatiment} m</span></p>
                    <p>Largeur de la structure à l'autre bout du service (W): <span style="color: blue;">${largeurbatiment} m</span></p>
                    <p>Hauteur de la structure à l'autre bout du service (H): <span style="color: blue;">${hauteurbatiment} m</span></p>  
                    <p>Facteur d'installation du service (Ci): <span style="color: blue;">${facteurInstallationLigneValeur}</span></p>               
                    <p>Facteur de type de service (Ct): <span style="color: blue;">${facteurTransformateurValeur}</span></p>
                    <p>Facteur d'environnement du service (Ce): <span style="color: blue;">${typeEnvironnementLigneValeur}</span></p>
                    <p>Surface d'exposition - Coups de foudre sur le service (Al): <span style="color: blue;">${Al} m<sup>2</sup></span></p>
                    <p>Surface d'exposition - Coups de foudre à proximité du service (Ai): <span style="color: blue;">${Ai} m<sup>2</sup></span></p>
                    <p>Nombre d'évènements - Coups de foudre sur le service (NL): <span style="color: blue;">${NL} /an</span></p>
                    <p>Nombre d'évènements - Coups de foudre à proximité du service (Nl): <span style="color: blue;">${Nl} /an</span></p>
                    <p>Surface d'exposition de la structure à l'autre bout du service (Ad/a): <span style="color: blue;">${Ada} m<sup>2</sup></span></p>
                    <p>Nombre d'évènements - Coups de foudre sur la structure à l'autre bout du service (NDa): <span style="color: blue;">${NDa} /an</sup></span></p>
                    <p>Parafoudres d'équipotentialité (PEB): <span style="color: blue;">${peb}</span></p>
                    <p>Parafoudres coordonnés (P PARAFOUDRE): <span style="color: blue;">${pspd}</span></p>
                    <p>Type de câblage interne (KS3): <span style="color: blue;">${ks3}</span></p>
                    <p>Interface d'isolement (Pour le calcul de PMS): <span style="color: blue;">${interface_isolement}</span></p>
                    <p>Tension assignée aux chocs de foudre du matériel (KS4): <span style="color: blue;">${ks4}</span></p>
                    <p>Type de câblage externe (PLD): <span style="color: blue;">${pld}</span></p>
                    <p>Type de câblage externe (PLI): <span style="color: blue;">${pli}</span></p>
                    <p>Facteurs associés aux conditions de blindage, de mise à la terre et d'isolation (CLD): <span style="color: blue;">${cld}</span></p>
                    <p>Facteurs associés aux conditions de blindage, de mise à la terre et d'isolation (CLI): <span style="color: blue;">${cli}</span></p>

                    <p>Coefficient KMS: <span style="color: blue;">${kms}</span></p>
                    <p>Probabilité PMS: <span style="color: blue;">${pms}</span></p>
                    <p>Probabilité pour qu'un impact sur la structure entraîne une défaillance des réseaux internes (PC): <span style="color: blue;">${pc}</span></p>
                    <p>Probabilité pour qu'un impact à proximité de la structure entraîne une défaillance des réseaux internes (PM): <span style="color: blue;">${pm}</span></p>       
                    <p>Probabilité pour qu'un impact sur le service entraîne dommages physiques (PV): <span style="color: blue;">${pv}</span></p>
                    <p>Probabilité pour qu'un impact sur le service entraîne une défaillance des équipements internes (PW): <span style="color: blue;">${pw}</span></p>
                    <p>Probabilité pour qu'un impact à proximité du service entraîne une défaillance des équipements internes (PZ): <span style="color: blue;">${pz}</span></p>


                `;


                lineDataContainerA.innerHTML += `
                    <h4 style="text-decoration: underline;">${selectedLine}</span></h4>
                    <p>Parafoudres d'équipotentialité (PEB): <span style="color: blue;">${pebA}</span></p>
                    <p>Parafoudres coordonnés (P PARAFOUDRE): <span style="color: blue;">${pspdA}</span></p>
                    <p>Type de câblage interne (KS3): <span style="color: blue;">${ks3A}</span></p>
                    <p>Interface d'isolement (Pour le calcul de PMS): <span style="color: blue;">${interface_isolementA}</span></p>
                    <p>Type de câblage externe (PLD): <span style="color: blue;">${pldA}</span></p>
                    <p>Facteurs associés aux conditions de blindage, de mise à la terre et d'isolation (CLD): <span style="color: blue;">${clda}</span></p>
                    <p>Facteurs associés aux conditions de blindage, de mise à la terre et d'isolation (CLI): <span style="color: blue;">${clia}</span></p>


                    <p>Coefficient KMS: <span style="color: blue;">${kmsA}</span></p>
                    <p>Probabilité PMS: <span style="color: blue;">${pmsA}</span></p>
                    <p>Probabilité pour qu'un impact sur la structure entraîne une défaillance des réseaux internes (PC): <span style="color: blue;">${pcA}</span></p>
                    <p>Probabilité pour qu'un impact à proximité de la structure entraîne une défaillance des réseaux internes (PM): <span style="color: blue;">${pmA}</span></p>       
                    <p>Probabilité pour qu'un impact sur le service entraîne dommages physiques (PV): <span style="color: blue;">${pvA}</span></p>
                    <p>Probabilité pour qu'un impact sur le service entraîne une défaillance des équipements internes (PW): <span style="color: blue;">${pwA}</span></p>
                    <p>Probabilité pour qu'un impact à proximité du service entraîne une défaillance des équipements internes (PZ): <span style="color: blue;">${pzA}</span></p>


                `;


   


            }


        }

        for (let j = 0; j < options_zone.length; j++) {
            const selectedZone = options_zone[j].text;

            if (zoneData[selectedZone]) {

                const pertesLtInt = zoneData[selectedZone]["PertesLtZoneIntValeur"];
                const pertesLf = zoneData[selectedZone]["PertesLfZoneValeur"];
                const pertesLo = zoneData[selectedZone]["PertesLoZoneValeur"];
                const hz = zoneData[selectedZone]["TypeDangerParticulierValeur"];
                const rf = zoneData[selectedZone]["FacteurRisqueIncendieValeur"];
                const rp = zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"];
                var lfe=zoneData[selectedZone]["PertesLFE"];
                var te=zoneData[selectedZone]["PertesTeLFE"];
                var ptws=zoneData[selectedZone]["PTWSLFE"];
                var ptwsA=zoneData[selectedZone]["PTWSLFE"];

                if (zoneData[selectedZone]["CheckedLFE"]=='false') {
                    lfe='Non considérées';
                    te='Non considérée';
                    ptws='Non considéré';

                }

                if (parseFloat(ptwsA)===0.0) {
                    ptwsA='Non considéré';
                }

                const raru = zoneData[selectedZone]["FacteurReductionToucherPasValeur"];
                const ks2 = zoneData[selectedZone]["EcranSpatialKS2Valeur"];
                const pta = zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"];
                const pa = zoneData[selectedZone]["PA"];
                const ptu = zoneData[selectedZone]["FacteurReductionToucherPasPTUValeur"];
                const pu = zoneData[selectedZone]["PU"];
                const pm = zoneData[selectedZone]["PM"];
                const pc = zoneData[selectedZone]["PC"];

                const rpA = zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"];
                const raruA = zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"];
                const ks2A = zoneData[selectedZone]["EcranSpatialKS2Valeur"];
                const ptaA = zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"];
                const paA = zoneData[selectedZone]["PA"];
                const ptuA = zoneDataA[selectedZone]["FacteurReductionToucherPasPTUValeur"];
                const puA = zoneDataA[selectedZone]["PU"];
                const pmA = zoneData[selectedZone]["PM"];
                const pcA = zoneData[selectedZone]["PC"];

                const risqueRAS= zoneData[selectedZone]["risqueRAS"];
                const risqueRBS= zoneData[selectedZone]["risqueRBS"];
                const risqueRCS= zoneData[selectedZone]["risqueRCS"];
                const risqueRMS= zoneData[selectedZone]["risqueRMS"];
                const risqueRUS= zoneData[selectedZone]["risqueRUS"];
                const risqueRVS= zoneData[selectedZone]["risqueRVS"];
                const risqueRWS= zoneData[selectedZone]["risqueRWS"];
                const risqueRZS= zoneData[selectedZone]["risqueRZS"];

                const risqueRAA= zoneDataA[selectedZone]["risqueRAA"];
                const risqueRBA= zoneDataA[selectedZone]["risqueRBA"];
                const risqueRCA= zoneDataA[selectedZone]["risqueRCA"];
                const risqueRMA= zoneDataA[selectedZone]["risqueRMA"];
                const risqueRUA= zoneDataA[selectedZone]["risqueRUA"];
                const risqueRVA= zoneDataA[selectedZone]["risqueRVA"];
                const risqueRWA= zoneDataA[selectedZone]["risqueRWA"];
                const risqueRZA= zoneDataA[selectedZone]["risqueRZA"];

                var chargecalorifique1;

                if (zoneData[selectedZone]["FacteurRisqueIncendie"]==='8') {

                    chargecalorifique1 = zoneData[selectedZone]["ChargeCalorifique"];

                } else {

                    chargecalorifique1 = 'Non calculée';

                }

                const chargecalorifique = chargecalorifique1;
             
                Ltintext=zoneData[selectedZone]["PertesLtZoneIntValeur"];

                const nz= zoneDatafloat[selectedZone]["nz"];
                const tz= zoneDatafloat[selectedZone]["tz"];


                const options_line = dropdownMenuLine.options;

                var lines_to_display =[];

                for (let k = 0; k < options_line.length; k++) {

                    const selectedLine = options_line[k].text;
                    if (selected_lines[selectedZone][selectedLine]===true) {
                        lines_to_display.push(selectedLine);
                    }

                }

                if (lines_to_display.length===0) {

                    lines_to_display='Aucun';
                }



                


                

                    zoneDataContainer.innerHTML += `
                    <h4 style="text-decoration: underline;">${selectedZone}</span></h4>
                    <p>Pertes dues aux tensions de contact et de pas (Lt) : <span style="color: blue;">${Ltintext}</span></p>
                     <p>Pertes dues aux dommages physiques (Lf): <span style="color: blue;">${pertesLf}</span></p>
                     <p>Pertes dues à la défaillance des équipements internes (Lo): <span style="color: blue;">${pertesLo}</span></p>
                    <p>Nombre de personnes dans la zone: <span style="color: blue;">${nz}</span></p>
                    <p>Durée annuelle de présence des personnes dans la zone: <span style="color: blue;">${tz} heures</span></p>

                    <p>Type de danger particulier (hz): <span style="color: blue;">${hz}</span></p>
                    <p>Charge calorifique dans la zone (MJ/m<sup>2</sup>): <span style="color: blue;"> ${chargecalorifique}</span></p>
                    <div id="charge-calorifique-data-${selectedZone}"></div>
                    <p>Facteur de réduction du risque incendie (rf): <span style="color: blue;">${rf}</span></p>                    
                    <p>Précautions prises contre le risque incendie (rp): <span style="color: blue;">${rp}</span></p>

                    <p>Pertes pour l'environnement (LFE): <span style="color: blue;">${lfe} %</span></p>
                    <p>Durée de présence des personnes à un emplacement dangereux à l’extérieur de la structure (te): <span style="color: blue;">${te}</span></p>
                    <p>Efficacité du système de détection d'orages (PWTS): <span style="color: blue;">${ptws} %</span></p>

                    <p>Facteur de réduction dû au type de sol ou de plancher (ra/ru): <span style="color: blue;">${raru}</span></p>
                    <p>Ecran spatial extérieur de la zone (KS2): <span style="color: blue;">${ks2}</span></p>
                    <p>Mesures de protection complémentaires contre les tensions de contact et de pas dues à un coup de foudre sur la structure (PTA): <span style="color: blue;">${pta}</span></p>
                    <p>Probabilité pour qu'un impact sur la structure entraîne des blessures sur les êtres vivants (PA): <span style="color: blue;">${pa}</span></p>
                    <p>Mesures de protection complémentaires contre les tensions de contact et de pas dues à un coup de foudre sur le service (PTU): <span style="color: blue;">${ptu}</span></p>
                    <p>Probabilité pour qu'un impact sur la structure entraîne une défaillance des réseaux internes (PC): <span style="color: blue;">${pc}</span></p>
                    <p>Probabilité pour qu'un impact à proximité de la structure entraîne une défaillance des réseaux internes (PM): <span style="color: blue;">${pm}</span></p>
                    <p>Risque RA lié aux tensions de contact et de pas dues à un impact sur la structure: <span style="color: blue;">${risqueRAS}</span></p>
                    <p>Risque RB lié aux dommages physiques dus à un impact sur la structure: <span style="color: blue;">${risqueRBS}</span></p>  
                    <p>Risque RC lié à la défaillance des réseaux internes due à un impact sur la structure: <span style="color: blue;">${risqueRCS}</span></p>  
                    <p>Risque RM lié à la défaillance des réseaux internes due à un impact à proximité de la structure: <span style="color: blue;">${risqueRMS}</span></p> 
                    <p>Risque RU lié aux tensions de contact et de pas dues à un impact sur le service: <span style="color: blue;">${risqueRUS}</span></p> 
                    <p>Risque RV lié aux dommages physiques dus à un impact sur le service: <span style="color: blue;">${risqueRVS}</span></p>
                    <p>Risque RW lié à la défaillance des réseaux internes due à un impact sur le service: <span style="color: blue;">${risqueRWS}</span></p> 
                    <p>Risque RZ lié à la défaillance des réseaux internes due à un impact à proximité du service le service: <span style="color: blue;">${risqueRZS}</span></p>       


                    <p>Services rattachées à la zone: <span style="color: blue;">${lines_to_display}</span></p>


                `;

                zoneDataContainerA.innerHTML += `
                    <h4 style="text-decoration: underline;">${selectedZone}</span></h4>

                    <p>Précautions prises contre le risque incendie (rp): <span style="color: blue;">${rpA}</span></p>
                    <p>Efficacité du système de détection d'orage (PTWS) (%) : <span style="color: blue;">${ptwsA}</span></p>
                    <p>Facteur de réduction dû au type de sol ou de plancher (ra/ru): <span style="color: blue;">${raruA}</span></p>
                    <p>Ecran spatial extérieur de la zone (KS2): <span style="color: blue;">${ks2A}</span></p>
                     <p>Mesures de protection complémentaires contre les tensions de contact et de pas dues à un coup de foudre sur la structure (PTA): <span style="color: blue;">${ptaA}</span></p>
                    <p>Probabilité pour qu'un impact sur la structure entraîne des blessures sur les êtres vivants (PA): <span style="color: blue;">${paA}</span></p>
                    <p>Mesures de protection complémentaires contre les tensions de contact et de pas dues à un coup de foudre sur le service (PTU): <span style="color: blue;">${ptuA}</span></p>
                    <p>Probabilité pour qu'un impact sur le service entraîne des blessures sur les êtres vivants (PU): <span style="color: blue;">${puA}</span></p>
                    <p>Probabilité pour qu'un impact sur la structure entraîne une défaillance des réseaux internes (PC): <span style="color: blue;">${pcA}</span></p>
                    <p>Probabilité pour qu'un impact à proximité de la structure entraîne une défaillance des réseaux internes (PM): <span style="color: blue;">${pmA}</span></p>
                    <p>Risque RA lié aux tensions de contact et de pas dues à un impact sur la structure: <span style="color: blue;">${risqueRAA}</span></p>
                    <p>Risque RB lié aux dommages physiques dus à un impact sur la structure: <span style="color: blue;">${risqueRBA}</span></p>  
                    <p>Risque RC lié à la défaillance des réseaux internes due à un impact sur la structure: <span style="color: blue;">${risqueRCA}</span></p>  
                    <p>Risque RM lié à la défaillance des réseaux internes due à un impact à proximité de la structure: <span style="color: blue;">${risqueRMA}</span></p> 
                    <p>Risque RU lié aux tensions de contact et de pas dues à un impact sur le service: <span style="color: blue;">${risqueRUA}</span></p> 
                    <p>Risque RV lié aux dommages physiques dus à un impact sur le service: <span style="color: blue;">${risqueRVA}</span></p>
                    <p>Risque RW lié à la défaillance des réseaux internes due à un impact sur le service: <span style="color: blue;">${risqueRWA}</span></p> 
                    <p>Risque RZ lié à la défaillance des réseaux internes due à un impact à proximité du service le service: <span style="color: blue;">${risqueRZA}</span></p>       

                `;

                

                if (zoneData[selectedZone]["FacteurRisqueIncendie"]==='8') {

                    const uniqueChargeCalId = `charge-calorifique-data-${selectedZone}`;

                    const chargecalorifiquedata = newDoc.getElementById(uniqueChargeCalId);
                                    


                    

                    chargecalorifiquedata.innerHTML += `
                    <p style="margin-right: 10px;">Charge calorifique composée de:</span></p>
                
                    `;

                    //const options = document.getElementById('dropdown-menu-risque').options;   

                    for (let i = 0; i < Object.keys(produits_data[selectedZone]).length; i++) {

                        const produit_name=Object.keys(produits_data[selectedZone])[i];

                        const PotentielCalorifique=produits_data[selectedZone][produit_name]["PotentielCalorifique"];
                        const QuantiteProduit=produits_data[selectedZone][produit_name]["QuantiteProduit"];

                        chargecalorifiquedata.innerHTML += `
                            
                        <div style="display: flex; flex-wrap: wrap;">
                            <p style="margin: 0 10px 0 0; padding: 0;">- ${produit_name}:</p>
                            <p style="margin: 0 10px 0 0; padding: 0;">Potentiel calorifique: <span style="color: blue;">${PotentielCalorifique} MJ/kg</span></p>
                            <p style="margin: 0; padding: 0;">Quantité du produit: <span style="color: blue;">${QuantiteProduit} kg</span></p>
                        </div>
                        `;


                    }

                    chargecalorifiquedata.innerHTML += `
                    <p style="display: inline-block; margin-right: 10px;">Surface de la zone:<span style="color: blue;">${zoneData[selectedZone]["ZoneSurface"]} m<sup>2</sup></span></p>
                
                    `;

                }
     
    


 
    
             






            }

        }

        const RA1S=RAS.toExponential(5);
        const RB1S=RBS.toExponential(5);
        const RC1S=RCS.toExponential(5);
        const RM1S=RMS.toExponential(5);
        const RU1S=RUS.toExponential(5);
        const RV1S=RVS.toExponential(5);
        const RW1S=RWS.toExponential(5);
        const RZ1S=RZS.toExponential(5);
        const R11S=R1S.toExponential(5);
        const RTT=RT.toExponential(5);

        const RA1A=RAA.toExponential(5);
        const RB1A=RBA.toExponential(5);
        const RC1A=RCA.toExponential(5);
        const RM1A=RMA.toExponential(5);
        const RU1A=RUA.toExponential(5);
        const RV1A=RVA.toExponential(5);
        const RW1A=RWA.toExponential(5);
        const RZ1A=RZA.toExponential(5);
        const R11A=R1A.toExponential(5);




        if (R11S>1e-5) {

            colortext='red';
            etat='NON PROTEGEE'
        } else {

            colortext='green';
            etat='PROTEGEE';
        }

        if (R11A>1e-5) {

            colortext_p='red';
            etat_p='NON PROTEGEE'
        } else {

            colortext_p='green';
            etat_p='PROTEGEE';
        }


        
        zoneDataTotauxContainer.innerHTML += `
            <p>Risque RA lié aux tensions de contact et de pas dues à un impact sur la structure: <span style="color: blue;">${RA1S}</span></p>
            <p>Risque RB lié aux dommages physiques dus à un impact sur la structure: <span style="color: blue;">${RB1S}</span></p>  
            <p>Risque RC lié à la défaillance des réseaux internes due à un impact sur la structure: <span style="color: blue;">${RC1S}</span></p>  
            <p>Risque RM lié à la défaillance des réseaux internes due à un impact à proximité de la structure: <span style="color: blue;">${RM1S}</span></p> 
            <p>Risque RU lié aux tensions de contact et de pas dues à un impact sur le service: <span style="color: blue;">${RU1S}</span></p> 
            <p>Risque RV lié aux dommages physiques dus à un impact sur le service: <span style="color: blue;">${RV1S}</span></p>
            <p>Risque RW lié à la défaillance des réseaux internes due à un impact sur le service: <span style="color: blue;">${RW1S}</span></p> 
            <p>Risque RZ lié à la défaillance des réseaux internes due à un impact à proximité du service le service: <span style="color: blue;">${RZ1S}</span></p>  
            <p><b>Risque total R1: <span style="color: blue;">${R11S}</span></b></p>
            <p><b>Risque tolérable: <span style="color: blue;">${RTT}</span></b></p>
            <p><b>Etat de la structure: <span style="color: ${colortext};">${etat}</span></b></p>
            
        `;

        //const chart1 = document.getElementById('chart1');
        //zoneDataTotauxContainer.appendChild(chart1);



        zoneDataTotauxContainerA.innerHTML += `
            <p>Risque RA lié aux tensions de contact et de pas dues à un impact sur la structure: <span style="color: blue;">${RA1A}</span></p>
            <p>Risque RB lié aux dommages physiques dus à un impact sur la structure: <span style="color: blue;">${RB1A}</span></p>  
            <p>Risque RC lié à la défaillance des réseaux internes due à un impact sur la structure: <span style="color: blue;">${RC1A}</span></p>  
            <p>Risque RM lié à la défaillance des réseaux internes due à un impact à proximité de la structure: <span style="color: blue;">${RM1A}</span></p> 
            <p>Risque RU lié aux tensions de contact et de pas dues à un impact sur le service: <span style="color: blue;">${RU1A}</span></p> 
            <p>Risque RV lié aux dommages physiques dus à un impact sur le service: <span style="color: blue;">${RV1A}</span></p>
            <p>Risque RW lié à la défaillance des réseaux internes due à un impact sur le service: <span style="color: blue;">${RW1A}</span></p> 
            <p>Risque RZ lié à la défaillance des réseaux internes due à un impact à proximité du service le service: <span style="color: blue;">${RZ1A}</span></p>  
            <p><b>Risque total R1: <span style="color: blue;">${R11A}</span></b></p>
            <p><b>Risque tolérable: <span style="color: blue;">${RTT}</span></b></p>
            <p><b>Etat de la structure: <span style="color: ${colortext_p};">${etat_p}</span></b></p>

        `;

        //const chart2 = document.getElementById('chart2');
        //zoneDataTotauxContainerA.appendChild(chart2);

        newWindow.print();

        const tempWindow = window.open('', '_blank', 'width=1,height=1');
        tempWindow.blur(); // Perdre le focus de la fenêtre temporaire
        window.focus(); // Revenir à la fenêtre principale
        setTimeout(() => tempWindow.close(), 10); // Fermer la fenêtre temporaire
       

        
    };

    

    //newWindow.onload();

    // Impression du contenu
    //newWindow.print();




}


function showDataD() {
    //const checkedData = getCheckedLineData();
    const newWindow = window.open('', '_blank');

    const newDoc = newWindow.document;
    const html = `
        <html>
        <head>
            <title>Définitions</title>
                <style>
                    /* Optional: CSS styles for the output window */
                </style>
        </head>
        <body>

                <h4 style="text-decoration: underline;">NORME DE REFERENCE: NF EN 62305-2 (Ed.2006)</h4>

                <h4 style="text-decoration: underline;">DEFINITIONS</h4>
                <p><strong>R1</strong>: Risque de perte de vie humaine</p>
                <p><strong>RA</strong>: Composante liée aux blessures d'êtres vivants dues aux tensions de contact et de pas</p>
                <p><strong>RB</strong>: Composante liée aux dommages physiques d'un étincelage dangereux dans la structure entraînant un incendie ou une explosion</p>
                <p style="margin-bottom: 30px;"><strong>RC</strong>: Composante liée à la défaillance des réseaux internes causées par l'impulsion électromagnétique de foudre</p>
              
           
        </body>
        </html>
    `;

    newDoc.open();
    newDoc.write(html);
    newDoc.close();


}






function copyDropdownLines() {
    // Get the source and destination dropdowns
    var sourceDropdown = document.getElementById('dropdown-menu-line');
    var destinationDropdown = document.getElementById('dropdown-menu-mesures');

    // Clear existing options in the destination dropdown
    destinationDropdown.innerHTML = '';

    // Loop through each option in the source dropdown
    for (var i = 0; i < sourceDropdown.options.length; i++) {
        var option = sourceDropdown.options[i];
                
        // Create a new option element
        var newOption = document.createElement('option');
                
        // Set the value and text of the new option element
        newOption.value = option.value;
        newOption.text = option.text;
                
        // Add the new option to the destination dropdown
        destinationDropdown.add(newOption);
            
    }
}

function copyDropdownZones() {
    // Get the source and destination dropdowns
    var sourceDropdown = document.getElementById('dropdown-menu-zone');
    var destinationDropdown = document.getElementById('dropdown-menu-zone-mesures');

    // Clear existing options in the destination dropdown
    destinationDropdown.innerHTML = '';

    // Loop through each option in the source dropdown
    for (var i = 0; i < sourceDropdown.options.length; i++) {
        var option = sourceDropdown.options[i];
                
        // Create a new option element
        var newOption = document.createElement('option');
                
        // Set the value and text of the new option element
        newOption.value = option.value;
        newOption.text = option.text;
                
        // Add the new option to the destination dropdown
        destinationDropdown.add(newOption);
            
    }
}





/////////////////dropdown with checkboxes ///////////////////////////////////

document.getElementById('densite_foudroiement').addEventListener('change',function() {


Ng = parseFloat(document.getElementById('densite_foudroiement').value);

if (Ng<=0 || isNaN(Ng)) {

    Ng = 1.0;
    document.getElementById('densite_foudroiement').value = '1'

}

updateResults();

});

nomProjet="Projet N°"

document.getElementById('nom_projet').addEventListener('change',function() {

nomProjet = document.getElementById('nom_projet').value;

});

nomRedacteur="Nom Prénom"

document.getElementById('nom_redacteur').addEventListener('change',function() {

nomRedacteur = document.getElementById('nom_redacteur').value;

});

nomSociete="Nom de la société"

document.getElementById('nom_societe').addEventListener('change',function() {

nomSociete = document.getElementById('nom_societe').value;

});

nomBatiment="Bâtiment N°"

document.getElementById('nom_batiment').addEventListener('change',function() {

nomBatiment = document.getElementById('nom_batiment').value;

});




var selectElement = document.getElementById('facteur-emplacement-options');
var displayElement = document.getElementById('display-value-emplacement-options');

selectElement.value = "1";
displayElement.value="1.00";



function toggleDropdown() {
    document.getElementById("dropdownContent").classList.toggle("show");
}

function toggleDropdownptu() {
    document.getElementById("dropdownContentptu").classList.toggle("show");
}

function toggleDropdown_mesures() {
    document.getElementById("dropdownContent_mesures").classList.toggle("show");
}
function toggleDropdownptu_mesures() {
    document.getElementById("dropdownContentptu_mesures").classList.toggle("show");
}


// Close the dropdown if the user clicks outside of it
window.onclick = function(event) {
    if (!event.target.matches('.dropdown button') && !event.target.matches('.dropdown-content') && !event.target.closest('.dropdown-content')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        for (var i = 0; i < dropdowns.length; i++) {
            var openDropdown = dropdowns[i];
            if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
            }
        }
    }

}



pa_array=[];
pa_array[1]=1.00;
pa_array[2]=1.00;
pa_array[3]=1.00;
pa_array[4]=1.00;
pa_array[5]=1.00;
pa_array[6]=1.00;

ptu_array=[];
ptu_array[1]=1.00;
ptu_array[2]=1.00;
ptu_array[3]=1.00;
ptu_array[4]=1.00;


pa_array_mesures=[];
pa_array_mesures[1]=1.00;
pa_array_mesures[2]=1.00;
pa_array_mesures[3]=1.00;
pa_array_mesures[4]=1.00;
pa_array_mesures[5]=1.00;
pa_array_mesures[6]=1.00;

ptu_array_mesures=[];
ptu_array_mesures[1]=1.00;
ptu_array_mesures[2]=1.00;
ptu_array_mesures[3]=1.00;
ptu_array_mesures[4]=1.00;



const dropdownContentId = document.getElementById('dropdownContent');

// Optional: Handle checkbox selections
const checkboxes = dropdownContentId.querySelectorAll('input[type="checkbox"]');
checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', (event) => {
        const checkedOptions = Array.from(checkboxes)
        
        //.filter(checkbox => checkbox.checked)
        .map(checkbox => `${checkbox.value}: ${checkbox.labels[0].innerText}`);
        const dropdownMenuZone = document.getElementById('dropdown-menu-zone');
        const selectedZone = dropdownMenuZone.value;

        
        zoneData[selectedZone][`option${checkbox.value}_checked`]=!zoneData[selectedZone][`option${checkbox.value}_checked`];

        if (checkbox.value==='1') {

            if (zoneData[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array[1]=1.00;

            } 

        } else if (checkbox.value==='2') {


            if (zoneData[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array[2]=0.01;

            } else {

                pa_array[2]=1.00;

                

            }
            


        } else if (checkbox.value==='3') {


            if (zoneData[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array[3]=0.01;

            } else {

                pa_array[3]=1.00;

                

            }


        } else if (checkbox.value==='4') {


            if (zoneData[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array[4]=0.1;

            } else {

                pa_array[4]=1.00;

                

            }


        } else if (checkbox.value==='5') {


            if (zoneData[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array[5]=0.00;

            } else {

                pa_array[5]=1.00;

                

            }


        } else if (checkbox.value==='6') {


            if (zoneData[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array[6]=0.00;

            } else {

                pa_array[6]=1.00;

                

            }


        }
        


        paa_sm=pa_array[1]*pa_array[2]*pa_array[3]*pa_array[4]*pa_array[5]*pa_array[6];
        zoneDatafloat[selectedZone]["FacteurPAValeur"]=paa_sm;
        paa_sm_st=paa_sm.toFixed(5);


        zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"]=paa_sm_st;
        document.getElementById('display-value-pa-options').value = zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"];

        //if (zoneDatafloatA[selectedZone]["FacteurPAValeur"]>zoneDatafloat[selectedZone]["FacteurPAValeur"]) {

            zoneDatafloatA[selectedZone]["FacteurPAValeur"]=zoneDatafloat[selectedZone]["FacteurPAValeur"];
            zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"]=zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"];

            zoneDataA[selectedZone]["option1_checked"]=zoneData[selectedZone]["option1_checked"];
            zoneDataA[selectedZone]["option2_checked"]=zoneData[selectedZone]["option2_checked"];
            zoneDataA[selectedZone]["option3_checked"]=zoneData[selectedZone]["option3_checked"];
            zoneDataA[selectedZone]["option4_checked"]=zoneData[selectedZone]["option4_checked"];
            zoneDataA[selectedZone]["option5_checked"]=zoneData[selectedZone]["option5_checked"];
            zoneDataA[selectedZone]["option6_checked"]=zoneData[selectedZone]["option6_checked"];

            document.getElementById('option1-mesures').checked=zoneData[selectedZone]["option1_checked"];
            document.getElementById('option2-mesures').checked=zoneData[selectedZone]["option2_checked"];
            document.getElementById('option3-mesures').checked=zoneData[selectedZone]["option3_checked"];
            document.getElementById('option4-mesures').checked=zoneData[selectedZone]["option4_checked"];
            document.getElementById('option5-mesures').checked=zoneData[selectedZone]["option5_checked"];
            document.getElementById('option6-mesures').checked=zoneData[selectedZone]["option6_checked"];

            document.getElementById('display-value-pa-options-mesures').value=zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"];

       updateResults();



    });

    
});


const dropdownContentptuId = document.getElementById('dropdownContentptu');

// Optional: Handle checkbox selections
const checkboxesptu = dropdownContentptuId.querySelectorAll('input[type="checkbox"]');
checkboxesptu.forEach(checkbox => {
    checkbox.addEventListener('change', (event) => {
        const checkedOptions = Array.from(checkboxesptu)
        
        //.filter(checkbox => checkbox.checked)
        .map(checkbox => `${checkbox.value}: ${checkbox.labels[0].innerText}`);
        const dropdownMenuZone = document.getElementById('dropdown-menu-zone');
        const selectedZone = dropdownMenuZone.value;

        
        zoneData[selectedZone][`optionptu${checkbox.value}_checked`]=!zoneData[selectedZone][`optionptu${checkbox.value}_checked`];

        if (checkbox.value==='1') {

            if (zoneData[selectedZone][`optionptu${checkbox.value}_checked`]===true) {

                ptu_array[1]=1.00;

            } 

        } else if (checkbox.value==='2') {


            if (zoneData[selectedZone][`optionptu${checkbox.value}_checked`]===true) {

                ptu_array[2]=0.1;

            } else {

                ptu_array[2]=1.00;

                

            }
            


        } else if (checkbox.value==='3') {


            if (zoneData[selectedZone][`optionptu${checkbox.value}_checked`]===true) {

                ptu_array[3]=0.01;

            } else {

                ptu_array[3]=1.00;

                

            }


        } else if (checkbox.value==='4') {


            if (zoneData[selectedZone][`optionptu${checkbox.value}_checked`]===true) {

                ptu_array[4]=0.00;

            } else {

                ptu_array[4]=1.00;

                

            }


        }        


        const ptu_sm=ptu_array[1]*ptu_array[2]*ptu_array[3]*ptu_array[4];
        zoneDatafloat[selectedZone]["FacteurPTUValeur"]=ptu_sm;

        const ptu_sm_st=ptu_sm.toFixed(5);

        zoneData[selectedZone]["FacteurReductionToucherPasPTUValeur"]=ptu_sm_st;
        document.getElementById('display-value-ptu-options').value = zoneData[selectedZone]["FacteurReductionToucherPasPTUValeur"];


        zoneDatafloatA[selectedZone]["FacteurPTUValeur"]=zoneDatafloat[selectedZone]["FacteurPTUValeur"];
        zoneDataA[selectedZone]["FacteurReductionToucherPasPTUValeur"]=zoneData[selectedZone]["FacteurReductionToucherPasPTUValeur"];

        zoneDataA[selectedZone]["optionptu1_checked"]=zoneData[selectedZone]["optionptu1_checked"];
        zoneDataA[selectedZone]["optionptu2_checked"]=zoneData[selectedZone]["optionptu2_checked"];
        zoneDataA[selectedZone]["optionptu3_checked"]=zoneData[selectedZone]["optionptu3_checked"];
        zoneDataA[selectedZone]["optionptu4_checked"]=zoneData[selectedZone]["optionptu4_checked"];

        document.getElementById('optionptu1-mesures').checked=zoneData[selectedZone]["optionptu1_checked"];
        document.getElementById('optionptu2-mesures').checked=zoneData[selectedZone]["optionptu2_checked"];
        document.getElementById('optionptu3-mesures').checked=zoneData[selectedZone]["optionptu3_checked"];
        document.getElementById('optionptu4-mesures').checked=zoneData[selectedZone]["optionptu4_checked"];

        document.getElementById('display-value-ptu-options-mesures').value=zoneDataA[selectedZone]["FacteurReductionToucherPasPTUValeur"];

       updateResults();



    });

    
});

//const dropdownMenuZoneMesuresA = document.getElementById('dropdown-menu-zone-mesures');


const dropdownContentIdMesures = document.getElementById('dropdownContent_mesures');

// Optional: Handle checkbox selections
const checkboxes_mesures = dropdownContentIdMesures.querySelectorAll('input[type="checkbox"]');
checkboxes_mesures.forEach(checkbox => {
    checkbox.addEventListener('change', (event) => {
        const checkedOptions = Array.from(checkboxes_mesures)
        
        //.filter(checkbox => checkbox.checked)
        .map(checkbox => `${checkbox.value}: ${checkbox.labels[0].innerText}`);
        const dropdownMenuZone = document.getElementById('dropdown-menu-zone-mesures');
        const selectedZone = dropdownMenuZone.value;

        
        zoneDataA[selectedZone][`option${checkbox.value}_checked`]=!zoneDataA[selectedZone][`option${checkbox.value}_checked`];

        if (checkbox.value==='1') {

            if (zoneDataA[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array_mesures[1]=1.00;

            } 

        } else if (checkbox.value==='2') {


            if (zoneDataA[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array_mesures[2]=0.01;

            } else {

                pa_array_mesures[2]=1.00;

                

            }
            


        } else if (checkbox.value==='3') {


            if (zoneDataA[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array_mesures[3]=0.01;

            } else {

                pa_array_mesures[3]=1.00;

                

            }


        } else if (checkbox.value==='4') {


            if (zoneDataA[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array_mesures[4]=0.1;

            } else {

                pa_array_mesures[4]=1.00;

                

            }


        } else if (checkbox.value==='5') {


            if (zoneDataA[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array_mesures[5]=0.00;

            } else {

                pa_array_mesures[5]=1.00;

                

            }


        } else if (checkbox.value==='6') {


            if (zoneDataA[selectedZone][`option${checkbox.value}_checked`]===true) {

                pa_array_mesures[6]=0.00;

            } else {

                pa_array_mesures[6]=1.00;

                

            }


        }
        

        ///paa=pa_array_mesures[1]*pa_array_mesures[2]*pa_array_mesures[3]*pa_array_mesures[4]*pa_array_mesures[5]*pa_array_mesures[6];
        //paa_st=paa.toFixed(5);


        //zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"]=paa_st;
        //document.getElementById('display-value-pa-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"];


        paa_am=pa_array_mesures[1]*pa_array_mesures[2]*pa_array_mesures[3]*pa_array_mesures[4]*pa_array_mesures[5]*pa_array_mesures[6];
        zoneDatafloatA[selectedZone]["FacteurPAValeur"]=paa_am;
        paa_am_st=paa_am.toFixed(5);


        zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"]=paa_am_st;
        document.getElementById('display-value-pa-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"];

        if (zoneDatafloatA[selectedZone]["FacteurPAValeur"]>zoneDatafloat[selectedZone]["FacteurPAValeur"]) {

            zoneDatafloatA[selectedZone]["FacteurPAValeur"]=zoneDatafloat[selectedZone]["FacteurPAValeur"];
            zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"]=zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"];

            zoneDataA[selectedZone]["option1_checked"]=zoneData[selectedZone]["option1_checked"];
            zoneDataA[selectedZone]["option2_checked"]=zoneData[selectedZone]["option2_checked"];
            zoneDataA[selectedZone]["option3_checked"]=zoneData[selectedZone]["option3_checked"];
            zoneDataA[selectedZone]["option4_checked"]=zoneData[selectedZone]["option4_checked"];
            zoneDataA[selectedZone]["option5_checked"]=zoneData[selectedZone]["option5_checked"];
            zoneDataA[selectedZone]["option6_checked"]=zoneData[selectedZone]["option6_checked"];

            document.getElementById('option1-mesures').checked=zoneData[selectedZone]["option1_checked"];
            document.getElementById('option2-mesures').checked=zoneData[selectedZone]["option2_checked"];
            document.getElementById('option3-mesures').checked=zoneData[selectedZone]["option3_checked"];
            document.getElementById('option4-mesures').checked=zoneData[selectedZone]["option4_checked"];
            document.getElementById('option5-mesures').checked=zoneData[selectedZone]["option5_checked"];
            document.getElementById('option6-mesures').checked=zoneData[selectedZone]["option6_checked"];

            document.getElementById('display-value-pa-options-mesures').value=zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"];






        }

        updateResults();


    });

    
});


const dropdownContentptuIdMesures = document.getElementById('dropdownContentptu_mesures');

// Optional: Handle checkbox selections
const checkboxesptumesures = dropdownContentptuIdMesures.querySelectorAll('input[type="checkbox"]');
checkboxesptumesures.forEach(checkbox => {
    checkbox.addEventListener('change', (event) => {
        const checkedOptions = Array.from(checkboxesptumesures)
        
        //.filter(checkbox => checkbox.checked)
        .map(checkbox => `${checkbox.value}: ${checkbox.labels[0].innerText}`);
        const dropdownMenuZoneMesures = document.getElementById('dropdown-menu-zone-mesures');
        const selectedZone = dropdownMenuZoneMesures.value;

        
        zoneDataA[selectedZone][`optionptu${checkbox.value}_checked`]=!zoneDataA[selectedZone][`optionptu${checkbox.value}_checked`];

        if (checkbox.value==='1') {

            if (zoneDataA[selectedZone][`optionptu${checkbox.value}_checked`]===true) {

                ptu_array_mesures[1]=1.00;

            } 

        } else if (checkbox.value==='2') {


            if (zoneDataA[selectedZone][`optionptu${checkbox.value}_checked`]===true) {

                ptu_array_mesures[2]=0.1;

            } else {

                ptu_array_mesures[2]=1.00;

                

            }
            


        } else if (checkbox.value==='3') {


            if (zoneDataA[selectedZone][`optionptu${checkbox.value}_checked`]===true) {

                ptu_array_mesures[3]=0.01;

            } else {

                ptu_array_mesures[3]=1.00;

                

            }


        } else if (checkbox.value==='4') {


            if (zoneDataA[selectedZone][`optionptu${checkbox.value}_checked`]===true) {

                ptu_array_mesures[4]=0.00;

            } else {

                ptu_array_mesures[4]=1.00;

                

            }


        }        


        const ptu_am=ptu_array_mesures[1]*ptu_array_mesures[2]*ptu_array_mesures[3]*ptu_array_mesures[4];
        zoneDatafloatA[selectedZone]["FacteurPTUValeur"]=ptu_am;

        const ptu_am_st=ptu_am.toFixed(5);

        zoneDataA[selectedZone]["FacteurReductionToucherPasPTUValeur"]=ptu_am_st;

        document.getElementById('display-value-ptu-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPTUValeur"];
        document.getElementById('optionptu1-mesures').checked=zoneDataA[selectedZone]["optionptu1_checked"];
        document.getElementById('optionptu2-mesures').checked=zoneDataA[selectedZone]["optionptu2_checked"];
        document.getElementById('optionptu3-mesures').checked=zoneDataA[selectedZone]["optionptu3_checked"];
        document.getElementById('optionptu4-mesures').checked=zoneDataA[selectedZone]["optionptu4_checked"];

        if (zoneDatafloatA[selectedZone]["FacteurPTUValeur"]>=zoneDatafloat[selectedZone]["FacteurPTUValeur"]) {

            document.getElementById('optionptu1-mesures').checked=zoneData[selectedZone]["optionptu1_checked"];
            document.getElementById('optionptu2-mesures').checked=zoneData[selectedZone]["optionptu2_checked"];
            document.getElementById('optionptu3-mesures').checked=zoneData[selectedZone]["optionptu3_checked"];
            document.getElementById('optionptu4-mesures').checked=zoneData[selectedZone]["optionptu4_checked"];
            document.getElementById('display-value-ptu-options-mesures').value=zoneData[selectedZone]["FacteurReductionToucherPasPTUValeur"];

            zoneDatafloatA[selectedZone]["FacteurPTUValeur"]=zoneDatafloat[selectedZone]["FacteurPTUValeur"];
            zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"]=zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"];

            zoneDataA[selectedZone]["optionptu1_checked"]=zoneData[selectedZone]["optionptu1_checked"];
            zoneDataA[selectedZone]["optionptu2_checked"]=zoneData[selectedZone]["optionptu2_checked"];
            zoneDataA[selectedZone]["optionptu3_checked"]=zoneData[selectedZone]["optionptu3_checked"];
            zoneDataA[selectedZone]["optionptu4_checked"]=zoneData[selectedZone]["optionptu4_checked"];




        }




       updateResults();



    });

    
});





/////////////////dropdown with checkboxes ///////////////////////////////////


document.getElementById('checkbox-container').addEventListener('change', (event) =>{

    const dropdownMenuZone = document.getElementById('dropdown-menu-zone');
    const selectedZone = dropdownMenuZone.value;
    const selected_line_zone=event.target.name;

    if (event.target.checked) {

        selected_lines[selectedZone][selected_line_zone]=true;

    } else {

        selected_lines[selectedZone][selected_line_zone]=false;

    }

    updateResults();


    




});


function getCheckedLineData() {
    const checkboxes =document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]:checked');
    const checkedData = {};

    checkboxes.forEach((checkbox) => {
        const lineName = checkbox.name;
        checkedData[lineName] = lineData[lineName];
    });

    return checkedData

}




document.addEventListener("DOMContentLoaded", function() {

    
    var selectElement = document.getElementById('facteur-emplacement-options');
    var displayElement = document.getElementById('display-value-emplacement-options');

    selectElement.value = "1";
    displayElement.value="1.00";


    var selectElement = document.getElementById('systeme-spf-options');
    var displayElement = document.getElementById('display-value-spf-options');
    selectElement.value = "1";
    displayElement.value="1.00";

    var selectElement = document.getElementById('systeme-spf-options-mesures');
    var displayElement = document.getElementById('display-value-spf-options-mesures');
    selectElement.value = document.getElementById('systeme-spf-options').value;
    displayElement.value=document.getElementById('display-value-spf-options').value;
    
    var selectElement = document.getElementById('systeme-ecran-options');
    var displayElement = document.getElementById('display-value-ecran-options');
    
    selectElement.value = "1";
    displayElement.value="1.00";

    var selectElement = document.getElementById('systeme-ecran-options-mesures');
    var displayElement = document.getElementById('display-value-ecran-options-mesures');
    
    selectElement.value = document.getElementById('systeme-ecran-options').value;
    displayElement.value=document.getElementById('display-value-ecran-options').value;


    document.getElementById('facteur-emplacement-options').addEventListener('change', function() {
        var selectElement = document.getElementById('facteur-emplacement-options').value;
        var displayElement_exposition = document.getElementById('display-value-emplacement-options');

        if (selectElement==='0.25') {

            displayElement_exposition.value='0.25';

        } else if (selectElement==='0.5') {

            displayElement_exposition.value='0.50';
        } else if (selectElement==='1') {

            displayElement_exposition.value='1.00';
        } else if (selectElement==='2') {

            displayElement_exposition.value='2.00';
        } 

        Cd = parseFloat(displayElement_exposition.value);

        updateResults();



    })





    document.getElementById('systeme-spf-options').addEventListener('change', function() {
        var selectElement = document.getElementById("systeme-spf-options").value;
        var displayElement_spf = document.getElementById('display-value-spf-options');

        if (selectElement==='1') {

            displayElement_spf.value='1.00';
            peb_test_sm='1.00';

        } else if (selectElement==='2') {

            displayElement_spf.value='0.20';
            peb_test_sm='0.05';

        } else if (selectElement==='3') {

            displayElement_spf.value='0.10';
            peb_test_sm='0.05';

        } else if (selectElement==='4') {

            displayElement_spf.value='0.05';
            peb_test_sm='0.02';

        } else if (selectElement==='5') {

            displayElement_spf.value='0.02';
            peb_test_sm='0.01';


        } else if (selectElement==='6') {

            displayElement_spf.value='0.01';
            peb_test_sm='0.005';

        } else if (selectElement==='7') {

            displayElement_spf.value='0.001';
            peb_test_sm='0.001';
        } 

        PB = parseFloat(displayElement_spf.value);

        //if (PBA>PB) {

            PBA=PB;
            document.getElementById("systeme-spf-options-mesures").value=document.getElementById("systeme-spf-options").value;
            document.getElementById('display-value-spf-options-mesures').value=document.getElementById('display-value-spf-options').value;
            peb_test_am=peb_test_sm;

            const checkboxes =document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]');

            checkboxes.forEach((checkbox) => {
            var selectedLine=checkbox.name;

            lineDataA[selectedLine]["parafoudresPEB"]=peb_test_am;
            lineDataA[selectedLine]["parafoudresPEBValeur"]=peb_test_am;

            document.getElementById('display-value-equipotentialite-mesures').value = lineDataA[selectedLine]["parafoudresPEBValeur"];
            document.getElementById('parafoudres-equipotentialite_select_mesures').value = lineDataA[selectedLine]["parafoudresPEB"];

            });

        //}


        //const checkboxes =document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]');

        //checkboxes.forEach((checkbox) => {
        //var selectedLine=checkbox.name;

        //lineData[selectedLine]["parafoudresPEB"]=peb_test_sm;
        //lineData[selectedLine]["parafoudresPEBValeur"]=peb_test_sm;

        //document.getElementById('display-value-equipotentialite').value = lineData[selectedLine]["parafoudresPEBValeur"];
        //document.getElementById('parafoudres-equipotentialite_select').value = lineData[selectedLine]["parafoudresPEB"];

        //});





       

        updateResults();


    }); 


    document.getElementById('systeme-spf-options-mesures').addEventListener('change', function() {
        var selectElement = document.getElementById("systeme-spf-options-mesures").value;
        var displayElement_spf = document.getElementById('display-value-spf-options-mesures');

        if (selectElement==='1') {

            displayElement_spf.value='1.00';
            peb_test_am='1.00';

        } else if (selectElement==='2') {

            displayElement_spf.value='0.20';
            peb_test_am='0.05';

        } else if (selectElement==='3') {

            displayElement_spf.value='0.10';
            peb_test_am='0.05';

        } else if (selectElement==='4') {

            displayElement_spf.value='0.05';
            peb_test_am='0.02';

        } else if (selectElement==='5') {

            displayElement_spf.value='0.02';
            peb_test_am='0.01';


        } else if (selectElement==='6') {

            displayElement_spf.value='0.01';
            peb_test_am='0.005';

        } else if (selectElement==='7') {

            displayElement_spf.value='0.001';
            peb_test_am='0.001';
        } 

        PBA = parseFloat(displayElement_spf.value);

        if (PBA>PB) {

            PBA=PB;
            document.getElementById("systeme-spf-options-mesures").value=document.getElementById("systeme-spf-options").value;
            document.getElementById('display-value-spf-options-mesures').value=document.getElementById('display-value-spf-options').value;
            peb_test_am=peb_test_sm;

        }

        const checkboxes =document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]');

        checkboxes.forEach((checkbox) => {
        var selectedLine=checkbox.name;

        lineDataA[selectedLine]["parafoudresPEB"]=peb_test_am;
        lineDataA[selectedLine]["parafoudresPEBValeur"]=peb_test_am;

        document.getElementById('display-value-equipotentialite-mesures').value = lineDataA[selectedLine]["parafoudresPEBValeur"];
        document.getElementById('parafoudres-equipotentialite_select_mesures').value = lineDataA[selectedLine]["parafoudresPEB"];

        });





       

        updateResults();


    }); 

    document.getElementById('systeme-ecran-options').addEventListener('change', function() {
        var selectElement = document.getElementById("systeme-ecran-options").value;
        var displayElement_ecran = document.getElementById('display-value-ecran-options');
        var taille_mailles_ecran = document.getElementById('taille-mailles-input');

        if (selectElement==='1') {

            displayElement_ecran.value='1.00';
            KS1=1.0;


        } else if (selectElement==='2') {

            displayElement_ecran.value='0.0001';
            KS1=0.0001;



        } else if (selectElement==='3') {

            displayElement_ecran.value='0.00001';
            KS1=0.00001;

        } else if (selectElement==='4') {


            KS1=0.12*parseFloat((taille_mailles_ecran).value);

            if (KS1>1.0) {
                KS1=1.00;
            }

            displayElement_ecran.value=KS1.toFixed(2);
            
            //document.getElementById('taille-mailles-input').classList.remove('grayed-out-mailles')
            //document.getElementById('taille-mailles-label').classList.remove('titre_label_mailles')

            
            document.getElementById('taille-mailles-input').className='center_container_options_b_text';
            document.getElementById('taille-mailles-label').className='titre_label';

            document.getElementById('taille-mailles-input-mesures').className='input_select_lines';
            document.getElementById('taille-mailles-label-mesures').className='label_input_field';





        }

        if (selectElement!=='4') {

 
            //document.getElementById('taille-mailles-input').classList.remove('titre_label_mailles')
            //document.getElementById('taille-mailles-label').classList.remove('titre_label')

            document.getElementById('taille-mailles-input').className='grayed-out-mailles';
            document.getElementById('taille-mailles-label').className='titre_label_mailles';

            document.getElementById('taille-mailles-input-mesures').className='grayed-out-mailles-KS2';
            document.getElementById('taille-mailles-label-mesures').className='titre_label_mailles_KS2';


        }

        
        //if (KS1A>KS1) {

            KS1A=KS1;

            document.getElementById('taille-mailles-input-mesures').value=document.getElementById('taille-mailles-input').value;
            document.getElementById("systeme-ecran-options-mesures").value=document.getElementById("systeme-ecran-options").value;
            document.getElementById('display-value-ecran-options-mesures').value=document.getElementById('display-value-ecran-options').value;
            


        //}

        updateResults();



    });


    document.getElementById('taille-mailles-input').addEventListener('input', function() {
        var taille_mailles_ecran = document.getElementById("taille-mailles-input").value;
        var displayElement_ecran = document.getElementById('display-value-ecran-options');
        var taille_mailles_ecrann=parseFloat(taille_mailles_ecran);

        if (isNaN(taille_mailles_ecrann) || taille_mailles_ecrann <= 0) {
            
            document.getElementById('taille-mailles-input').value = '0.01';
            KS1=0.0012;

        } else {

            KS1=0.12*parseFloat(taille_mailles_ecrann);

            if (KS1>1.0) {

                KS1=1.0;
            }

        }

        //if (KS1A>KS1) {

            KS1A=KS1;

            document.getElementById('taille-mailles-input-mesures').value=document.getElementById('taille-mailles-input').value;
            document.getElementById("systeme-ecran-options-mesures").value=document.getElementById("systeme-ecran-options").value;
            document.getElementById('display-value-ecran-options-mesures').value=document.getElementById('display-value-ecran-options').value;



        //}

        displayElement_ecran.value=KS1.toFixed(2);

        updateResults();


    }); 

    document.getElementById('systeme-ecran-options-mesures').addEventListener('change', function() {
        var selectElement = document.getElementById("systeme-ecran-options-mesures").value;
        var displayElement_ecran = document.getElementById('display-value-ecran-options-mesures');
        var taille_mailles_ecran = document.getElementById('taille-mailles-input-mesures');

        if (selectElement==='1') {

            displayElement_ecran.value='1.00';
            KS1A=1.0;


        } else if (selectElement==='2') {

            displayElement_ecran.value='0.0001';
            KS1A=0.0001;



        } else if (selectElement==='3') {

            displayElement_ecran.value='0.00001';
            KS1A=0.00001;

        } else if (selectElement==='4') {


            KS1A=0.12*parseFloat((taille_mailles_ecran).value);

            if (KS1A>1.0) {
                KS1A=1.00;
            }


            displayElement_ecran.value=KS1A.toFixed(2);


            document.getElementById('taille-mailles-input-mesures').className='input_select_lines';
            document.getElementById('taille-mailles-label-mesures').className='label_input_field';




        }

        if (selectElement!=='4') {


            document.getElementById('taille-mailles-input-mesures').className='grayed-out-mailles-KS2';
            document.getElementById('taille-mailles-label-mesures').className='titre_label_mailles_KS2';


        }

        if (KS1A>KS1) {

            KS1A=KS1;

            document.getElementById('taille-mailles-input-mesures').value=document.getElementById('taille-mailles-input').value;
            document.getElementById("systeme-ecran-options-mesures").value=document.getElementById("systeme-ecran-options").value;
            document.getElementById('display-value-ecran-options-mesures').value=document.getElementById('display-value-ecran-options').value;

        }

        updateResults();



    });


    document.getElementById('taille-mailles-input-mesures').addEventListener('input', function() {
        var taille_mailles_ecran = document.getElementById("taille-mailles-input-mesures").value;
        var displayElement_ecran = document.getElementById('display-value-ecran-options-mesures');
        var taille_mailles_ecrann=parseFloat(taille_mailles_ecran);

        if (isNaN(taille_mailles_ecrann) || taille_mailles_ecrann <= 0) {
            
            document.getElementById('taille-mailles-input-mesures').value = '0.01';
            KS1A=0.0012;

        } else {

            KS1A=0.12*parseFloat(taille_mailles_ecrann);

            if (KS1A>1.0) {

                KS1A=1.0;
            }

        }

        if (KS1A>KS1) {

            KS1A=KS1;

            document.getElementById('taille-mailles-input-mesures').value=document.getElementById('taille-mailles-input').value;
            document.getElementById("systeme-ecran-options-mesures").value=document.getElementById("systeme-ecran-options").value;
            //document.getElementById('display-value-ecran-options-mesures').value=document.getElementById('display-value-ecran-options').value;



        }

        displayElement_ecran.value=KS1A.toFixed(2);


        updateResults();


    }); 






    //showValue_structure();
});







document.addEventListener('DOMContentLoaded', function() {
    const dropdownMenuLine = document.getElementById('dropdown-menu-line');
    const addLineButton = document.getElementById('add-line-btn');
    const lineList = document.getElementById('line-list');
    const checkboxContainer = document.getElementById('checkbox-container');
    const selectedDataContainer = document.getElementById('selected-data-container');

    const selectedLine = dropdownMenuLine.value;

    lineData[selectedLine] = {
        "typeCheminement": "enterre",
        "longueurLigne": "1000.00",
        "facteurInstallationLigne": "1.0",
        "facteurInstallationLigneValeur": "1.00",
        "typeEnvironnementLigne": "1.0",
        "typeEnvironnementLigneValeur":"1.0",
        "facteurTransformateur": "1.0",
        "facteurTransformateurValeur": "1.0",
        "longueurStructureExt":"10.00",
        "largeurStructureExt":"10.00",
        "hauteurStructureExt":"10.00",
        "emplacementRelatifStructureExt": "1",
        "emplacementRelatifStructureExtValeur": "1.00",
        "parafoudresCoordonnesPspd": "1.00",
        "parafoudresCoordonnesPspdValeur": "1.00",
        "parafoudresPEB": "1.00",
        "parafoudresPEBValeur": "1.00",
        "typeCablageInterne": "1.0",
        "typeCablageInterneValeur": "1.0",
        "tensionAssignee":"1.5",
        "tensionAssigneeValeur":"1.00",
        "interfacesIsolement":"1.00",
        "interfacesIsolementValeur":"1.00",
        "typeCablageExternePLD": "1",
        "typeCablageExternePLI": "1",
        "typeCablageExternePLDValeur": "1.00",
        "typeCablageExternePLIValeur": "1.00",
        "conditionsBlindageCLDCLI":"1",
        "conditionsBlindageCLDValeur":"1.00",
        "conditionsBlindageCLIValeur":"1.00",
        "Al":"0.00",
        "NL":"0.00",
        "Ai":"0.00",
        "Nl":"0.00",
        "Ada":"0.00",
        "NDa":"0.00",
        "KMS":"1.00",
        "PMS":"1.00",
        "PM":"1.00",
        "PV":"1.00",
        "PW":"1.00",
        "PZ":"1.00",
        "PC":"1.00"
    
    }

    lineData_float[selectedLine] = {

        "tensionAssigneeValeur":1.00,

  
    }

    lineDataA[selectedLine] = {
        "parafoudresCoordonnesPspd": "1.00",
        "parafoudresCoordonnesPspdValeur": "1.00",
        "parafoudresPEB": "1.00",
        "parafoudresPEBValeur": "1.00",
        "interfacesIsolement":"1.00",
        "interfacesIsolementValeur":"1.00",
        "typeCablageInterne": "1.0",
        "typeCablageInterneValeur": "1.00",
        "typeCablageExternePLD": "1",
        "typeCablageExternePLI": "1",
        "typeCablageExternePLDValeur": "1.00",
        "typeCablageExternePLIValeur": "1.00",
        "conditionsBlindageCLDCLI":"1",
        "conditionsBlindageCLDValeur":"1.00",
        "conditionsBlindageCLIValeur":"1.00",
        "KMS":"1.00",
        "PMS":"1.00",
        "PM":"1.00",
        "PV":"1.00",
        "PW":"1.00",
        "PZ":"1.00",
        "PC":"1.00"
  
  
    }

    document.getElementById('longueur-ligne').value = lineData[selectedLine]["longueurLigne"];

    document.getElementById('facteur-installation-ligne').value = lineData[selectedLine]["facteurInstallationLigne"];
    document.getElementById('display-value-installation-ligne').value = lineData[selectedLine]["facteurInstallationLigneValeur"];

    document.getElementById('environnement-ligne').value = lineData[selectedLine]["typeEnvironnementLigne"];
    document.getElementById('display-value-environnement-ligne').value = lineData[selectedLine]["typeEnvironnementLigneValeur"];

    document.getElementById('facteur-transformateur').value = lineData[selectedLine]["facteurTransformateur"];
    document.getElementById('display-value-facteur-transformateur').value = lineData[selectedLine]["facteurTransformateurValeur"]; 

    document.getElementById('display-value-longueur-batiment').value = lineData[selectedLine]["longueurStructureExt"]; 
    document.getElementById('display-value-largeur-batiment').value = lineData[selectedLine]["largeurStructureExt"]; 
    document.getElementById('display-value-hauteur-batiment').value = lineData[selectedLine]["hauteurStructureExt"]; 

    document.getElementById('emplacement-relatif-extremite').value = lineData[selectedLine]["emplacementRelatifStructureExt"];
    document.getElementById('display-value-facteur-emplacement-extremite').value = lineData[selectedLine]["emplacementRelatifStructureExtValeur"];

    document.getElementById('parafoudres-coordonnes_select').value = lineData[selectedLine]["parafoudresCoordonnesPspd"];
    document.getElementById('display-value-pspd').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];

    document.getElementById('parafoudres-equipotentialite_select').value = lineData[selectedLine]["parafoudresPEB"];
    document.getElementById('display-value-equipotentialite').value = lineData[selectedLine]["parafoudresPEBValeur"];

    document.getElementById('type-cablage-interne-select').value = lineData[selectedLine]["typeCablageInterne"];
    document.getElementById('display-value-ks3').value = lineData[selectedLine]["typeCablageInterneValeur"];

    document.getElementById('tension-assignee-chocs').value = lineData[selectedLine]["tensionAssignee"];
    
    document.getElementById('display-value-uw').value = lineData[selectedLine]["tensionAssigneeValeur"];

    document.getElementById('interfaces_isolement_select').value = lineData[selectedLine]["interfacesIsolement"];
    document.getElementById('display-value-interfaces-isolement').value = lineData[selectedLine]["interfacesIsolementValeur"];

    document.getElementById('interfaces_isolement_select_mesures').value = lineDataA[selectedLine]["interfacesIsolement"];
    document.getElementById('display-value-interfaces-isolement-mesures').value = lineDataA[selectedLine]["interfacesIsolementValeur"];

    document.getElementById('resistance-ecran-pld').value = lineData[selectedLine]["typeCablageExternePLD"];
    document.getElementById('resistance-ecran-pli').value = lineData[selectedLine]["typeCablageExternePLI"];
    document.getElementById('display-value-pld').value = lineData[selectedLine]["typeCablageExternePLDValeur"];
    document.getElementById('display-value-pli').value = lineData[selectedLine]["typeCablageExternePLIValeur"];

    document.getElementById('conditions-blindage-cld-cli-mesures').value = lineDataA[selectedLine]["typeCablageExternePLD"];
    document.getElementById('display-value-cld-mesures').value = lineDataA[selectedLine]["conditionsBlindageCLDValeur"];
    document.getElementById('display-value-cli-mesures').value = lineDataA[selectedLine]["conditionsBlindageCLIValeur"];

    document.getElementById('conditions-blindage-cld-cli').value = lineData[selectedLine]["typeCablageExternePLD"];
    document.getElementById('display-value-cld').value = lineData[selectedLine]["conditionsBlindageCLDValeur"];
    document.getElementById('display-value-cli').value = lineData[selectedLine]["conditionsBlindageCLIValeur"];

    document.getElementById('parafoudres-coordonnes_select_mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspd"];
    document.getElementById('display-value-pspd-mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"];

    document.getElementById('parafoudres-equipotentialite_select_mesures').value = lineDataA[selectedLine]["parafoudresPEB"];
    document.getElementById('display-value-equipotentialite-mesures').value = lineDataA[selectedLine]["parafoudresPEBValeur"];

    document.getElementById('type-cablage-interne-select-mesures').value = lineDataA[selectedLine]["typeCablageInterne"];
    document.getElementById('display-value-ks3-mesures').value = lineDataA[selectedLine]["typeCablageInterneValeur"];

    document.getElementById('resistance-ecran-pld-mesures').value = lineDataA[selectedLine]["typeCablageExternePLD"];
    document.getElementById('display-value-pld-mesures').value = lineDataA[selectedLine]["typeCablageExternePLDValeur"];


    

    


    // Add new checkbox for the new line
    const checkboxDiv = document.createElement('div');
    checkboxDiv.className = 'checkbox-item'; 
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = selectedLine;
    checkbox.name = selectedLine;
    //checkbox.className = 'checkbox-container';
    const label = document.createElement('label');
    label.htmlFor = selectedLine;
    label.appendChild(document.createTextNode(selectedLine));
    checkboxDiv.appendChild(checkbox);
    checkboxDiv.appendChild(label);
    checkboxContainer.appendChild(checkboxDiv);


    addLineButton.addEventListener('click', function() {
    const newLine = `Ligne N° ${lineCounter}`;

    // Add new option to the dropdown menu
    const option_line = document.createElement('option');
    option_line.value = newLine;
    option_line.textContent = newLine;

    dropdownMenuLine.appendChild(option_line);
    dropdownMenuLine.value=newLine;
    lineData[newLine] = {
        "typeCheminement": "enterre",
        "longueurLigne": "1000.00",
        "facteurInstallationLigne": "1.0",
        "facteurInstallationLigneValeur": "1.00",
        "typeEnvironnementLigne": "1.0",
        "typeEnvironnementLigneValeur":"1.0",
        "facteurTransformateur": "1.0",
        "facteurTransformateurValeur": "1.0",
        "longueurStructureExt":"10.00",
        "largeurStructureExt":"10.00",
        "hauteurStructureExt":"10.00",
        "emplacementRelatifStructureExt": "1",
        "emplacementRelatifStructureExtValeur": "1.00",
        "parafoudresCoordonnesPspd": "1.00",
        "parafoudresCoordonnesPspdValeur": "1.00",
        "parafoudresPEB": "1.00",
        "parafoudresPEBValeur": "1.00",
        "typeCablageInterne": "1.0",
        "typeCablageInterneValeur": "1.00",
        "tensionAssignee":"1.5",
        "tensionAssigneeValeur":"1.00",
        "interfacesIsolement":"1.00",
        "interfacesIsolementValeur":"1.00",
        "typeCablageExternePLD": "1",
        "typeCablageExternePLI": "1",
        "typeCablageExternePLDValeur": "1.00",
        "typeCablageExternePLIValeur": "1.00",
        "conditionsBlindageCLDCLI":"1",
        "conditionsBlindageCLDValeur":"1.00",
        "conditionsBlindageCLIValeur":"1.00",
        "Al":"0.00",
        "NL":"0.00",
        "Ai":"0.00",
        "Nl":"0.00",
        "Ada":"0.00",
        "NDa":"0.00",
        "KMS":"1.00",
        "PMS":"1.00",
        "PM":"1.00",
        "PV":"1.00",
        "PW":"1.00",
        "PZ":"1.00",
        "PC":"1.00"


  
    }

    lineData_float[newLine] = {


        "tensionAssigneeValeur":1.00,


  
    }

    lineDataA[newLine] = {
        "parafoudresCoordonnesPspd": "1.00",
        "parafoudresCoordonnesPspdValeur": "1.00",
        "parafoudresPEB": "1.00",
        "parafoudresPEBValeur": "1.00",
        "typeCablageInterne": "1.0",
        "typeCablageInterneValeur": "1.00",
        "interfacesIsolement":"1.00",
        "interfacesIsolementValeur":"1.00",
        "typeCablageExternePLD": "1",
        "typeCablageExternePLI": "1",
        "typeCablageExternePLDValeur": "1.00",
        "typeCablageExternePLIValeur": "1.00",
        "conditionsBlindageCLDCLI":"1",
        "conditionsBlindageCLDValeur":"1.00",
        "conditionsBlindageCLIValeur":"1.00",
        "KMS":"1.00",
        "PMS":"1.00",
        "PM":"1.00",
        "PV":"1.00",
        "PW":"1.00",
        "PZ":"1.00",
        "PC":"1.00"

  
    }

    document.getElementById('longueur-ligne').value = lineData[newLine]["longueurLigne"];

    document.getElementById('facteur-installation-ligne').value = lineData[newLine]["facteurInstallationLigne"];
    document.getElementById('display-value-installation-ligne').value = lineData[newLine]["facteurInstallationLigneValeur"];

    document.getElementById('environnement-ligne').value = lineData[newLine]["typeEnvironnementLigne"];
    document.getElementById('display-value-environnement-ligne').value = lineData[newLine]["typeEnvironnementLigneValeur"];

    document.getElementById('facteur-transformateur').value = lineData[newLine]["facteurTransformateur"];
    document.getElementById('display-value-facteur-transformateur').value = lineData[newLine]["facteurTransformateurValeur"]; 

    document.getElementById('display-value-longueur-batiment').value = lineData[newLine]["longueurStructureExt"]; 
    document.getElementById('display-value-largeur-batiment').value = lineData[newLine]["largeurStructureExt"]; 
    document.getElementById('display-value-hauteur-batiment').value = lineData[newLine]["hauteurStructureExt"]; 

    document.getElementById('emplacement-relatif-extremite').value = lineData[newLine]["emplacementRelatifStructureExt"];
    document.getElementById('display-value-facteur-emplacement-extremite').value = lineData[newLine]["emplacementRelatifStructureExtValeur"];

    document.getElementById('parafoudres-coordonnes_select').value = lineData[newLine]["parafoudresCoordonnesPspd"];
    document.getElementById('display-value-pspd').value = lineData[newLine]["parafoudresCoordonnesPspdValeur"];

    document.getElementById('parafoudres-equipotentialite_select').value = lineData[newLine]["parafoudresPEB"];
    document.getElementById('display-value-equipotentialite').value = lineData[newLine]["parafoudresPEBValeur"];

    document.getElementById('type-cablage-interne-select').value = lineData[newLine]["typeCablageInterne"];
    document.getElementById('display-value-ks3').value = lineData[newLine]["typeCablageInterneValeur"];

    document.getElementById('tension-assignee-chocs').value = lineData[newLine]["tensionAssignee"];

    document.getElementById('display-value-uw').value = lineData[newLine]["tensionAssigneeValeur"];

    document.getElementById('interfaces_isolement_select').value = lineData[newLine]["interfacesIsolement"];
    document.getElementById('display-value-interfaces-isolement').value = lineData[newLine]["interfacesIsolementValeur"];

    document.getElementById('interfaces_isolement_select_mesures').value = lineDataA[newLine]["interfacesIsolement"];
    document.getElementById('display-value-interfaces-isolement-mesures').value = lineDataA[newLine]["interfacesIsolementValeur"];

    document.getElementById('resistance-ecran-pld').value = lineData[newLine]["typeCablageExternePLD"];
    document.getElementById('resistance-ecran-pli').value = lineData[newLine]["typeCablageExternePLI"];
    document.getElementById('display-value-pld').value = lineData[newLine]["typeCablageExternePLDValeur"];
    document.getElementById('display-value-pli').value = lineData[newLine]["typeCablageExternePLIValeur"];

    document.getElementById('conditions-blindage-cld-cli').value = lineData[newLine]["typeCablageExternePLD"];
    document.getElementById('display-value-cld').value = lineData[newLine]["conditionsBlindageCLDValeur"];
    document.getElementById('display-value-cli').value = lineData[newLine]["conditionsBlindageCLIValeur"];

    document.getElementById('conditions-blindage-cld-cli-mesures').value = lineDataA[newLine]["typeCablageExternePLD"];
    document.getElementById('display-value-cld-mesures').value = lineDataA[newLine]["conditionsBlindageCLDValeur"];
    document.getElementById('display-value-cli-mesures').value = lineDataA[newLine]["conditionsBlindageCLIValeur"];


    document.getElementById('parafoudres-coordonnes_select_mesures').value = lineDataA[newLine]["parafoudresCoordonnesPspd"];
    document.getElementById('display-value-pspd-mesures').value = lineDataA[newLine]["parafoudresCoordonnesPspdValeur"];

    document.getElementById('parafoudres-equipotentialite_select_mesures').value = lineDataA[newLine]["parafoudresPEB"];
    document.getElementById('display-value-equipotentialite-mesures').value = lineDataA[newLine]["parafoudresPEBValeur"];

    document.getElementById('type-cablage-interne-select-mesures').value = lineDataA[newLine]["typeCablageInterne"];
    document.getElementById('display-value-ks3-mesures').value = lineDataA[newLine]["typeCablageInterneValeur"];

    document.getElementById('resistance-ecran-pld-mesures').value = lineDataA[newLine]["typeCablageExternePLD"];

    document.getElementById('display-value-pld-mesures').value = lineDataA[newLine]["typeCablageExternePLDValeur"];



    updateResults();




    // Add new checkbox for the new line
    const checkboxDiv = document.createElement('div');
    checkboxDiv.className = 'checkbox-item'; 
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = newLine;
    checkbox.name = newLine;
    //checkbox.className = 'checkbox-container';
    const label = document.createElement('label');
    label.htmlFor = newLine;
    label.appendChild(document.createTextNode(newLine));
    checkboxDiv.appendChild(checkbox);
    checkboxDiv.appendChild(label);
    checkboxContainer.appendChild(checkboxDiv);
  
    lineCounter++;

    });

    dropdownMenuLine.addEventListener('change', function() {

        const selectedLine = dropdownMenuLine.value;

        document.getElementById('longueur-ligne').value = lineData[selectedLine]["longueurLigne"];
        document.getElementById('facteur-installation-ligne').value = lineData[selectedLine]["facteurInstallationLigne"];
        document.getElementById('display-value-installation-ligne').value = lineData[selectedLine]["facteurInstallationLigneValeur"];

        document.getElementById('environnement-ligne').value = lineData[selectedLine]["typeEnvironnementLigne"];
        document.getElementById('display-value-environnement-ligne').value = lineData[selectedLine]["typeEnvironnementLigneValeur"];

        document.getElementById('facteur-transformateur').value = lineData[selectedLine]["facteurTransformateur"];
        document.getElementById('display-value-facteur-transformateur').value = lineData[selectedLine]["facteurTransformateurValeur"]; 

        document.getElementById('display-value-longueur-batiment').value = lineData[selectedLine]["longueurStructureExt"]; 
        document.getElementById('display-value-largeur-batiment').value = lineData[selectedLine]["largeurStructureExt"]; 
        document.getElementById('display-value-hauteur-batiment').value = lineData[selectedLine]["hauteurStructureExt"]; 

        document.getElementById('emplacement-relatif-extremite').value = lineData[selectedLine]["emplacementRelatifStructureExt"];
        document.getElementById('display-value-facteur-emplacement-extremite').value = lineData[selectedLine]["emplacementRelatifStructureExtValeur"];

        document.getElementById('parafoudres-coordonnes_select').value = lineData[selectedLine]["parafoudresCoordonnesPspd"];
        document.getElementById('display-value-pspd').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];

        document.getElementById('parafoudres-equipotentialite_select').value = lineData[selectedLine]["parafoudresPEB"];
        document.getElementById('display-value-equipotentialite').value = lineData[selectedLine]["parafoudresPEBValeur"];

        document.getElementById('type-cablage-interne-select').value = lineData[selectedLine]["typeCablageInterne"];
        document.getElementById('display-value-ks3').value = lineData[selectedLine]["typeCablageInterneValeur"];

        document.getElementById('tension-assignee-chocs').value = lineData[selectedLine]["tensionAssignee"];

        document.getElementById('display-value-uw').value = lineData[selectedLine]["tensionAssigneeValeur"];

        document.getElementById('interfaces_isolement_select').value = lineData[selectedLine]["interfacesIsolement"];
        document.getElementById('display-value-interfaces-isolement').value = lineData[selectedLine]["interfacesIsolementValeur"];

        document.getElementById('resistance-ecran-pld').value = lineData[selectedLine]["typeCablageExternePLD"];
        document.getElementById('resistance-ecran-pli').value = lineData[selectedLine]["typeCablageExternePLI"];
        document.getElementById('display-value-pld').value = lineData[selectedLine]["typeCablageExternePLDValeur"];
        document.getElementById('display-value-pli').value = lineData[selectedLine]["typeCablageExternePLIValeur"];

        
    });



     document.getElementById('longueur-ligne').addEventListener('change', function() {

        const longueur_ligne_value = parseFloat(document.getElementById('longueur-ligne').value);

        if (longueur_ligne_value<=0 || isNaN(longueur_ligne_value)) {

            document.getElementById('longueur-ligne').value = '1000.00';
        }
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["longueurLigne"] = document.getElementById('longueur-ligne').value;
        //lineData_float[selectedLine]["longueurLigne"] = parseFloat(this.value);

        updateResults();



    });    

    

   
    document.getElementById('facteur-installation-ligne').addEventListener('change', function() {
        
        const selectedLine = dropdownMenuLine.value;

       

        lineData[selectedLine]["facteurInstallationLigne"] = this.value;

        if (lineData[selectedLine]["facteurInstallationLigne"]==='1.0') {

            //lineData[selectedLine]["emplacementRelatifLigneValeur"]= "0.25";
            document.getElementById('display-value-installation-ligne').value='1.00';
            
            

        } else if (lineData[selectedLine]["facteurInstallationLigne"]==='0.5') {

            //lineData[selectedLine]["emplacementRelatifLigneValeur"]= "0.25";
            document.getElementById('display-value-installation-ligne').value='0.50';
            
            

        } else if (lineData[selectedLine]["facteurInstallationLigne"]==='0.01') {

            //lineData[selectedLine]["emplacementRelatifLigneValeur"]= "0.25";
            document.getElementById('display-value-installation-ligne').value='0.01';
            
            

        }

        lineData[selectedLine]["facteurInstallationLigneValeur"]= document.getElementById('display-value-installation-ligne').value;

        //lineData_float[selectedLine]["CtLigne"] = parseFloat(lineData[selectedLine]["emplacementRelatifLigneValeur"]);

        updateResults();



        //lineData[selectedLine]["emplacementRelatifLigneValeur"]= this.value;
    });    

    document.getElementById('environnement-ligne').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;

                       
        lineData[selectedLine]["typeEnvironnementLigne"] = this.value;

        if (lineData[selectedLine]["typeEnvironnementLigne"]==='0.01') {

            //lineData[selectedLine]["typeEnvironnementLigneValeur"]= "0.0";
            document.getElementById('display-value-environnement-ligne').value='0.01';

        } else if (lineData[selectedLine]["typeEnvironnementLigne"]==="0.1") {

            //lineData[selectedLine]["typeEnvironnementLigneValeur"]= '0.1';
            document.getElementById('display-value-environnement-ligne').value='0.1';

        } else if (lineData[selectedLine]["typeEnvironnementLigne"]==="0.5") {

            //lineData[selectedLine]["typeEnvironnementLigneValeur"]= '0.5';
            document.getElementById('display-value-environnement-ligne').value='0.5';

        } else if (lineData[selectedLine]["typeEnvironnementLigne"]==="1.0") {

            //lineData[selectedLine]["typeEnvironnementLigneValeur"]= '1.0';
            document.getElementById('display-value-environnement-ligne').value='1.0';

        }

        lineData[selectedLine]["typeEnvironnementLigneValeur"]= document.getElementById('display-value-environnement-ligne').value;

        //lineData_float[selectedLine]["CeLigne"] = parseFloat(lineData[selectedLine]["typeEnvironnementLigne"]);

        updateResults();

        //lineData[selectedLine]["typeEnvironnementLigneValeur"]= this.value;
    });   

    document.getElementById('facteur-transformateur').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["facteurTransformateur"] = this.value;

        if (lineData[selectedLine]["facteurTransformateur"]==='0.2') {

            //lineData[selectedLine]["facteurTransformateurValeur"]= "0.2";
            document.getElementById('display-value-facteur-transformateur').value='0.2';

        } else {

            //lineData[selectedLine]["typeEnvironnementLigneValeur"]= '1.0';
            document.getElementById('display-value-facteur-transformateur').value='1.0';

        } 

        
        lineData[selectedLine]["facteurTransformateurValeur"]= document.getElementById('display-value-facteur-transformateur').value;

        //lineData_float[selectedLine]["CtLigne"] = parseFloat(lineData[selectedLine]["facteurTransformateurValeur"]);

        updateResults();

        


        //lineData[selectedLine]["facteurTransformateurValeur"]= this.value;
    });   

        document.getElementById('display-value-longueur-batiment').addEventListener('change', function() {

        const longueur_batiment_value = parseFloat(document.getElementById('display-value-longueur-batiment').value);

        if (longueur_batiment_value<=0 || isNaN(longueur_batiment_value)) {

            document.getElementById('display-value-longueur-batiment').value = '10.00';
        }

        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["longueurStructureExt"] = document.getElementById('display-value-longueur-batiment').value;

        //lineData_float[selectedLine]["longueurStructureExt"] = parseFloat(this.value);

        updateResults();

    });  

    document.getElementById('display-value-largeur-batiment').addEventListener('change', function() {

        const largeur_batiment_value = parseFloat(document.getElementById('display-value-largeur-batiment').value);

        if (largeur_batiment_value<=0 || isNaN(largeur_batiment_value)) {

            document.getElementById('display-value-largeur-batiment').value = '10.00';
        }

        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["largeurStructureExt"] = document.getElementById('display-value-largeur-batiment').value;
        //lineData_float[selectedLine]["largeurStructureExt"] = parseFloat(this.value);

        updateResults();

    });  

    document.getElementById('display-value-hauteur-batiment').addEventListener('change', function() {

        const hauteur_batiment_value = parseFloat(document.getElementById('display-value-hauteur-batiment').value);

        if (hauteur_batiment_value<=0 || isNaN(hauteur_batiment_value)) {

            document.getElementById('display-value-hauteur-batiment').value = '10.00';
        }

        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["hauteurStructureExt"] = document.getElementById('display-value-hauteur-batiment').value;
        //lineData_float[selectedLine]["hauteurStructureExt"] = parseFloat(this.value);

        updateResults();

    });  

    document.getElementById('emplacement-relatif-extremite').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["emplacementRelatifStructureExt"] = this.value;

        if (lineData[selectedLine]["emplacementRelatifStructureExt"]==='0.25') {

            //lineData[selectedLine]["emplacementRelatifStructureExtValeur"]= "0.25";
            document.getElementById('display-value-facteur-emplacement-extremite').value='0.25';

        } else if (lineData[selectedLine]["emplacementRelatifStructureExt"]==="0.5") {

            //lineData[selectedLine]["emplacementRelatifStructureExtValeur"]= '0.5';
            document.getElementById('display-value-facteur-emplacement-extremite').value='0.5';

        } else if (lineData[selectedLine]["emplacementRelatifStructureExt"]==="1") {

            //lineData[selectedLine]["emplacementRelatifStructureExtValeur"]= '1.0';
            document.getElementById('display-value-facteur-emplacement-extremite').value='1.0';

        } else if (lineData[selectedLine]["emplacementRelatifStructureExt"]==="2") {

            //lineData[selectedLine]["emplacementRelatifStructureExtValeur"]= '2.0';
            document.getElementById('display-value-facteur-emplacement-extremite').value='2.0';

        }

        lineData[selectedLine]["emplacementRelatifStructureExtValeur"]=document.getElementById('display-value-facteur-emplacement-extremite').value;
        //lineData_float[selectedLine]["Cda"] = parseFloat(lineData[selectedLine]["emplacementRelatifStructureExtValeur"]);

        updateResults();


    });  


    document.getElementById('parafoudres-coordonnes_select').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["parafoudresCoordonnesPspd"] = this.value;

        if (lineData[selectedLine]["parafoudresCoordonnesPspd"]==='1.00') {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= "1.00";
            document.getElementById('display-value-pspd').value='1.00';
            

        } else if (lineData[selectedLine]["parafoudresCoordonnesPspd"]==="0.05") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.03';
            document.getElementById('display-value-pspd').value='0.05';
            

        } else if (lineData[selectedLine]["parafoudresCoordonnesPspd"]==="0.02") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.02';
            document.getElementById('display-value-pspd').value='0.02';
            

        } else if (lineData[selectedLine]["parafoudresCoordonnesPspd"]==="0.01") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.01';
            document.getElementById('display-value-pspd').value='0.01';
            

        } else if (lineData[selectedLine]["parafoudresCoordonnesPspd"]==="0.005") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.005';
            document.getElementById('display-value-pspd').value='0.005';
            

        } else if (lineData[selectedLine]["parafoudresCoordonnesPspd"]==="0.001") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.001';
            document.getElementById('display-value-pspd').value='0.001';
            

        }

        lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]=document.getElementById('display-value-pspd').value;
        //lineData_float[selectedLine]["pspd"]=parseFloat(lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]);

        

        if (lineData[selectedLine]["parafoudresCoordonnesPspd"]!=="1.00") {

            lineData[selectedLine]["parafoudresCoordonnesPspd"]=lineData[selectedLine]["parafoudresPEB"];
            lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]=lineData[selectedLine]["parafoudresPEBValeur"];


        }


        updateResults();

        document.getElementById('display-value-pspd').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
        document.getElementById('parafoudres-coordonnes_select').value = lineData[selectedLine]["parafoudresCoordonnesPspd"];

        pspd_am_valeur=parseFloat(lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]);
        //pspd_am_valeur=lineDataA[selectedLine]["parafoudresPEBValeur"];
        pspd_sm_valeur=parseFloat(lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]);
        //pspd_sm_valeur=lineDataA[selectedLine]["parafoudresPEBValeur"];

        //if(pspd_am_valeur>pspd_sm_valeur) {

            //document.getElementById('display-value-pspd-mesures').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('display-value-pspd').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('parafoudres-coordonnes_select').value = lineData[selectedLine]["parafoudresCoordonnesPspd"];

            lineDataA[selectedLine]["parafoudresCoordonnesPspd"]=lineData[selectedLine]["parafoudresCoordonnesPspd"];
            lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]=lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];

        //}





    });  


    document.getElementById('parafoudres-equipotentialite_select').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["parafoudresPEB"] = this.value;

        if (lineData[selectedLine]["parafoudresPEB"]==='1.00') {

            document.getElementById('display-value-equipotentialite').value='1.00';
            pb_test='1.00';

        } else if (lineData[selectedLine]["parafoudresPEB"]==="0.05") {

            document.getElementById('display-value-equipotentialite').value='0.05';
            pb_test='0.10';

        } else if (lineData[selectedLine]["parafoudresPEB"]==="0.02") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.02';
            document.getElementById('display-value-equipotentialite').value='0.02';
            pb_test='0.05';

        } else if (lineData[selectedLine]["parafoudresPEB"]==="0.01") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.01';
            document.getElementById('display-value-equipotentialite').value='0.01';
            pb_test='0.02';

        } else if (lineData[selectedLine]["parafoudresPEB"]==="0.005") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.005';
            document.getElementById('display-value-equipotentialite').value='0.005';
            pb_test='0.02';

        } else if (lineData[selectedLine]["parafoudresPEB"]==="0.001") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.001';
            document.getElementById('display-value-equipotentialite').value='0.001';
            pb_test='0.02';

        }

        lineData[selectedLine]["parafoudresPEBValeur"]=document.getElementById('display-value-equipotentialite').value;
        //lineData_float[selectedLine]["pspd"]=parseFloat(lineData[selectedLine]["parafoudresPEBValeur"]);

        pb_test_float=parseFloat(pb_test);

        if (pb_test_float>PB) {

            lineData[selectedLine]["parafoudresPEB"]=peb_test_sm;
            lineData[selectedLine]["parafoudresPEBValeur"]=peb_test_sm;







        }

        document.getElementById('display-value-equipotentialite').value = lineData[selectedLine]["parafoudresPEBValeur"];
        document.getElementById('parafoudres-equipotentialite_select').value = lineData[selectedLine]["parafoudresPEB"];

        if (lineData[selectedLine]["parafoudresCoordonnesPspd"]!=="1.00") {

            lineData[selectedLine]["parafoudresCoordonnesPspd"]=lineData[selectedLine]["parafoudresPEB"];
            lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]=lineData[selectedLine]["parafoudresPEBValeur"];
            document.getElementById('display-value-pspd').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('parafoudres-coordonnes_select').value = lineData[selectedLine]["parafoudresCoordonnesPspd"];



        }


        peb_am_valeur=parseFloat(lineDataA[selectedLine]["parafoudresPEBValeur"]);
        pspd_am_valeur=parseFloat(lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]);

        //pspd_am_valeur=lineDataA[selectedLine]["parafoudresPEBValeur"];
        peb_sm_valeur=parseFloat(lineData[selectedLine]["parafoudresPEBValeur"]);
        pspd_sm_valeur=parseFloat(lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]);

        //pspd_sm_valeur=lineDataA[selectedLine]["parafoudresPEBValeur"];

        //if(peb_am_valeur>peb_sm_valeur) {

            //document.getElementById('display-value-pspd-mesures').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('display-value-equipotentialite-mesures').value=lineData[selectedLine]["parafoudresPEBValeur"];
            document.getElementById('parafoudres-equipotentialite_select_mesures').value=lineData[selectedLine]["parafoudresPEB"];

            lineDataA[selectedLine]["parafoudresPEB"]=lineData[selectedLine]["parafoudresPEB"];
            lineDataA[selectedLine]["parafoudresPEBValeur"]=lineData[selectedLine]["parafoudresPEBValeur"];




        //}

        //if(pspd_am_valeur>pspd_sm_valeur) {

            //document.getElementById('display-value-pspd-mesures').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('display-value-pspd').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('parafoudres-coordonnes_select').value = lineData[selectedLine]["parafoudresCoordonnesPspd"];

            lineDataA[selectedLine]["parafoudresCoordonnesPspd"]=lineData[selectedLine]["parafoudresCoordonnesPspd"];
            lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]=lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];

        //}


 



        updateResults();




    });  


    document.getElementById('type-cablage-interne-select').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["typeCablageInterne"] = this.value;

        
        if (lineData[selectedLine]["typeCablageInterne"]==='1.0') {

            //lineData[selectedLine]["typeCablageInterneValeur"]= "1.00";
            document.getElementById('display-value-ks3').value='1.00';

        } else if (lineData[selectedLine]["typeCablageInterne"]==="0.2") {

            //lineData[selectedLine]["typeCablageInterneValeur"]= '0.20';
            document.getElementById('display-value-ks3').value='0.20';

        } else if (lineData[selectedLine]["typeCablageInterne"]==="0.01") {

            //lineData[selectedLine]["typeCablageInterneValeur"]= '0.02';
            document.getElementById('display-value-ks3').value='0.01';

        } else if (lineData[selectedLine]["typeCablageInterne"]==="0.0001") {

            //lineData[selectedLine]["typeCablageInterneValeur"]= '0.0002';
            document.getElementById('display-value-ks3').value='0.0001';

        } 

        lineData[selectedLine]["typeCablageInterneValeur"]=document.getElementById('display-value-ks3').value;
        lineData[selectedLine]["KS3"]=parseFloat(lineData[selectedLine]["typeCablageInterneValeur"]);

        KS3_value_am=parseFloat(lineDataA[selectedLine]["typeCablageInterneValeur"]);
        KS3_value_sm=parseFloat(lineData[selectedLine]["typeCablageInterneValeur"]);

        //if (KS3_value_am>KS3_value_sm) {

        document.getElementById('display-value-ks3-mesures').value=lineData[selectedLine]["typeCablageInterneValeur"];
        document.getElementById('type-cablage-interne-select-mesures').value=lineData[selectedLine]["typeCablageInterne"];
        lineDataA[selectedLine]["typeCablageInterneValeur"]=lineData[selectedLine]["typeCablageInterneValeur"];
        lineDataA[selectedLine]["typeCablageInterne"]=lineData[selectedLine]["typeCablageInterne"];





        //}

        updateResults();



    });  


    document.getElementById('interfaces_isolement_select').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["interfacesIsolement"] = this.value;

        
        if (lineData[selectedLine]["interfacesIsolement"]==='1.00') {

            //lineData[selectedLine]["typeCablageInterneValeur"]= "1.00";
            document.getElementById('display-value-interfaces-isolement').value='1.00';

        } else {

            document.getElementById('display-value-interfaces-isolement').value='0.00';


        }
       

        lineData[selectedLine]["interfacesIsolementValeur"]=document.getElementById('display-value-interfaces-isolement').value;
        //lineData[selectedLine]["interfacesIsolementValeur"]=document.getElementById('display-value-interfaces-isolement').value;
        lineDataA[selectedLine]["interfacesIsolementValeur"]=lineData[selectedLine]["interfacesIsolementValeur"];
        lineDataA[selectedLine]["interfacesIsolement"]=lineData[selectedLine]["interfacesIsolement"];

        document.getElementById('display-value-interfaces-isolement-mesures').value=lineData[selectedLine]["interfacesIsolementValeur"];
        document.getElementById('interfaces_isolement_select_mesures').value=lineData[selectedLine]["interfacesIsolement"];


        updateResults();



    });  


    document.getElementById('tension-assignee-chocs').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["tensionAssignee"] = this.value;
        //lineData_float[selectedLine]["UwLigne"] = parseFloat(this.value);

        
        if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

            lineData[selectedLine]["tensionAssigneeValeur"]='1.00';
            KS4=1.0;//parseFloat(lineData[selectedLine]["tensionAssigneeValeur"]);
            lineData[selectedLine]["tensionAssigneeValeur"]=KS4.toFixed(2);
            lineData_float[selectedLine]["tensionAssigneeValeur"]=KS4;


        } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

            lineData[selectedLine]["tensionAssigneeValeur"]='1.50';
            KS4=1.5/parseFloat(lineData[selectedLine]["tensionAssigneeValeur"]);
            lineData[selectedLine]["tensionAssigneeValeur"]=KS4.toFixed(2);
            lineData_float[selectedLine]["tensionAssigneeValeur"]=KS4;
           

       } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

            lineData[selectedLine]["tensionAssigneeValeur"]='2.50';
            KS4=1.5/parseFloat(lineData[selectedLine]["tensionAssigneeValeur"]);
            lineData[selectedLine]["tensionAssigneeValeur"]=KS4.toFixed(2);
            lineData_float[selectedLine]["tensionAssigneeValeur"]=KS4;


 
       } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {

            lineData[selectedLine]["tensionAssigneeValeur"]='4.00';
            KS4=1.5/parseFloat(lineData[selectedLine]["tensionAssigneeValeur"]);
            lineData[selectedLine]["tensionAssigneeValeur"]=KS4.toFixed(2);
            lineData_float[selectedLine]["tensionAssigneeValeur"]=KS4;


       } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {

            lineData[selectedLine]["tensionAssigneeValeur"]='6.00';
            KS4=1.5/parseFloat(lineData[selectedLine]["tensionAssigneeValeur"]);
            lineData[selectedLine]["tensionAssigneeValeur"]=KS4.toFixed(2);
            lineData_float[selectedLine]["tensionAssigneeValeur"]=KS4;


       }

       document.getElementById('display-value-uw').value = lineData[selectedLine]["tensionAssigneeValeur"];


 
        if (lineData[selectedLine]["typeCablageExternePLD"]==='1') {


            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';
               


            }


        } else if (lineData[selectedLine]["typeCablageExternePLD"]==='2') {


            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';
               


            }

        } else if (lineData[selectedLine]["typeCablageExternePLD"]==='3') {

           if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.95';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.95';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.90';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.90';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.80';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.80';
               


            }



        } else if (lineData[selectedLine]["typeCablageExternePLD"]==='4') {

           if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.90';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.90';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.80';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.80';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.60';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.60';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.30';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.30';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.10';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.10';
               


            }


        } else if (lineData[selectedLine]["typeCablageExternePLD"]==='5') {

            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.60';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.60';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.40';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.40';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.20';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.20';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.04';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.04';
            


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.02';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.02';
               


            }



        } 


      
        document.getElementById('display-value-pli').value = lineData[selectedLine]["typeCablageExternePLIValeur"];
        document.getElementById('display-value-pld').value = lineData[selectedLine]["typeCablageExternePLDValeur"];
        //document.getElementById('display-value-pli-mesures').value = lineData[selectedLine]["typeCablageExternePLIValeur"];
        document.getElementById('display-value-pld-mesures').value = lineData[selectedLine]["typeCablageExternePLDValeur"];

        updateResults();






        


    });  



    document.getElementById('resistance-ecran-pld').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["typeCablageExternePLD"] = this.value;

        

       if (lineData[selectedLine]["typeCablageExternePLD"]==='1') {


            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';
               


            }


        } else if (lineData[selectedLine]["typeCablageExternePLD"]==='2') {


            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';
               


            }

        } else if (lineData[selectedLine]["typeCablageExternePLD"]==='3') {

           if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.95';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.95';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.90';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.90';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.80';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.80';
               


            }



        } else if (lineData[selectedLine]["typeCablageExternePLD"]==='4') {

           if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.90';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.90';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.80';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.80';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.60';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.60';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.30';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.30';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.10';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.10';
               


            }


        } else if (lineData[selectedLine]["typeCablageExternePLD"]==='5') {

            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.60';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.60';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.40';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.40';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.20';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.20';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.04';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.04';
            


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLDValeur"]='0.02';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.02';
               


            }



        } 



        //document.getElementById('display-value-pli').value = lineData[selectedLine]["typeCablageExternePLIValeur"];
        document.getElementById('display-value-pld').value = lineData[selectedLine]["typeCablageExternePLDValeur"];


        //document.getElementById('display-value-pli-mesures').value = lineData[selectedLine]["typeCablageExternePLIValeur"];
        document.getElementById('display-value-pld-mesures').value = lineData[selectedLine]["typeCablageExternePLDValeur"];
        //document.getElementById('resistance-ecran-pld-pli-mesures').value=lineData[selectedLine]["typeCablageExternePLDPLI"];
        lineDataA[selectedLine]["typeCablageExternePLDValeur"]=lineData[selectedLine]["typeCablageExternePLDValeur"];
        //lineDataA[selectedLine]["typeCablageExternePLIValeur"]=lineData[selectedLine]["typeCablageExternePLIValeur"];
        lineDataA[selectedLine]["typeCablageExternePLD"]=lineData[selectedLine]["typeCablageExternePLD"];





          //}



          
          updateResults();


        


        

    });  


    document.getElementById('resistance-ecran-pli').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["typeCablageExternePLI"] = this.value;

        

        if (lineData[selectedLine]["typeCablageExternePLI"]==='1') {


            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLIValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLIValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLIValeur"]='0.60';
                lineDataA[selectedLine]["typeCablageExternePLIValeur"]='0.60';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLIValeur"]='0.30';
                lineDataA[selectedLine]["typeCablageExternePLIValeur"]='0.30';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLIValeur"]='0.16';
                lineDataA[selectedLine]["typeCablageExternePLIValeur"]='0.16';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLIValeur"]='0.10';
                lineDataA[selectedLine]["typeCablageExternePLIValeur"]='0.10';
               


            }


        } else {


            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                lineData[selectedLine]["typeCablageExternePLIValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLIValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                lineData[selectedLine]["typeCablageExternePLIValeur"]='0.50';
                lineDataA[selectedLine]["typeCablageExternePLIValeur"]='0.50';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                lineData[selectedLine]["typeCablageExternePLIValeur"]='0.20';
                lineDataA[selectedLine]["typeCablageExternePLIValeur"]='0.20';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                lineData[selectedLine]["typeCablageExternePLIValeur"]='0.08';
                lineDataA[selectedLine]["typeCablageExternePLIValeur"]='0.08';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                lineData[selectedLine]["typeCablageExternePLIValeur"]='0.04';
                lineDataA[selectedLine]["typeCablageExternePLIValeur"]='0.04';
               


            }

        }


        //document.getElementById('display-value-pli').value = lineData[selectedLine]["typeCablageExternePLIValeur"];
        document.getElementById('display-value-pli').value = lineData[selectedLine]["typeCablageExternePLIValeur"];


        //document.getElementById('display-value-pli-mesures').value = lineData[selectedLine]["typeCablageExternePLIValeur"];
        document.getElementById('display-value-pli-mesures').value = lineData[selectedLine]["typeCablageExternePLIValeur"];
        //document.getElementById('resistance-ecran-pld-pli-mesures').value=lineData[selectedLine]["typeCablageExternePLDPLI"];
        lineDataA[selectedLine]["typeCablageExternePLIValeur"]=lineData[selectedLine]["typeCablageExternePLIValeur"];
        //lineDataA[selectedLine]["typeCablageExternePLIValeur"]=lineData[selectedLine]["typeCablageExternePLIValeur"];
        lineDataA[selectedLine]["typeCablageExternePLI"]=lineData[selectedLine]["typeCablageExternePLI"];





          //}



          
          updateResults();


        


        

    });  


    document.getElementById('conditions-blindage-cld-cli').addEventListener('change', function() {
        const selectedLine = dropdownMenuLine.value;
        lineData[selectedLine]["conditionsBlindageCLDCLI"] = this.value;

        

       if (lineData[selectedLine]["conditionsBlindageCLDCLI"]==='1') {

            lineData[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineData[selectedLine]["conditionsBlindageCLIValeur"]='1.00';
            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='1.00';

 
        } else if (lineData[selectedLine]["conditionsBlindageCLDCLI"]==='2') {

            lineData[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineData[selectedLine]["conditionsBlindageCLIValeur"]='1.00';
            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='1.00';


        } else if (lineData[selectedLine]["conditionsBlindageCLDCLI"]==='3') {

            lineData[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineData[selectedLine]["conditionsBlindageCLIValeur"]='0.20';
            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.20';


        } else if (lineData[selectedLine]["conditionsBlindageCLDCLI"]==='4') {

            lineData[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineData[selectedLine]["conditionsBlindageCLIValeur"]='0.30';
            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.30';


        } else if (lineData[selectedLine]["conditionsBlindageCLDCLI"]==='5') {

            lineData[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineData[selectedLine]["conditionsBlindageCLIValeur"]='0.10';
            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.10';


        } else if (lineData[selectedLine]["conditionsBlindageCLDCLI"]==='6') {

            lineData[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineData[selectedLine]["conditionsBlindageCLIValeur"]='0.00';
            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='.00';


        } else if (lineData[selectedLine]["conditionsBlindageCLDCLI"]==='7') {

            lineData[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineData[selectedLine]["conditionsBlindageCLIValeur"]='0.00';
            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.00';


        } else if (lineData[selectedLine]["conditionsBlindageCLDCLI"]==='8') {

            lineData[selectedLine]["conditionsBlindageCLDValeur"]='0.00';
            lineData[selectedLine]["conditionsBlindageCLIValeur"]='0.00';
            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='0.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.00';


        } else if (lineData[selectedLine]["conditionsBlindageCLDCLI"]==='9') {

            lineData[selectedLine]["conditionsBlindageCLDValeur"]='0.00';
            lineData[selectedLine]["conditionsBlindageCLIValeur"]='0.00';
            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='0.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.00';


        } else if (lineData[selectedLine]["conditionsBlindageCLDCLI"]==='10') {

            lineData[selectedLine]["conditionsBlindageCLDValeur"]='0.00';
            lineData[selectedLine]["conditionsBlindageCLIValeur"]='0.00';
            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='0.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.00';


        } 

        //document.getElementById('display-value-pli').value = lineData[selectedLine]["typeCablageExternePLIValeur"];
        document.getElementById('display-value-cld').value = lineData[selectedLine]["conditionsBlindageCLDValeur"];
        document.getElementById('display-value-cli').value = lineData[selectedLine]["conditionsBlindageCLIValeur"];

        document.getElementById('display-value-cld-mesures').value = lineData[selectedLine]["conditionsBlindageCLDValeur"];
        document.getElementById('display-value-cli-mesures').value = lineData[selectedLine]["conditionsBlindageCLIValeur"];

        document.getElementById('conditions-blindage-cld-cli-mesures').value = lineData[selectedLine]["conditionsBlindageCLDCLI"];

        lineDataA[selectedLine]["conditionsBlindageCLDValeur"]=lineData[selectedLine]["conditionsBlindageCLDValeur"];
        lineDataA[selectedLine]["conditionsBlindageCLIValeur"]=lineData[selectedLine]["conditionsBlindageCLIValeur"];

        lineDataA[selectedLine]["conditionsBlindageCLDCLI"]=lineData[selectedLine]["conditionsBlindageCLDCLI"];

          
          updateResults();

      


        

    });  




});



const dropdownMenuLineMesures = document.getElementById('dropdown-menu-mesures');

dropdownMenuLineMesures.addEventListener('change', function() {

    const selectedLine = dropdownMenuLineMesures.value;
 
    document.getElementById('parafoudres-coordonnes_select_mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspd"];
    document.getElementById('display-value-pspd-mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"];

    document.getElementById('parafoudres-equipotentialite_select_mesures').value = lineDataA[selectedLine]["parafoudresPEB"];
    document.getElementById('display-value-equipotentialite-mesures').value = lineDataA[selectedLine]["parafoudresPEBValeur"];

    document.getElementById('type-cablage-interne-select-mesures').value = lineDataA[selectedLine]["typeCablageInterne"];
    document.getElementById('display-value-ks3-mesures').value = lineDataA[selectedLine]["typeCablageInterneValeur"];

    document.getElementById('resistance-ecran-pld-mesures').value = lineDataA[selectedLine]["typeCablageExternePLD"];
    document.getElementById('display-value-pld-mesures').value = lineDataA[selectedLine]["typeCablageExternePLDValeur"];

    document.getElementById('interfaces_isolement_select_mesures').value = lineDataA[selectedLine]["interfacesIsolement"];
    document.getElementById('display-value-interfaces-isolement-mesures').value = lineDataA[selectedLine]["interfacesIsolementValeur"];


    
});


document.getElementById('parafoudres-coordonnes_select_mesures').addEventListener('change', function() {
    const selectedLine = dropdownMenuLineMesures.value;

    lineDataA[selectedLine]["parafoudresCoordonnesPspd"] = this.value;

        if (lineDataA[selectedLine]["parafoudresCoordonnesPspd"]==='1.00') {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= "1.00";
            document.getElementById('display-value-pspd-mesures').value='1.00';
            

        } else if (lineDataA[selectedLine]["parafoudresCoordonnesPspd"]==="0.05") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.03';
            document.getElementById('display-value-pspd-mesures').value='0.05';
            

        } else if (lineDataA[selectedLine]["parafoudresCoordonnesPspd"]==="0.02") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.02';
            document.getElementById('display-value-pspd-mesures').value='0.02';
            

        } else if (lineDataA[selectedLine]["parafoudresCoordonnesPspd"]==="0.01") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.01';
            document.getElementById('display-value-pspd-mesures').value='0.01';
            

        } else if (lineDataA[selectedLine]["parafoudresCoordonnesPspd"]==="0.005") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.005';
            document.getElementById('display-value-pspd-mesures').value='0.005';
            

        } else if (lineDataA[selectedLine]["parafoudresCoordonnesPspd"]==="0.001") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.001';
            document.getElementById('display-value-pspd-mesures').value='0.001';
            

        }

        lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]=document.getElementById('display-value-pspd-mesures').value;
        //lineData_float[selectedLine]["pspd"]=parseFloat(lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]);

        

        if (lineDataA[selectedLine]["parafoudresCoordonnesPspd"]!=="1.00") {

            lineDataA[selectedLine]["parafoudresCoordonnesPspd"]=lineDataA[selectedLine]["parafoudresPEB"];
            lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]=lineDataA[selectedLine]["parafoudresPEBValeur"];


        }


        updateResults();

        document.getElementById('display-value-pspd-mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"];
        document.getElementById('parafoudres-coordonnes_select_mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspd"];

        pspd_am_valeur=parseFloat(lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]);
        //pspd_am_valeur=lineDataA[selectedLine]["parafoudresPEBValeur"];
        pspd_sm_valeur=parseFloat(lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]);
        //pspd_sm_valeur=lineDataA[selectedLine]["parafoudresPEBValeur"];

        if(pspd_am_valeur>pspd_sm_valeur) {

            //document.getElementById('display-value-pspd-mesures').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('display-value-pspd').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('parafoudres-coordonnes_select').value = lineData[selectedLine]["parafoudresCoordonnesPspd"];

            lineDataA[selectedLine]["parafoudresCoordonnesPspd"]=lineData[selectedLine]["parafoudresCoordonnesPspd"];
            lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]=lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];

        }





    });  


    document.getElementById('parafoudres-equipotentialite_select_mesures').addEventListener('change', function() {
        const selectedLine = dropdownMenuLineMesures.value;
        lineDataA[selectedLine]["parafoudresPEB"] = this.value;

        if (lineDataA[selectedLine]["parafoudresPEB"]==='1.00') {

            document.getElementById('display-value-equipotentialite-mesures').value='1.00';
            pb_test='1.00';

        } else if (lineDataA[selectedLine]["parafoudresPEB"]==="0.05") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.03';
            document.getElementById('display-value-equipotentialite-mesures').value='0.05';
            pb_test='0.10';

        } else if (lineDataA[selectedLine]["parafoudresPEB"]==="0.02") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.02';
            document.getElementById('display-value-equipotentialite-mesures').value='0.02';
            pb_test='0.05';

        } else if (lineDataA[selectedLine]["parafoudresPEB"]==="0.01") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.01';
            document.getElementById('display-value-equipotentialite-mesures').value='0.01';
            pb_test='0.02';

        } else if (lineDataA[selectedLine]["parafoudresPEB"]==="0.005") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.005';
            document.getElementById('display-value-equipotentialite-mesures').value='0.005';
            pb_test='0.02';

        } else if (lineDataA[selectedLine]["parafoudresPEB"]==="0.001") {

            //lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]= '0.001';
            document.getElementById('display-value-equipotentialite-mesures').value='0.001';
            pb_test='0.02';

        }

        lineDataA[selectedLine]["parafoudresPEBValeur"]=document.getElementById('display-value-equipotentialite-mesures').value;
        //lineData_float[selectedLine]["pspd"]=parseFloat(lineData[selectedLine]["parafoudresPEBValeur"]);

        pb_test_float=parseFloat(pb_test);

        if (pb_test_float>PBA) {

            lineDataA[selectedLine]["parafoudresPEB"]=peb_test_am;
            lineDataA[selectedLine]["parafoudresPEBValeur"]=peb_test_am;

        }

        document.getElementById('display-value-equipotentialite-mesures').value = lineDataA[selectedLine]["parafoudresPEBValeur"];
        document.getElementById('parafoudres-equipotentialite_select_mesures').value = lineDataA[selectedLine]["parafoudresPEB"];

        if (lineDataA[selectedLine]["parafoudresCoordonnesPspd"]!=="1.00") {

            lineDataA[selectedLine]["parafoudresCoordonnesPspd"]=lineDataA[selectedLine]["parafoudresPEB"];
            lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]=lineDataA[selectedLine]["parafoudresPEBValeur"];
            document.getElementById('display-value-pspd-mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('parafoudres-coordonnes_select_mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspd"];



        }

        peb_am_valeur=parseFloat(lineDataA[selectedLine]["parafoudresPEBValeur"]);
        pspd_am_valeur=parseFloat(lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]);

        //pspd_am_valeur=lineDataA[selectedLine]["parafoudresPEBValeur"];
        peb_sm_valeur=parseFloat(lineData[selectedLine]["parafoudresPEBValeur"]);
        pspd_sm_valeur=parseFloat(lineData[selectedLine]["parafoudresCoordonnesPspdValeur"]);

        //pspd_sm_valeur=lineDataA[selectedLine]["parafoudresPEBValeur"];

        if(peb_am_valeur>peb_sm_valeur) {

            //document.getElementById('display-value-pspd-mesures').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('display-value-equipotentialite-mesures').value=lineData[selectedLine]["parafoudresPEBValeur"];
            document.getElementById('parafoudres-equipotentialite_select_mesures').value=lineData[selectedLine]["parafoudresPEB"];

            lineDataA[selectedLine]["parafoudresPEB"]=lineData[selectedLine]["parafoudresPEB"];
            lineDataA[selectedLine]["parafoudresPEBValeur"]=lineData[selectedLine]["parafoudresPEBValeur"];

        }

        if(pspd_am_valeur>pspd_sm_valeur) {

            //document.getElementById('display-value-pspd-mesures').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('display-value-pspd').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];
            document.getElementById('parafoudres-coordonnes_select').value = lineData[selectedLine]["parafoudresCoordonnesPspd"];

            lineDataA[selectedLine]["parafoudresCoordonnesPspd"]=lineData[selectedLine]["parafoudresCoordonnesPspd"];
            lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"]=lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];

        }


 





        updateResults();




    });  


    document.getElementById('type-cablage-interne-select-mesures').addEventListener('change', function() {
        const selectedLine = dropdownMenuLineMesures.value;
        lineDataA[selectedLine]["typeCablageInterne"] = this.value;

        
        if (lineDataA[selectedLine]["typeCablageInterne"]==='1.0') {

            //lineData[selectedLine]["typeCablageInterneValeur"]= "1.00";
            document.getElementById('display-value-ks3-mesures').value='1.00';

        } else if (lineDataA[selectedLine]["typeCablageInterne"]==="0.2") {

            //lineData[selectedLine]["typeCablageInterneValeur"]= '0.20';
            document.getElementById('display-value-ks3-mesures').value='0.20';

        } else if (lineDataA[selectedLine]["typeCablageInterne"]==="0.01") {

            //lineData[selectedLine]["typeCablageInterneValeur"]= '0.02';
            document.getElementById('display-value-ks3-mesures').value='0.01';

        } else if (lineDataA[selectedLine]["typeCablageInterne"]==="0.0001") {

            //lineData[selectedLine]["typeCablageInterneValeur"]= '0.0002';
            document.getElementById('display-value-ks3-mesures').value='0.0001';

        } 
        
        lineDataA[selectedLine]["typeCablageInterneValeur"]=document.getElementById('display-value-ks3-mesures').value;
        //lineDataA[selectedLine]["typeCablageInterneValeur"]=parseFloat(lineDataA[selectedLine]["typeCablageInterneValeur"]);

        KS3_value_am=parseFloat(lineDataA[selectedLine]["typeCablageInterneValeur"]);
        KS3_value_sm=parseFloat(lineData[selectedLine]["typeCablageInterneValeur"]);

        if (KS3_value_am>KS3_value_sm) {

            document.getElementById('display-value-ks3-mesures').value=lineData[selectedLine]["typeCablageInterneValeur"];
            document.getElementById('type-cablage-interne-select-mesures').value=lineData[selectedLine]["typeCablageInterne"];
            lineDataA[selectedLine]["typeCablageInterneValeur"]=lineData[selectedLine]["typeCablageInterneValeur"];
            lineDataA[selectedLine]["typeCablageInterne"]=lineData[selectedLine]["typeCablageInterne"];



        }


        updateResults();



    });  

    document.getElementById('interfaces_isolement_select_mesures').addEventListener('change', function() {
        const selectedLine = dropdownMenuLineMesures.value;
        lineDataA[selectedLine]["interfacesIsolement"] = this.value;
        
        if (lineDataA[selectedLine]["interfacesIsolement"]==='1.00') {

            //lineData[selectedLine]["typeCablageInterneValeur"]= "1.00";
            document.getElementById('display-value-interfaces-isolement-mesures').value='1.00';

        } else {

            document.getElementById('display-value-interfaces-isolement-mesures').value='0.00';


        }
       

        lineDataA[selectedLine]["interfacesIsolementValeur"]=document.getElementById('display-value-interfaces-isolement-mesures').value;
        document.getElementById('display-value-interfaces-isolement-mesures').value=lineDataA[selectedLine]["interfacesIsolementValeur"];

        if (parseFloat(lineDataA[selectedLine]["interfacesIsolementValeur"])>=parseFloat(lineData[selectedLine]["interfacesIsolementValeur"])) {

            lineDataA[selectedLine]["interfacesIsolementValeur"]=lineData[selectedLine]["interfacesIsolementValeur"];
            lineDataA[selectedLine]["interfacesIsolement"]=lineData[selectedLine]["interfacesIsolement"];
            document.getElementById('display-value-interfaces-isolement-mesures').value=lineData[selectedLine]["interfacesIsolementValeur"];
            document.getElementById('interfaces_isolement_select_mesures').value=lineData[selectedLine]["interfacesIsolement"]

        }



        updateResults();



    });  



    document.getElementById('resistance-ecran-pld-mesures').addEventListener('change', function() {
        const selectedLine = dropdownMenuLineMesures.value;
        lineDataA[selectedLine]["typeCablageExternePLD"] = this.value;

        

      if (lineDataA[selectedLine]["typeCablageExternePLD"]==='1') {


            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';
               


            }


        } else if (lineDataA[selectedLine]["typeCablageExternePLD"]==='2') {


            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';
               


            }

        } else if (lineDataA[selectedLine]["typeCablageExternePLD"]==='3') {

           if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='1.00';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='1.00';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.95';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.95';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.90';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.90';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.80';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.80';
               


            }



        } else if (lineDataA[selectedLine]["typeCablageExternePLD"]==='4') {

           if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.90';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.90';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.80';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.80';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.60';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.60';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.30';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.30';

               


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.10';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.10';
               


            }


        } else if (lineDataA[selectedLine]["typeCablageExternePLD"]==='5') {

            if (lineData[selectedLine]["tensionAssignee"]==='1.0') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.60';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.60';

                

            } else if (lineData[selectedLine]["tensionAssignee"]==='1.5') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.40';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.40';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='2.5') {

                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.20';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.20';

                


            } else if (lineData[selectedLine]["tensionAssignee"]==='4.0') {


                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.04';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.04';
            


            } else if (lineData[selectedLine]["tensionAssignee"]==='6.0') {


                //lineData[selectedLine]["typeCablageExternePLDValeur"]='0.02';
                lineDataA[selectedLine]["typeCablageExternePLDValeur"]='0.02';
               


            }



        } 





          //document.getElementById('display-value-pli-mesures').value = lineDataA[selectedLine]["typeCablageExternePLIValeur"];
          document.getElementById('display-value-pld-mesures').value = lineDataA[selectedLine]["typeCablageExternePLDValeur"];

          pld_float_am=parseFloat(lineDataA[selectedLine]["typeCablageExternePLDValeur"]);
          //pli_float_am=parseFloat(lineDataA[selectedLine]["typeCablageExternePLIValeur"]);

          pld_float_sm=parseFloat(lineData[selectedLine]["typeCablageExternePLDValeur"]);
          //pli_float_sm=parseFloat(lineData[selectedLine]["typeCablageExternePLIValeur"]);

          if (pld_float_am>pld_float_sm) {

            //document.getElementById('display-value-pli-mesures').value = lineData[selectedLine]["typeCablageExternePLIValeur"];
            document.getElementById('display-value-pld-mesures').value = lineData[selectedLine]["typeCablageExternePLDValeur"];
            document.getElementById('resistance-ecran-pld-mesures').value=lineData[selectedLine]["typeCablageExternePLD"];
            lineDataA[selectedLine]["typeCablageExternePLDValeur"]=lineData[selectedLine]["typeCablageExternePLDValeur"];
            //lineDataA[selectedLine]["typeCablageExternePLIValeur"]=lineData[selectedLine]["typeCablageExternePLIValeur"];
            lineDataA[selectedLine]["typeCablageExternePLD"]=lineData[selectedLine]["typeCablageExternePLD"];


          }






          
          updateResults();


        


        

    });
    
    
    document.getElementById('conditions-blindage-cld-cli-mesures').addEventListener('change', function() {
        const selectedLine = dropdownMenuLineMesures.value;
        lineDataA[selectedLine]["conditionsBlindageCLDCLI"] = this.value;

        

       if (lineDataA[selectedLine]["conditionsBlindageCLDCLI"]==='1') {

            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='1.00';

 
        } else if (lineDataA[selectedLine]["conditionsBlindageCLDCLI"]==='2') {

            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='1.00';


        } else if (lineDataA[selectedLine]["conditionsBlindageCLDCLI"]==='3') {

            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.20';


        } else if (lineDataA[selectedLine]["conditionsBlindageCLDCLI"]==='4') {

            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.30';


        } else if (lineDataA[selectedLine]["conditionsBlindageCLDCLI"]==='5') {


            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.10';


        } else if (lineDataA[selectedLine]["conditionsBlindageCLDCLI"]==='6') {

            
            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.00';


        } else if (lineDataA[selectedLine]["conditionsBlindageCLDCLI"]==='7') {


            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='1.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.00';


        } else if (lineDataA[selectedLine]["conditionsBlindageCLDCLI"]==='8') {

            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='0.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.00';


        } else if (lineDataA[selectedLine]["conditionsBlindageCLDCLI"]==='9') {


            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='0.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.00';


        } else if (lineDataA[selectedLine]["conditionsBlindageCLDCLI"]==='10') {


            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]='0.00';
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]='0.00';


        } 



        //document.getElementById('display-value-pli').value = lineData[selectedLine]["typeCablageExternePLIValeur"];
        document.getElementById('display-value-cld-mesures').value = lineDataA[selectedLine]["conditionsBlindageCLDValeur"];
        document.getElementById('display-value-cli-mesures').value = lineDataA[selectedLine]["conditionsBlindageCLIValeur"];

        //lineDataA[selectedLine]["conditionsBlindageCLDValeur"]=lineData[selectedLine]["conditionsBlindageCLDValeur"];
        //lineDataA[selectedLine]["conditionsBlindageCLIValeur"]=lineData[selectedLine]["conditionsBlindageCLIValeur"];

        if (paseFloat(lineDataA[selectedLine]["conditionsBlindageCLDValeur"])>=parseFloat(lineData[selectedLine]["conditionsBlindageCLDValeur"]) || parseFloat(lineDataA[selectedLine]["conditionsBlindageCLIValeur"])>=parseFloat(lineData[selectedLine]["conditionsBlindageCLIValeur"])) {

            lineDataA[selectedLine]["conditionsBlindageCLDValeur"]=lineData[selectedLine]["conditionsBlindageCLDValeur"];
            lineDataA[selectedLine]["conditionsBlindageCLIValeur"]=lineData[selectedLine]["conditionsBlindageCLIValeur"];
            lineDataA[selectedLine]["conditionsBlindageCLDCLI"]=lineData[selectedLine]["conditionsBlindageCLDCLI"];
            document.getElementById('display-value-cld-mesures').value = lineData[selectedLine]["conditionsBlindageCLDValeur"];
            document.getElementById('display-value-cli-mesures').value = lineData[selectedLine]["conditionsBlindageCLIValeur"];
            document.getElementById('conditions-blindage-cld-cli-mesures').value = lineData[selectedLine]["conditionsBlindageCLDCLI"];



        } 


          
          updateResults();

      


        

    });  







document.addEventListener('DOMContentLoaded', function() {
    const dropdownMenuZone = document.getElementById('dropdown-menu-zone');
    const addZoneButton = document.getElementById('add-zone-btn');
    const zoneList = document.getElementById('zone-list');

    const selectedZone = dropdownMenuZone.value;

    zoneData[selectedZone] = {
        "PertesLtZoneInt": "1",
        "PertesLtZoneIntValeur": "0.01",
        "taillemaillesinputks2":"grayed-out-mailles-KS2",
        "taillemailleslabeks2":"titre_label_mailles_KS2",
        "PertesLfZone": "2",
        "PertesLfZoneValeur": "0.02",
        "PertesLoZone": "1",
        "PertesLoZoneValeur": "0.00",
        "TypeDangerParticulier": "2",
        "TypeDangerParticulierValeur": "2.00",
        "FacteurRisqueIncendie": "3",
        "FacteurRisqueIncendieValeur": "0.01",
        "PrecautionsRisqueIncendie":"1",
        "PrecautionsRisqueIncendieValeur":"1.00",
        "CheckedLFE":false,
        "CheckedINERIS":false,
        "ClassNameLFELabel":'grayed-out-label',
        "ClassNameLFEInput":'grayed-out',
        "ClassNameTeLabel":'grayed-out-label',
        "ClassNameTeInput":'grayed-out',
        "PertesLFE":'0.0',
        "PertesTeLFE":'0.0',
        "DisabledCheckboxINERIS":true,
        "LabelCheckboxINERIS":'disabled-label',
        "ClassNamePTWSLabel":'grayed-out-label',
        "ClassNamePTWSInput":'grayed-out',
        "PTWSLFE":'0.0',
        "FacteurReductionToucherPas":"1",
        "FacteurReductionToucherPasValeur":"0.01",
        "EcranSpatialKS2":"1",
        "EcranSpatialKS2Valeur":"1.00",
        "TailleMaillesK2":"5.00",
        "FacteurReductionToucherPasPAValeur":"1.00000",
        "option1_checked":true,
        "option2_checked":false,
        "option3_checked":false,
        "option4_checked":false,
        "option5_checked":false,
        "option6_checked":false,
        "FacteurReductionToucherPasPTU":"1",
        "FacteurReductionToucherPasPTUValeur":"1.00000",
        "optionptu1_checked":true,
        "optionptu2_checked":false,
        "optionptu3_checked":false,
        "optionptu4_checked":false,
        "nz":"10",
        "tz":"8760",
        "risqueRAS":"0.00",
        "risqueRBS":"0.00",
        "risqueRCS":"0.00",
        "risqueRMS":"0.00",
        "risqueRUS":"0.00",
        "risqueRVS":"0.00",
        "risqueRWS":"0.00",
        "risqueRZS":"0.00",
        "ZoneSurface":"10.0",
        "ChargeCalorifique":"10.0",
        "ChargeClorifiqueAffichee": "Non calculée",
        "PA":"1.00",
        "PU":"1.00",
        "PM":"1.00",
        "PC":"1.00",
        "risqueCounter":2

    }

        zoneDatafloat[selectedZone] = {

        "PertesLtZoneIntValeur": 0.01,
        "PertesLfZoneValeur": 0.02,
        "PertesLoZoneValeur": 0.00,
        "EcranSpatialKS2Valeur": 1.00,
        "FacteurPAValeur":1.00,
        "FacteurPTUValeur":1.00,
        "nz":"10",
        "tz":"8760",
      

    }


    zoneDataA[selectedZone] = {
        "PrecautionsRisqueIncendie":"1",
        "PrecautionsRisqueIncendieValeur":"1.00",
        "PTWSLFE":'0.0',
        "FacteurReductionToucherPas":"1",
        "FacteurReductionToucherPasValeur":"0.01",
        "EcranSpatialKS2":"1",
        "EcranSpatialKS2Valeur":"1.00",
        "TailleMaillesK2":"5.00",
        "FacteurReductionToucherPasPAValeur":"1.00000",
        "option1_checked":true,
        "option2_checked":false,
        "option3_checked":false,
        "option4_checked":false,
        "option5_checked":false,
        "option6_checked":false,
        "FacteurReductionToucherPasPTU":"1",
        "FacteurReductionToucherPasPTUValeur":"1.00000",
        "optionptu1_checked":true,
        "optionptu2_checked":false,
        "optionptu3_checked":false,
        "optionptu4_checked":false,
        "risqueRAA":"0.00",
        "risqueRBA":"0.00",
        "risqueRCA":"0.00",
        "risqueRMA":"0.00",
        "risqueRUA":"0.00",
        "risqueRVA":"0.00",
        "risqueRWA":"0.00",
        "risqueRZA":"0.00",
        "PA":"1.00",
        "PU":"1.00",
        "PM":"1.00",
        "PC":"1.00"


    }

        zoneDatafloatA[selectedZone] = {

        "EcranSpatialKS2Valeur": 1.00,
        "FacteurPAValeur":1.00,
        "FacteurPTUValeur":1.00

    };


    produits_data[selectedZone] = {"Produit N° 1":

        {"PotentielCalorifique":"10.0",
        "QuantiteProduit":"10.0"}

    };

    const checkboxes = document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]');

    checkboxes.forEach(checkbox => {
        // Get the name of the current line
        checkbox_name=checkbox.name;

        if (!selected_lines[selectedZone]) {
            selected_lines[selectedZone] = {};
        }
        
        // Store the checked state of the line
        selected_lines[selectedZone][checkbox_name] = false;
        checkbox.checked=false;
    });



   
    document.getElementById('perte-contact-pas-int').value =zoneData[selectedZone]["PertesLtZoneInt"];
    document.getElementById('display-value-perte-contact-pas-int').value = zoneData[selectedZone]["PertesLtZoneIntValeur"];

    document.getElementById('perte-dommages-physiques').value =zoneData[selectedZone]["PertesLfZone"];
    document.getElementById('display-value-dommages-physiques-int').value = zoneData[selectedZone]["PertesLfZoneValeur"];

    document.getElementById('perte-defaillance-equipements').value =zoneData[selectedZone]["PertesLoZone"];
    document.getElementById('display-value-defaillance-equipements').value = zoneData[selectedZone]["PertesLoZoneValeur"];

    document.getElementById('display-value-nz').value=zoneDatafloat[selectedZone]["nz"];
    document.getElementById('display-value-tz').value=zoneDatafloat[selectedZone]["tz"];

    document.getElementById('type_danger_particulier_hz').value =zoneData[selectedZone]["TypeDangerParticulier"];
    document.getElementById('display-value-type-danger-particulier').value = zoneData[selectedZone]["TypeDangerParticulierValeur"];

    document.getElementById('type_risque_incendie').value =zoneData[selectedZone]["FacteurRisqueIncendie"];
    document.getElementById('display-value-reduction-risque-incendie').value = zoneData[selectedZone]["FacteurRisqueIncendieValeur"];

    document.getElementById('precaution_risque_incendie').value =zoneData[selectedZone]["PrecautionsRisqueIncendie"];
    document.getElementById('display-value-precaution-risque-incendie').value = zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"];

    document.getElementById('facteur-reduction-sol').value =zoneData[selectedZone]["FacteurReductionToucherPas"];
    document.getElementById('display-value-facteur-reduction-sol').value = zoneData[selectedZone]["FacteurReductionToucherPasValeur"];

    document.getElementById('systeme-ecran-interne').value =zoneData[selectedZone]["EcranSpatialKS2"];
    document.getElementById('display-value-ecra-interne-options').value = zoneData[selectedZone]["EcranSpatialKS2Valeur"];

    
    document.getElementById('display-value-pa-options').value = zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"];
    document.getElementById('option1').checked=zoneData[selectedZone]["option1_checked"];
    document.getElementById('option2').checked=zoneData[selectedZone]["option2_checked"];
    document.getElementById('option3').checked=zoneData[selectedZone]["option3_checked"];
    document.getElementById('option4').checked=zoneData[selectedZone]["option4_checked"];
    document.getElementById('option5').checked=zoneData[selectedZone]["option5_checked"];
    document.getElementById('option6').checked=zoneData[selectedZone]["option6_checked"];

    document.getElementById('display-value-ptu-options').value = zoneData[selectedZone]["FacteurReductionToucherPasPTUValeur"];
    document.getElementById('optionptu1').checked=zoneData[selectedZone]["optionptu1_checked"];
    document.getElementById('optionptu2').checked=zoneData[selectedZone]["optionptu2_checked"];
    document.getElementById('optionptu3').checked=zoneData[selectedZone]["optionptu3_checked"];
    document.getElementById('optionptu4').checked=zoneData[selectedZone]["optionptu4_checked"];


    document.getElementById('precaution_risque_incendie_mesures').value =zoneDataA[selectedZone]["PrecautionsRisqueIncendie"];
    document.getElementById('display-value-precaution-risque-incendie-mesures').value = zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"];

    document.getElementById('facteur-reduction-sol-mesures').value =zoneDataA[selectedZone]["FacteurReductionToucherPas"];
    document.getElementById('display-value-facteur-reduction-sol-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"];

    document.getElementById('systeme-ecran-interne-mesures').value =zoneDataA[selectedZone]["EcranSpatialKS2"];
    document.getElementById('display-value-ecra-interne-options-mesures').value = zoneDataA[selectedZone]["EcranSpatialKS2Valeur"];

    document.getElementById('display-value-pa-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"];  
    document.getElementById('option1-mesures').checked=zoneDataA[selectedZone]["option1_checked"];
    document.getElementById('option2-mesures').checked=zoneDataA[selectedZone]["option2_checked"];
    document.getElementById('option3-mesures').checked=zoneDataA[selectedZone]["option3_checked"];
    document.getElementById('option4-mesures').checked=zoneDataA[selectedZone]["option4_checked"];
    document.getElementById('option5-mesures').checked=zoneDataA[selectedZone]["option5_checked"];
    document.getElementById('option6-mesures').checked=zoneDataA[selectedZone]["option6_checked"];

    document.getElementById('display-value-ptu-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPTUValeur"];
    document.getElementById('optionptu1-mesures').checked=zoneDataA[selectedZone]["optionptu1_checked"];
    document.getElementById('optionptu2-mesures').checked=zoneDataA[selectedZone]["optionptu2_checked"];
    document.getElementById('optionptu3-mesures').checked=zoneDataA[selectedZone]["optionptu3_checked"];
    document.getElementById('optionptu4-mesures').checked=zoneDataA[selectedZone]["optionptu4_checked"];

    document.getElementById('pertes_lfe').className=zoneData[selectedZone]["ClassNameLFELabel"];
    document.getElementById('display-value-lfe').className=zoneData[selectedZone]["ClassNameLFEInput"];
    document.getElementById('te_lfe').className=zoneData[selectedZone]["ClassNameTeLabel"];
    document.getElementById('display-te-lfe').className=zoneData[selectedZone]["ClassNameTeInput"];
    document.getElementById('display-value-lfe').value=zoneData[selectedZone]["PertesLFE"];
    document.getElementById('display-te-lfe').value=zoneData[selectedZone]["PertesTeLFE"];
    document.getElementById('includeOptionPertes').checked=zoneData[selectedZone]["CheckedLFE"];
    document.getElementById('includeOptionNoteINERIS').checked=zoneData[selectedZone]["CheckedINERIS"];
    document.getElementById('includeOptionNoteINERIS').disabled=zoneData[selectedZone]["DisabledCheckboxINERIS"];
    document.getElementById('labelincludeOptionNoteINERIS').className=zoneData[selectedZone]["LabelCheckboxINERIS"];
    document.getElementById('ptws_lfe').className=zoneData[selectedZone]["ClassNamePTWSLabel"];
    document.getElementById('display-ptws-lfe').className=zoneData[selectedZone]["ClassNamePTWSInput"];
    document.getElementById('display-ptws-lfe').value=zoneData[selectedZone]["PTWSLFE"];



    create_risque_container ();

    document.getElementById('surface_zone').value =zoneData[selectedZone]["ZoneSurface"];
    document.getElementById('potentiel_zone').value =produits_data[selectedZone]["Produit N° 1"]["PotentielCalorifique"];
    document.getElementById('quantite_zone').value =produits_data[selectedZone]["Produit N° 1"]["QuantiteProduit"];
    document.getElementById('charge_zone').value =zoneData[selectedZone]["ChargeCalorifique"];



    updateResults();




    addZoneButton.addEventListener('click', function() {
    const newZone = `Zone N° ${zoneCounter}`;

    // Add new option to the dropdown menu
    const option_zone = document.createElement('option');
    option_zone.value = newZone;
    option_zone.textContent = newZone;

    dropdownMenuZone.appendChild(option_zone);
    dropdownMenuZone.value=newZone;
    //selectedZone=dropdownMenuZone.value;

    const checkboxes =document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]');

    checkboxes.forEach((checkbox) => {
        var checkbox_name=checkbox.name;

        checkbox.checked=selected_lines[selectedZone][checkbox_name];

        


    });


    const checkboxes2 = document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]');

    checkboxes2.forEach(checkbox => {
    // Get the name of the current line
    checkbox_name=checkbox.name;

    if (!selected_lines[newZone]) {
        selected_lines[newZone] = {};
    }
    
    // Store the checked state of the line
    selected_lines[newZone][checkbox_name] = false;
    checkbox.checked=false;
    });



     zoneData[newZone] = {
        "PertesLtZoneInt": "1",
        "PertesLtZoneIntValeur": "0.01",
        "taillemaillesinputks2":"grayed-out-mailles-KS2",
        "taillemailleslabeks2":"titre_label_mailles_KS2",
        "PertesLfZone": "2",
        "PertesLfZoneValeur": "0.02",
        "PertesLoZone": "1",
        "PertesLoZoneValeur": "0.00",
        "TypeDangerParticulier": "2",
        "TypeDangerParticulierValeur": "2.00",
        "FacteurRisqueIncendie": "3",
        "FacteurRisqueIncendieValeur": "0.01",
        "PrecautionsRisqueIncendie":"1",
        "PrecautionsRisqueIncendieValeur":"1.00",
        "CheckedLFE":false,
        "CheckedINERIS":false,
        "ClassNameLFELabel":'grayed-out-label',
        "ClassNameLFEInput":'grayed-out',
        "ClassNameTeLabel":'grayed-out-label',
        "ClassNameTeInput":'grayed-out',
        "PertesLFE":'0.0',
        "PertesTeLFE":'0.0',
        "DisabledCheckboxINERIS":true,
        "LabelCheckboxINERIS":'disabled-label',
        "ClassNamePTWSLabel":'grayed-out-label',
        "ClassNamePTWSInput":'grayed-out',
        "PTWSLFE":'0.0',
        "FacteurReductionToucherPas":"1",
        "FacteurReductionToucherPasValeur":"0.01",
        "EcranSpatialKS2":"1",
        "EcranSpatialKS2Valeur":"1.00",
        "TailleMaillesK2":"5.00",
        "FacteurReductionToucherPasPAValeur":"1.00000",
        "option1_checked":true,
        "option2_checked":false,
        "option3_checked":false,
        "option4_checked":false,
        "option5_checked":false,
        "option6_checked":false,
        "FacteurReductionToucherPasPTU":"1",
        "FacteurReductionToucherPasPTUValeur":"1.00000",
        "optionptu1_checked":true,
        "optionptu2_checked":false,
        "optionptu3_checked":false,
        "optionptu4_checked":false,
        "nz":"10",
        "tz":"8760",
        "risqueRAS":"0.00",
        "risqueRBS":"0.00",
        "risqueRCS":"0.00",
        "risqueRMS":"0.00",
        "risqueRUS":"0.00",
        "risqueRVS":"0.00",
        "risqueRWS":"0.00",
        "risqueRZS":"0.00",
        "ZoneSurface":"10.0",
        "ChargeCalorifique":"10.0",
        "ChargeClorifiqueAffichee": "Non calculée",
        "PA":"1.00",
        "PU":"1.00",
        "PM":"1.00",
        "PC":"1.00",
        "risqueCounter":2

    }

        zoneDatafloat[newZone] = {

        "PertesLtZoneIntValeur": 0.01,
        "PertesLfZoneValeur": 0.02,
        "PertesLoZoneValeur": 0.00,
        "EcranSpatialKS2Valeur": 1.00,
        "FacteurPAValeur":1.00,
        "FacteurPTUValeur":1.00,
        "nz":"10",
        "tz":"8760",

    }

    zoneDataA[newZone] = {
        "PrecautionsRisqueIncendie":"1",
        "PrecautionsRisqueIncendieValeur":"1.00",
        "PTWSLFE":'0.0',
        "FacteurReductionToucherPas":"1",
        "FacteurReductionToucherPasValeur":"0.01",
        "EcranSpatialKS2":"1",
        "EcranSpatialKS2Valeur":"1.00",
        "TailleMaillesK2":"5.00",
        "FacteurReductionToucherPasPAValeur":"1.00000",
        "option1_checked":true,
        "option2_checked":false,
        "option3_checked":false,
        "option4_checked":false,
        "option5_checked":false,
        "option6_checked":false,
        "FacteurReductionToucherPasPTUValeur":"1.00000",
        "optionptu1_checked":true,
        "optionptu2_checked":false,
        "optionptu3_checked":false,
        "optionptu4_checked":false,
        "risqueRAA":"0.00",
        "risqueRBA":"0.00",
        "risqueRCA":"0.00",
        "risqueRMA":"0.00",
        "risqueRUA":"0.00",
        "risqueRVA":"0.00",
        "risqueRWA":"0.00",
        "risqueRZA":"0.00",
        "PA":"1.00",
        "PU":"1.00",
        "PM":"1.00",
        "PC":"1.00"


    }

    zoneDatafloatA[newZone] = {

        "EcranSpatialKS2Valeur": 1.00,
        "FacteurPAValeur":1.00,
        "FacteurPTUValeur":1.00,


    }


    produits_data[newZone] = {"Produit N° 1":

        {"PotentielCalorifique":"10.0",
        "QuantiteProduit":"10.0"}

    };


    if (!selected_lines[newZone]) {
        selected_lines[newZone] = {};
    }

    selected_lines[newZone]['Ligne N° 1']=false;



    document.getElementById('perte-contact-pas-int').value =zoneData[newZone]["PertesLtZoneInt"];
    document.getElementById('display-value-perte-contact-pas-int').value = zoneData[newZone]["PertesLtZoneIntValeur"];

    document.getElementById('perte-dommages-physiques').value =zoneData[newZone]["PertesLfZone"];
    document.getElementById('display-value-dommages-physiques-int').value = zoneData[newZone]["PertesLfZoneValeur"];

    document.getElementById('perte-defaillance-equipements').value =zoneData[newZone]["PertesLoZone"];
    document.getElementById('display-value-defaillance-equipements').value = zoneData[newZone]["PertesLoZoneValeur"];
    
    document.getElementById('display-value-nz').value=zoneDatafloat[newZone]["nz"];
    document.getElementById('display-value-tz').value=zoneDatafloat[newZone]["tz"];

    document.getElementById('type_danger_particulier_hz').value =zoneData[newZone]["TypeDangerParticulier"];
    document.getElementById('display-value-type-danger-particulier').value = zoneData[newZone]["TypeDangerParticulierValeur"];

    document.getElementById('type_risque_incendie').value =zoneData[newZone]["FacteurRisqueIncendie"];
    document.getElementById('display-value-reduction-risque-incendie').value = zoneData[newZone]["FacteurRisqueIncendieValeur"];

    document.getElementById('precaution_risque_incendie').value =zoneData[newZone]["PrecautionsRisqueIncendie"];
    document.getElementById('display-value-precaution-risque-incendie').value = zoneData[newZone]["PrecautionsRisqueIncendieValeur"];

    document.getElementById('facteur-reduction-sol').value =zoneData[newZone]["FacteurReductionToucherPas"];
    document.getElementById('display-value-facteur-reduction-sol').value = zoneData[newZone]["FacteurReductionToucherPasValeur"];

    document.getElementById('systeme-ecran-interne').value =zoneData[newZone]["EcranSpatialKS2"];
    document.getElementById('display-value-ecra-interne-options').value = zoneData[newZone]["EcranSpatialKS2Valeur"];
    document.getElementById('taille-mailles-KS2-input').value = zoneData[newZone]["TailleMaillesK2"];
  
    document.getElementById('taille-mailles-KS2-input').className='grayed-out-mailles-KS2';
    document.getElementById('taille-mailles-label-KS2').className='titre_label_mailles_KS2';

    document.getElementById('display-value-pa-options').value = zoneData[newZone]["FacteurReductionToucherPasPAValeur"];

    document.getElementById('option1').checked=zoneData[newZone]["option1_checked"];
    document.getElementById('option2').checked=zoneData[newZone]["option2_checked"];
    document.getElementById('option3').checked=zoneData[newZone]["option3_checked"];
    document.getElementById('option4').checked=zoneData[newZone]["option4_checked"];
    document.getElementById('option5').checked=zoneData[newZone]["option5_checked"];
    document.getElementById('option6').checked=zoneData[newZone]["option6_checked"];

    document.getElementById('display-value-ptu-options').value = zoneData[newZone]["FacteurReductionToucherPasPTUValeur"];
    document.getElementById('optionptu1').checked=zoneData[newZone]["optionptu1_checked"];
    document.getElementById('optionptu2').checked=zoneData[newZone]["optionptu2_checked"];
    document.getElementById('optionptu3').checked=zoneData[newZone]["optionptu3_checked"];
    document.getElementById('optionptu4').checked=zoneData[newZone]["optionptu4_checked"];


    document.getElementById('precaution_risque_incendie_mesures').value =zoneDataA[newZone]["PrecautionsRisqueIncendie"];
    document.getElementById('display-value-precaution-risque-incendie-mesures').value = zoneDataA[newZone]["PrecautionsRisqueIncendieValeur"];

    document.getElementById('facteur-reduction-sol-mesures').value =zoneDataA[newZone]["FacteurReductionToucherPas"];
    document.getElementById('display-value-facteur-reduction-sol-mesures').value = zoneDataA[newZone]["FacteurReductionToucherPasValeur"];

    document.getElementById('systeme-ecran-interne-mesures').value =zoneDataA[newZone]["EcranSpatialKS2"];
    document.getElementById('display-value-ecra-interne-options-mesures').value = zoneDataA[newZone]["EcranSpatialKS2Valeur"];
    document.getElementById('taille-mailles-KS2-input-mesures').value = zoneDataA[newZone]["TailleMaillesK2"];
    
    document.getElementById('display-value-pa-options-mesures').value = zoneDataA[newZone]["FacteurReductionToucherPasPAValeur"];
    
    document.getElementById('option1-mesures').checked=zoneDataA[newZone]["option1_checked"];
    document.getElementById('option2-mesures').checked=zoneDataA[newZone]["option2_checked"];
    document.getElementById('option3-mesures').checked=zoneDataA[newZone]["option3_checked"];
    document.getElementById('option4-mesures').checked=zoneDataA[newZone]["option4_checked"];
    document.getElementById('option5-mesures').checked=zoneDataA[newZone]["option5_checked"];
    document.getElementById('option6-mesures').checked=zoneDataA[newZone]["option6_checked"];

    document.getElementById('display-value-ptu-options-mesures').value = zoneDataA[newZone]["FacteurReductionToucherPasPTUValeur"];
    document.getElementById('optionptu1-mesures').checked=zoneDataA[newZone]["optionptu1_checked"];
    document.getElementById('optionptu2-mesures').checked=zoneDataA[newZone]["optionptu2_checked"];
    document.getElementById('optionptu3-mesures').checked=zoneDataA[newZone]["optionptu3_checked"];
    document.getElementById('optionptu4-mesures').checked=zoneDataA[newZone]["optionptu4_checked"];

    create_risque_container ();

    document.getElementById('surface_zone').value =zoneData[newZone]["ZoneSurface"];
    document.getElementById('potentiel_zone').value =produits_data[newZone]["Produit N° 1"]["PotentielCalorifique"];
    document.getElementById('quantite_zone').value =produits_data[newZone]["Produit N° 1"]["QuantiteProduit"];
    document.getElementById('charge_zone').value =zoneData[newZone]["ChargeCalorifique"];

    document.getElementById('pertes_lfe').className=zoneData[newZone]["ClassNameLFELabel"];
    document.getElementById('display-value-lfe').className=zoneData[newZone]["ClassNameLFEInput"];
    document.getElementById('te_lfe').className=zoneData[newZone]["ClassNameTeLabel"];
    document.getElementById('display-te-lfe').className=zoneData[newZone]["ClassNameTeInput"];
    document.getElementById('display-value-lfe').value=zoneData[newZone]["PertesLFE"];
    document.getElementById('display-te-lfe').value=zoneData[newZone]["PertesTeLFE"];
    document.getElementById('includeOptionPertes').checked=zoneData[newZone]["CheckedLFE"];
    document.getElementById('includeOptionNoteINERIS').checked=zoneData[newZone]["CheckedINERIS"];
    document.getElementById('includeOptionNoteINERIS').disabled=zoneData[newZone]["DisabledCheckboxINERIS"];
    document.getElementById('labelincludeOptionNoteINERIS').className=zoneData[newZone]["LabelCheckboxINERIS"];
    document.getElementById('ptws_lfe').className=zoneData[newZone]["ClassNamePTWSLabel"];
    document.getElementById('display-ptws-lfe').className=zoneData[newZone]["ClassNamePTWSInput"];
    document.getElementById('display-ptws-lfe').value=zoneData[newZone]["PTWSLFE"];
    




    updateResults()











  
    zoneCounter++;
    });


    dropdownMenuZone.addEventListener('change', function() {

        const selectedZone = dropdownMenuZone.value;


        document.getElementById('perte-contact-pas-int').value =zoneData[selectedZone]["PertesLtZoneInt"];
        document.getElementById('display-value-perte-contact-pas-int').value = zoneData[selectedZone]["PertesLtZoneIntValeur"];

        document.getElementById('perte-dommages-physiques').value =zoneData[selectedZone]["PertesLfZone"];
        document.getElementById('display-value-dommages-physiques-int').value = zoneData[selectedZone]["PertesLfZoneValeur"];

        document.getElementById('perte-defaillance-equipements').value =zoneData[selectedZone]["PertesLoZone"];
        document.getElementById('display-value-defaillance-equipements').value = zoneData[selectedZone]["PertesLoZoneValeur"];

        document.getElementById('display-value-nz').value=zoneDatafloat[selectedZone]["nz"];
        document.getElementById('display-value-tz').value=zoneDatafloat[selectedZone]["tz"];

        document.getElementById('type_danger_particulier_hz').value =zoneData[selectedZone]["TypeDangerParticulier"];
        document.getElementById('display-value-type-danger-particulier').value = zoneData[selectedZone]["TypeDangerParticulierValeur"];

        document.getElementById('type_risque_incendie').value =zoneData[selectedZone]["FacteurRisqueIncendie"];
        document.getElementById('display-value-reduction-risque-incendie').value = zoneData[selectedZone]["FacteurRisqueIncendieValeur"];

        document.getElementById('precaution_risque_incendie').value =zoneData[selectedZone]["PrecautionsRisqueIncendie"];
        document.getElementById('display-value-precaution-risque-incendie').value = zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"];

        document.getElementById('facteur-reduction-sol').value =zoneData[selectedZone]["FacteurReductionToucherPas"];
        document.getElementById('display-value-facteur-reduction-sol').value = zoneData[selectedZone]["FacteurReductionToucherPasValeur"];

        document.getElementById('systeme-ecran-interne').value =zoneData[selectedZone]["EcranSpatialKS2"];
        document.getElementById('display-value-ecra-interne-options').value = zoneData[selectedZone]["EcranSpatialKS2Valeur"];
        document.getElementById('taille-mailles-KS2-input').value = zoneData[selectedZone]["TailleMaillesK2"];
        
        document.getElementById('display-value-pa-options').value = zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"];      
        document.getElementById('option1').checked=zoneData[selectedZone]["option1_checked"];
        document.getElementById('option2').checked=zoneData[selectedZone]["option2_checked"];
        document.getElementById('option3').checked=zoneData[selectedZone]["option3_checked"];
        document.getElementById('option4').checked=zoneData[selectedZone]["option4_checked"];
        document.getElementById('option5').checked=zoneData[selectedZone]["option5_checked"];
        document.getElementById('option6').checked=zoneData[selectedZone]["option6_checked"];

        document.getElementById('display-value-ptu-options').value = zoneData[selectedZone]["FacteurReductionToucherPasPTUValeur"];
        document.getElementById('optionptu1').checked=zoneData[selectedZone]["optionptu1_checked"];
        document.getElementById('optionptu2').checked=zoneData[selectedZone]["optionptu2_checked"];
        document.getElementById('optionptu3').checked=zoneData[selectedZone]["optionptu3_checked"];
        document.getElementById('optionptu4').checked=zoneData[selectedZone]["optionptu4_checked"];

        document.getElementById('display-value-nz').value=zoneDatafloat[selectedZone]["nz"];
        document.getElementById('display-value-tz').value=zoneDatafloat[selectedZone]["tz"];

        document.getElementById('pertes_lfe').className=zoneData[selectedZone]["ClassNameLFELabel"];
        document.getElementById('display-value-lfe').className=zoneData[selectedZone]["ClassNameLFEInput"];
        document.getElementById('te_lfe').className=zoneData[selectedZone]["ClassNameTeLabel"];
        document.getElementById('display-te-lfe').className=zoneData[selectedZone]["ClassNameTeInput"];
        document.getElementById('display-value-lfe').value=zoneData[selectedZone]["PertesLFE"];
        document.getElementById('display-te-lfe').value=zoneData[selectedZone]["PertesTeLFE"];
        document.getElementById('includeOptionPertes').checked=zoneData[selectedZone]["CheckedLFE"];
        document.getElementById('includeOptionNoteINERIS').checked=zoneData[selectedZone]["CheckedINERIS"];
        document.getElementById('includeOptionNoteINERIS').disabled=zoneData[selectedZone]["DisabledCheckboxINERIS"];
        document.getElementById('labelincludeOptionNoteINERIS').className=zoneData[selectedZone]["LabelCheckboxINERIS"];
        document.getElementById('ptws_lfe').className=zoneData[selectedZone]["ClassNamePTWSLabel"];
        document.getElementById('display-ptws-lfe').className=zoneData[selectedZone]["ClassNamePTWSInput"];
        document.getElementById('display-ptws-lfe').value=zoneData[selectedZone]["PTWSLFE"];



        const checkboxes2 = document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]');

        checkboxes2.forEach(checkbox => {
        // Get the name of the current line
        checkbox_name=checkbox.name;

        // Store the checked state of the line
        checkbox.checked=selected_lines[selectedZone][checkbox_name];
        });

        create_risque_container ();

        document.getElementById('dropdown-menu-risque').selectedIndex=0;
        const selectedProduct=document.getElementById('dropdown-menu-risque').value;
    
        document.getElementById('surface_zone').value =zoneData[selectedZone]["ZoneSurface"];
        document.getElementById('potentiel_zone').value =produits_data[selectedZone][selectedProduct]["PotentielCalorifique"];
        document.getElementById('quantite_zone').value =produits_data[selectedZone][selectedProduct]["QuantiteProduit"];
        document.getElementById('charge_zone').value =zoneData[selectedZone]["ChargeCalorifique"];


    });

   
    document.getElementById('perte-contact-pas-int').addEventListener('change', function() {
        const selectedZone = dropdownMenuZone.value;
        zoneData[selectedZone]["PertesLtZoneInt"] = this.value;
        const displayValueInput = document.getElementById('display-value-perte-contact-pas-int');
    

        if (this.value==='1') {

            zoneData[selectedZone]["PertesLtZoneIntValeur"]="0.01";
            zoneDatafloat[selectedZone]["PertesLtZoneIntValeur"]=0.01;
            displayValueInput.readOnly = true; // Enable input for manual changes

            document.getElementById('display-value-perte-contact-pas-int').value = zoneData[selectedZone]["PertesLtZoneIntValeur"];

            updateResults();




        } else {

            displayValueInput.value = '0.00';

            displayValueInput.readOnly = false;

            zoneData[selectedZone]["PertesLtZoneIntValeur"]="0.00";
            zoneDatafloat[selectedZone]["PertesLtZoneIntValeur"]=0.00;
            
          
            
            displayValueInput.addEventListener('change', function() {

                lt_value=parseFloat(document.getElementById('display-value-perte-contact-pas-int').value);


                if (isNaN(lt_value) || lt_value <= 0) {

                    lt_value=0.0;
                    document.getElementById('display-value-perte-contact-pas-int').value='0.00';


                } 

            zoneData[selectedZone]["PertesLtZoneIntValeur"]=document.getElementById('display-value-perte-contact-pas-int').value;
            zoneDatafloat[selectedZone]["PertesLtZoneIntValeur"]=parseFloat(document.getElementById('display-value-perte-contact-pas-int').value);

            document.getElementById('display-value-perte-contact-pas-int').value = zoneData[selectedZone]["PertesLtZoneIntValeur"];

            updateResults();



            });


        







        }



    });  




 

    document.getElementById('perte-dommages-physiques').addEventListener('change', function() {

  
        const selectedZone = dropdownMenuZone.value;
        zoneData[selectedZone]["PertesLfZone"] = this.value;
        const displayValueInput = document.getElementById('display-value-dommages-physiques-int');


        

        if (this.value==='1') {

            zoneData[selectedZone]["PertesLfZoneValeur"]="0.1";
            zoneDatafloat[selectedZone]["PertesLfZoneValeur"]=0.1;

            displayValueInput.readOnly = false;

            document.getElementById('display-value-dommages-physiques-int').value = zoneData[selectedZone]["PertesLfZoneValeur"];

            updateResults()

            


        } else if (this.value==='2') {

            zoneData[selectedZone]["PertesLfZoneValeur"]="0.02";
            zoneDatafloat[selectedZone]["PertesLfZoneValeur"]=0.02;

            displayValueInput.readOnly = false;

            document.getElementById('display-value-dommages-physiques-int').value = zoneData[selectedZone]["PertesLfZoneValeur"];

            updateResults()

        } else if (this.value==='3') {

            zoneData[selectedZone]["PertesLfZoneValeur"]="0.05";
            zoneDatafloat[selectedZone]["PertesLfZoneValeur"]=0.05;

            displayValueInput.readOnly = false;

            document.getElementById('display-value-dommages-physiques-int').value = zoneData[selectedZone]["PertesLfZoneValeur"];

            updateResults()


        } else if (this.value==='4') {

            zoneData[selectedZone]["PertesLfZoneValeur"]="0.01";
            zoneDatafloat[selectedZone]["PertesLfZoneValeur"]=0.01;

            displayValueInput.readOnly = false;

            document.getElementById('display-value-dommages-physiques-int').value = zoneData[selectedZone]["PertesLfZoneValeur"];

            updateResults()

        } else {

            displayValueInput.value = '0.00';

            displayValueInput.readOnly = false;

            zoneData[selectedZone]["PertesLfZoneValeur"]="0.00";
            zoneDatafloat[selectedZone]["PertesLfZoneValeur"]=0.00;
                   
            displayValueInput.addEventListener('change', function() {

                lf_value=parseFloat(document.getElementById('display-value-dommages-physiques-int').value);

                if (isNaN(lf_value) || lf_value <= 0) {

                lf_value=0.0;
                document.getElementById('display-value-dommages-physiques-int').value='0.00';


                } 


            zoneData[selectedZone]["PertesLfZoneValeur"]=document.getElementById('display-value-dommages-physiques-int').value;
            zoneDatafloat[selectedZone]["PertesLfZoneValeur"]=parseFloat(document.getElementById('display-value-dommages-physiques-int').value);

            document.getElementById('display-value-dommages-physiques-int').value = zoneData[selectedZone]["PertesLfZoneValeur"];

            updateResults();



            });



        }



    }); 

    //var event = new Event('input');
    //document.getElementById('perte-dommages-physiques').dispatchEvent(event);


    document.getElementById('perte-defaillance-equipements').addEventListener('change', function() {
        const selectedZone = dropdownMenuZone.value;
        zoneData[selectedZone]["PertesLoZone"] = this.value;
        const displayValueInput = document.getElementById('display-value-defaillance-equipements');
        

        if (this.value==='1') {

            zoneData[selectedZone]["PertesLoZoneValeur"]="0.0";
            zoneDatafloat[selectedZone]["PertesLoZoneValeur"]=0.0;

            displayValueInput.readOnly = false;

            document.getElementById('display-value-defaillance-equipements').value = zoneData[selectedZone]["PertesLoZoneValeur"];
            


        } else if (this.value==='2') {

            zoneData[selectedZone]["PertesLoZoneValeur"]="0.1";
            zoneDatafloat[selectedZone]["PertesLoZoneValeur"]=0.1;

            displayValueInput.readOnly = false;

            document.getElementById('display-value-defaillance-equipements').value = zoneData[selectedZone]["PertesLoZoneValeur"];


        } else if (this.value==='3') {

            zoneData[selectedZone]["PertesLoZoneValeur"]="0.01";
            zoneDatafloat[selectedZone]["PertesLoZoneValeur"]=0.01;

            displayValueInput.readOnly = false;

            document.getElementById('display-value-defaillance-equipements').value = zoneData[selectedZone]["PertesLoZoneValeur"];

        
        } else if (this.value==='4'){ 

            zoneData[selectedZone]["PertesLoZoneValeur"]="0.001";
            zoneDatafloat[selectedZone]["PertesLoZoneValeur"]=0.001;

            displayValueInput.readOnly = false;

            document.getElementById('display-value-defaillance-equipements').value = zoneData[selectedZone]["PertesLoZoneValeur"];


        } else {


            displayValueInput.value = '0.00';

            displayValueInput.readOnly = false;

            zoneData[selectedZone]["PertesLoZoneValeur"]="0.00";
            zoneDatafloat[selectedZone]["PertesLoZoneValeur"]=0.00;
            
          
            
            displayValueInput.addEventListener('change', function() {

                lo_value=parseFloat(document.getElementById('display-value-defaillance-equipements').value);



                if (isNaN(lo_value) || lo_value <= 0) {

                    lo_value=0.0;
                    document.getElementById('display-value-defaillance-equipements').value='0.00';

                } 

            zoneData[selectedZone]["PertesLoZoneValeur"]=document.getElementById('display-value-defaillance-equipements').value;
            zoneDatafloat[selectedZone]["PertesLoZoneValeur"]=parseFloat(document.getElementById('display-value-defaillance-equipements').value);
        
            document.getElementById('display-value-defaillance-equipements').value = zoneData[selectedZone]["PertesLoZoneValeur"];

            updateResults()



            });


        }

        updateResults()




    });  

    document.getElementById('display-value-nz').addEventListener('change', function() {
        const selectedZone = dropdownMenuZone.value;
        zoneDatafloat[selectedZone]["nz"] = this.value;

        const nz_value=parseFloat(document.getElementById('display-value-nz').value);

        if (isNaN(nz_value) || nz_value <= 0) {

            document.getElementById('display-value-nz').value='10';

        } 

        zoneDatafloat[selectedZone]["nz"] = document.getElementById('display-value-nz').value;
        
        updateResults()

    });  

    document.getElementById('display-value-tz').addEventListener('change', function() {
        
        const selectedZone = dropdownMenuZone.value;
        zoneDatafloat[selectedZone]["tz"] = this.value;

        const tz_value=parseFloat(document.getElementById('display-value-tz').value);

        if (isNaN(tz_value) || tz_value <= 0  || tz_value > 8760) {

            document.getElementById('display-value-tz').value='8760';

        } 

        zoneDatafloat[selectedZone]["tz"] = document.getElementById('display-value-tz').value;
        
        updateResults()

    }); 



    document.getElementById('type_danger_particulier_hz').addEventListener('change', function() {
        const selectedZone = dropdownMenuZone.value;
        zoneData[selectedZone]["TypeDangerParticulier"] = this.value;
        

        if (this.value==='1') {

            zoneData[selectedZone]["TypeDangerParticulierValeur"]="1.00";

            


        } else if (this.value==='2') {

            zoneData[selectedZone]["TypeDangerParticulierValeur"]="2.00";

        } else if (this.value==='3') {

            zoneData[selectedZone]["TypeDangerParticulierValeur"]="5.00";

        } else if (this.value==='4') {

            zoneData[selectedZone]["TypeDangerParticulierValeur"]="5.00";

        } else if (this.value==='5') {

            zoneData[selectedZone]["TypeDangerParticulierValeur"]="10.00";

        } 


        document.getElementById('display-value-type-danger-particulier').value = zoneData[selectedZone]["TypeDangerParticulierValeur"];

        updateResults()

    });  



    document.getElementById('type_risque_incendie').addEventListener('change', function() {
        const selectedZone = dropdownMenuZone.value;
        zoneData[selectedZone]["FacteurRisqueIncendie"] = this.value;
        

        if (this.value==='1') {

            zoneData[selectedZone]["FacteurRisqueIncendieValeur"]="0.00";
           

        } else if (this.value==='2') {

            zoneData[selectedZone]["FacteurRisqueIncendieValeur"]="0.001";

        } else if (this.value==='3') {

            zoneData[selectedZone]["FacteurRisqueIncendieValeur"]="0.01";

        } else if (this.value==='4') {

            zoneData[selectedZone]["FacteurRisqueIncendieValeur"]="0.10";

        } else if (this.value==='5') {

            zoneData[selectedZone]["FacteurRisqueIncendieValeur"]="0.01";
        

        } else if (this.value==='6') {

            zoneData[selectedZone]["FacteurRisqueIncendieValeur"]="0.10";
        

        } else if (this.value==='7') {

            zoneData[selectedZone]["FacteurRisqueIncendieValeur"]="1.00";
        

        } else {

            const popup_risque_incendie = document.getElementById('popup-risque-incendie');
            const overlay_risque_incendie = document.getElementById('overlay-risque-incendie');

            popup_risque_incendie.style.display = "block";
            overlay_risque_incendie.style.display = "block";


        }

        document.getElementById('display-value-reduction-risque-incendie').value = zoneData[selectedZone]["FacteurRisqueIncendieValeur"];

        updateResults()

    });  

    document.getElementById('calcul-charge-calorifique').addEventListener('click', function() {

        const popup_risque_incendie = document.getElementById('popup-risque-incendie');
        const overlay_risque_incendie = document.getElementById('overlay-risque-incendie');

        popup_risque_incendie.style.display = "block";
        overlay_risque_incendie.style.display = "block";

    })



    document.getElementById('precaution_risque_incendie').addEventListener('change', function() {
        const selectedZone = dropdownMenuZone.value;
        zoneData[selectedZone]["PrecautionsRisqueIncendie"] = this.value;
        

        if (this.value==='1') {

            zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"]="1.00";
           

        } else if (this.value==='2') {

            zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"]="0.5";

        } else if (this.value==='3') {

            zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"]="0.2";

        } 

        document.getElementById('display-value-precaution-risque-incendie').value = zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"];

        document.getElementById('display-value-precaution-risque-incendie-mesures').value=zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"];
        document.getElementById('precaution_risque_incendie_mesures').value=document.getElementById('precaution_risque_incendie').value;
        zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"]=zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"];
        zoneDataA[selectedZone]["PrecautionsRisqueIncendie"]=zoneData[selectedZone]["PrecautionsRisqueIncendie"];

        updateResults()

    });  

    document.getElementById('computationFormLFE').addEventListener('change', function(event) {
        const selectedZone = dropdownMenuZone.value;
        const CheckedLFE = document.getElementById('includeOptionPertes').checked;
        var CheckedINERIS = document.getElementById('includeOptionNoteINERIS').checked;



        const pertes_lfe=parseFloat(document.getElementById('display-value-lfe').value);
        const pertes_te=parseFloat(document.getElementById('display-te-lfe').value);
        const ptws_lfe=parseFloat(document.getElementById('display-ptws-lfe').value);


        if (CheckedLFE) {


            zoneData[selectedZone]["ClassNameLFELabel"]='label_input_field';
            zoneData[selectedZone]["ClassNameLFEInput"]='select_field';
            zoneData[selectedZone]["ClassNameTeLabel"]='label_input_field';
            zoneData[selectedZone]["ClassNameTeInput"]='select_field';
            zoneData[selectedZone]["DisabledCheckboxINERIS"]=false;
            zoneData[selectedZone]["LabelCheckboxINERIS"]='label_input_field';

            document.getElementById('pertes_lfe').className=zoneData[selectedZone]["ClassNameLFELabel"];
            document.getElementById('display-value-lfe').className=zoneData[selectedZone]["ClassNameLFEInput"];
            document.getElementById('te_lfe').className=zoneData[selectedZone]["ClassNameTeLabel"];
            document.getElementById('display-te-lfe').className=zoneData[selectedZone]["ClassNameTeInput"];
            document.getElementById('includeOptionNoteINERIS').disabled=zoneData[selectedZone]["DisabledCheckboxINERIS"];           
            document.getElementById('labelincludeOptionNoteINERIS').className=zoneData[selectedZone]["LabelCheckboxINERIS"];

            


                      

        } else {

            zoneData[selectedZone]["ClassNameLFELabel"]='grayed-out-label';
            zoneData[selectedZone]["ClassNameLFEInput"]='grayed-out';
            zoneData[selectedZone]["ClassNameTeLabel"]='grayed-out-label';
            zoneData[selectedZone]["ClassNameTeInput"]='grayed-out';
            zoneData[selectedZone]["DisabledCheckboxINERIS"]=true;
            zoneData[selectedZone]["LabelCheckboxINERIS"]='disabled-label';

            document.getElementById('pertes_lfe').className=zoneData[selectedZone]["ClassNameLFELabel"];
            document.getElementById('display-value-lfe').className=zoneData[selectedZone]["ClassNameLFEInput"];
            document.getElementById('te_lfe').className=zoneData[selectedZone]["ClassNameTeLabel"];
            document.getElementById('display-te-lfe').className=zoneData[selectedZone]["ClassNameTeInput"];
            document.getElementById('includeOptionNoteINERIS').disabled=zoneData[selectedZone]["DisabledCheckboxINERIS"];
            document.getElementById('labelincludeOptionNoteINERIS').className=zoneData[selectedZone]["LabelCheckboxINERIS"];
            document.getElementById('includeOptionNoteINERIS').checked=false;
            CheckedINERIS=document.getElementById('includeOptionNoteINERIS').checked
            

        }

        if (CheckedINERIS) {

            zoneData[selectedZone]["ClassNamePTWSLabel"]='label_input_field';
            zoneData[selectedZone]["ClassNamePTWSInput"]='select_field';
            document.getElementById('ptws_lfe').className=zoneData[selectedZone]["ClassNamePTWSLabel"];
            document.getElementById('display-ptws-lfe').className=zoneData[selectedZone]["ClassNamePTWSInput"];

               document.getElementById('display-ptws-lfe').addEventListener('change', function(event) {

                                                
                    if (isNaN(ptws_lfe) || ptws_lfe<0.0 ||  ptws_lfe>100.0) {

                        document.getElementById('display-ptws-lfe').value='0.0';
                        document.getElementById('display-ptws-lfe-mesures').value='0.0';

                    }
                       

                    zoneData[selectedZone]["PTWSLFE"]=document.getElementById('display-ptws-lfe').value;
                    zoneDataA[selectedZone]["PTWSLFE"]=document.getElementById('display-ptws-lfe').value;
                    document.getElementById('display-ptws-lfe-mesures').value=zoneDataA[selectedZone]["PTWSLFE"];

                    updateResults();

                });


          

            

        } else {

            zoneData[selectedZone]["ClassNamePTWSLabel"]='grayed-out-label';
            zoneData[selectedZone]["ClassNamePTWSInput"]='grayed-out';
            document.getElementById('ptws_lfe').className=zoneData[selectedZone]["ClassNamePTWSLabel"];
            document.getElementById('display-ptws-lfe').className=zoneData[selectedZone]["ClassNamePTWSInput"];

        }


        if (isNaN(pertes_lfe) || pertes_lfe<0.0) {

            document.getElementById('display-value-lfe').value='0.0';


        }

        if (isNaN(pertes_te) || pertes_te<0.0 ||  pertes_te>8760.0) {

            document.getElementById('display-te-lfe').value='0.0';


        }


        zoneData[selectedZone]["PertesLFE"]=document.getElementById('display-value-lfe').value;
        zoneData[selectedZone]["PertesTeLFE"]=document.getElementById('display-te-lfe').value;
        zoneData[selectedZone]["CheckedLFE"]=CheckedLFE;
        zoneData[selectedZone]["CheckedINERIS"]=CheckedINERIS;


 

       

        updateResults();

    });

 

    document.getElementById('facteur-reduction-sol').addEventListener('change', function() {
        const selectedZone = dropdownMenuZone.value;
        zoneData[selectedZone]["FacteurReductionToucherPas"] = this.value;
        //var taille_mailles_ecran = document.getElementById('taille-mailles-label-KS2');
        

        if (this.value==='1') {

            zoneData[selectedZone]["FacteurReductionToucherPasValeur"]="0.01";
           

        } else if (this.value==='2') {

            zoneData[selectedZone]["FacteurReductionToucherPasValeur"]="0.001";

        } else if (this.value==='3') {

            zoneData[selectedZone]["FacteurReductionToucherPasValeur"]="0.0001";

        } else if (this.value==='4') {

            zoneData[selectedZone]["FacteurReductionToucherPasValeur"]="0.00001";

        } 


        document.getElementById('display-value-facteur-reduction-sol').value = zoneData[selectedZone]["FacteurReductionToucherPasValeur"];

        document.getElementById('display-value-facteur-reduction-sol-mesures').value=zoneData[selectedZone]["FacteurReductionToucherPasValeur"];
        document.getElementById('facteur-reduction-sol-mesures').value=zoneData[selectedZone]["FacteurReductionToucherPas"];
        zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"]=zoneData[selectedZone]["FacteurReductionToucherPasValeur"];
        zoneDataA[selectedZone]["FacteurReductionToucherPas"]=zoneData[selectedZone]["FacteurReductionToucherPas"];


        updateResults()

    });  


    document.getElementById('systeme-ecran-interne').addEventListener('change', function() {

        const selectedZone = dropdownMenuZone.value;
        zoneData[selectedZone]["EcranSpatialKS2"] = this.value;



        var selectElement = document.getElementById("systeme-ecran-options").value;
        var displayElement_ecran = document.getElementById('display-value-ecra-interne-options');
        var taille_mailles_ecran = document.getElementById('taille-mailles-KS2-input');

        if (this.value==='1') {

            zoneData[selectedZone]["EcranSpatialKS2Valeur"]="1.00";
            KS2=1.0;
            zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]=KS2;


        } else if (this.value==='2') {

            zoneData[selectedZone]["EcranSpatialKS2Valeur"]="0.0001";
            KS2=0.0001;
            zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]=KS2;



        } else if (this.value==='3') {

            zoneData[selectedZone]["EcranSpatialKS2Valeur"]="1.00";
            
            KS2=1.00;
            zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]=KS2;

        } else if (this.value==='4') {


            KS2=0.12*parseFloat((taille_mailles_ecran).value);

            if (KS2>1.0) {
                KS2=1.00;
            }

            

            document.getElementById('taille-mailles-KS2-input').className='input_select_lines';
            document.getElementById('taille-mailles-label-KS2').className='label_input_field';

            displayElement_ecran.value=KS2.toFixed(2);
            zoneData[selectedZone]["EcranSpatialKS2Valeur"]=displayElement_ecran.value;
            zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]=KS2;

            




        }

        if (this.value!=='4') {


            document.getElementById('taille-mailles-KS2-input').className='grayed-out-mailles-KS2';
            document.getElementById('taille-mailles-label-KS2').className='titre_label_mailles_KS2';

        }



        document.getElementById('display-value-ecra-interne-options').value = zoneData[selectedZone]["EcranSpatialKS2Valeur"];
        zoneData[selectedZone]["TailleMaillesK2"]=document.getElementById("taille-mailles-KS2-input").value;

        //if (zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]>zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]) {

            zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"];
            zoneDataA[selectedZone]["EcranSpatialKS2Valeur"]=zoneData[selectedZone]["EcranSpatialKS2Valeur"];
            zoneDataA[selectedZone]["TailleMaillesK2"]=zoneData[selectedZone]["TailleMaillesK2"];
            zoneDataA[selectedZone]["EcranSpatialKS2"]=zoneData[selectedZone]["EcranSpatialKS2"];

            document.getElementById('systeme-ecran-interne-mesures').value=zoneDataA[selectedZone]["EcranSpatialKS2"];
            document.getElementById("taille-mailles-KS2-input-mesures").value=zoneDataA[selectedZone]["TailleMaillesK2"];
            document.getElementById('display-value-ecra-interne-options-mesures').value=zoneDataA[selectedZone]["EcranSpatialKS2Valeur"];


        //}

        zoneData[selectedZone]["taillemaillesinputks2"]=document.getElementById('taille-mailles-KS2-input').className;
        zoneData[selectedZone]["taillemailleslabeks2"]=document.getElementById('taille-mailles-label-KS2').className;


        updateResults()

    });  

    document.getElementById('taille-mailles-KS2-input').addEventListener('input', function() {
        const selectedZone = dropdownMenuZone.value;
        var taille_mailles_ecran = document.getElementById("taille-mailles-KS2-input").value;
        var displayElement_ecran = document.getElementById('display-value-ecra-interne-options');
        var taille_mailles_ecrann=parseFloat(taille_mailles_ecran);

        if (isNaN(taille_mailles_ecrann) || taille_mailles_ecrann <= 0) {
            
            document.getElementById('taille-mailles-KS2-input').value = '0.01';
            KS2=0.0012;
            zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]=KS2;

        } else {

            KS2=0.12*parseFloat(taille_mailles_ecrann);

            if (KS2>1.0) {

                KS2=1.0;
            }

            zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]=KS2;

        }

        displayElement_ecran.value=KS2.toFixed(2);

        zoneData[selectedZone]["EcranSpatialKS2Valeur"]=displayElement_ecran.value;
        zoneData[selectedZone]["TailleMaillesK2"]=document.getElementById("taille-mailles-KS2-input").value;
        zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]=KS2;

        //if (zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]>zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]) {

            zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"];
            zoneDataA[selectedZone]["EcranSpatialKS2Valeur"]=zoneData[selectedZone]["EcranSpatialKS2Valeur"];
            zoneDataA[selectedZone]["TailleMaillesK2"]=zoneData[selectedZone]["TailleMaillesK2"];
            zoneDataA[selectedZone]["EcranSpatialKS2"]=zoneData[selectedZone]["EcranSpatialKS2"];

            document.getElementById('systeme-ecran-interne-mesures').value=zoneDataA[selectedZone]["EcranSpatialKS2"];
            document.getElementById("taille-mailles-KS2-input-mesures").value=zoneDataA[selectedZone]["TailleMaillesK2"];
            document.getElementById('display-value-ecra-interne-options-mesures').value=zoneDataA[selectedZone]["EcranSpatialKS2Valeur"];


        //}


        updateResults()


    }); 

    
 

    const dropdownMenuRisque = document.getElementById('dropdown-menu-risque');
    const selectedProduct = document.getElementById('dropdown-menu-risque').value;
    const addProduitButton = document.getElementById('add-risque-btn');

    // Vérification et initialisation de la structure de données produits_data si nécessaire
    if (!produits_data[selectedZone]) {
        produits_data[selectedZone] = {};
    }

    // Vérification et initialisation de l'objet pour le produit sélectionné si nécessaire
    if (!produits_data[selectedZone][selectedProduct]) {
        produits_data[selectedZone][selectedProduct] = {};
    }


    produits_data[selectedZone][selectedProduct]={

        "PotentielCalorifique":"10.0",
        "QuantiteProduit":"10.0",

        

    }

    document.getElementById('surface_zone').value =zoneData[selectedZone]["ZoneSurface"];
    document.getElementById('potentiel_zone').value =produits_data[selectedZone][selectedProduct]["PotentielCalorifique"];
    document.getElementById('quantite_zone').value =produits_data[selectedZone][selectedProduct]["QuantiteProduit"];
    document.getElementById('charge_zone').value =zoneData[selectedZone]["ChargeCalorifique"];

    addProduitButton.addEventListener('click', function() {

        const selectedZone = dropdownMenuZone.value;

        risqueCounter=zoneData[selectedZone]["risqueCounter"];


        const newProduct = `Produit N° ${risqueCounter}`;
 

        // Vérification et initialisation de la structure de données produits_data si nécessaire
        if (!produits_data[selectedZone]) {
            produits_data[selectedZone] = {};
        }

        // Vérification et initialisation de l'objet pour le produit sélectionné si nécessaire
        if (!produits_data[selectedZone][newProduct]) {
            produits_data[selectedZone][newProduct] = {};
        }


        produits_data[selectedZone][newProduct]={

        "PotentielCalorifique":"10.0",
        "QuantiteProduit":"10.0",

        };

        document.getElementById('surface_zone').value =zoneData[selectedZone]["ZoneSurface"];
        document.getElementById('potentiel_zone').value =produits_data[selectedZone][newProduct]["PotentielCalorifique"];
        document.getElementById('quantite_zone').value =produits_data[selectedZone][newProduct]["QuantiteProduit"];
        document.getElementById('charge_zone').value =zoneData[selectedZone]["ChargeCalorifique"];

        

        risqueCounter++;

        zoneData[selectedZone]["risqueCounter"]=risqueCounter;

        

        create_risque_container ()


        calcul_charge_calorifique();


        






    });




    

    dropdownMenuRisque.addEventListener('change', function() {


        const selectedProduct = dropdownMenuRisque.value;
        const selectedZone = dropdownMenuZone.value;

        document.getElementById('surface_zone').value =zoneData[selectedZone]["ZoneSurface"];
        document.getElementById('potentiel_zone').value =produits_data[selectedZone][selectedProduct]["PotentielCalorifique"];
        document.getElementById('quantite_zone').value =produits_data[selectedZone][selectedProduct]["QuantiteProduit"];
        document.getElementById('charge_zone').value =zoneData[selectedZone]["ChargeCalorifique"];

    });

    document.getElementById('surface_zone').addEventListener('change', function() {

        const selectedProduct = dropdownMenuRisque.value;
        const selectedZone = dropdownMenuZone.value;
        zoneData[selectedZone]["ZoneSurface"]=this.value;
        surface_zone=parseFloat(this.value);

        if (surface_zone<=0 || isNaN(surface_zone)) {

            document.getElementById('surface_zone').value='10.0';
            zoneData[selectedZone]["ZoneSurface"]=document.getElementById('surface_zone').value;

        } 

        calcul_charge_calorifique ();

        

    });

    document.getElementById('potentiel_zone').addEventListener('change', function() {

        const selectedZone = document.getElementById('dropdown-menu-zone').value;
        //create_risque_container ();
        const selectedProduct = dropdownMenuRisque.value;
        produits_data[selectedZone][selectedProduct]["PotentielCalorifique"]=this.value;
        potentiel_zone=parseFloat(this.value);

        if (potentiel_zone<0 || isNaN(potentiel_zone)) {

            document.getElementById('potentiel_zone').value='10.0';
            produits_data[selectedZone][selectedProduct]["PotentielCalorifique"]=document.getElementById('potentiel_zone').value;


        } 

        calcul_charge_calorifique ();

        


    });

    document.getElementById('quantite_zone').addEventListener('change', function() {

        const selectedZone = document.getElementById('dropdown-menu-zone').value;
        //create_risque_container ();
        const selectedProduct = dropdownMenuRisque.value;
        produits_data[selectedZone][selectedProduct]["QuantiteProduit"]=this.value;

        quantite_zone=parseFloat(this.value);

        if (quantite_zone<0 || isNaN(quantite_zone)) {

            document.getElementById('quantite_zone').value='10.0';
            produits_data[selectedZone][selectedProduct]["QuantiteProduit"]=document.getElementById('quantite_zone').value;


        } 

        calcul_charge_calorifique ();

        

        

    });












});

function create_risque_container () {

const dropdownMenuRisque = document.getElementById('dropdown-menu-risque');
const selectedZone = document.getElementById('dropdown-menu-zone').value;

dropdownMenuRisque.innerHTML='';

for (let i = 0; i < Object.keys(produits_data[selectedZone]).length; i++) {

    const produit_name=Object.keys(produits_data[selectedZone])[i];

    const option_product = document.createElement('option');
    option_product.value=produit_name;
    option_product.textContent=produit_name;

    dropdownMenuRisque.appendChild(option_product);
    dropdownMenuRisque.value=produit_name;

}






}



function calcul_charge_calorifique () {

    const dropdownMenuRisque = document.getElementById('dropdown-menu-risque');
    const selectedZone = document.getElementById('dropdown-menu-zone').value;

    // Get all <option> elements within the <select>
    const options = dropdownMenuRisque.options;  
    
    var surface_zone=parseFloat(document.getElementById('surface_zone').value);
    zoneData[selectedZone]["ZoneSurface"]=document.getElementById('surface_zone').value;

    
    var potentiel_calorifique_total=0.;

    for (let i = 0; i < options.length; i++) {


        const selectedProduct=options[i].text;

                
        var potentiel_zone=parseFloat(produits_data[selectedZone][selectedProduct]["PotentielCalorifique"]);
        var quantite_zone=parseFloat(produits_data[selectedZone][selectedProduct]["QuantiteProduit"]);

        potentiel_calorifique_total=potentiel_calorifique_total+potentiel_zone*quantite_zone;


}
    var charge_calorifique=potentiel_calorifique_total/surface_zone;

    document.getElementById('charge_zone').value=charge_calorifique.toFixed(2);
    zoneData[selectedZone]["ChargeCalorifique"]=document.getElementById('charge_zone').value;
    zoneData[selectedZone]["ChargeClorifiqueAffichee"]=document.getElementById('charge_zone').value;
    
}


const dropdownMenuZoneMesures = document.getElementById('dropdown-menu-zone-mesures');

dropdownMenuZoneMesures.addEventListener('change', function() {

    const selectedZone = dropdownMenuZoneMesures.value;

    document.getElementById('precaution_risque_incendie_mesures').value =zoneDataA[selectedZone]["PrecautionsRisqueIncendie"];
    document.getElementById('display-value-precaution-risque-incendie-mesures').value = zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"];

    document.getElementById('facteur-reduction-sol-mesures').value =zoneDataA[selectedZone]["FacteurReductionToucherPas"];
    document.getElementById('display-value-facteur-reduction-sol-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"];

    document.getElementById('systeme-ecran-interne-mesures').value =zoneDataA[selectedZone]["EcranSpatialKS2"];
    document.getElementById('display-value-ecra-interne-options-mesures').value = zoneDataA[selectedZone]["EcranSpatialKS2Valeur"];
    document.getElementById('taille-mailles-KS2-input-mesures').value = zoneDataA[selectedZone]["TailleMaillesK2"];

    document.getElementById('display-value-pa-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"];
    document.getElementById('option1-mesures').checked=zoneDataA[selectedZone]["option1_checked"];
    document.getElementById('option2-mesures').checked=zoneDataA[selectedZone]["option2_checked"];
    document.getElementById('option3-mesures').checked=zoneDataA[selectedZone]["option3_checked"];
    document.getElementById('option4-mesures').checked=zoneDataA[selectedZone]["option4_checked"];
    document.getElementById('option5-mesures').checked=zoneDataA[selectedZone]["option5_checked"];
    document.getElementById('option6-mesures').checked=zoneDataA[selectedZone]["option6_checked"];

    document.getElementById('display-value-ptu-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPTUValeur"];
    document.getElementById('optionptu1-mesures').checked=zoneDataA[selectedZone]["optionptu1_checked"];
    document.getElementById('optionptu2-mesures').checked=zoneDataA[selectedZone]["optionptu2_checked"];
    document.getElementById('optionptu3-mesures').checked=zoneDataA[selectedZone]["optionptu3_checked"];
    document.getElementById('optionptu4-mesures').checked=zoneDataA[selectedZone]["optionptu4_checked"];

    document.getElementById('display-ptws-lfe-mesures').value=zoneData[selectedZone]["PTWSLFE"];

    if (zoneDataA[selectedZone]["EcranSpatialKS2"]==='4') {

    document.getElementById('taille-mailles-KS2-input-mesures').className='input_select_lines';
    document.getElementById('taille-mailles-label-KS2-mesures').className='label_input_field';


    } else {

    document.getElementById('taille-mailles-KS2-input-mesures').className='grayed-out-mailles-KS2';
    document.getElementById('taille-mailles-label-KS2-mesures').className='titre_label_mailles_KS2';



    }

});

document.getElementById('precaution_risque_incendie_mesures').addEventListener('change', function() {
        const selectedZone = dropdownMenuZoneMesures.value;
        zoneDataA[selectedZone]["PrecautionsRisqueIncendie"] = this.value;
        

        if (this.value==='1') {

            zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"]="1.00";
           

        } else if (this.value==='2') {

            zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"]="0.5";

        } else if (this.value==='3') {

            zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"]="0.2";

        } 

        document.getElementById('display-value-precaution-risque-incendie-mesures').value = zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"];

        rp_valeur_sm=parseFloat(zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"]);
        rp_valeur_am=parseFloat(zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"]);

        if (rp_valeur_am>rp_valeur_sm) {

            document.getElementById('display-value-precaution-risque-incendie-mesures').value=zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"];
            document.getElementById('precaution_risque_incendie_mesures').value=document.getElementById('precaution_risque_incendie').value;
            zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"]=zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"];
            zoneDataA[selectedZone]["PrecautionsRisqueIncendie"]=zoneData[selectedZone]["PrecautionsRisqueIncendie"];

        }

        updateResults()

    });  

    document.getElementById('display-ptws-lfe-mesures').addEventListener('change', function(event) {

        const selectedZone = dropdownMenuZoneMesures.value;
        const ptws=zoneData[selectedZone]["PTWSLFE"]
        const ptws_mesures=parseFloat(this.value);

        if (isNaN(ptws_mesures) || ptws_mesures<0.0 || ptws_mesures>100.0) {

            document.getElementById('display-ptws-lfe-mesures').value='0.0';


        }
        

        if (ptws_mesures<ptws) {

            document.getElementById('display-ptws-lfe-mesures').value=zoneData[selectedZone]["PTWSLFE"];

        }

        zoneDataA[selectedZone]["PTWSLFE"]=document.getElementById('display-ptws-lfe-mesures').value;
      


        updateResults();

    });


    document.getElementById('facteur-reduction-sol-mesures').addEventListener('change', function() {
        const selectedZone = dropdownMenuZoneMesures.value;
        zoneDataA[selectedZone]["FacteurReductionToucherPas"] = this.value;
        //var taille_mailles_ecran = document.getElementById('taille-mailles-label-KS2');
        

        if (this.value==='1') {

            zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"]="0.01";
           

        } else if (this.value==='2') {

            zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"]="0.001";

        } else if (this.value==='3') {

            zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"]="0.0001";

        } else if (this.value==='4') {

            zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"]="0.00001";

        } 


        document.getElementById('display-value-facteur-reduction-sol-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"];

        ra_ru_valeur_sm=parseFloat(zoneData[selectedZone]["FacteurReductionToucherPasValeur"]);
        ra_ru_valeur_am=parseFloat(zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"]);

        if (ra_ru_valeur_am>ra_ru_valeur_sm) {

            document.getElementById('display-value-facteur-reduction-sol-mesures').value=zoneData[selectedZone]["FacteurReductionToucherPasValeur"];
            document.getElementById('facteur-reduction-sol-mesures').value=zoneData[selectedZone]["FacteurReductionToucherPas"];
            zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"]=zoneData[selectedZone]["FacteurReductionToucherPasValeur"];
            zoneDataA[selectedZone]["FacteurReductionToucherPas"]=zoneData[selectedZone]["FacteurReductionToucherPas"];

        }

        updateResults()

    });  

    document.getElementById('systeme-ecran-interne-mesures').addEventListener('change', function() {

        const selectedZone = dropdownMenuZoneMesures.value;
        zoneDataA[selectedZone]["EcranSpatialKS2"] = this.value;



        var selectElement = document.getElementById("systeme-ecran-options-mesures").value;
        var displayElement_ecran = document.getElementById('display-value-ecra-interne-options-mesures');
        var taille_mailles_ecran = document.getElementById('taille-mailles-KS2-input-mesures');

        if (this.value==='1') {

            zoneDataA[selectedZone]["EcranSpatialKS2Valeur"]="1.00";
            KS2=1.00;
            zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=KS2;


        } else if (this.value==='2') {

            zoneDataA[selectedZone]["EcranSpatialKS2Valeur"]="0.0001";
            KS2=0.0001;
            zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=KS2;



        } else if (this.value==='3') {

            zoneDataA[selectedZone]["EcranSpatialKS2Valeur"]="1.00";
            
            KS2=1.00;
            zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=KS2;

        } else if (this.value==='4') {


            KS2=0.12*parseFloat((taille_mailles_ecran).value);

            if (KS2>1.0) {
                KS2=1.00;
            }

            

            document.getElementById('taille-mailles-KS2-input-mesures').className='input_select_lines';
            document.getElementById('taille-mailles-label-KS2-mesures').className='label_input_field';

            displayElement_ecran.value=KS2.toFixed(2);
            zoneDataA[selectedZone]["EcranSpatialKS2Valeur"]=displayElement_ecran.value;
            zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=KS2;


        }

        if (this.value!=='4') {


            document.getElementById('taille-mailles-KS2-input-mesures').className='grayed-out-mailles-KS2';
            document.getElementById('taille-mailles-label-KS2-mesures').className='titre_label_mailles_KS2';

        }



        document.getElementById('display-value-ecra-interne-options-mesures').value = zoneDataA[selectedZone]["EcranSpatialKS2Valeur"];
        zoneDataA[selectedZone]["TailleMaillesK2"]=document.getElementById("taille-mailles-KS2-input-mesures").value;

        if (zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]>zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]) {

            zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"];
            zoneDataA[selectedZone]["EcranSpatialKS2Valeur"]=zoneData[selectedZone]["EcranSpatialKS2Valeur"];
            zoneDataA[selectedZone]["TailleMaillesK2"]=zoneData[selectedZone]["TailleMaillesK2"];
            zoneDataA[selectedZone]["EcranSpatialKS2"]=zoneData[selectedZone]["EcranSpatialKS2"];

            document.getElementById('systeme-ecran-interne-mesures').value=zoneDataA[selectedZone]["EcranSpatialKS2"];
            document.getElementById("taille-mailles-KS2-input-mesures").value=zoneDataA[selectedZone]["TailleMaillesK2"];
            document.getElementById('display-value-ecra-interne-options-mesures').value=zoneDataA[selectedZone]["EcranSpatialKS2Valeur"];


        }


        updateResults()

    });  

    document.getElementById('taille-mailles-KS2-input-mesures').addEventListener('input', function() {
        const selectedZone = dropdownMenuZoneMesures.value;

        var taille_mailles_ecran = document.getElementById("taille-mailles-KS2-input-mesures").value;
        var displayElement_ecran = document.getElementById('display-value-ecra-interne-options-mesures');
        var taille_mailles_ecrann=parseFloat(taille_mailles_ecran);

        if (isNaN(taille_mailles_ecrann) || taille_mailles_ecrann <= 0) {
            
            document.getElementById('taille-mailles-KS2-input-mesures').value = '0.01';
            KS2=0.0012;
            zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=KS2;

        } else {

            KS2=0.12*parseFloat(taille_mailles_ecrann);

            if (KS2>1.0) {

                KS2=1.0;
            }

            zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=KS2;

        }

        displayElement_ecran.value=KS2.toFixed(2);

        zoneDataA[selectedZone]["EcranSpatialKS2Valeur"]=displayElement_ecran.value;
        zoneDataA[selectedZone]["TailleMaillesK2"]=document.getElementById("taille-mailles-KS2-input-mesures").value;
        zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=KS2;

        if (zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]>zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"]) {

            zoneDatafloatA[selectedZone]["EcranSpatialKS2Valeur"]=zoneDatafloat[selectedZone]["EcranSpatialKS2Valeur"];
            zoneDataA[selectedZone]["EcranSpatialKS2Valeur"]=zoneData[selectedZone]["EcranSpatialKS2Valeur"];
            zoneDataA[selectedZone]["TailleMaillesK2"]=zoneData[selectedZone]["TailleMaillesK2"];
            zoneDataA[selectedZone]["EcranSpatialKS2"]=zoneData[selectedZone]["EcranSpatialKS2"];

            document.getElementById('systeme-ecran-interne-mesures').value=zoneDataA[selectedZone]["EcranSpatialKS2"];
            document.getElementById("taille-mailles-KS2-input-mesures").value=zoneDataA[selectedZone]["TailleMaillesK2"];
            document.getElementById('display-value-ecra-interne-options-mesures').value=zoneDataA[selectedZone]["EcranSpatialKS2Valeur"];


        }

        updateResults();


    }); 












function removeline() {
    var dropdown_line = document.getElementById("dropdown-menu-line");
    var dropdown_line_value = document.getElementById("dropdown-menu-line").value;
    var dropdownMenuZone = document.getElementById('dropdown-menu-zone');

    const options = dropdownMenuZone.options;   

    for (let i = 0; i < options.length; i++) {

    const selectedZone=options[i].text;

    if (!selected_lines[selectedZone]) {
            selected_lines[selectedZone] = {};
    }

    delete selected_lines[selectedZone][dropdown_line_value];



    }




    var selectedOption = dropdown_line.options[dropdown_line.selectedIndex];
    var selectedOptionValue = selectedOption.value;

    if (dropdown_line.options.length > 1) {
        dropdown_line.remove(dropdown_line.selectedIndex);
        lineCounter=lineCounter-1;
        // Remove checkbox for the line
        const checkbox = document.getElementById(selectedOptionValue);
        checkbox.parentElement.removeChild(checkbox.nextElementSibling); // Remove label
        checkbox.parentElement.removeChild(checkbox); // Remove checkbox

        delete lineData[dropdown_line_value];
        delete lineData_float[dropdown_line_value];
        delete lineDataA[dropdown_line_value];
    //delete lineData_floatA[dropdown_line_value];

    } else {
        alert("Opération invalide");
    }

    dropdown_line.selectedIndex = dropdown_line.options.length - 1;

    const selectedLine = dropdown_line.value;


    document.getElementById('longueur-ligne').value = lineData[selectedLine]["longueurLigne"];
    document.getElementById('facteur-installation-ligne').value = lineData[selectedLine]["facteurInstallationLigne"];
    document.getElementById('display-value-installation-ligne').value = lineData[selectedLine]["facteurInstallationLigneValeur"];

    document.getElementById('environnement-ligne').value = lineData[selectedLine]["typeEnvironnementLigne"];
    document.getElementById('display-value-environnement-ligne').value = lineData[selectedLine]["typeEnvironnementLigneValeur"];

    document.getElementById('facteur-transformateur').value = lineData[selectedLine]["facteurTransformateur"];
    document.getElementById('display-value-facteur-transformateur').value = lineData[selectedLine]["facteurTransformateurValeur"]; 

    document.getElementById('display-value-longueur-batiment').value = lineData[selectedLine]["longueurStructureExt"]; 
    document.getElementById('display-value-largeur-batiment').value = lineData[selectedLine]["largeurStructureExt"]; 
    document.getElementById('display-value-hauteur-batiment').value = lineData[selectedLine]["hauteurStructureExt"]; 

    document.getElementById('emplacement-relatif-extremite').value = lineData[selectedLine]["emplacementRelatifStructureExt"];
    document.getElementById('display-value-facteur-emplacement-extremite').value = lineData[selectedLine]["emplacementRelatifStructureExtValeur"];

    document.getElementById('parafoudres-coordonnes_select').value = lineData[selectedLine]["parafoudresCoordonnesPspd"];
    document.getElementById('display-value-pspd').value = lineData[selectedLine]["parafoudresCoordonnesPspdValeur"];

    document.getElementById('parafoudres-equipotentialite_select').value = lineData[selectedLine]["parafoudresPEB"];
    document.getElementById('display-value-equipotentialite').value = lineData[selectedLine]["parafoudresPEBValeur"];

    document.getElementById('type-cablage-interne-select').value = lineData[selectedLine]["typeCablageInterne"];
    document.getElementById('display-value-ks3').value = lineData[selectedLine]["typeCablageInterneValeur"];

    document.getElementById('tension-assignee-chocs').value = lineData[selectedLine]["tensionAssignee"];

    document.getElementById('display-value-uw').value = lineData[selectedLine]["tensionAssigneeValeur"];

    document.getElementById('interfaces_isolement_select').value = lineData[selectedLine]["interfacesIsolement"];
    document.getElementById('display-value-interfaces-isolement').value = lineData[selectedLine]["interfacesIsolementValeur"];

    document.getElementById('interfaces_isolement_select_mesures').value = lineDataA[selectedLine]["interfacesIsolement"];
    document.getElementById('display-value-interfaces-isolement-mesures').value = lineDataA[selectedLine]["interfacesIsolementValeur"];

    document.getElementById('resistance-ecran-pld').value = lineData[selectedLine]["typeCablageExternePLD"];
    document.getElementById('resistance-ecran-pli').value = lineData[selectedLine]["typeCablageExternePLI"];
    document.getElementById('display-value-pld').value = lineData[selectedLine]["typeCablageExternePLDValeur"];
    document.getElementById('display-value-pli').value = lineData[selectedLine]["typeCablageExternePLIValeur"];

    document.getElementById('conditions-blindage-cld-cli-mesures').value = lineDataA[selectedLine]["conditionsBlindageCLDCLI"];
    document.getElementById('display-value-cld-mesures').value=lineDataA[selectedLine]["conditionsBlindageCLDValeur"];
    document.getElementById('display-value-cli-mesures').value=lineDataA[selectedLine]["conditionsBlindageCLIValeur"];

    document.getElementById('conditions-blindage-cld-cli').value = lineData[selectedLine]["conditionsBlindageCLDCLI"];
    document.getElementById('display-value-cld').value=lineData[selectedLine]["conditionsBlindageCLDValeur"];
    document.getElementById('display-value-cli').value=lineData[selectedLine]["conditionsBlindageCLIValeur"];


    document.getElementById('parafoudres-coordonnes_select_mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspd"];
    document.getElementById('display-value-pspd-mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"];

    document.getElementById('parafoudres-equipotentialite_select_mesures').value = lineDataA[selectedLine]["parafoudresPEB"];
    document.getElementById('display-value-equipotentialite-mesures').value = lineDataA[selectedLine]["parafoudresPEBValeur"];

    document.getElementById('type-cablage-interne-select-mesures').value = lineDataA[selectedLine]["typeCablageInterne"];
    document.getElementById('display-value-ks3-mesures').value = lineDataA[selectedLine]["typeCablageInterneValeur"];

    document.getElementById('resistance-ecran-pld-mesures').value = lineDataA[selectedLine]["typeCablageExternePLD"];
    document.getElementById('display-value-pld-mesures').value = lineDataA[selectedLine]["typeCablageExternePLDValeur"];
           

}

function removezone() {
    var dropdown_zone = document.getElementById("dropdown-menu-zone");
    var dropdown_zone_value = document.getElementById("dropdown-menu-zone").value;



    if (dropdown_zone.options.length > 1) {
        dropdown_zone.remove(dropdown_zone.selectedIndex);
        zoneCounter=zoneCounter-1;
        delete selected_lines[dropdown_zone_value];
        delete zoneData[dropdown_zone_value];
        delete zoneDatafloat[dropdown_zone_value];
        delete zoneDataA[dropdown_zone_value];
        delete zoneDatafloatA[dropdown_zone_value];
        delete produits_data[dropdown_zone_value];

    } else {
        alert("Opération invalide");
    }

    dropdown_zone.selectedIndex = dropdown_zone.options.length - 1;

    const selectedZone = dropdown_zone.value;


    document.getElementById('perte-contact-pas-int').value =zoneData[selectedZone]["PertesLtZoneInt"];
    document.getElementById('display-value-perte-contact-pas-int').value = zoneData[selectedZone]["PertesLtZoneIntValeur"];

    document.getElementById('perte-dommages-physiques').value =zoneData[selectedZone]["PertesLfZone"];
    document.getElementById('display-value-dommages-physiques-int').value = zoneData[selectedZone]["PertesLfZoneValeur"];

    document.getElementById('perte-defaillance-equipements').value =zoneData[selectedZone]["PertesLoZone"];
    document.getElementById('display-value-defaillance-equipements').value = zoneData[selectedZone]["PertesLoZoneValeur"];

    document.getElementById('type_danger_particulier_hz').value =zoneData[selectedZone]["TypeDangerParticulier"];
    document.getElementById('display-value-type-danger-particulier').value = zoneData[selectedZone]["TypeDangerParticulierValeur"];

    document.getElementById('type_risque_incendie').value =zoneData[selectedZone]["FacteurRisqueIncendie"];
    document.getElementById('display-value-reduction-risque-incendie').value = zoneData[selectedZone]["FacteurRisqueIncendieValeur"];

    document.getElementById('precaution_risque_incendie').value =zoneData[selectedZone]["PrecautionsRisqueIncendie"];
    document.getElementById('display-value-precaution-risque-incendie').value = zoneData[selectedZone]["PrecautionsRisqueIncendieValeur"];

    document.getElementById('facteur-reduction-sol').value =zoneData[selectedZone]["FacteurReductionToucherPas"];
    document.getElementById('display-value-facteur-reduction-sol').value = zoneData[selectedZone]["FacteurReductionToucherPasValeur"];

    document.getElementById('systeme-ecran-interne').value =zoneData[selectedZone]["EcranSpatialKS2"];
    document.getElementById('display-value-ecra-interne-options').value = zoneData[selectedZone]["EcranSpatialKS2Valeur"];

    document.getElementById('display-value-pa-options').value = zoneData[selectedZone]["FacteurReductionToucherPasPAValeur"];
    document.getElementById('option1').checked=zoneData[selectedZone]["option1_checked"];
    document.getElementById('option2').checked=zoneData[selectedZone]["option2_checked"];
    document.getElementById('option3').checked=zoneData[selectedZone]["option3_checked"];
    document.getElementById('option4').checked=zoneData[selectedZone]["option4_checked"];
    document.getElementById('option5').checked=zoneData[selectedZone]["option5_checked"];
    document.getElementById('option6').checked=zoneData[selectedZone]["option6_checked"];

    document.getElementById('display-value-ptu-options').value = zoneData[selectedZone]["FacteurReductionToucherPasPTUValeur"];
    document.getElementById('optionptu1').checked=zoneData[selectedZone]["optionptu1_checked"];
    document.getElementById('optionptu2').checked=zoneData[selectedZone]["optionptu2_checked"];
    document.getElementById('optionptu3').checked=zoneData[selectedZone]["optionptu3_checked"];
    document.getElementById('optionptu4').checked=zoneData[selectedZone]["optionptu4_checked"];

    document.getElementById('display-value-nz').value=zoneDatafloat[selectedZone]["nz"];
    document.getElementById('display-value-tz').value=zoneDatafloat[selectedZone]["tz"];

    document.getElementById('precaution_risque_incendie_mesures').value =zoneDataA[selectedZone]["PrecautionsRisqueIncendie"];
    document.getElementById('display-value-precaution-risque-incendie-mesures').value = zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"];

    document.getElementById('facteur-reduction-sol-mesures').value =zoneDataA[selectedZone]["FacteurReductionToucherPas"];
    document.getElementById('display-value-facteur-reduction-sol-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"];

    document.getElementById('systeme-ecran-interne-mesures').value =zoneDataA[selectedZone]["EcranSpatialKS2"];
    document.getElementById('display-value-ecra-interne-options-mesures').value = zoneDataA[selectedZone]["EcranSpatialKS2Valeur"];
    document.getElementById('taille-mailles-KS2-input-mesures').value = zoneDataA[selectedZone]["TailleMaillesK2"];

    document.getElementById('display-value-pa-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"];
    document.getElementById('option1-mesures').checked=zoneDataA[selectedZone]["option1_checked"];
    document.getElementById('option2-mesures').checked=zoneDataA[selectedZone]["option2_checked"];
    document.getElementById('option3-mesures').checked=zoneDataA[selectedZone]["option3_checked"];
    document.getElementById('option4-mesures').checked=zoneDataA[selectedZone]["option4_checked"];
    document.getElementById('option5-mesures').checked=zoneDataA[selectedZone]["option5_checked"];
    document.getElementById('option6-mesures').checked=zoneDataA[selectedZone]["option6_checked"];

    document.getElementById('display-value-ptu-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPTUValeur"];
    document.getElementById('optionptu1-mesures').checked=zoneDataA[selectedZone]["optionptu1_checked"];
    document.getElementById('optionptu2-mesures').checked=zoneDataA[selectedZone]["optionptu2_checked"];
    document.getElementById('optionptu3-mesures').checked=zoneDataA[selectedZone]["optionptu3_checked"];
    document.getElementById('optionptu4-mesures').checked=zoneDataA[selectedZone]["optionptu4_checked"];

    document.getElementById('pertes_lfe').className=zoneData[selectedZone]["ClassNameLFELabel"];
    document.getElementById('display-value-lfe').className=zoneData[selectedZone]["ClassNameLFEInput"];
    document.getElementById('te_lfe').className=zoneData[selectedZone]["ClassNameTeLabel"];
    document.getElementById('display-te-lfe').className=zoneData[selectedZone]["ClassNameTeInput"];
    document.getElementById('display-value-lfe').value=zoneData[selectedZone]["PertesLFE"];
    document.getElementById('display-te-lfe').value=zoneData[selectedZone]["PertesTeLFE"];
    document.getElementById('includeOptionPertes').checked=zoneData[selectedZone]["CheckedLFE"];
    document.getElementById('includeOptionNoteINERIS').checked=zoneData[selectedZone]["CheckedINERIS"];
    document.getElementById('includeOptionNoteINERIS').disabled=zoneData[selectedZone]["DisabledCheckboxINERIS"];
    document.getElementById('labelincludeOptionNoteINERIS').className=zoneData[selectedZone]["LabelCheckboxINERIS"];
    document.getElementById('ptws_lfe').className=zoneData[selectedZone]["ClassNamePTWSLabel"];
    document.getElementById('display-ptws-lfe').className=zoneData[selectedZone]["ClassNamePTWSInput"];
    document.getElementById('display-ptws-lfe').value=zoneData[selectedZone]["PTWSLFE"];
    document.getElementById('display-ptws-lfe-mesures').value=zoneData[selectedZone]["PTWSLFE"];

    if (zoneDataA[selectedZone]["EcranSpatialKS2"]==='4') {

    document.getElementById('taille-mailles-KS2-input-mesures').className='input_select_lines';
    document.getElementById('taille-mailles-label-KS2-mesures').className='label_input_field';


    } else {

    document.getElementById('taille-mailles-KS2-input-mesures').className='grayed-out-mailles-KS2';
    document.getElementById('taille-mailles-label-KS2-mesures').className='titre_label_mailles_KS2';



    }


    const checkboxes2 = document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]');

    checkboxes2.forEach(checkbox => {
    // Get the name of the current line
    checkbox_name=checkbox.name;

    // Store the checked state of the line
    checkbox.checked=selected_lines[selectedZone][checkbox_name];
    });

    create_risque_container ();
    const options = document.getElementById('dropdown-menu-risque').options;   
    document.getElementById('surface_zone').value =zoneData[selectedZone]["ZoneSurface"];
    document.getElementById('charge_zone').value =zoneData[selectedZone]["ChargeCalorifique"];

    for (let i = 0; i < options.length; i++) {

        const selectedProduct=options[i].text;

        document.getElementById('potentiel_zone').value =produits_data[selectedZone][selectedProduct]["PotentielCalorifique"];
        document.getElementById('quantite_zone').value =produits_data[selectedZone][selectedProduct]["QuantiteProduit"];


    }



    updateResults();



}


function removeproduit() {
    var dropdown_risque = document.getElementById("dropdown-menu-risque");
    var dropdown_zone = document.getElementById("dropdown-menu-zone");

    var dropdown_risque_value = document.getElementById("dropdown-menu-risque").value;

    const selectedZone = dropdown_zone.value;


    if (dropdown_risque.options.length > 1) {
        dropdown_risque.remove(dropdown_risque.selectedIndex);
        risqueCounter=risqueCounter-1;
        delete produits_data[selectedZone][dropdown_risque_value];

    } else {
        alert("Opération invalide");
    }

    dropdown_risque.selectedIndex = dropdown_risque.options.length - 1;

    calcul_charge_calorifique ();

}


function renameline() {

    const dropdownMenu = document.getElementById('dropdown-menu-line');
    const selectedOption = dropdownMenu.options[dropdownMenu.selectedIndex];
    const selectedOptionValue = selectedOption.value;
    // Prompt the user to enter a new name for the item
    const newName = prompt("Saisir un nouveau nom de la ligne:",selectedOption.text);
    
    // Check if a new name was provided and it's not an empty string
    if (newName !== null && newName.trim() !== "") {
        const newNameTrimmed = newName.trim();

        const existingOptions = Array.from(dropdownMenu.options).map(option => option.value.trim());
        if (existingOptions.includes(newNameTrimmed)) {
            alert("Ce nom existe déjà. Veuillez choisir un autre nom.");
            return;
        }

        lineData[newNameTrimmed] = lineData[selectedOptionValue];
        lineDataA[newNameTrimmed] = lineDataA[selectedOptionValue];
        lineData_float[newNameTrimmed] = lineData_float[selectedOptionValue];

        delete lineData[selectedOptionValue];
        delete lineDataA[selectedOptionValue];
        delete lineData_float[selectedOptionValue];

        const zone_names =document.getElementById('dropdown-menu-zone').querySelectorAll('option');

        zone_names.forEach((zone_name) => {
        const selectedZone = zone_name.value.trim();

        if (!selected_lines[selectedZone]) {
            selected_lines[selectedZone] = {};
        }

        selected_lines[selectedZone][newNameTrimmed]=selected_lines[selectedZone][selectedOptionValue];
        delete selected_lines[selectedZone][selectedOptionValue];

        })


        selectedOption.value = newNameTrimmed;
        selectedOption.text = newNameTrimmed;

        



        const checkbox = document.getElementById(selectedOptionValue);
        checkbox.id = newNameTrimmed;
        checkbox.name = newNameTrimmed;
        checkbox.nextElementSibling.htmlFor = newNameTrimmed;
        checkbox.nextElementSibling.innerText = newNameTrimmed;
    }
}

function renamezone() {

    const dropdownMenu = document.getElementById('dropdown-menu-zone');
    const selectedOption = dropdownMenu.options[dropdownMenu.selectedIndex];
    const selectedOptionValue = selectedOption.value;

    // Prompt the user to enter a new name for the item
    const newName = prompt("Saisir un nouveau nom de la zone:",selectedOption.text);
    
    // Check if a new name was provided and it's not an empty string
    if (newName !== null && newName.trim() !== "") {

        const newNameTrimmed = newName.trim();

        const existingOptions = Array.from(dropdownMenu.options).map(option => option.value.trim());
        if (existingOptions.includes(newNameTrimmed)) {
            alert("Ce nom existe déjà. Veuillez choisir un autre nom.");
            return;
        }

        zoneData[newNameTrimmed] = zoneData[selectedOptionValue];
        zoneDatafloat[newNameTrimmed] = zoneDatafloat[selectedOptionValue];
        delete zoneData[selectedOptionValue];
        delete zoneDatafloat[selectedOptionValue];

        zoneDataA[newNameTrimmed] = zoneDataA[selectedOptionValue];
        zoneDatafloatA[newNameTrimmed] = zoneDatafloatA[selectedOptionValue];
        delete zoneDataA[selectedOptionValue];
        delete zoneDatafloatA[selectedOptionValue];

        const checkboxes =document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]');

        checkboxes.forEach((checkbox) => {
        const selectedLine = checkbox.name;

        if (!selected_lines[newNameTrimmed]) {
            selected_lines[newNameTrimmed] = {};
        }

        selected_lines[newNameTrimmed][selectedLine]=selected_lines[selectedOptionValue][selectedLine];
        delete selected_lines[selectedOptionValue][selectedLine];

        })
       

        selectedOption.value = newNameTrimmed;
        selectedOption.text = newNameTrimmed;

        // Get the dropdown select element
        //let dropdownMenu = document.getElementById("dropdown-menu-zone");

        // Update the selected option's text content with the new name
        //dropdownMenu.options[dropdownMenu.selectedIndex].textContent = newName;
    }
}

function renameproduit() {

const dropdownMenu = document.getElementById('dropdown-menu-risque');
const selectedZone = document.getElementById('dropdown-menu-zone').value;
const selectedOption = dropdownMenu.options[dropdownMenu.selectedIndex];
const selectedOptionValue = selectedOption.value;

// Prompt the user to enter a new name for the item
const newName = prompt("Saisir un nouveau nom du produit:",selectedOption.text);

// Check if a new name was provided and it's not an empty string
if (newName !== null && newName.trim() !== "") {

    const newNameTrimmed = newName.trim();

    const existingOptions = Array.from(dropdownMenu.options).map(option => option.value.trim());
    if (existingOptions.includes(newNameTrimmed)) {
        alert("Ce nom existe déjà. Veuillez choisir un autre nom.");
        return;
    }

    

    produits_data[selectedZone][newNameTrimmed]=produits_data[selectedZone][selectedOptionValue];
    delete produits_data[selectedZone][selectedOptionValue];

    selectedOption.value = newNameTrimmed;
    selectedOption.text = newNameTrimmed;
 
}

}






var buttons = document.querySelectorAll('.button');
    buttons.forEach(function(button) {
    button.addEventListener('click', function() {
    // Remove clicked class from all buttons
    buttons.forEach(function(btn) {
        btn.classList.remove('clicked');
    });

    // Add clicked class to the clicked button
    button.classList.add('clicked');
    });
});



document.getElementById('structure').addEventListener('click', function() {

    var buttonContainer = document.getElementById('line-container');
    buttonContainer.style.display = 'none'; // Show the line container if hidden

    var buttonContainer = document.getElementById('zone-container');
    buttonContainer.style.display = 'none'; // Show the line container if hidden

    var buttonContainer = document.getElementById('mesures-container');
    buttonContainer.style.display = 'none'; // Show the line container if hidden

    var buttonContainer = document.getElementById('surface_exposition_button_container');
    if (buttonContainer.style.display === 'none' || buttonContainer.style.display === '') {
        buttonContainer.style.display = 'flex';

    }

    var center_container_options = document.getElementById('center-container-options');

    if (center_container_options.style.display === 'none' || center_container_options.style.display === '') {
        center_container_options.style.display = 'flex';

    }

    
});


document.getElementById('services').addEventListener('click', function() {

    var buttonContainer = document.getElementById('surface_exposition_button_container');
    buttonContainer.style.display = 'none';

    var center_container_options = document.getElementById('center-container-options');
    center_container_options.style.display = 'none';

    var buttonContainer = document.getElementById('zone-container');
    buttonContainer.style.display = 'none';

    var buttonContainer = document.getElementById('mesures-container');
    buttonContainer.style.display = 'none'; // Show the line container if hidden
    
    var buttonContainer = document.getElementById('line-container');

 
    if (buttonContainer.style.display === 'none' || buttonContainer.style.display === '') {
        buttonContainer.style.display = 'flex'; // Show the line container if hidden
    }
    
});

document.getElementById('zones').addEventListener('click', function() {

var buttonContainer = document.getElementById('surface_exposition_button_container');
buttonContainer.style.display = 'none';

var center_container_options = document.getElementById('center-container-options');
center_container_options.style.display = 'none';

var buttonContainer = document.getElementById('line-container');
buttonContainer.style.display = 'none'; // Show the line container if hidden

var buttonContainer = document.getElementById('mesures-container');
buttonContainer.style.display = 'none'; // Show the line container if hidden

var buttonContainer = document.getElementById('zone-container');

if (buttonContainer.style.display === 'none' || buttonContainer.style.display === '') {
    buttonContainer.style.display = 'flex'; // Show the line container if hidden
}

});

document.getElementById('mesures').addEventListener('click', function() {

var buttonContainer = document.getElementById('surface_exposition_button_container');
buttonContainer.style.display = 'none';

var center_container_options = document.getElementById('center-container-options');
center_container_options.style.display = 'none';

var buttonContainer = document.getElementById('line-container');
buttonContainer.style.display = 'none'; // Show the line container if hidden

var buttonContainer = document.getElementById('zone-container');
buttonContainer.style.display = 'none'; // Show the line container if hidden

var buttonContainer = document.getElementById('mesures-container');

if (buttonContainer.style.display === 'none' || buttonContainer.style.display === '') {
   buttonContainer.style.display = 'flex'; // Show the line container if hidden
}

copyDropdownLines();
copyDropdownZones();

const dropdownMenuLineMesures = document.getElementById('dropdown-menu-mesures');
dropdownMenuLineMesures.selectedIndex = 0;

const selectedLine = dropdownMenuLineMesures.value;
document.getElementById('display-value-equipotentialite-mesures').value=lineDataA[selectedLine]["parafoudresPEBValeur"];
document.getElementById('parafoudres-equipotentialite_select_mesures').value=lineDataA[selectedLine]["parafoudresPEB"];
document.getElementById('display-value-pspd-mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspdValeur"];
document.getElementById('parafoudres-coordonnes_select_mesures').value = lineDataA[selectedLine]["parafoudresCoordonnesPspd"];
document.getElementById('display-value-ks3-mesures').value=lineDataA[selectedLine]["typeCablageInterneValeur"];
document.getElementById('type-cablage-interne-select-mesures').value=lineDataA[selectedLine]["typeCablageInterne"];
document.getElementById('display-value-pld-mesures').value = lineDataA[selectedLine]["typeCablageExternePLDValeur"];
document.getElementById('resistance-ecran-pld-mesures').value=lineDataA[selectedLine]["typeCablageExternePLD"];

document.getElementById('conditions-blindage-cld-cli-mesures').value = lineDataA[selectedLine]["conditionsBlindageCLDCLI"];
document.getElementById('display-value-cld').value=lineDataA[selectedLine]["conditionsBlindageCLDValeur"];
document.getElementById('display-value-cli').value=lineDataA[selectedLine]["conditionsBlindageCLIValeur"];

document.getElementById('interfaces_isolement_select_mesures').value = lineDataA[selectedLine]["interfacesIsolement"];
document.getElementById('display-value-interfaces-isolement-mesures').value = lineDataA[selectedLine]["interfacesIsolementValeur"];

const dropdownMenuZoneMesures = document.getElementById('dropdown-menu-zone-mesures');
dropdownMenuZoneMesures.selectedIndex = 0;

const selectedZone = dropdownMenuZoneMesures.value;

document.getElementById('precaution_risque_incendie_mesures').value =zoneDataA[selectedZone]["PrecautionsRisqueIncendie"];
document.getElementById('display-value-precaution-risque-incendie-mesures').value = zoneDataA[selectedZone]["PrecautionsRisqueIncendieValeur"];

document.getElementById('facteur-reduction-sol-mesures').value =zoneDataA[selectedZone]["FacteurReductionToucherPas"];
document.getElementById('display-value-facteur-reduction-sol-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasValeur"];

document.getElementById('systeme-ecran-interne-mesures').value =zoneDataA[selectedZone]["EcranSpatialKS2"];
document.getElementById('display-value-ecra-interne-options-mesures').value = zoneDataA[selectedZone]["EcranSpatialKS2Valeur"];
document.getElementById('taille-mailles-KS2-input-mesures').value = zoneDataA[selectedZone]["TailleMaillesK2"];

if (zoneDataA[selectedZone]["EcranSpatialKS2"]==='4') {

document.getElementById('taille-mailles-KS2-input-mesures').className='input_select_lines';
document.getElementById('taille-mailles-label-KS2-mesures').className='label_input_field';


} else {

document.getElementById('taille-mailles-KS2-input-mesures').className='grayed-out-mailles-KS2';
document.getElementById('taille-mailles-label-KS2-mesures').className='titre_label_mailles_KS2';



}

document.getElementById('display-value-pa-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPAValeur"];
document.getElementById('option1-mesures').checked=zoneDataA[selectedZone]["option1_checked"];
document.getElementById('option2-mesures').checked=zoneDataA[selectedZone]["option2_checked"];
document.getElementById('option3-mesures').checked=zoneDataA[selectedZone]["option3_checked"];
document.getElementById('option4-mesures').checked=zoneDataA[selectedZone]["option4_checked"];
document.getElementById('option5-mesures').checked=zoneDataA[selectedZone]["option5_checked"];
document.getElementById('option6-mesures').checked=zoneDataA[selectedZone]["option6_checked"];

document.getElementById('display-value-ptu-options-mesures').value = zoneDataA[selectedZone]["FacteurReductionToucherPasPTUValeur"];
document.getElementById('optionptu1-mesures').checked=zoneDataA[selectedZone]["optionptu1_checked"];
document.getElementById('optionptu2-mesures').checked=zoneDataA[selectedZone]["optionptu2_checked"];
document.getElementById('optionptu3-mesures').checked=zoneDataA[selectedZone]["optionptu3_checked"];
document.getElementById('optionptu4-mesures').checked=zoneDataA[selectedZone]["optionptu4_checked"];

document.getElementById('display-ptws-lfe-mesures').value=zoneData[selectedZone]["PTWSLFE"];



});

const closePopupBtn_cube_simple = document.getElementById('close-popup-btn-cube-simple');
const closePopupBtn_cube_edicule = document.getElementById('close-popup-btn-cube-edicule');
const closePopupBtn_cylindre_simple = document.getElementById('close-popup-btn-cylindre-simple');
const closePopupBtn_cylindre_edicule = document.getElementById('close-popup-btn-cylindre-edicule');
const closePopupBtn_structure_complexe = document.getElementById('close-popup-btn-structure-complexe');

const closePopupBtn_risque_incendie = document.getElementById('close-popup-btn-risque-incendie');

const validatePopupBtn_cube_simple = document.getElementById('validate-popup-btn-cube-simple');
const validatePopupBtn_cube_edicule = document.getElementById('validate-popup-btn-cube-edicule');
const validatePopupBtn_cylindre_simple = document.getElementById('validate-popup-btn-cylindre-simple');
const validatePopupBtn_cylindre_edicule = document.getElementById('validate-popup-btn-cylindre-edicule');
const validatePopupBtn_structure_complexe = document.getElementById('validate-popup-btn-structure-complexe');

const validatePopupBtn_risque_incendie = document.getElementById('validate-popup-btn-risque-incendie');

const popup_cube_simple = document.getElementById('popup-cube-simple');
const popup_cube_edicule = document.getElementById('popup-cube-edicule');
const popup_cylindre_simple = document.getElementById('popup-cylindre-simple');
const popup_cylindre_edicule = document.getElementById('popup-cylindre-edicule');
const popup_structure_complexe = document.getElementById('popup-structure-complexe');

const popup_risque_incendie = document.getElementById('popup-risque-incendie');

const overlay_cube_simple = document.getElementById('overlay-cube-simple');
const overlay_cube_edicule = document.getElementById('overlay-cube-edicule');
const overlay_cylindre_simple = document.getElementById('overlay-cylindre-simple');
const overlay_cylindre_edicule = document.getElementById('overlay-cylindre-edicule');
const overlay_structure_complexe = document.getElementById('overlay-structure-complexe');

const overlay_risque_incendie = document.getElementById('overlay-risque-incendie');

document.getElementById('cube_simple').addEventListener('click', function() {
    popup_cube_simple.style.display = "block";
    overlay_cube_simple.style.display = "block";
});

document.getElementById('cube_simple_edicule').addEventListener('click', function() {
    popup_cube_edicule.style.display = "block";
    overlay_cube_edicule.style.display = "block";
});

document.getElementById('cylindre_simple').addEventListener('click', function() {
    popup_cylindre_simple.style.display = "block";
    overlay_cylindre_simple.style.display = "block";
});

document.getElementById('cylindre_edicule').addEventListener('click', function() {
    popup_cylindre_edicule.style.display = "block";
    overlay_cylindre_edicule.style.display = "block";
});

document.getElementById('forme_complexe').addEventListener('click', function() {
    popup_structure_complexe.style.display = "block";
    overlay_structure_complexe.style.display = "block";
});


closePopupBtn_cube_simple.addEventListener('click', function() {
    popup_cube_simple.style.display = "none";
    overlay_cube_simple.style.display = "none";
});

closePopupBtn_cube_edicule.addEventListener('click', function() {
    popup_cube_edicule.style.display = "none";
    overlay_cube_edicule.style.display = "none";
});

closePopupBtn_cylindre_simple.addEventListener('click', function() {
    popup_cylindre_simple.style.display = "none";
    overlay_cylindre_simple.style.display = "none";
});

closePopupBtn_cylindre_edicule.addEventListener('click', function() {
    popup_cylindre_edicule.style.display = "none";
    overlay_cylindre_edicule.style.display = "none";
});

closePopupBtn_structure_complexe.addEventListener('click', function() {
    popup_structure_complexe.style.display = "none";
    overlay_structure_complexe.style.display = "none";
});


closePopupBtn_risque_incendie .addEventListener('click', function() {
    popup_risque_incendie.style.display = "none";
    overlay_risque_incendie.style.display = "none";
});


validatePopupBtn_cube_simple.addEventListener('click', function() {
    popup_cube_simple.style.display = "none";
    overlay_cube_simple.style.display = "none";
    Ad=parseFloat(document.getElementById('resultat_cube_simple_Ad').value);  // Display with two decimal places
    Am=parseFloat(document.getElementById('resultat_cube_simple_Am').value);  // Display with two decimal places

    document.getElementById('cube_simple').style.borderColor = 'black';
    document.getElementById('cube_simple_edicule').style.borderColor = 'lightgray';
    document.getElementById('cylindre_simple').style.borderColor = 'lightgray';
    document.getElementById('cylindre_edicule').style.borderColor = 'lightgray';
    document.getElementById('forme_complexe').style.borderColor = 'lightgray';
    structure_selectionne=1;

    //Ad=Add;
    //Am=Amm;
    //RA=5e-5;
    updateResults();
});

validatePopupBtn_cube_edicule.addEventListener('click', function() {
    popup_cube_edicule.style.display = "none";
    overlay_cube_edicule.style.display = "none";
    Ad=parseFloat(document.getElementById('resultat_cube_edicule_Ad').value);  // Display with two decimal places
    Am=parseFloat(document.getElementById('resultat_cube_edicule_Am').value);  // Display with two decimal places
    document.getElementById('cube_simple').style.borderColor = 'lightgray';
    document.getElementById('cube_simple_edicule').style.borderColor = 'black';
    document.getElementById('cylindre_simple').style.borderColor = 'lightgray';
    document.getElementById('cylindre_edicule').style.borderColor = 'lightgray';
    document.getElementById('forme_complexe').style.borderColor = 'lightgray';
    structure_selectionne=2;
    //Ad=Add;
    //Am=Amm;
    //RA=5e-5;
    updateResults();
});

validatePopupBtn_cylindre_simple.addEventListener('click', function() {
    popup_cylindre_simple.style.display = "none";
    overlay_cylindre_simple.style.display = "none";
    Ad=parseFloat(document.getElementById('resultat_cylindre_simple_Ad').value);  // Display with two decimal places
    Am=parseFloat(document.getElementById('resultat_cylindre_simple_Am').value);  // Display with two decimal places
    document.getElementById('cube_simple').style.borderColor = 'lightgray';
    document.getElementById('cube_simple_edicule').style.borderColor = 'lightgray';
    document.getElementById('cylindre_simple').style.borderColor = 'black';
    document.getElementById('cylindre_edicule').style.borderColor = 'lightgray';
    document.getElementById('forme_complexe').style.borderColor = 'lightgray';
    structure_selectionne=3;

    //Ad=Add;
    //Am=Amm;
    //RA=5e-5;
    updateResults();
});

validatePopupBtn_cylindre_edicule.addEventListener('click', function() {
    popup_cylindre_edicule.style.display = "none";
    overlay_cylindre_edicule.style.display = "none";
    Ad=parseFloat(document.getElementById('resultat_cylindre_edicule_Ad').value);  // Display with two decimal places
    Am=parseFloat(document.getElementById('resultat_cylindre_edicule_Am').value);  // Display with two decimal places
    document.getElementById('cube_simple').style.borderColor = 'lightgray';
    document.getElementById('cube_simple_edicule').style.borderColor = 'lightgray';
    document.getElementById('cylindre_simple').style.borderColor = 'lightgray';
    document.getElementById('cylindre_edicule').style.borderColor = 'black';
    document.getElementById('forme_complexe').style.borderColor = 'lightgray';
    structure_selectionne=4;
    //Ad=Add;
    //Am=Amm;
    //RA=5e-5;
    updateResults();
});

validatePopupBtn_structure_complexe.addEventListener('click', function() {
    popup_structure_complexe.style.display = "none";
    overlay_structure_complexe.style.display = "none";
    document.getElementById('cube_simple').style.borderColor = 'lightgray';
    document.getElementById('cube_simple_edicule').style.borderColor = 'lightgray';
    document.getElementById('cylindre_simple').style.borderColor = 'lightgray';
    document.getElementById('cylindre_edicule').style.borderColor = 'lightgray';
    document.getElementById('forme_complexe').style.borderColor = 'black';
    structure_selectionne=5;
    Ad=Add;
    Am=Amm;
    //RA=5e-5;
    updateResults();
});


validatePopupBtn_risque_incendie.addEventListener('click', function() {

const dropdownMenuZone = document.getElementById('dropdown-menu-zone');
const selectedZone = dropdownMenuZone.value;

var charge_calorifique=parseFloat(zoneData[selectedZone]["ChargeCalorifique"]);
zone_surface=parseFloat(zoneData[selectedZone]["ZoneSurface"]);

if (zone_surface===0.) {

alert("Opération invalide");

} else {

if (charge_calorifique<400.) {

    document.getElementById('display-value-reduction-risque-incendie').value='0.001';

} else if (charge_calorifique>=400. && charge_calorifique<=800. ){

    document.getElementById('display-value-reduction-risque-incendie').value='0.01';


} else if (charge_calorifique>800.) {

    document.getElementById('display-value-reduction-risque-incendie').value='0.1';

}

zoneData[selectedZone]["FacteurRisqueIncendieValeur"]=document.getElementById('display-value-reduction-risque-incendie').value;

document.getElementById('type_risque_incendie').value='8'; 

zoneData[selectedZone]["FacteurRisqueIncendie"]=document.getElementById('type_risque_incendie').value; 


const popup_risque_incendie = document.getElementById('popup-risque-incendie');
const overlay_risque_incendie = document.getElementById('overlay-risque-incendie');
popup_risque_incendie.style.display = "none";
overlay_risque_incendie.style.display = "none";


}

updateResults();



});




longueur_cube_simple.addEventListener('change', calcul_Ad_Am_cube_simple);
largeur_cube_simple.addEventListener('change', calcul_Ad_Am_cube_simple);
hauteur_cube_simple.addEventListener('change', calcul_Ad_Am_cube_simple);

longueur_cube_edicule.addEventListener('change',calcul_Ad_Am_cube_edicule);
largeur_cube_edicule.addEventListener('change',calcul_Ad_Am_cube_edicule);
hauteur_min_cube_edicule.addEventListener('change',calcul_Ad_Am_cube_edicule);
hauteur_max_cube_edicule.addEventListener('change',calcul_Ad_Am_cube_edicule);

rayon_cylindre_simple.addEventListener('change', calcul_Ad_Am_cylindre_simple);
hauteur_cylindre_simple.addEventListener('change', calcul_Ad_Am_cylindre_simple);

rayon_cylindre_edicule.addEventListener('change', calcul_Ad_Am_cylindre_edicule);
hauteur_min_cylindre_edicule.addEventListener('change', calcul_Ad_Am_cylindre_edicule);
hauteur_max_cylindre_edicule.addEventListener('change', calcul_Ad_Am_cylindre_edicule);

function calcul_Ad_Am_cube_simple() {

    const longueur_cube_simple_1 = document.getElementById('longueur_cube_simple').value;
    const largeur_cube_simple_1 = document.getElementById('largeur_cube_simple').value;
    const hauteur_cube_simple_1 = document.getElementById('hauteur_cube_simple').value;

    document.getElementById('longueur_cube_simple').value = longueur_cube_simple_1;
    document.getElementById('largeur_cube_simple').value = largeur_cube_simple_1;
    document.getElementById('hauteur_cube_simple').value = hauteur_cube_simple_1;
    
    var Longueur_bat = parseFloat(longueur_cube_simple_1);
    var Largeur_bat = parseFloat(largeur_cube_simple_1);
    var Hauteur_bat = parseFloat(hauteur_cube_simple_1);
    
    if (isNaN(Longueur_bat) || Longueur_bat < 0) {
        // If not a positive number, clear the input field
        document.getElementById('longueur_cube_simple').value = '10';
        Longueur_bat=10.;
    }

    if (isNaN(Largeur_bat) || Largeur_bat < 0 ) {
        // If not a positive number, clear the input field
        document.getElementById('largeur_cube_simple').value = '10';
        Largeur_bat=10.;
    }

    if (isNaN(Hauteur_bat) || Hauteur_bat < 0) {
        // If not a positive number, clear the input field
        document.getElementById('hauteur_cube_simple').value = '10';
        Hauteur_bat=10.;
    }

    Ha=Hauteur_bat;

    Add=Longueur_bat*Largeur_bat+6*Hauteur_bat*(Longueur_bat+Largeur_bat)+9*Math.PI*Math.pow(Hauteur_bat,2);
    Amm=0*Longueur_bat*Largeur_bat+2*offset*(Longueur_bat+Largeur_bat)+Math.PI*Math.pow(offset,2);

    document.getElementById('resultat_cube_simple_Ad').value = Add.toFixed(2);  // Display with two decimal places
    document.getElementById('resultat_cube_simple_Am').value = Amm.toFixed(2);  // Display with two decimal places

    
    
}


function calcul_Ad_Am_cube_edicule() {

const longueur_cube_edicule_1 = document.getElementById('longueur_cube_edicule').value;
const largeur_cube_edicule_1 = document.getElementById('largeur_cube_edicule').value;
const hauteur_min_cube_edicule_1 = document.getElementById('hauteur_min_cube_edicule').value;
const hauteur_max_cube_edicule_1 = document.getElementById('hauteur_max_cube_edicule').value;

document.getElementById('longueur_cube_edicule').value =longueur_cube_edicule_1;
document.getElementById('largeur_cube_edicule').value =largeur_cube_edicule_1;
document.getElementById('hauteur_min_cube_edicule').value =hauteur_min_cube_edicule_1;
document.getElementById('hauteur_max_cube_edicule').value =hauteur_max_cube_edicule_1;

var Longueur_bat = parseFloat(longueur_cube_edicule_1);
var Largeur_bat = parseFloat(largeur_cube_edicule_1);
var Hauteur_min_bat = parseFloat(hauteur_min_cube_edicule_1);
var Hauteur_max_bat = parseFloat(hauteur_max_cube_edicule_1);

if (isNaN(Longueur_bat) || Longueur_bat < 0) {
    // If not a positive number, clear the input field
    document.getElementById('longueur_cube_edicule').value = '10';
    Longueur_bat=10.;
}

if (isNaN(Largeur_bat) || Largeur_bat < 0) {
    // If not a positive number, clear the input field
    document.getElementById('largeur_cube_edicule').value = '10';
    Largeur_bat=10.;
}

if (isNaN(Hauteur_min_bat) || Hauteur_min_bat < 0) {
    // If not a positive number, clear the input field
    document.getElementById('hauteur_min_cube_edicule').value = '10';
    Hauteur_min_bat=10.;
}

if (isNaN(Hauteur_max_bat) || Hauteur_max_bat < 0) {
    // If not a positive number, clear the input field
    document.getElementById('hauteur_max_cube_edicule').value = '15';
    Hauteur_max_bat=15.;
}

Ha=Hauteur_min_bat;

Add_1=Longueur_bat*Largeur_bat+6*Hauteur_min_bat*(Longueur_bat+Largeur_bat)+9*Math.PI*Math.pow(Hauteur_min_bat,2);
Add_2=9*Math.PI*Math.pow(Hauteur_max_bat,2);

if (Add_1<=Add_2) {

    Add=Add_2

} else {

    Add=Add_1;


}

Amm=0*Longueur_bat*Largeur_bat+2*offset*(Longueur_bat+Largeur_bat)+Math.PI*Math.pow(offset,2);

document.getElementById('resultat_cube_edicule_Ad').value = Add.toFixed(2);  // Display with two decimal places
document.getElementById('resultat_cube_edicule_Am').value = Amm.toFixed(2);  // Display with two decimal places

}

function calcul_Ad_Am_cylindre_simple() {

const rayon_cylindre_simple_1 = document.getElementById('rayon_cylindre_simple').value;
const hauteur_cylindre_simple_1 = document.getElementById('hauteur_cylindre_simple').value;

document.getElementById('rayon_cylindre_simple').value = rayon_cylindre_simple_1;
document.getElementById('hauteur_cylindre_simple').value = hauteur_cylindre_simple_1;

var Rayon_bat = parseFloat(rayon_cylindre_simple_1);
var Hauteur_bat = parseFloat(hauteur_cylindre_simple_1);

if (isNaN(Rayon_bat) || Rayon_bat < 0) {
    // If not a positive number, clear the input field
    document.getElementById('rayon_cylindre_simple').value = '10';
    Rayon_bat=10.;
}

if (isNaN(Hauteur_bat) || Hauteur_bat < 0) {
    // If not a positive number, clear the input field
    document.getElementById('hauteur_cylindre_simple').value = '10';
    Hauteur_bat=10.;
}

Ha=Hauteur_bat;

Add=Math.PI*Math.pow(Rayon_bat+3*Hauteur_bat,2);
Amm=Math.PI*Math.pow(Rayon_bat+offset,2)-Math.PI*Math.pow(Rayon_bat,2);

document.getElementById('resultat_cylindre_simple_Ad').value = Add.toFixed(2);  // Display with two decimal places
document.getElementById('resultat_cylindre_simple_Am').value = Amm.toFixed(2);  // Display with two decimal places

}



function calcul_Ad_Am_cylindre_edicule() {

const rayon_cylindre_edicule_1 = document.getElementById('rayon_cylindre_edicule').value;
const hauteur_min_cylindre_edicule_1 = document.getElementById('hauteur_min_cylindre_edicule').value;
const hauteur_max_cylindre_edicule_1 = document.getElementById('hauteur_max_cylindre_edicule').value;

document.getElementById('rayon_cylindre_edicule').value = rayon_cylindre_edicule_1;
document.getElementById('hauteur_min_cylindre_edicule').value = hauteur_min_cylindre_edicule_1;
document.getElementById('hauteur_max_cylindre_edicule').value = hauteur_max_cylindre_edicule_1;

var Rayon_bat = parseFloat(rayon_cylindre_edicule_1);
var Hauteur_min_bat = parseFloat(hauteur_min_cylindre_edicule_1);
var Hauteur_max_bat = parseFloat(hauteur_max_cylindre_edicule_1);

if (isNaN(Rayon_bat) || Rayon_bat < 0 ) {
    // If not a positive number, clear the input field
    document.getElementById('rayon_cylindre_edicule').value = '10';
    Rayon_bat=10.;
}

if (isNaN(Hauteur_min_bat) || Hauteur_min_bat < 0 ) {
    // If not a positive number, clear the input field
    document.getElementById('hauteur_min_cylindre_edicule').value = '10';
    Hauteur_min_bat=10.;
}

if (isNaN(Hauteur_max_bat) || Hauteur_max_bat < 0 ) {
    // If not a positive number, clear the input field
    document.getElementById('hauteur_max_cylindre_edicule').value = '15';
    Hauteur_max_bat=15.;
}

Ha=Hauteur_min_bat;


Add_1=Math.PI*Math.pow(Rayon_bat+3*Hauteur_min_bat,2);
Add_2=Math.PI*Math.pow(3*Hauteur_max_bat,2);
Amm=Math.PI*Math.pow(Rayon_bat+offset,2)-Math.PI*Math.pow(Rayon_bat,2);

if (Add_1<=Add_2) {

Add=Add_2

} else {

Add=Add_1;


}

document.getElementById('resultat_cylindre_edicule_Ad').value = Add.toFixed(2);  // Display with two decimal places
document.getElementById('resultat_cylindre_edicule_Am').value = Amm.toFixed(2);  // Display with two decimal places

}

////////////////////////////////////////////////////////////

function addRectangle() {
    rectangleCount++;
    rectangleCounti++;
    
    const div = document.createElement('div');
    div.id = `rect${rectangleCount}`;
    div.innerHTML = `
    <div class="shape-properties1">
    <label id="rect${rectangleCount}Label" class="input-label-complexe-bis-1">Structure cubique N° ${rectangleCounti}: </label>
    <label class="input-label-complexe"> Centre X0 (m):</label>
    <input type="number" id="rect${rectangleCount}x" value="0" onchange="checkvalues('x0',this)" onfocus="highlightcolorrectangles(${rectangleCount})" onblur="create_shapes()">
    <label class="input-label-complexe"> Centre Y0 (m):</label>
    <input type="number" id="rect${rectangleCount}y" value="0" onchange="checkvalues('y0',this)" onfocus="highlightcolorrectangles(${rectangleCount})" onblur="create_shapes()" >
    <label class="input-label-complexe"> Longueur (m):</label>
    <input type="number" id="rect${rectangleCount}L" value="10" onchange="checkvalues('L',this)" onfocus="highlightcolorrectangles(${rectangleCount})" onblur="create_shapes()">
    <label class="input-label-complexe"> Largeur (m):</label>
    <input type="number" id="rect${rectangleCount}W" value="10" onchange="checkvalues('W',this)" onfocus="highlightcolorrectangles(${rectangleCount})" onblur="create_shapes()">
    <label class="input-label-complexe"> Hauteur (m):</label>
    <input type="number" id="rect${rectangleCount}H" value="10" onchange="checkvalues('H',this)" onfocus="highlightcolorrectangles(${rectangleCount})" onblur="create_shapes()">
    <button type="button" onmouseover="highlightcolorrectangles(${rectangleCount})" onmouseout="highlightcolorrectangles(null);" onclick="this.focus(); deleteShape('rect${rectangleCount}','rectangle')">Supprimer</button>
    <button type="button" onmouseover="highlightcolorrectangles(${rectangleCount})" onmouseout="highlightcolorrectangles(null);" onclick="this.focus(); renameShape('rect${rectangleCount}Label','rectangleCount', ${rectangleCount})">Renommer</button>
    <input type="color" title="Couleur" id="rect${rectangleCount}Color" value="#000000" class="small-color-input" onmouseover="highlightcolorrectangles(${rectangleCount})" onmouseout="highlightcolorrectangles(null);" onblur="create_shapes()">
 
    </div>
    `;

    document.getElementById('rectangles').appendChild(div);

    create_shapes();

    addInputListeners(`rect${rectangleCount}`);

    }

    function changeColor(rectangleCount) {
    //const colorInput = document.getElementById(`rect${rectangleCount}Color`);
    //const shape = shapes.find(shape => shape.id === rectangleCount);
   // if (shape) {
      //  shape.color = colorInput.value;
        const colorButton = document.getElementById(`colorButton${rectangleCount}`);
        colorButton.style.backgroundColor = colorInput.value;
      //  drawCanvas();
   // }
}



function changeBackgroundColor() {
    const colorInput = document.getElementById('backgroundColorPicker');
    backgroundColor = colorInput.value;
    drawCanvas();
}

function triggerColorPicker(rectangleCount) {
    const colorInput = document.getElementById(`rect${rectangleCount}Color`);
    colorInput.click();
}

function addCircle() {
    circleCount++;
    circleCounti++;
    const div = document.createElement('div');
    div.id = `circle${circleCount}`;
    div.innerHTML = `
    <div class="shape-properties1">
    <label id="circle${circleCount}Label" class="input-label-complexe-bis-1">Structure cylindrique N° ${circleCounti}:</label>
    <label class="input-label-complexe"> Centre X0 (m):</label>
    <input type="number" id="circle${circleCount}x" value= "0" onchange="checkvalues('x0',this)" onfocus="highlightcolorcircles(${circleCount})" onblur="create_shapes()">
    <label class="input-label-complexe"> Centre Y0 (m):</label>
    <input type="number" id="circle${circleCount}y" value="0" onchange="checkvalues('y0',this)" )" onfocus="highlightcolorcircles(${circleCount})" onblur="create_shapes()">
    <label class="input-label-complexe"> Rayon (m):</label>
    <input type="number" id="circle${circleCount}r" value="10" onchange="checkvalues('rayon',this)" onfocus="highlightcolorcircles(${circleCount})" onblur="create_shapes()">
    <label class="input-label-complexe"> Hauteur (m):</label>
    <input type="number" id="circle${circleCount}H" value="10" onchange="checkvalues('H',this)" onfocus="highlightcolorcircles(${circleCount})" onblur="create_shapes()">
    <button type="button" onmouseover="highlightcolorcircles(${circleCount});" onmouseout="highlightcolorcircles(null);" onclick="this.focus(); deleteShape('circle${circleCount}', 'circle')">Supprimer</button>
    <button type="button" onmouseover="highlightcolorcircles(${circleCount});" onmouseout="highlightcolorcircles(null);" onclick="this.focus(); renameShape('circle${circleCount}Label');">Renommer</button>
    <input type="color" title="Couleur" id="circle${circleCount}Color" value="#000000"  class="small-color-input" onmouseover="highlightcolorcircles(${circleCount});" onmouseout="highlightcolorcircles(null);" onblur="create_shapes()">
    </div>
    `;
    document.getElementById('rectangles').appendChild(div);

    addInputListeners(`circle${circleCount}`);

    create_shapes();

            
}


var canvas_structure_complexe = document.getElementById('canvas_structure_complexe');
var context_structure_complexe= canvas_structure_complexe.getContext('2d');

function highlightcolorrectangles(rectangleCountx) {

    if (rectangleCountx) {

    
    context_structure_complexe.clearRect(0, 0, canvas_structure_complexe.width, canvas_structure_complexe.height);

    context_structure_complexe.save();

   
    create_shapes();

    const x0 = parseFloat(document.getElementById(`rect${rectangleCountx}x`).value);
    const y0 = parseFloat(document.getElementById(`rect${rectangleCountx}y`).value);
    const L = parseFloat(document.getElementById(`rect${rectangleCountx}L`).value);
    const W = parseFloat(document.getElementById(`rect${rectangleCountx}W`).value);


    //context_structure_complexe.translate(canvas_structure_complexe.width / 2 - offsetXX, canvas_structure_complexe.height / 2 + offsetYY);
    
    //context_structure_complexe.scale(1, 100/60);
    //context_structure_complexe.scale(zoomLevel, zoomLevel);

    context_structure_complexe.translate(canvas_structure_complexe.width / 2, canvas_structure_complexe.height / 2);
    context_structure_complexe.scale(scale*60/100, scale); // Inverser Y pour correspondre au système de coordonnées
    context_structure_complexe.translate(-offsetXX, offsetYY);


    
    //const colorButton = document.getElementById(`colorButton${rectangleCount}`);

    //const colorInput = document.getElementById(`rect${rectangleCount}Color`);

    //console.log(colorInput);
    //const originalColorHex = colorInput.value; // Valeur hexadécimale sélectionnée par l'utilisateur
    //const rgbColor = hexToRgb(originalColorHex); // Conversion en RGB
    //const lightenedRgbColor = lightenColor(rgbColor, 20); // Éclaircir de 20%
    //const lightenedColorHex = rgbToHex(lightenedRgbColor); // Conversion en hexadécimal

// Appliquer la couleur éclaircie au contour du rectangle
    //context_structure_complexe.strokeStyle = lightenedColorHex;


    context_structure_complexe.strokeStyle = 'green'; // Bordure rouge
    context_structure_complexe.lineWidth = 2;
    context_structure_complexe.strokeRect(x0-L/2, -y0-W/2, L, W);
    
    

    context_structure_complexe.restore();

    } else {

        create_shapes();

    }

   
}

function highlightcolorcircles(circleCountx) {

    
    if (circleCountx) {
    
    context_structure_complexe.clearRect(0, 0, canvas_structure_complexe.width, canvas_structure_complexe.height);

    context_structure_complexe.save();


    create_shapes();

    const x0 = parseFloat(document.getElementById(`circle${circleCountx}x`).value);
    const y0 = parseFloat(document.getElementById(`circle${circleCountx}y`).value);
    const Rayon = parseFloat(document.getElementById(`circle${circleCountx}r`).value);

    //context_structure_complexe.translate(canvas_structure_complexe.width / 2 - offsetXX, canvas_structure_complexe.height / 2 + offsetYY);

    //context_structure_complexe.scale(1, 100/60);
    //context_structure_complexe.scale(zoomLevel, zoomLevel);

    context_structure_complexe.translate(canvas_structure_complexe.width / 2, canvas_structure_complexe.height / 2);
    context_structure_complexe.scale(scale*60/100, scale); // Inverser Y pour correspondre au système de coordonnées
    context_structure_complexe.translate(-offsetXX, offsetYY);

    context_structure_complexe.strokeStyle = 'green'; // Bordure rouge
    context_structure_complexe.lineWidth = 2;

    context_structure_complexe.beginPath(); // Commence un nouveau tracé
    context_structure_complexe.arc(x0, -y0, Rayon, 0, 2 * Math.PI); // Trace le cercle
    context_structure_complexe.stroke(); // Dessine le contour

    context_structure_complexe.restore();

    } else {

        create_shapes();

    }


}

function checkvalues(type,input) {

    

    //value = input.value.replace(',', '.');

    //input.value = value;

    value = input.value;
    
    // Replace comma with a dot to use it as a decimal point for internal calculations
    //value = value.replace(',', '.');

    let numValue = parseFloat(value);

    if (type==='rayon') {


        if (numValue < 0) {
            numValue = 10;
            input.value = numValue.toFixed(0);

            
        }

        if (numValue >= 100.) {
            numValue = 100.;
            input.value = numValue.toFixed(0);

        } 

        if (isNaN(numValue)) {

            numValue = 10.;
            input.value = numValue.toFixed(0);

            
           
            
        }

    
    } else if ((type==='x0') || (type==='y0')) {

        if (numValue <= -1000) {
            numValue = -1000.;
            input.value = numValue.toFixed(0);

        }
        if (numValue >= 1000.) {
            numValue = 1000.;
            input.value = numValue.toFixed(0);

        }

        if (isNaN(numValue)) {

            numValue = 0.;
            input.value = numValue.toFixed(0);
                          

        }


    } else if ((type==='L') || (type==='W') || (type==='H')) {

        if (numValue < 0) {
            numValue = 10;
            input.value = numValue.toFixed(0);

        }
        if (numValue >= 500.) {
            numValue = 500.;
            input.value = numValue.toFixed(0);

        }

        if (isNaN(numValue)) {

            numValue = 10.;
            input.value = numValue.toFixed(0);
            
            



           
            
        }

        


    }


}

function deleteShape(id,type) {
    document.getElementById(id).remove();

    if (type==='rectangle') {

        rectangleCounti=rectangleCounti-1;


    } else {

        circleCounti=circleCounti-1;


    }

    create_shapes();

}

function renameShape(labelId) {
    // Récupérer l'élément par son ID
    const labelElement = document.getElementById(labelId);

    // Extraire le texte actuel du label
    const currentLabel = labelElement.innerText.replace(/:\s*$/, ''); // Supprime le ":" final s'il existe

    // Demander un nouveau nom en affichant le nom actuel
    const newLabel = prompt("Entrez un nouveau nom :", currentLabel);

    // Si l'utilisateur entre un nouveau nom, mettre à jour le texte
    if (newLabel) {
        labelElement.innerText = `${newLabel}:`;
    }
}



function addInputListeners(id) {
    const inputs = document.querySelectorAll(`#${id} input`);
    inputs.forEach(input => {
    input.addEventListener('change', create_shapes);
    });

}


function zoomOut() {
    zoomLevel /= zoomFactor;

    //clearAndDrawGrid();
    create_shapes();

}

function zoomIn() {
    zoomLevel *= zoomFactor;

    //clearAndDrawGrid();
    create_shapes();

}


let zoomLevel = 1;
const zoomFactor = 1.1; // Adjust this value to control zoom speed

var offsetXX;
var offsetYY;
var scale;

function drawShapes(rectangles, circles) {

    
    //context_structure_complexe.scale(1, 100/60);
    context_structure_complexe.clearRect(0, 0, canvas_structure_complexe.width, canvas_structure_complexe.height);
    //const rangeX = maxX - minX;
    //const rangeY = (maxY - minY);
    //const stepX = rangeX / 20;
    //const stepY = rangeY / 20;

    context_structure_complexe.save();
    //context_structure_complexe.scale(1, 100/60);
    minX = Math.min(...rectangles.map(r => r.x - r.L / 2 - 3 * r.H), ...circles.map(c => c.x - c.r - 3 * c.H));
    minY = Math.min(...rectangles.map(r => r.y - r.W / 2 - 3 * r.H), ...circles.map(c => c.y - c.r - 3 * c.H));
    maxX = Math.max(...rectangles.map(r => r.x + r.L / 2 + 3 * r.H), ...circles.map(c => c.x + c.r + 3 * c.H));
    maxY = Math.max(...rectangles.map(r => r.y + r.W / 2 + 3 * r.H), ...circles.map(c => c.y + c.r + 3 * c.H));
    Ha=Math.min(...rectangles.map(r => r.H), ...circles.map(c => c.H));

    const shapesWidth = maxX - minX;
    const shapesHeight = maxY - minY;
    const scaleX = canvas_structure_complexe.width / shapesWidth;
    const scaleY = canvas_structure_complexe.height / shapesHeight;
    scale = Math.min(scaleX, scaleY);
    const offsetX = (minX + maxX) / 2;
    const offsetY = (minY + maxY) / 2;

    offsetXX=offsetX;
    offsetYY=offsetY;
        
    context_structure_complexe.translate(canvas_structure_complexe.width / 2, canvas_structure_complexe.height / 2);
    context_structure_complexe.scale(scale*60/100, scale); // Inverser Y pour correspondre au système de coordonnées
    context_structure_complexe.translate(-offsetX, offsetY);
    
    

    //context_structure_complexe.scale(1, 100/60);
    //context_structure_complexe.scale(zoomLevel, zoomLevel);
        
    rectangles.forEach((rect) => {
        context_structure_complexe.fillStyle = 'rgba(255, 0, 0, 0.3)';
        context_structure_complexe.fillRect(rect.x - rect.L / 2 - 3 * rect.H, -rect.y - rect.W / 2, rect.L + 6 * rect.H, rect.W);
        context_structure_complexe.fillRect(rect.x - rect.L / 2, -rect.y - rect.W / 2 - 3 * rect.H, rect.L, rect.W + 6 * rect.H);

        context_structure_complexe.beginPath();
        context_structure_complexe.moveTo(rect.x - rect.L / 2, -rect.y - rect.W / 2); // Move to the center of the circle
        context_structure_complexe.arc(rect.x - rect.L / 2, -rect.y - rect.W / 2, 3*rect.H, Math.PI, 3*Math.PI / 2); // Draw an arc from 0 to π/2 radians (90 degrees)
        context_structure_complexe.closePath(); // Close the path to form a triangle with the center
        context_structure_complexe.fill();

        context_structure_complexe.beginPath();
        context_structure_complexe.moveTo(rect.x - rect.L / 2, -rect.y + rect.W / 2); // Move to the center of the circle
        context_structure_complexe.arc(rect.x - rect.L / 2, -rect.y + rect.W / 2, 3*rect.H, Math.PI/2, Math.PI); // Draw an arc from 0 to π/2 radians (90 degrees)
        context_structure_complexe.closePath(); // Close the path to form a triangle with the center
        context_structure_complexe.fill();

        context_structure_complexe.beginPath();
        context_structure_complexe.moveTo(rect.x + rect.L / 2, -rect.y - rect.W / 2); // Move to the center of the circle
        context_structure_complexe.arc(rect.x + rect.L / 2, -rect.y - rect.W / 2, 3*rect.H, 3*Math.PI/2, 0); // Draw an arc from 0 to π/2 radians (90 degrees)
        context_structure_complexe.closePath(); // Close the path to form a triangle with the center
        context_structure_complexe.fill();

        context_structure_complexe.beginPath();
        context_structure_complexe.moveTo(rect.x + rect.L / 2, -rect.y + rect.W / 2); // Move to the center of the circle
        context_structure_complexe.arc(rect.x + rect.L / 2, -rect.y + rect.W / 2, 3*rect.H, 0, Math.PI/2); // Draw an arc from 0 to π/2 radians (90 degrees)
        context_structure_complexe.closePath(); // Close the path to form a triangle with the center
        context_structure_complexe.fill();

        context_structure_complexe.fillStyle = rect.Color;//'rgba(0, 0, 0, 1)';
        context_structure_complexe.fillRect(rect.x - rect.L / 2, -rect.y - rect.W / 2, rect.L, rect.W);
    });

    circles.forEach((circle) => {
        context_structure_complexe.fillStyle = 'rgba(255, 0, 0, 0.3)';
        context_structure_complexe.beginPath();
        context_structure_complexe.arc(circle.x, -circle.y, circle.r + 3 * circle.H, 0, Math.PI * 2);
        context_structure_complexe.fill();

        context_structure_complexe.fillStyle = circle.Color;//'rgba(0, 0, 0, 1)';
        context_structure_complexe.beginPath();
        context_structure_complexe.arc(circle.x, -circle.y, circle.r, 0, Math.PI * 2);
        context_structure_complexe.fill();
    });
    
    context_structure_complexe.restore();
        
}





function create_shapes() {

    

    const rectangles = [];
    for (let i = 1; i <= rectangleCount; i++) {
        const rectElem = document.getElementById(`rect${i}`);
        if (rectElem) {
            const x = parseFloat(document.getElementById(`rect${i}x`).value);
            const y = parseFloat(document.getElementById(`rect${i}y`).value);
            const L = parseFloat(document.getElementById(`rect${i}L`).value);
            const W = parseFloat(document.getElementById(`rect${i}W`).value);
            const H = parseFloat(document.getElementById(`rect${i}H`).value);
            const Color=document.getElementById(`rect${i}Color`).value;
            rectangles.push({ x, y, L, W, H, Color });
            
        } 
    }
    
    const circles = [];
        for (let i = 1; i <= circleCount; i++) {
            const circleElem = document.getElementById(`circle${i}`);
            if (circleElem) {
                const x = parseFloat(document.getElementById(`circle${i}x`).value);
                const y = parseFloat(document.getElementById(`circle${i}y`).value);
                const r = parseFloat(document.getElementById(`circle${i}r`).value);
                const H = parseFloat(document.getElementById(`circle${i}H`).value);
                const Color=document.getElementById(`circle${i}Color`).value;
                circles.push({ x, y, r, H, Color });

            }
                
 
        }

        



    //clearAndDrawGrid(minX, minY, maxX, maxY);
    drawShapes(rectangles, circles);
    calcul_Ad(rectangles, circles);
    calcul_Am(rectangles, circles);


}

async function calcul_Ad(rectangles, circles) {


    const response = await fetch('/calcul_AD_structure_complexe', {
    method: 'POST',
    headers: {
    'Content-Type': 'application/json'
    },
    body: JSON.stringify({rectangles, circles})
    });
 
    // Attend la réponse du serveur
    const result = await response.json();

    coveredArea = result.coveredArea;


    document.getElementById('resultat_structure_complexe_Ad').innerHTML = `Ad (m<sup>2</sup>): ${coveredArea.toFixed(2)}`;

    Add=coveredArea;

}

async function calcul_Am(rectangles, circles) {


    //var a=false;
    //var b=false;

    const Aii=offset;

    const response = await fetch('/calcul_AM_structure_complexe', {
    method: 'POST',
    headers: {
    'Content-Type': 'application/json'
    },
    body: JSON.stringify({rectangles, circles,Aii})
    });
 
    // Attend la réponse du serveur
    const result = await response.json();

    coveredArea = result.coveredArea;


    document.getElementById('resultat_structure_complexe_Am').innerHTML = `Am (m<sup>2</sup>): ${coveredArea.toFixed(2)}`;

    Amm=coveredArea;



}



//window.addEventListener('DOMContentLoaded', () => {
//clearAndDrawGrid(-400, -400, 400, 400);
//});



function adjustCanvasSize() {
    
            const devicePixelRatio = window.devicePixelRatio || 1;
            
            canvas_structure_complexe.width = window.innerWidth * devicePixelRatio;
            canvas_structure_complexe.height = window.innerHeight * devicePixelRatio;
            
            canvas_structure_complexe.style.width = window.innerWidth + 'px';
            canvas_structure_complexe.style.height = window.innerHeight + 'px';
           
            context_structure_complexe.scale(devicePixelRatio, devicePixelRatio); // Adjust drawing to maintain the correct scale

            context_structure_complexe.setTransform(1, 0, 0, 1, 0, 0); // Reset any existing transformations

            //context_structure_complexe.clearRect(0, 0, canvas_structure_complexe.width, canvas_structure_complexe.height); // Clear canvas

            create_shapes();
        }

        window.addEventListener('resize', adjustCanvasSize);
        window.addEventListener('load', adjustCanvasSize);




        //drawShapes();

////////////////////////////////////////////////////////////


    const labels = ['RA', 'RB', 'RC', 'RM', 'RU', 'RV', 'RW', 'RZ', 'R1','RT'];

    // Bar chart configuration
    const ctx1 = document.getElementById('chart1').getContext('2d');
    const chart1 = new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
               label: '',
                data: Risque_R1_S,
                backgroundColor: [
                    'rgba(0, 0, 255)',
                    'rgba(0, 128, 0)',
                    'rgba(0, 255, 0)',
                    'rgba(255, 140, 0)',
                    'rgba(255, 255, 0)',
                    'rgba(128, 0, 0)',
                    'rgba(255, 0, 255)',
                    'rgba(0, 255, 255)',
                    'rgba(0, 0, 0)',
                    'rgba(255, 0, 0)'


                ],
                borderColor: [
                'rgba(0, 0, 255)',
                    'rgba(0, 128, 0)',
                    'rgba(0, 255, 0)',
                    'rgba(255, 140, 0)',
                    'rgba(255, 255, 0)',
                    'rgba(128, 0, 0)',
                    'rgba(255, 0, 255)',
                    'rgba(0, 255, 255)',
                    'rgba(0, 0, 0)',
                    'rgba(255, 0, 0)'

                ],
                borderWidth: 1
            }]
        },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                ticks: {
                    stepSize: 1e-5,
                    callback: function(value) {
                        return value.toExponential(1).replace('e', 'E'); // Format the y-axis labels in scientific notation with E
                    }
                }
            }
        },
        plugins: {
            legend: {
                display: false,
                position: 'top'
            },

            tooltip: {
                    callbacks: {
                        label: function(context) {
                            const value = context.raw;
                            return `Valeur: ${(value * 1e5).toFixed(2)}E-5`; // Format the tooltip values in scientific notation with exponent -5
                        }
                    }
                },
        

            title: {
                display: true,
                text: 'Risque R1 sans mesures de protection', // Replace with your desired title
                font: {
                    size: 16 // Adjust the font size as needed
                },

            }

        }
    }
    });
 
    // Bar chart configuration
    const ctx2 = document.getElementById('chart2').getContext('2d');
    const chart2 = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
               label: '',
                data: Risque_R1_A,
                backgroundColor: [
                'rgba(0, 0, 255)',
                    'rgba(0, 128, 0)',
                    'rgba(0, 255, 0)',
                    'rgba(255, 140, 0)',
                    'rgba(255, 255, 0)',
                    'rgba(128, 0, 0)',
                    'rgba(255, 0, 255)',
                    'rgba(0, 255, 255)',
                    'rgba(0, 0, 0)',
                    'rgba(255, 0, 0)'


                ],
                borderColor: [
                'rgba(0, 0, 255)',
                    'rgba(0, 128, 0)',
                    'rgba(0, 255, 0)',
                    'rgba(255, 140, 0)',
                    'rgba(255, 255, 0)',
                    'rgba(128, 0, 0)',
                    'rgba(255, 0, 255)',
                    'rgba(0, 255, 255)',
                    'rgba(0, 0, 0)',
                    'rgba(255, 0, 0)'

                ],
                borderWidth: 1
            }]
        },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                ticks: {
                    stepSize: 1e-5,
                    callback: function(value) {
                        return value.toExponential(1).replace('e', 'E'); // Format the y-axis labels in scientific notation with E
                    }
                }
            }
        },
        
        plugins: {
            legend: {
                display: false,
                position: 'top'
            
        },

        tooltip: {
                    callbacks: {
                        label: function(context) {
                            const value = context.raw;
                            return `Valeur: ${(value * 1e5).toFixed(2)}E-5`; // Format the tooltip values in scientific notation with exponent -5
                        }
                    }
        },

        title: {
                display: true,
                text: 'Risque R1 avec mesures de protection', // Replace with your desired title
                font: {
                    size: 16 // Adjust the font size as needed
                },

            }

        }

    }
});



// Function to update charts dynamically
async function updateResults() {





    const selectedCheckboxes = document.getElementById('checkbox-container').querySelectorAll('input[type="checkbox"]');
    const checkboxes = Array.from(selectedCheckboxes)
    .filter(checkbox => checkbox.checked)
    .map(checkbox => ({
        name: checkbox.name,    // Inclure le nom
        value: checkbox.value   // Optionnel : inclure la valeur
    }));


    const options1 = document.getElementById('dropdown-menu-zone').options;
    const options = Array.from(options1).map(option => ({
        value: option.value,
        text: option.text,
        selected: option.selected // Facultatif, si vous voulez aussi savoir lesquelles sont sélectionnées
    }));



    // Envoie une requête POST au serveur Node.js
    const response = await fetch('/updateResults_arf2', {
    method: 'POST',
    headers: {
    'Content-Type': 'application/json'
    },
    body: JSON.stringify({Ng,Ad,Am,Cd,PB,PBA,KS1,KS1A,checkboxes,zoneData,zoneDataA,zoneDatafloatA,zoneDatafloat,lineData,lineDataA,options,selected_lines})
    });

   
   // body: JSON.stringify({Ng,Ad,Am,Nm,Cd,offset,Ha,RAS,RAA,RBS,RBA,RCS,RCA,RMS,RMA,RUS,RUA,RVS,RVA,RWS,RWA,RZS,RZA,R1S,R1A,checkboxes,zoneData,zoneDatafloat,lineData,lineData,options})

    // Attend la réponse du serveur
    const result = await response.json();

    RAS = result.RAS;
    RBS = result.RBS;
    RCS = result.RCS;
    RMS = result.RMS;
    RUS = result.RUS;
    RVS = result.RVS;
    RWS = result.RWS;
    RZS = result.RZS;
    RAA = result.RAA;
    RBA = result.RBA;
    RCA = result.RCA;
    RMA = result.RMA;
    RUA = result.RUA;
    RVA = result.RVA;
    RWA = result.RWA;
    RZA = result.RZA;

    zoneData = result.zoneData;
    zoneDataA = result.zoneDataA;
    lineData = result.lineData;
    lineDataA = result.lineDataA;

    
    //const courantpartielgaleriekta2206 = result.courantpartielgaleriekta2206;

        R1S=RAS+RBS+RCS+RMS+RUS+RVS+RWS+RZS;

        R1A=RAA+RBA+RCA+RMA+RUA+RVA+RWA+RZA;

        const formattedResultS = (R1S *1e5).toFixed(2) + 'E-5';
        const formattedResultA = (R1A *1e5).toFixed(2) + 'E-5';

        Risque_R1_S=[RAS,RBS,RCS,RMS,RUS,RVS,RWS,RZS,R1S,RT];
        Risque_R1_A=[RAA,RBA,RCA,RMA,RUA,RVA,RWA,RZA,R1A,RT];
 
        chart1.data.datasets[0].data = Risque_R1_S;
        chart1.update();

        chart2.data.datasets[0].data = Risque_R1_A;
        chart2.update();


        if (R1S>1e-5) {

            document.getElementById('resultat-R1-smp').textContent = `R1=${formattedResultS} - Structure non protégée`;
            document.getElementById('resultat-R1-smp').className='result_button_np';
            document.getElementById('input-resulat-smp').className='title_result_amp_smp_np';



        } else if (R1S<=1e-5 && R1S>0.0) {
            
            document.getElementById('resultat-R1-smp').textContent = `R1=${formattedResultS} - Structure autoprotégée`;
            document.getElementById('resultat-R1-smp').className='result_button';
            document.getElementById('input-resulat-smp').className='title_result_amp_smp_p';

        } else if (R1S===0.0) {

            document.getElementById('resultat-R1-smp').textContent = ``;
            document.getElementById('resultat-R1-smp').className='result_button_gray';
            document.getElementById('input-resulat-smp').className='title_result_amp_smp_gr';

        }

        if (R1A>1e-5) {

            document.getElementById('resultat-R1-amp').textContent = `R1=${formattedResultA} - Structure non protégée`;
            document.getElementById('resultat-R1-amp').className='result_button_np';
            document.getElementById('input-resulat-amp').className='title_result_amp_smp_np';


        } else if (R1A<=1e-5 && R1A>0.0) {
            
            document.getElementById('resultat-R1-amp').textContent = `R1=${formattedResultA} - Structure protégée`;
            document.getElementById('resultat-R1-amp').className='result_button';
            document.getElementById('input-resulat-amp').className='title_result_amp_smp_p';


        } else if (R1A===0.0) {

            document.getElementById('resultat-R1-amp').textContent = ``;
            document.getElementById('resultat-R1-amp').className='result_button_gray';
            document.getElementById('input-resulat-amp').className='title_result_amp_smp_gr';

        }

        






    }


</script>




</body>
</html>
